var xy=Object.defineProperty;var gy=(t,s,r)=>s in t?xy(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var Zi=(t,s,r)=>gy(t,typeof s!="symbol"?s+"":s,r);import{r as x,j as e,b as ue,u as De,d as Xe,e as dt,c as Qu,g as vy,f as Mn,Q as yy,h as jy}from"./query-DHmRvZhP.js";import{r as Bo,R as by,u as Rn,N as ea,a as Ut,L as xt,b as Dn,B as wy,c as Ny,d as Le}from"./vendor-Bm9faeb9.js";import{P as ht,u as Ht,B as _y,a as ra,b as Lr,c as st,d as yr,e as rh,R as ky,f as wr,g as Gc,h as mr,i as Cy,D as Qc,C as Xc,j as En,k as ah,l as In,m as Jc,A as $o,n as Zc,S as Sy,o as nh,p as ih,q as Ay,r as oh,I as lh,s as ch,t as dh,v as uh,L as mh,w as hh,x as Ty,T as Py,O as Uo,y as ed,z as Ho,E as td,F as Vo,G as Ko,H as sd,J as ph,K as fh,M as xh,N as gh,Q as vh,U as yh,V as rd,W as ad,X as jh,Y as bh,Z as wh,_ as My,$ as Ry,a0 as Nh,a1 as Dy,a2 as Ey,a3 as _h}from"./ui-zIe2N_n5.js";import{c as kh,R as Iy,L as Oy,C as Fy,X as Ly,Y as qy,T as zy,a as By}from"./charts-C9xPG8vo.js";import{c as $y}from"./supabase-bJh-9NuP.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var Ch,Xu=Bo;Ch=Xu.createRoot,Xu.hydrateRoot;const Uy=1,Hy=1e6;let Vl=0;function Vy(){return Vl=(Vl+1)%Number.MAX_SAFE_INTEGER,Vl.toString()}const Kl=new Map,Ju=t=>{if(Kl.has(t))return;const s=setTimeout(()=>{Kl.delete(t),oi({type:"REMOVE_TOAST",toastId:t})},Hy);Kl.set(t,s)},Ky=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,Uy)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(r=>r.id===s.toast.id?{...r,...s.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=s;return r?Ju(r):t.toasts.forEach(a=>{Ju(a.id)}),{...t,toasts:t.toasts.map(a=>a.id===r||r===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(r=>r.id!==s.toastId)}}},fo=[];let xo={toasts:[]};function oi(t){xo=Ky(xo,t),fo.forEach(s=>{s(xo)})}function Wy({...t}){const s=Vy(),r=n=>oi({type:"UPDATE_TOAST",toast:{...n,id:s}}),a=()=>oi({type:"DISMISS_TOAST",toastId:s});return oi({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:n=>{n||a()}}}),{id:s,dismiss:a,update:r}}function hs(){const[t,s]=x.useState(xo);return x.useEffect(()=>(fo.push(s),()=>{const r=fo.indexOf(s);r>-1&&fo.splice(r,1)}),[t]),{...t,toast:Wy,dismiss:r=>oi({type:"DISMISS_TOAST",toastId:r})}}var Sh=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Yy="VisuallyHidden",Wo=x.forwardRef((t,s)=>e.jsx(ht.span,{...t,ref:s,style:{...Sh,...t.style}}));Wo.displayName=Yy;var Gy=Wo,nd="ToastProvider",[id,Qy,Xy]=rh("Toast"),[Ah]=wr("Toast",[Xy]),[Jy,Yo]=Ah(nd),Th=t=>{const{__scopeToast:s,label:r="Notification",duration:a=5e3,swipeDirection:n="right",swipeThreshold:i=50,children:o}=t,[c,l]=x.useState(null),[u,d]=x.useState(0),p=x.useRef(!1),h=x.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${nd}\`. Expected non-empty \`string\`.`),e.jsx(id.Provider,{scope:s,children:e.jsx(Jy,{scope:s,label:r,duration:a,swipeDirection:n,swipeThreshold:i,toastCount:u,viewport:c,onViewportChange:l,onToastAdd:x.useCallback(()=>d(f=>f+1),[]),onToastRemove:x.useCallback(()=>d(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:p,isClosePausedRef:h,children:o})})};Th.displayName=nd;var Ph="ToastViewport",Zy=["F8"],jc="toast.viewportPause",bc="toast.viewportResume",Mh=x.forwardRef((t,s)=>{const{__scopeToast:r,hotkey:a=Zy,label:n="Notifications ({hotkey})",...i}=t,o=Yo(Ph,r),c=Qy(r),l=x.useRef(null),u=x.useRef(null),d=x.useRef(null),p=x.useRef(null),h=Ht(s,p,o.onViewportChange),f=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),y=o.toastCount>0;x.useEffect(()=>{const b=N=>{a.length!==0&&a.every(j=>N[j]||N.code===j)&&p.current?.focus()};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[a]),x.useEffect(()=>{const b=l.current,N=p.current;if(y&&b&&N){const A=()=>{if(!o.isClosePausedRef.current){const k=new CustomEvent(jc);N.dispatchEvent(k),o.isClosePausedRef.current=!0}},j=()=>{if(o.isClosePausedRef.current){const k=new CustomEvent(bc);N.dispatchEvent(k),o.isClosePausedRef.current=!1}},C=k=>{!b.contains(k.relatedTarget)&&j()},I=()=>{b.contains(document.activeElement)||j()};return b.addEventListener("focusin",A),b.addEventListener("focusout",C),b.addEventListener("pointermove",A),b.addEventListener("pointerleave",I),window.addEventListener("blur",A),window.addEventListener("focus",j),()=>{b.removeEventListener("focusin",A),b.removeEventListener("focusout",C),b.removeEventListener("pointermove",A),b.removeEventListener("pointerleave",I),window.removeEventListener("blur",A),window.removeEventListener("focus",j)}}},[y,o.isClosePausedRef]);const v=x.useCallback(({tabbingDirection:b})=>{const A=c().map(j=>{const C=j.ref.current,I=[C,...mj(C)];return b==="forwards"?I:I.reverse()});return(b==="forwards"?A.reverse():A).flat()},[c]);return x.useEffect(()=>{const b=p.current;if(b){const N=A=>{const j=A.altKey||A.ctrlKey||A.metaKey;if(A.key==="Tab"&&!j){const I=document.activeElement,k=A.shiftKey;if(A.target===b&&k){u.current?.focus();return}const T=v({tabbingDirection:k?"backwards":"forwards"}),E=T.findIndex(D=>D===I);Wl(T.slice(E+1))?A.preventDefault():k?u.current?.focus():d.current?.focus()}};return b.addEventListener("keydown",N),()=>b.removeEventListener("keydown",N)}},[c,v]),e.jsxs(_y,{ref:l,role:"region","aria-label":n.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:y?void 0:"none"},children:[y&&e.jsx(wc,{ref:u,onFocusFromOutsideViewport:()=>{const b=v({tabbingDirection:"forwards"});Wl(b)}}),e.jsx(id.Slot,{scope:r,children:e.jsx(ht.ol,{tabIndex:-1,...i,ref:h})}),y&&e.jsx(wc,{ref:d,onFocusFromOutsideViewport:()=>{const b=v({tabbingDirection:"backwards"});Wl(b)}})]})});Mh.displayName=Ph;var Rh="ToastFocusProxy",wc=x.forwardRef((t,s)=>{const{__scopeToast:r,onFocusFromOutsideViewport:a,...n}=t,i=Yo(Rh,r);return e.jsx(Wo,{"aria-hidden":!0,tabIndex:0,...n,ref:s,style:{position:"fixed"},onFocus:o=>{const c=o.relatedTarget;!i.viewport?.contains(c)&&a()}})});wc.displayName=Rh;var vi="Toast",ej="toast.swipeStart",tj="toast.swipeMove",sj="toast.swipeCancel",rj="toast.swipeEnd",Dh=x.forwardRef((t,s)=>{const{forceMount:r,open:a,defaultOpen:n,onOpenChange:i,...o}=t,[c,l]=ra({prop:a,defaultProp:n??!0,onChange:i,caller:vi});return e.jsx(Lr,{present:r||c,children:e.jsx(ij,{open:c,...o,ref:s,onClose:()=>l(!1),onPause:yr(t.onPause),onResume:yr(t.onResume),onSwipeStart:st(t.onSwipeStart,u=>{u.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:st(t.onSwipeMove,u=>{const{x:d,y:p}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","move"),u.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${p}px`)}),onSwipeCancel:st(t.onSwipeCancel,u=>{u.currentTarget.setAttribute("data-swipe","cancel"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:st(t.onSwipeEnd,u=>{const{x:d,y:p}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","end"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${p}px`),l(!1)})})})});Dh.displayName=vi;var[aj,nj]=Ah(vi,{onClose(){}}),ij=x.forwardRef((t,s)=>{const{__scopeToast:r,type:a="foreground",duration:n,open:i,onClose:o,onEscapeKeyDown:c,onPause:l,onResume:u,onSwipeStart:d,onSwipeMove:p,onSwipeCancel:h,onSwipeEnd:f,...y}=t,v=Yo(vi,r),[b,N]=x.useState(null),A=Ht(s,q=>N(q)),j=x.useRef(null),C=x.useRef(null),I=n||v.duration,k=x.useRef(0),R=x.useRef(I),S=x.useRef(0),{onToastAdd:T,onToastRemove:E}=v,D=yr(()=>{b?.contains(document.activeElement)&&v.viewport?.focus(),o()}),F=x.useCallback(q=>{!q||q===1/0||(window.clearTimeout(S.current),k.current=new Date().getTime(),S.current=window.setTimeout(D,q))},[D]);x.useEffect(()=>{const q=v.viewport;if(q){const B=()=>{F(R.current),u?.()},L=()=>{const P=new Date().getTime()-k.current;R.current=R.current-P,window.clearTimeout(S.current),l?.()};return q.addEventListener(jc,L),q.addEventListener(bc,B),()=>{q.removeEventListener(jc,L),q.removeEventListener(bc,B)}}},[v.viewport,I,l,u,F]),x.useEffect(()=>{i&&!v.isClosePausedRef.current&&F(I)},[i,I,v.isClosePausedRef,F]),x.useEffect(()=>(T(),()=>E()),[T,E]);const H=x.useMemo(()=>b?zh(b):null,[b]);return v.viewport?e.jsxs(e.Fragment,{children:[H&&e.jsx(oj,{__scopeToast:r,role:"status","aria-live":a==="foreground"?"assertive":"polite","aria-atomic":!0,children:H}),e.jsx(aj,{scope:r,onClose:D,children:Bo.createPortal(e.jsx(id.ItemSlot,{scope:r,children:e.jsx(ky,{asChild:!0,onEscapeKeyDown:st(c,()=>{v.isFocusedToastEscapeKeyDownRef.current||D(),v.isFocusedToastEscapeKeyDownRef.current=!1}),children:e.jsx(ht.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":v.swipeDirection,...y,ref:A,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:st(t.onKeyDown,q=>{q.key==="Escape"&&(c?.(q.nativeEvent),q.nativeEvent.defaultPrevented||(v.isFocusedToastEscapeKeyDownRef.current=!0,D()))}),onPointerDown:st(t.onPointerDown,q=>{q.button===0&&(j.current={x:q.clientX,y:q.clientY})}),onPointerMove:st(t.onPointerMove,q=>{if(!j.current)return;const B=q.clientX-j.current.x,L=q.clientY-j.current.y,P=!!C.current,K=["left","right"].includes(v.swipeDirection),$=["left","up"].includes(v.swipeDirection)?Math.min:Math.max,se=K?$(0,B):0,ne=K?0:$(0,L),Y=q.pointerType==="touch"?10:2,fe={x:se,y:ne},me={originalEvent:q,delta:fe};P?(C.current=fe,eo(tj,p,me,{discrete:!1})):Zu(fe,v.swipeDirection,Y)?(C.current=fe,eo(ej,d,me,{discrete:!1}),q.target.setPointerCapture(q.pointerId)):(Math.abs(B)>Y||Math.abs(L)>Y)&&(j.current=null)}),onPointerUp:st(t.onPointerUp,q=>{const B=C.current,L=q.target;if(L.hasPointerCapture(q.pointerId)&&L.releasePointerCapture(q.pointerId),C.current=null,j.current=null,B){const P=q.currentTarget,K={originalEvent:q,delta:B};Zu(B,v.swipeDirection,v.swipeThreshold)?eo(rj,f,K,{discrete:!0}):eo(sj,h,K,{discrete:!0}),P.addEventListener("click",$=>$.preventDefault(),{once:!0})}})})})}),v.viewport)})]}):null}),oj=t=>{const{__scopeToast:s,children:r,...a}=t,n=Yo(vi,s),[i,o]=x.useState(!1),[c,l]=x.useState(!1);return dj(()=>o(!0)),x.useEffect(()=>{const u=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(u)},[]),c?null:e.jsx(Gc,{asChild:!0,children:e.jsx(Wo,{...a,children:i&&e.jsxs(e.Fragment,{children:[n.label," ",r]})})})},lj="ToastTitle",Eh=x.forwardRef((t,s)=>{const{__scopeToast:r,...a}=t;return e.jsx(ht.div,{...a,ref:s})});Eh.displayName=lj;var cj="ToastDescription",Ih=x.forwardRef((t,s)=>{const{__scopeToast:r,...a}=t;return e.jsx(ht.div,{...a,ref:s})});Ih.displayName=cj;var Oh="ToastAction",Fh=x.forwardRef((t,s)=>{const{altText:r,...a}=t;return r.trim()?e.jsx(qh,{altText:r,asChild:!0,children:e.jsx(od,{...a,ref:s})}):(console.error(`Invalid prop \`altText\` supplied to \`${Oh}\`. Expected non-empty \`string\`.`),null)});Fh.displayName=Oh;var Lh="ToastClose",od=x.forwardRef((t,s)=>{const{__scopeToast:r,...a}=t,n=nj(Lh,r);return e.jsx(qh,{asChild:!0,children:e.jsx(ht.button,{type:"button",...a,ref:s,onClick:st(t.onClick,n.onClose)})})});od.displayName=Lh;var qh=x.forwardRef((t,s)=>{const{__scopeToast:r,altText:a,...n}=t;return e.jsx(ht.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0,...n,ref:s})});function zh(t){const s=[];return Array.from(t.childNodes).forEach(a=>{if(a.nodeType===a.TEXT_NODE&&a.textContent&&s.push(a.textContent),uj(a)){const n=a.ariaHidden||a.hidden||a.style.display==="none",i=a.dataset.radixToastAnnounceExclude==="";if(!n)if(i){const o=a.dataset.radixToastAnnounceAlt;o&&s.push(o)}else s.push(...zh(a))}}),s}function eo(t,s,r,{discrete:a}){const n=r.originalEvent.currentTarget,i=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:r});s&&n.addEventListener(t,s,{once:!0}),a?Cy(n,i):n.dispatchEvent(i)}var Zu=(t,s,r=0)=>{const a=Math.abs(t.x),n=Math.abs(t.y),i=a>n;return s==="left"||s==="right"?i&&a>r:!i&&n>r};function dj(t=()=>{}){const s=yr(t);mr(()=>{let r=0,a=0;return r=window.requestAnimationFrame(()=>a=window.requestAnimationFrame(s)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(a)}},[s])}function uj(t){return t.nodeType===t.ELEMENT_NODE}function mj(t){const s=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const n=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||n?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)s.push(r.currentNode);return s}function Wl(t){const s=document.activeElement;return t.some(r=>r===s?!0:(r.focus(),document.activeElement!==s))}var hj=Th,Bh=Mh,$h=Dh,Uh=Eh,Hh=Ih,Vh=Fh,Kh=od;const em=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,tm=kh,yi=(t,s)=>r=>{var a;if(s?.variants==null)return tm(t,r?.class,r?.className);const{variants:n,defaultVariants:i}=s,o=Object.keys(n).map(u=>{const d=r?.[u],p=i?.[u];if(d===null)return null;const h=em(d)||em(p);return n[u][h]}),c=r&&Object.entries(r).reduce((u,d)=>{let[p,h]=d;return h===void 0||(u[p]=h),u},{}),l=s==null||(a=s.compoundVariants)===null||a===void 0?void 0:a.reduce((u,d)=>{let{class:p,className:h,...f}=d;return Object.entries(f).every(y=>{let[v,b]=y;return Array.isArray(b)?b.includes({...i,...c}[v]):{...i,...c}[v]===b})?[...u,p,h]:u},[]);return tm(t,o,l,r?.class,r?.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pj=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Wh=(...t)=>t.filter((s,r,a)=>!!s&&s.trim()!==""&&a.indexOf(s)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var fj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xj=x.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:n="",children:i,iconNode:o,...c},l)=>x.createElement("svg",{ref:l,...fj,width:s,height:s,stroke:t,strokeWidth:a?Number(r)*24/Number(s):r,className:Wh("lucide",n),...c},[...o.map(([u,d])=>x.createElement(u,d)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=(t,s)=>{const r=x.forwardRef(({className:a,...n},i)=>x.createElement(xj,{ref:i,iconNode:s,className:Wh(`lucide-${pj(t)}`,a),...n}));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=ve("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yh=ve("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=ve("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=ve("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gj=ve("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vj=ve("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yj=ve("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=ve("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jj=ve("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ni=ve("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=ve("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bj=ve("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gh=ve("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qh=ve("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xh=ve("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=ve("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=ve("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=ve("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=ve("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wj=ve("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=ve("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=ve("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jh=ve("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=ve("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ld=ve("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=ve("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=ve("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=ve("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cd=ve("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nj=ve("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=ve("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zh=ve("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=ve("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=ve("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _j=ve("CloudDrizzle",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M8 19v1",key:"1dk2by"}],["path",{d:"M8 14v1",key:"84yxot"}],["path",{d:"M16 19v1",key:"v220m7"}],["path",{d:"M16 14v1",key:"g12gj6"}],["path",{d:"M12 21v1",key:"q8vafk"}],["path",{d:"M12 16v1",key:"1mx6rx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kj=ve("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cj=ve("CloudRain",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sj=ve("CloudSnow",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M8 19h.01",key:"puxtts"}],["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M12 21h.01",key:"h35vbk"}],["path",{d:"M16 15h.01",key:"rnfrdf"}],["path",{d:"M16 19h.01",key:"1vcnzz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=ve("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nc=ve("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=ve("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=ve("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ui=ve("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=ve("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ep=ve("Earth",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17",key:"1tzkfa"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"14pb5j"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aj=ve("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=ve("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dd=ve("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=ve("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=ve("FileAudio",[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tp=ve("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=ve("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ud=ve("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tj=ve("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=ve("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pj=ve("Handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sp=ve("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mj=ve("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rj=ve("ImagePlus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=ve("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rp=ve("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=ve("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dj=ve("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=ve("LandPlot",[["path",{d:"m12 8 6-3-6-3v10",key:"mvpnpy"}],["path",{d:"m8 11.99-5.5 3.14a1 1 0 0 0 0 1.74l8.5 4.86a2 2 0 0 0 2 0l8.5-4.86a1 1 0 0 0 0-1.74L16 12",key:"ek95tt"}],["path",{d:"m6.49 12.85 11.02 6.3",key:"1kt42w"}],["path",{d:"M17.51 12.85 6.5 19.15",key:"v55bdg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ap=ve("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sm=ve("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=ve("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=ve("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=ve("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ej=ve("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const md=ve("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _o=ve("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hd=ve("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=ve("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const np=ve("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pd=ve("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qo=ve("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ip=ve("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xo=ve("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ko=ve("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const op=ve("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ij=ve("PackageCheck",[["path",{d:"m16 16 2 2 4-4",key:"gfu2re"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=ve("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oj=ve("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lp=ve("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=ve("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=ve("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=ve("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hi=ve("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fj=ve("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=ve("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rm=ve("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const am=ve("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=ve("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cp=ve("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dp=ve("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lj=ve("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=ve("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _c=ve("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=ve("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nm=ve("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=ve("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=ve("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=ve("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=ve("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=ve("Sprout",[["path",{d:"M7 20h10",key:"e6iznv"}],["path",{d:"M10 20c5.5-2.5.8-6.4 3-10",key:"161w41"}],["path",{d:"M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z",key:"9gtqwd"}],["path",{d:"M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z",key:"bkxnd2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ji=ve("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const im=ve("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qj=ve("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zj=ve("TestTubeDiagonal",[["path",{d:"M21 7 6.82 21.18a2.83 2.83 0 0 1-3.99-.01a2.83 2.83 0 0 1 0-4L17 3",key:"1ub6xw"}],["path",{d:"m16 2 6 6",key:"1gw87d"}],["path",{d:"M12 16H4",key:"1cjfip"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bj=ve("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $j=ve("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const up=ve("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=ve("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uj=ve("TreeDeciduous",[["path",{d:"M8 19a4 4 0 0 1-2.24-7.32A3.5 3.5 0 0 1 9 6.03V6a3 3 0 1 1 6 0v.04a3.5 3.5 0 0 1 3.24 5.65A4 4 0 0 1 16 19Z",key:"oadzkq"}],["path",{d:"M12 19v3",key:"npa21l"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kc=ve("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=ve("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=ve("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=ve("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pi=ve("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const om=ve("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cc=ve("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=ve("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=ve("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=ve("Wheat",[["path",{d:"M2 22 16 8",key:"60hf96"}],["path",{d:"M3.47 12.53 5 11l1.53 1.53a3.5 3.5 0 0 1 0 4.94L5 19l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"1rdhi6"}],["path",{d:"M7.47 8.53 9 7l1.53 1.53a3.5 3.5 0 0 1 0 4.94L9 15l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"1sdzmb"}],["path",{d:"M11.47 4.53 13 3l1.53 1.53a3.5 3.5 0 0 1 0 4.94L13 11l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"eoatbi"}],["path",{d:"M20 2h2v2a4 4 0 0 1-4 4h-2V6a4 4 0 0 1 4-4Z",key:"19rau1"}],["path",{d:"M11.47 17.47 13 19l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L5 19l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"tc8ph9"}],["path",{d:"M15.47 13.47 17 15l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L9 15l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"2m8kc5"}],["path",{d:"M19.47 9.47 21 11l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L13 11l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"vex3ng"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hj=ve("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vj=ve("Wind",[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=ve("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sc=ve("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kj=ve("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),fd="-",Wj=t=>{const s=Gj(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:a}=t;return{getClassGroupId:o=>{const c=o.split(fd);return c[0]===""&&c.length!==1&&c.shift(),mp(c,s)||Yj(o)},getConflictingClassGroupIds:(o,c)=>{const l=r[o]||[];return c&&a[o]?[...l,...a[o]]:l}}},mp=(t,s)=>{if(t.length===0)return s.classGroupId;const r=t[0],a=s.nextPart.get(r),n=a?mp(t.slice(1),a):void 0;if(n)return n;if(s.validators.length===0)return;const i=t.join(fd);return s.validators.find(({validator:o})=>o(i))?.classGroupId},lm=/^\[(.+)\]$/,Yj=t=>{if(lm.test(t)){const s=lm.exec(t)[1],r=s?.substring(0,s.indexOf(":"));if(r)return"arbitrary.."+r}},Gj=t=>{const{theme:s,prefix:r}=t,a={nextPart:new Map,validators:[]};return Xj(Object.entries(t.classGroups),r).forEach(([i,o])=>{Ac(o,a,i,s)}),a},Ac=(t,s,r,a)=>{t.forEach(n=>{if(typeof n=="string"){const i=n===""?s:cm(s,n);i.classGroupId=r;return}if(typeof n=="function"){if(Qj(n)){Ac(n(a),s,r,a);return}s.validators.push({validator:n,classGroupId:r});return}Object.entries(n).forEach(([i,o])=>{Ac(o,cm(s,i),r,a)})})},cm=(t,s)=>{let r=t;return s.split(fd).forEach(a=>{r.nextPart.has(a)||r.nextPart.set(a,{nextPart:new Map,validators:[]}),r=r.nextPart.get(a)}),r},Qj=t=>t.isThemeGetter,Xj=(t,s)=>s?t.map(([r,a])=>{const n=a.map(i=>typeof i=="string"?s+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,c])=>[s+o,c])):i);return[r,n]}):t,Jj=t=>{if(t<1)return{get:()=>{},set:()=>{}};let s=0,r=new Map,a=new Map;const n=(i,o)=>{r.set(i,o),s++,s>t&&(s=0,a=r,r=new Map)};return{get(i){let o=r.get(i);if(o!==void 0)return o;if((o=a.get(i))!==void 0)return n(i,o),o},set(i,o){r.has(i)?r.set(i,o):n(i,o)}}},hp="!",Zj=t=>{const{separator:s,experimentalParseClassName:r}=t,a=s.length===1,n=s[0],i=s.length,o=c=>{const l=[];let u=0,d=0,p;for(let b=0;b<c.length;b++){let N=c[b];if(u===0){if(N===n&&(a||c.slice(b,b+i)===s)){l.push(c.slice(d,b)),d=b+i;continue}if(N==="/"){p=b;continue}}N==="["?u++:N==="]"&&u--}const h=l.length===0?c:c.substring(d),f=h.startsWith(hp),y=f?h.substring(1):h,v=p&&p>d?p-d:void 0;return{modifiers:l,hasImportantModifier:f,baseClassName:y,maybePostfixModifierPosition:v}};return r?c=>r({className:c,parseClassName:o}):o},e0=t=>{if(t.length<=1)return t;const s=[];let r=[];return t.forEach(a=>{a[0]==="["?(s.push(...r.sort(),a),r=[]):r.push(a)}),s.push(...r.sort()),s},t0=t=>({cache:Jj(t.cacheSize),parseClassName:Zj(t),...Wj(t)}),s0=/\s+/,r0=(t,s)=>{const{parseClassName:r,getClassGroupId:a,getConflictingClassGroupIds:n}=s,i=[],o=t.trim().split(s0);let c="";for(let l=o.length-1;l>=0;l-=1){const u=o[l],{modifiers:d,hasImportantModifier:p,baseClassName:h,maybePostfixModifierPosition:f}=r(u);let y=!!f,v=a(y?h.substring(0,f):h);if(!v){if(!y){c=u+(c.length>0?" "+c:c);continue}if(v=a(h),!v){c=u+(c.length>0?" "+c:c);continue}y=!1}const b=e0(d).join(":"),N=p?b+hp:b,A=N+v;if(i.includes(A))continue;i.push(A);const j=n(v,y);for(let C=0;C<j.length;++C){const I=j[C];i.push(N+I)}c=u+(c.length>0?" "+c:c)}return c};function a0(){let t=0,s,r,a="";for(;t<arguments.length;)(s=arguments[t++])&&(r=pp(s))&&(a&&(a+=" "),a+=r);return a}const pp=t=>{if(typeof t=="string")return t;let s,r="";for(let a=0;a<t.length;a++)t[a]&&(s=pp(t[a]))&&(r&&(r+=" "),r+=s);return r};function n0(t,...s){let r,a,n,i=o;function o(l){const u=s.reduce((d,p)=>p(d),t());return r=t0(u),a=r.cache.get,n=r.cache.set,i=c,c(l)}function c(l){const u=a(l);if(u)return u;const d=r0(l,r);return n(l,d),d}return function(){return i(a0.apply(null,arguments))}}const os=t=>{const s=r=>r[t]||[];return s.isThemeGetter=!0,s},fp=/^\[(?:([a-z-]+):)?(.+)\]$/i,i0=/^\d+\/\d+$/,o0=new Set(["px","full","screen"]),l0=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,c0=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,d0=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,u0=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,m0=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Xr=t=>fn(t)||o0.has(t)||i0.test(t),ha=t=>On(t,"length",j0),fn=t=>!!t&&!Number.isNaN(Number(t)),Yl=t=>On(t,"number",fn),Jn=t=>!!t&&Number.isInteger(Number(t)),h0=t=>t.endsWith("%")&&fn(t.slice(0,-1)),vt=t=>fp.test(t),pa=t=>l0.test(t),p0=new Set(["length","size","percentage"]),f0=t=>On(t,p0,xp),x0=t=>On(t,"position",xp),g0=new Set(["image","url"]),v0=t=>On(t,g0,w0),y0=t=>On(t,"",b0),Zn=()=>!0,On=(t,s,r)=>{const a=fp.exec(t);return a?a[1]?typeof s=="string"?a[1]===s:s.has(a[1]):r(a[2]):!1},j0=t=>c0.test(t)&&!d0.test(t),xp=()=>!1,b0=t=>u0.test(t),w0=t=>m0.test(t),N0=()=>{const t=os("colors"),s=os("spacing"),r=os("blur"),a=os("brightness"),n=os("borderColor"),i=os("borderRadius"),o=os("borderSpacing"),c=os("borderWidth"),l=os("contrast"),u=os("grayscale"),d=os("hueRotate"),p=os("invert"),h=os("gap"),f=os("gradientColorStops"),y=os("gradientColorStopPositions"),v=os("inset"),b=os("margin"),N=os("opacity"),A=os("padding"),j=os("saturate"),C=os("scale"),I=os("sepia"),k=os("skew"),R=os("space"),S=os("translate"),T=()=>["auto","contain","none"],E=()=>["auto","hidden","clip","visible","scroll"],D=()=>["auto",vt,s],F=()=>[vt,s],H=()=>["",Xr,ha],q=()=>["auto",fn,vt],B=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],L=()=>["solid","dashed","dotted","double","none"],P=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],K=()=>["start","end","center","between","around","evenly","stretch"],$=()=>["","0",vt],se=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ne=()=>[fn,vt];return{cacheSize:500,separator:":",theme:{colors:[Zn],spacing:[Xr,ha],blur:["none","",pa,vt],brightness:ne(),borderColor:[t],borderRadius:["none","","full",pa,vt],borderSpacing:F(),borderWidth:H(),contrast:ne(),grayscale:$(),hueRotate:ne(),invert:$(),gap:F(),gradientColorStops:[t],gradientColorStopPositions:[h0,ha],inset:D(),margin:D(),opacity:ne(),padding:F(),saturate:ne(),scale:ne(),sepia:$(),skew:ne(),space:F(),translate:F()},classGroups:{aspect:[{aspect:["auto","square","video",vt]}],container:["container"],columns:[{columns:[pa]}],"break-after":[{"break-after":se()}],"break-before":[{"break-before":se()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...B(),vt]}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:T()}],"overscroll-x":[{"overscroll-x":T()}],"overscroll-y":[{"overscroll-y":T()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[v]}],"inset-x":[{"inset-x":[v]}],"inset-y":[{"inset-y":[v]}],start:[{start:[v]}],end:[{end:[v]}],top:[{top:[v]}],right:[{right:[v]}],bottom:[{bottom:[v]}],left:[{left:[v]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Jn,vt]}],basis:[{basis:D()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",vt]}],grow:[{grow:$()}],shrink:[{shrink:$()}],order:[{order:["first","last","none",Jn,vt]}],"grid-cols":[{"grid-cols":[Zn]}],"col-start-end":[{col:["auto",{span:["full",Jn,vt]},vt]}],"col-start":[{"col-start":q()}],"col-end":[{"col-end":q()}],"grid-rows":[{"grid-rows":[Zn]}],"row-start-end":[{row:["auto",{span:[Jn,vt]},vt]}],"row-start":[{"row-start":q()}],"row-end":[{"row-end":q()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",vt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",vt]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...K()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...K(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...K(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[A]}],px:[{px:[A]}],py:[{py:[A]}],ps:[{ps:[A]}],pe:[{pe:[A]}],pt:[{pt:[A]}],pr:[{pr:[A]}],pb:[{pb:[A]}],pl:[{pl:[A]}],m:[{m:[b]}],mx:[{mx:[b]}],my:[{my:[b]}],ms:[{ms:[b]}],me:[{me:[b]}],mt:[{mt:[b]}],mr:[{mr:[b]}],mb:[{mb:[b]}],ml:[{ml:[b]}],"space-x":[{"space-x":[R]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[R]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",vt,s]}],"min-w":[{"min-w":[vt,s,"min","max","fit"]}],"max-w":[{"max-w":[vt,s,"none","full","min","max","fit","prose",{screen:[pa]},pa]}],h:[{h:[vt,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[vt,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[vt,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[vt,s,"auto","min","max","fit"]}],"font-size":[{text:["base",pa,ha]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Yl]}],"font-family":[{font:[Zn]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",vt]}],"line-clamp":[{"line-clamp":["none",fn,Yl]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Xr,vt]}],"list-image":[{"list-image":["none",vt]}],"list-style-type":[{list:["none","disc","decimal",vt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[N]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[N]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...L(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Xr,ha]}],"underline-offset":[{"underline-offset":["auto",Xr,vt]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:F()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",vt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",vt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[N]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...B(),x0]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",f0]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},v0]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[N]}],"border-style":[{border:[...L(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[N]}],"divide-style":[{divide:L()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...L()]}],"outline-offset":[{"outline-offset":[Xr,vt]}],"outline-w":[{outline:[Xr,ha]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:H()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[N]}],"ring-offset-w":[{"ring-offset":[Xr,ha]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",pa,y0]}],"shadow-color":[{shadow:[Zn]}],opacity:[{opacity:[N]}],"mix-blend":[{"mix-blend":[...P(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":P()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[a]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",pa,vt]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[p]}],saturate:[{saturate:[j]}],sepia:[{sepia:[I]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[p]}],"backdrop-opacity":[{"backdrop-opacity":[N]}],"backdrop-saturate":[{"backdrop-saturate":[j]}],"backdrop-sepia":[{"backdrop-sepia":[I]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",vt]}],duration:[{duration:ne()}],ease:[{ease:["linear","in","out","in-out",vt]}],delay:[{delay:ne()}],animate:[{animate:["none","spin","ping","pulse","bounce",vt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[C]}],"scale-x":[{"scale-x":[C]}],"scale-y":[{"scale-y":[C]}],rotate:[{rotate:[Jn,vt]}],"translate-x":[{"translate-x":[S]}],"translate-y":[{"translate-y":[S]}],"skew-x":[{"skew-x":[k]}],"skew-y":[{"skew-y":[k]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",vt]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",vt]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":F()}],"scroll-mx":[{"scroll-mx":F()}],"scroll-my":[{"scroll-my":F()}],"scroll-ms":[{"scroll-ms":F()}],"scroll-me":[{"scroll-me":F()}],"scroll-mt":[{"scroll-mt":F()}],"scroll-mr":[{"scroll-mr":F()}],"scroll-mb":[{"scroll-mb":F()}],"scroll-ml":[{"scroll-ml":F()}],"scroll-p":[{"scroll-p":F()}],"scroll-px":[{"scroll-px":F()}],"scroll-py":[{"scroll-py":F()}],"scroll-ps":[{"scroll-ps":F()}],"scroll-pe":[{"scroll-pe":F()}],"scroll-pt":[{"scroll-pt":F()}],"scroll-pr":[{"scroll-pr":F()}],"scroll-pb":[{"scroll-pb":F()}],"scroll-pl":[{"scroll-pl":F()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",vt]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Xr,ha,Yl]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},_0=n0(N0);function ke(...t){return _0(kh(t))}const k0=hj,gp=x.forwardRef(({className:t,...s},r)=>e.jsx(Bh,{ref:r,className:ke("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s}));gp.displayName=Bh.displayName;const C0=yi("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),vp=x.forwardRef(({className:t,variant:s,...r},a)=>e.jsx($h,{ref:a,className:ke(C0({variant:s}),t),...r}));vp.displayName=$h.displayName;const S0=x.forwardRef(({className:t,...s},r)=>e.jsx(Vh,{ref:r,className:ke("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",t),...s}));S0.displayName=Vh.displayName;const yp=x.forwardRef(({className:t,...s},r)=>e.jsx(Kh,{ref:r,className:ke("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx(ar,{className:"h-4 w-4"})}));yp.displayName=Kh.displayName;const jp=x.forwardRef(({className:t,...s},r)=>e.jsx(Uh,{ref:r,className:ke("text-sm font-semibold",t),...s}));jp.displayName=Uh.displayName;const bp=x.forwardRef(({className:t,...s},r)=>e.jsx(Hh,{ref:r,className:ke("text-sm opacity-90",t),...s}));bp.displayName=Hh.displayName;function A0(){const{toasts:t}=hs();return e.jsxs(k0,{children:[t.map(function({id:s,title:r,description:a,action:n,...i}){return e.jsxs(vp,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(jp,{children:r}),a&&e.jsx(bp,{children:a})]}),n,e.jsx(yp,{})]},s)}),e.jsx(gp,{})]})}var dm=["light","dark"],T0="(prefers-color-scheme: dark)",P0=x.createContext(void 0),M0={setTheme:t=>{},themes:[]},R0=()=>{var t;return(t=x.useContext(P0))!=null?t:M0};x.memo(({forcedTheme:t,storageKey:s,attribute:r,enableSystem:a,enableColorScheme:n,defaultTheme:i,value:o,attrs:c,nonce:l})=>{let u=i==="system",d=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${c.map(y=>`'${y}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,p=n?dm.includes(i)&&i?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${i}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",h=(y,v=!1,b=!0)=>{let N=o?o[y]:y,A=v?y+"|| ''":`'${N}'`,j="";return n&&b&&!v&&dm.includes(y)&&(j+=`d.style.colorScheme = '${y}';`),r==="class"?v||N?j+=`c.add(${A})`:j+="null":N&&(j+=`d[s](n,${A})`),j},f=t?`!function(){${d}${h(t)}}()`:a?`!function(){try{${d}var e=localStorage.getItem('${s}');if('system'===e||(!e&&${u})){var t='${T0}',m=window.matchMedia(t);if(m.media!==t||m.matches){${h("dark")}}else{${h("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${h(o?"x[e]":"e",!0)}}${u?"":"else{"+h(i,!1,!1)+"}"}${p}}catch(e){}}()`:`!function(){try{${d}var e=localStorage.getItem('${s}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${h(o?"x[e]":"e",!0)}}else{${h(i,!1,!1)};}${p}}catch(t){}}();`;return x.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:f}})});var D0=t=>{switch(t){case"success":return O0;case"info":return L0;case"warning":return F0;case"error":return q0;default:return null}},E0=Array(12).fill(0),I0=({visible:t,className:s})=>ue.createElement("div",{className:["sonner-loading-wrapper",s].filter(Boolean).join(" "),"data-visible":t},ue.createElement("div",{className:"sonner-spinner"},E0.map((r,a)=>ue.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),O0=ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ue.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),F0=ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ue.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),L0=ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ue.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),q0=ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ue.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),z0=ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ue.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ue.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),B0=()=>{let[t,s]=ue.useState(document.hidden);return ue.useEffect(()=>{let r=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),t},Tc=1,$0=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let s=this.subscribers.indexOf(t);this.subscribers.splice(s,1)}),this.publish=t=>{this.subscribers.forEach(s=>s(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var s;let{message:r,...a}=t,n=typeof t?.id=="number"||((s=t.id)==null?void 0:s.length)>0?t.id:Tc++,i=this.toasts.find(c=>c.id===n),o=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(n)&&this.dismissedToasts.delete(n),i?this.toasts=this.toasts.map(c=>c.id===n?(this.publish({...c,...t,id:n,title:r}),{...c,...t,id:n,dismissible:o,title:r}):c):this.addToast({title:r,...a,dismissible:o,id:n}),n},this.dismiss=t=>(this.dismissedToasts.add(t),t||this.toasts.forEach(s=>{this.subscribers.forEach(r=>r({id:s.id,dismiss:!0}))}),this.subscribers.forEach(s=>s({id:t,dismiss:!0})),t),this.message=(t,s)=>this.create({...s,message:t}),this.error=(t,s)=>this.create({...s,message:t,type:"error"}),this.success=(t,s)=>this.create({...s,type:"success",message:t}),this.info=(t,s)=>this.create({...s,type:"info",message:t}),this.warning=(t,s)=>this.create({...s,type:"warning",message:t}),this.loading=(t,s)=>this.create({...s,type:"loading",message:t}),this.promise=(t,s)=>{if(!s)return;let r;s.loading!==void 0&&(r=this.create({...s,promise:t,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));let a=t instanceof Promise?t:t(),n=r!==void 0,i,o=a.then(async l=>{if(i=["resolve",l],ue.isValidElement(l))n=!1,this.create({id:r,type:"default",message:l});else if(H0(l)&&!l.ok){n=!1;let u=typeof s.error=="function"?await s.error(`HTTP error! status: ${l.status}`):s.error,d=typeof s.description=="function"?await s.description(`HTTP error! status: ${l.status}`):s.description;this.create({id:r,type:"error",message:u,description:d})}else if(s.success!==void 0){n=!1;let u=typeof s.success=="function"?await s.success(l):s.success,d=typeof s.description=="function"?await s.description(l):s.description;this.create({id:r,type:"success",message:u,description:d})}}).catch(async l=>{if(i=["reject",l],s.error!==void 0){n=!1;let u=typeof s.error=="function"?await s.error(l):s.error,d=typeof s.description=="function"?await s.description(l):s.description;this.create({id:r,type:"error",message:u,description:d})}}).finally(()=>{var l;n&&(this.dismiss(r),r=void 0),(l=s.finally)==null||l.call(s)}),c=()=>new Promise((l,u)=>o.then(()=>i[0]==="reject"?u(i[1]):l(i[1])).catch(u));return typeof r!="string"&&typeof r!="number"?{unwrap:c}:Object.assign(r,{unwrap:c})},this.custom=(t,s)=>{let r=s?.id||Tc++;return this.create({jsx:t(r),id:r,...s}),r},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},ir=new $0,U0=(t,s)=>{let r=s?.id||Tc++;return ir.addToast({title:t,...s,id:r}),r},H0=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",V0=U0,K0=()=>ir.toasts,W0=()=>ir.getActiveToasts(),ce=Object.assign(V0,{success:ir.success,info:ir.info,warning:ir.warning,error:ir.error,custom:ir.custom,message:ir.message,promise:ir.promise,dismiss:ir.dismiss,loading:ir.loading},{getHistory:K0,getToasts:W0});function Y0(t,{insertAt:s}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",s==="top"&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t))}Y0(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function so(t){return t.label!==void 0}var G0=3,Q0="32px",X0="16px",um=4e3,J0=356,Z0=14,eb=20,tb=200;function Tr(...t){return t.filter(Boolean).join(" ")}function sb(t){let[s,r]=t.split("-"),a=[];return s&&a.push(s),r&&a.push(r),a}var rb=t=>{var s,r,a,n,i,o,c,l,u,d,p;let{invert:h,toast:f,unstyled:y,interacting:v,setHeights:b,visibleToasts:N,heights:A,index:j,toasts:C,expanded:I,removeToast:k,defaultRichColors:R,closeButton:S,style:T,cancelButtonStyle:E,actionButtonStyle:D,className:F="",descriptionClassName:H="",duration:q,position:B,gap:L,loadingIcon:P,expandByDefault:K,classNames:$,icons:se,closeButtonAriaLabel:ne="Close toast",pauseWhenPageIsHidden:Y}=t,[fe,me]=ue.useState(null),[xe,He]=ue.useState(null),[Ae,Ye]=ue.useState(!1),[Ze,Ne]=ue.useState(!1),[Ge,qe]=ue.useState(!1),[Ke,as]=ue.useState(!1),[yt,Vt]=ue.useState(!1),[Pt,Dt]=ue.useState(0),[Gt,ns]=ue.useState(0),jt=ue.useRef(f.duration||q||um),is=ue.useRef(null),Ct=ue.useRef(null),Et=j===0,ps=j+1<=N,_t=f.type,ls=f.dismissible!==!1,cs=f.className||"",Us=f.descriptionClassName||"",Jt=ue.useMemo(()=>A.findIndex(Ue=>Ue.toastId===f.id)||0,[A,f.id]),ds=ue.useMemo(()=>{var Ue;return(Ue=f.closeButton)!=null?Ue:S},[f.closeButton,S]),Zt=ue.useMemo(()=>f.duration||q||um,[f.duration,q]),As=ue.useRef(0),fs=ue.useRef(0),ws=ue.useRef(0),Be=ue.useRef(null),[Ar,Qe]=B.split("-"),bt=ue.useMemo(()=>A.reduce((Ue,pt,gt)=>gt>=Jt?Ue:Ue+pt.height,0),[A,Jt]),_e=B0(),Ot=f.invert||h,ft=_t==="loading";fs.current=ue.useMemo(()=>Jt*L+bt,[Jt,bt]),ue.useEffect(()=>{jt.current=Zt},[Zt]),ue.useEffect(()=>{Ye(!0)},[]),ue.useEffect(()=>{let Ue=Ct.current;if(Ue){let pt=Ue.getBoundingClientRect().height;return ns(pt),b(gt=>[{toastId:f.id,height:pt,position:f.position},...gt]),()=>b(gt=>gt.filter(At=>At.toastId!==f.id))}},[b,f.id]),ue.useLayoutEffect(()=>{if(!Ae)return;let Ue=Ct.current,pt=Ue.style.height;Ue.style.height="auto";let gt=Ue.getBoundingClientRect().height;Ue.style.height=pt,ns(gt),b(At=>At.find(Kt=>Kt.toastId===f.id)?At.map(Kt=>Kt.toastId===f.id?{...Kt,height:gt}:Kt):[{toastId:f.id,height:gt,position:f.position},...At])},[Ae,f.title,f.description,b,f.id]);let Mt=ue.useCallback(()=>{Ne(!0),Dt(fs.current),b(Ue=>Ue.filter(pt=>pt.toastId!==f.id)),setTimeout(()=>{k(f)},tb)},[f,k,b,fs]);ue.useEffect(()=>{if(f.promise&&_t==="loading"||f.duration===1/0||f.type==="loading")return;let Ue;return I||v||Y&&_e?(()=>{if(ws.current<As.current){let pt=new Date().getTime()-As.current;jt.current=jt.current-pt}ws.current=new Date().getTime()})():jt.current!==1/0&&(As.current=new Date().getTime(),Ue=setTimeout(()=>{var pt;(pt=f.onAutoClose)==null||pt.call(f,f),Mt()},jt.current)),()=>clearTimeout(Ue)},[I,v,f,_t,Y,_e,Mt]),ue.useEffect(()=>{f.delete&&Mt()},[Mt,f.delete]);function Qt(){var Ue,pt,gt;return se!=null&&se.loading?ue.createElement("div",{className:Tr($?.loader,(Ue=f?.classNames)==null?void 0:Ue.loader,"sonner-loader"),"data-visible":_t==="loading"},se.loading):P?ue.createElement("div",{className:Tr($?.loader,(pt=f?.classNames)==null?void 0:pt.loader,"sonner-loader"),"data-visible":_t==="loading"},P):ue.createElement(I0,{className:Tr($?.loader,(gt=f?.classNames)==null?void 0:gt.loader),visible:_t==="loading"})}return ue.createElement("li",{tabIndex:0,ref:Ct,className:Tr(F,cs,$?.toast,(s=f?.classNames)==null?void 0:s.toast,$?.default,$?.[_t],(r=f?.classNames)==null?void 0:r[_t]),"data-sonner-toast":"","data-rich-colors":(a=f.richColors)!=null?a:R,"data-styled":!(f.jsx||f.unstyled||y),"data-mounted":Ae,"data-promise":!!f.promise,"data-swiped":yt,"data-removed":Ze,"data-visible":ps,"data-y-position":Ar,"data-x-position":Qe,"data-index":j,"data-front":Et,"data-swiping":Ge,"data-dismissible":ls,"data-type":_t,"data-invert":Ot,"data-swipe-out":Ke,"data-swipe-direction":xe,"data-expanded":!!(I||K&&Ae),style:{"--index":j,"--toasts-before":j,"--z-index":C.length-j,"--offset":`${Ze?Pt:fs.current}px`,"--initial-height":K?"auto":`${Gt}px`,...T,...f.style},onDragEnd:()=>{qe(!1),me(null),Be.current=null},onPointerDown:Ue=>{ft||!ls||(is.current=new Date,Dt(fs.current),Ue.target.setPointerCapture(Ue.pointerId),Ue.target.tagName!=="BUTTON"&&(qe(!0),Be.current={x:Ue.clientX,y:Ue.clientY}))},onPointerUp:()=>{var Ue,pt,gt,At;if(Ke||!ls)return;Be.current=null;let Kt=Number(((Ue=Ct.current)==null?void 0:Ue.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Ws=Number(((pt=Ct.current)==null?void 0:pt.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),er=new Date().getTime()-((gt=is.current)==null?void 0:gt.getTime()),St=fe==="x"?Kt:Ws,Xt=Math.abs(St)/er;if(Math.abs(St)>=eb||Xt>.11){Dt(fs.current),(At=f.onDismiss)==null||At.call(f,f),He(fe==="x"?Kt>0?"right":"left":Ws>0?"down":"up"),Mt(),as(!0),Vt(!1);return}qe(!1),me(null)},onPointerMove:Ue=>{var pt,gt,At,Kt;if(!Be.current||!ls||((pt=window.getSelection())==null?void 0:pt.toString().length)>0)return;let Ws=Ue.clientY-Be.current.y,er=Ue.clientX-Be.current.x,St=(gt=t.swipeDirections)!=null?gt:sb(B);!fe&&(Math.abs(er)>1||Math.abs(Ws)>1)&&me(Math.abs(er)>Math.abs(Ws)?"x":"y");let Xt={x:0,y:0};fe==="y"?(St.includes("top")||St.includes("bottom"))&&(St.includes("top")&&Ws<0||St.includes("bottom")&&Ws>0)&&(Xt.y=Ws):fe==="x"&&(St.includes("left")||St.includes("right"))&&(St.includes("left")&&er<0||St.includes("right")&&er>0)&&(Xt.x=er),(Math.abs(Xt.x)>0||Math.abs(Xt.y)>0)&&Vt(!0),(At=Ct.current)==null||At.style.setProperty("--swipe-amount-x",`${Xt.x}px`),(Kt=Ct.current)==null||Kt.style.setProperty("--swipe-amount-y",`${Xt.y}px`)}},ds&&!f.jsx?ue.createElement("button",{"aria-label":ne,"data-disabled":ft,"data-close-button":!0,onClick:ft||!ls?()=>{}:()=>{var Ue;Mt(),(Ue=f.onDismiss)==null||Ue.call(f,f)},className:Tr($?.closeButton,(n=f?.classNames)==null?void 0:n.closeButton)},(i=se?.close)!=null?i:z0):null,f.jsx||x.isValidElement(f.title)?f.jsx?f.jsx:typeof f.title=="function"?f.title():f.title:ue.createElement(ue.Fragment,null,_t||f.icon||f.promise?ue.createElement("div",{"data-icon":"",className:Tr($?.icon,(o=f?.classNames)==null?void 0:o.icon)},f.promise||f.type==="loading"&&!f.icon?f.icon||Qt():null,f.type!=="loading"?f.icon||se?.[_t]||D0(_t):null):null,ue.createElement("div",{"data-content":"",className:Tr($?.content,(c=f?.classNames)==null?void 0:c.content)},ue.createElement("div",{"data-title":"",className:Tr($?.title,(l=f?.classNames)==null?void 0:l.title)},typeof f.title=="function"?f.title():f.title),f.description?ue.createElement("div",{"data-description":"",className:Tr(H,Us,$?.description,(u=f?.classNames)==null?void 0:u.description)},typeof f.description=="function"?f.description():f.description):null),x.isValidElement(f.cancel)?f.cancel:f.cancel&&so(f.cancel)?ue.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||E,onClick:Ue=>{var pt,gt;so(f.cancel)&&ls&&((gt=(pt=f.cancel).onClick)==null||gt.call(pt,Ue),Mt())},className:Tr($?.cancelButton,(d=f?.classNames)==null?void 0:d.cancelButton)},f.cancel.label):null,x.isValidElement(f.action)?f.action:f.action&&so(f.action)?ue.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||D,onClick:Ue=>{var pt,gt;so(f.action)&&((gt=(pt=f.action).onClick)==null||gt.call(pt,Ue),!Ue.defaultPrevented&&Mt())},className:Tr($?.actionButton,(p=f?.classNames)==null?void 0:p.actionButton)},f.action.label):null))};function mm(){if(typeof window>"u"||typeof document>"u")return"ltr";let t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function ab(t,s){let r={};return[t,s].forEach((a,n)=>{let i=n===1,o=i?"--mobile-offset":"--offset",c=i?X0:Q0;function l(u){["top","right","bottom","left"].forEach(d=>{r[`${o}-${d}`]=typeof u=="number"?`${u}px`:u})}typeof a=="number"||typeof a=="string"?l(a):typeof a=="object"?["top","right","bottom","left"].forEach(u=>{a[u]===void 0?r[`${o}-${u}`]=c:r[`${o}-${u}`]=typeof a[u]=="number"?`${a[u]}px`:a[u]}):l(c)}),r}var nb=x.forwardRef(function(t,s){let{invert:r,position:a="bottom-right",hotkey:n=["altKey","KeyT"],expand:i,closeButton:o,className:c,offset:l,mobileOffset:u,theme:d="light",richColors:p,duration:h,style:f,visibleToasts:y=G0,toastOptions:v,dir:b=mm(),gap:N=Z0,loadingIcon:A,icons:j,containerAriaLabel:C="Notifications",pauseWhenPageIsHidden:I}=t,[k,R]=ue.useState([]),S=ue.useMemo(()=>Array.from(new Set([a].concat(k.filter(Y=>Y.position).map(Y=>Y.position)))),[k,a]),[T,E]=ue.useState([]),[D,F]=ue.useState(!1),[H,q]=ue.useState(!1),[B,L]=ue.useState(d!=="system"?d:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),P=ue.useRef(null),K=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),$=ue.useRef(null),se=ue.useRef(!1),ne=ue.useCallback(Y=>{R(fe=>{var me;return(me=fe.find(xe=>xe.id===Y.id))!=null&&me.delete||ir.dismiss(Y.id),fe.filter(({id:xe})=>xe!==Y.id)})},[]);return ue.useEffect(()=>ir.subscribe(Y=>{if(Y.dismiss){R(fe=>fe.map(me=>me.id===Y.id?{...me,delete:!0}:me));return}setTimeout(()=>{by.flushSync(()=>{R(fe=>{let me=fe.findIndex(xe=>xe.id===Y.id);return me!==-1?[...fe.slice(0,me),{...fe[me],...Y},...fe.slice(me+1)]:[Y,...fe]})})})}),[]),ue.useEffect(()=>{if(d!=="system"){L(d);return}if(d==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?L("dark"):L("light")),typeof window>"u")return;let Y=window.matchMedia("(prefers-color-scheme: dark)");try{Y.addEventListener("change",({matches:fe})=>{L(fe?"dark":"light")})}catch{Y.addListener(({matches:me})=>{try{L(me?"dark":"light")}catch(xe){console.error(xe)}})}},[d]),ue.useEffect(()=>{k.length<=1&&F(!1)},[k]),ue.useEffect(()=>{let Y=fe=>{var me,xe;n.every(He=>fe[He]||fe.code===He)&&(F(!0),(me=P.current)==null||me.focus()),fe.code==="Escape"&&(document.activeElement===P.current||(xe=P.current)!=null&&xe.contains(document.activeElement))&&F(!1)};return document.addEventListener("keydown",Y),()=>document.removeEventListener("keydown",Y)},[n]),ue.useEffect(()=>{if(P.current)return()=>{$.current&&($.current.focus({preventScroll:!0}),$.current=null,se.current=!1)}},[P.current]),ue.createElement("section",{ref:s,"aria-label":`${C} ${K}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},S.map((Y,fe)=>{var me;let[xe,He]=Y.split("-");return k.length?ue.createElement("ol",{key:Y,dir:b==="auto"?mm():b,tabIndex:-1,ref:P,className:c,"data-sonner-toaster":!0,"data-theme":B,"data-y-position":xe,"data-lifted":D&&k.length>1&&!i,"data-x-position":He,style:{"--front-toast-height":`${((me=T[0])==null?void 0:me.height)||0}px`,"--width":`${J0}px`,"--gap":`${N}px`,...f,...ab(l,u)},onBlur:Ae=>{se.current&&!Ae.currentTarget.contains(Ae.relatedTarget)&&(se.current=!1,$.current&&($.current.focus({preventScroll:!0}),$.current=null))},onFocus:Ae=>{Ae.target instanceof HTMLElement&&Ae.target.dataset.dismissible==="false"||se.current||(se.current=!0,$.current=Ae.relatedTarget)},onMouseEnter:()=>F(!0),onMouseMove:()=>F(!0),onMouseLeave:()=>{H||F(!1)},onDragEnd:()=>F(!1),onPointerDown:Ae=>{Ae.target instanceof HTMLElement&&Ae.target.dataset.dismissible==="false"||q(!0)},onPointerUp:()=>q(!1)},k.filter(Ae=>!Ae.position&&fe===0||Ae.position===Y).map((Ae,Ye)=>{var Ze,Ne;return ue.createElement(rb,{key:Ae.id,icons:j,index:Ye,toast:Ae,defaultRichColors:p,duration:(Ze=v?.duration)!=null?Ze:h,className:v?.className,descriptionClassName:v?.descriptionClassName,invert:r,visibleToasts:y,closeButton:(Ne=v?.closeButton)!=null?Ne:o,interacting:H,position:Y,style:v?.style,unstyled:v?.unstyled,classNames:v?.classNames,cancelButtonStyle:v?.cancelButtonStyle,actionButtonStyle:v?.actionButtonStyle,removeToast:ne,toasts:k.filter(Ge=>Ge.position==Ae.position),heights:T.filter(Ge=>Ge.position==Ae.position),setHeights:E,expandByDefault:i,gap:N,loadingIcon:A,expanded:D,pauseWhenPageIsHidden:I,swipeDirections:t.swipeDirections})})):null}))});const ib=({...t})=>{const{theme:s="system"}=R0();return e.jsx(nb,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})};var[Jo]=wr("Tooltip",[En]),Zo=En(),wp="TooltipProvider",ob=700,Pc="tooltip.open",[lb,xd]=Jo(wp),Np=t=>{const{__scopeTooltip:s,delayDuration:r=ob,skipDelayDuration:a=300,disableHoverableContent:n=!1,children:i}=t,o=x.useRef(!0),c=x.useRef(!1),l=x.useRef(0);return x.useEffect(()=>{const u=l.current;return()=>window.clearTimeout(u)},[]),e.jsx(lb,{scope:s,isOpenDelayedRef:o,delayDuration:r,onOpen:x.useCallback(()=>{window.clearTimeout(l.current),o.current=!1},[]),onClose:x.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.current=!0,a)},[a]),isPointerInTransitRef:c,onPointerInTransitChange:x.useCallback(u=>{c.current=u},[]),disableHoverableContent:n,children:i})};Np.displayName=wp;var fi="Tooltip",[cb,el]=Jo(fi),_p=t=>{const{__scopeTooltip:s,children:r,open:a,defaultOpen:n,onOpenChange:i,disableHoverableContent:o,delayDuration:c}=t,l=xd(fi,t.__scopeTooltip),u=Zo(s),[d,p]=x.useState(null),h=In(),f=x.useRef(0),y=o??l.disableHoverableContent,v=c??l.delayDuration,b=x.useRef(!1),[N,A]=ra({prop:a,defaultProp:n??!1,onChange:R=>{R?(l.onOpen(),document.dispatchEvent(new CustomEvent(Pc))):l.onClose(),i?.(R)},caller:fi}),j=x.useMemo(()=>N?b.current?"delayed-open":"instant-open":"closed",[N]),C=x.useCallback(()=>{window.clearTimeout(f.current),f.current=0,b.current=!1,A(!0)},[A]),I=x.useCallback(()=>{window.clearTimeout(f.current),f.current=0,A(!1)},[A]),k=x.useCallback(()=>{window.clearTimeout(f.current),f.current=window.setTimeout(()=>{b.current=!0,A(!0),f.current=0},v)},[v,A]);return x.useEffect(()=>()=>{f.current&&(window.clearTimeout(f.current),f.current=0)},[]),e.jsx(Jc,{...u,children:e.jsx(cb,{scope:s,contentId:h,open:N,stateAttribute:j,trigger:d,onTriggerChange:p,onTriggerEnter:x.useCallback(()=>{l.isOpenDelayedRef.current?k():C()},[l.isOpenDelayedRef,k,C]),onTriggerLeave:x.useCallback(()=>{y?I():(window.clearTimeout(f.current),f.current=0)},[I,y]),onOpen:C,onClose:I,disableHoverableContent:y,children:r})})};_p.displayName=fi;var Mc="TooltipTrigger",kp=x.forwardRef((t,s)=>{const{__scopeTooltip:r,...a}=t,n=el(Mc,r),i=xd(Mc,r),o=Zo(r),c=x.useRef(null),l=Ht(s,c,n.onTriggerChange),u=x.useRef(!1),d=x.useRef(!1),p=x.useCallback(()=>u.current=!1,[]);return x.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),e.jsx($o,{asChild:!0,...o,children:e.jsx(ht.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...a,ref:l,onPointerMove:st(t.onPointerMove,h=>{h.pointerType!=="touch"&&!d.current&&!i.isPointerInTransitRef.current&&(n.onTriggerEnter(),d.current=!0)}),onPointerLeave:st(t.onPointerLeave,()=>{n.onTriggerLeave(),d.current=!1}),onPointerDown:st(t.onPointerDown,()=>{n.open&&n.onClose(),u.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:st(t.onFocus,()=>{u.current||n.onOpen()}),onBlur:st(t.onBlur,n.onClose),onClick:st(t.onClick,n.onClose)})})});kp.displayName=Mc;var db="TooltipPortal",[HA,ub]=Jo(db,{forceMount:void 0}),vn="TooltipContent",Cp=x.forwardRef((t,s)=>{const r=ub(vn,t.__scopeTooltip),{forceMount:a=r.forceMount,side:n="top",...i}=t,o=el(vn,t.__scopeTooltip);return e.jsx(Lr,{present:a||o.open,children:o.disableHoverableContent?e.jsx(Sp,{side:n,...i,ref:s}):e.jsx(mb,{side:n,...i,ref:s})})}),mb=x.forwardRef((t,s)=>{const r=el(vn,t.__scopeTooltip),a=xd(vn,t.__scopeTooltip),n=x.useRef(null),i=Ht(s,n),[o,c]=x.useState(null),{trigger:l,onClose:u}=r,d=n.current,{onPointerInTransitChange:p}=a,h=x.useCallback(()=>{c(null),p(!1)},[p]),f=x.useCallback((y,v)=>{const b=y.currentTarget,N={x:y.clientX,y:y.clientY},A=gb(N,b.getBoundingClientRect()),j=vb(N,A),C=yb(v.getBoundingClientRect()),I=bb([...j,...C]);c(I),p(!0)},[p]);return x.useEffect(()=>()=>h(),[h]),x.useEffect(()=>{if(l&&d){const y=b=>f(b,d),v=b=>f(b,l);return l.addEventListener("pointerleave",y),d.addEventListener("pointerleave",v),()=>{l.removeEventListener("pointerleave",y),d.removeEventListener("pointerleave",v)}}},[l,d,f,h]),x.useEffect(()=>{if(o){const y=v=>{const b=v.target,N={x:v.clientX,y:v.clientY},A=l?.contains(b)||d?.contains(b),j=!jb(N,o);A?h():j&&(h(),u())};return document.addEventListener("pointermove",y),()=>document.removeEventListener("pointermove",y)}},[l,d,o,u,h]),e.jsx(Sp,{...t,ref:i})}),[hb,pb]=Jo(fi,{isInside:!1}),fb=ah("TooltipContent"),Sp=x.forwardRef((t,s)=>{const{__scopeTooltip:r,children:a,"aria-label":n,onEscapeKeyDown:i,onPointerDownOutside:o,...c}=t,l=el(vn,r),u=Zo(r),{onClose:d}=l;return x.useEffect(()=>(document.addEventListener(Pc,d),()=>document.removeEventListener(Pc,d)),[d]),x.useEffect(()=>{if(l.trigger){const p=h=>{h.target?.contains(l.trigger)&&d()};return window.addEventListener("scroll",p,{capture:!0}),()=>window.removeEventListener("scroll",p,{capture:!0})}},[l.trigger,d]),e.jsx(Qc,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:p=>p.preventDefault(),onDismiss:d,children:e.jsxs(Xc,{"data-state":l.stateAttribute,...u,...c,ref:s,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(fb,{children:a}),e.jsx(hb,{scope:r,isInside:!0,children:e.jsx(Gy,{id:l.contentId,role:"tooltip",children:n||a})})]})})});Cp.displayName=vn;var Ap="TooltipArrow",xb=x.forwardRef((t,s)=>{const{__scopeTooltip:r,...a}=t,n=Zo(r);return pb(Ap,r).isInside?null:e.jsx(Zc,{...n,...a,ref:s})});xb.displayName=Ap;function gb(t,s){const r=Math.abs(s.top-t.y),a=Math.abs(s.bottom-t.y),n=Math.abs(s.right-t.x),i=Math.abs(s.left-t.x);switch(Math.min(r,a,n,i)){case i:return"left";case n:return"right";case r:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function vb(t,s,r=5){const a=[];switch(s){case"top":a.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":a.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":a.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":a.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return a}function yb(t){const{top:s,right:r,bottom:a,left:n}=t;return[{x:n,y:s},{x:r,y:s},{x:r,y:a},{x:n,y:a}]}function jb(t,s){const{x:r,y:a}=t;let n=!1;for(let i=0,o=s.length-1;i<s.length;o=i++){const c=s[i],l=s[o],u=c.x,d=c.y,p=l.x,h=l.y;d>a!=h>a&&r<(p-u)*(a-d)/(h-d)+u&&(n=!n)}return n}function bb(t){const s=t.slice();return s.sort((r,a)=>r.x<a.x?-1:r.x>a.x?1:r.y<a.y?-1:r.y>a.y?1:0),wb(s)}function wb(t){if(t.length<=1)return t.slice();const s=[];for(let a=0;a<t.length;a++){const n=t[a];for(;s.length>=2;){const i=s[s.length-1],o=s[s.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))s.pop();else break}s.push(n)}s.pop();const r=[];for(let a=t.length-1;a>=0;a--){const n=t[a];for(;r.length>=2;){const i=r[r.length-1],o=r[r.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))r.pop();else break}r.push(n)}return r.pop(),s.length===1&&r.length===1&&s[0].x===r[0].x&&s[0].y===r[0].y?s:s.concat(r)}var Nb=Np,_b=_p,kb=kp,Tp=Cp;const Cb=Nb,Sb=_b,Ab=kb,Pp=x.forwardRef(({className:t,sideOffset:s=4,...r},a)=>e.jsx(Tp,{ref:a,sideOffset:s,className:ke("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r}));Pp.displayName=Tp.displayName;const Tb="https://rmtkkzfzdmpjlqexrbme.supabase.co",Pb="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg",W=$y(Tb,Pb,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),Mp=Object.freeze(Object.defineProperty({__proto__:null,supabase:W},Symbol.toStringTag,{value:"Module"})),Rp=x.createContext({user:null,session:null,loading:!0,userRole:null,realRole:null,activeRole:null,isDevOverride:!1,devExpiresAt:null,profiles:[],activeProfileId:null,setActiveProfileId:async()=>{},signOut:async()=>{},refreshRole:async()=>{},switchActiveRole:async()=>{}}),Mb=({children:t})=>{const[s,r]=x.useState(null),[a,n]=x.useState(null),[i,o]=x.useState(!0),[c,l]=x.useState(null),[u,d]=x.useState(null),[p,h]=x.useState(null),[f,y]=x.useState(!1),[v,b]=x.useState(null),[N,A]=x.useState([]),[j,C]=x.useState(()=>{try{return localStorage.getItem("agrinext_active_profile")||null}catch{return null}}),I=x.useCallback(F=>{A(F);let H=j;!H&&F.length===1?H=F[0].id:H&&!F.find(B=>B.id===H)&&(H=F[0]?.id??null),C(H||null);const q=F.find(B=>B.id===H)||F[0]||null;d(q?.profile_type??null),l(q?.profile_type??null)},[j]),k=x.useCallback(async F=>{try{const{data:H,error:q}=await W.from("user_profiles").select("id, profile_type, display_name, phone, is_active").eq("user_id",F);if(!q&&H&&H.length>0){I(H.map(se=>({id:se.id,profile_type:se.profile_type,display_name:se.display_name||"User",phone:se.phone||"",is_active:se.is_active??!0})));return}q&&console.warn("user_profiles lookup failed, falling back to legacy role tables:",q.message);const[{data:B,error:L},{data:P,error:K}]=await Promise.all([W.from("user_roles").select("role").eq("user_id",F).limit(5),W.from("profiles").select("id, full_name, phone").eq("id",F).maybeSingle()]);L&&console.warn("Legacy user_roles lookup failed:",L.message),K&&console.warn("Legacy profiles lookup failed:",K.message);const $=B?.[0]?.role??null;if($){I([{id:F,profile_type:$,display_name:P?.full_name?.trim()||"User",phone:P?.phone||"",is_active:!0}]);return}A([]),d(null),l(null)}catch(H){console.error("Error fetching user profiles:",H),A([]),d(null),l(null)}},[I]),R=x.useCallback(async()=>{s?.id&&await k(s.id)},[s?.id,k]),S=x.useCallback(async F=>{try{return}catch(H){console.error("fetchDevActiveRole error:",H)}},[]),T=x.useCallback(async F=>{try{return}catch(H){console.error("switchActiveRole error:",H)}},[a?.access_token]);x.useEffect(()=>{let F=!0;(async()=>{try{const{data:{session:B}}=await W.auth.getSession();if(!F)return;n(B),r(B?.user??null),B?.user&&(await k(B.user.id),await S(B.access_token??void 0))}catch(B){console.error("Auth initialization error:",B)}finally{F&&o(!1)}})();const{data:{subscription:q}}=W.auth.onAuthStateChange(async(B,L)=>{F&&(n(L),r(L?.user??null),L?.user?setTimeout(()=>{F&&(k(L.user.id),S(L.access_token??void 0))},100):(d(null),h(null),l(null)),o(!1))});return()=>{F=!1,q.unsubscribe()}},[k,S]);const E=x.useCallback(async()=>{try{await W.auth.signOut(),r(null),n(null),d(null),h(null),l(null),A([]),C(null),y(!1),b(null);try{localStorage.removeItem("agrinext_active_profile")}catch{}}catch(F){console.error("Sign out error:",F)}},[]),D=x.useCallback(F=>{C(F);try{F?localStorage.setItem("agrinext_active_profile",F):localStorage.removeItem("agrinext_active_profile")}catch{}const H=N.find(q=>q.id===F);d(H?.profile_type??null),l(f?p??H?.profile_type??null:H?.profile_type??null)},[N,f,p]);return e.jsx(Rp.Provider,{value:{user:s,session:a,loading:i,userRole:c,realRole:u,activeRole:p,isDevOverride:f,devExpiresAt:v,profiles:N,activeProfileId:j,setActiveProfileId:D,signOut:E,refreshRole:R,switchActiveRole:T},children:t})},Fe=()=>{const t=x.useContext(Rp);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},Rb={common:{save:"Save",save_changes:"Save Changes",saveChanges:"Save Changes",saving:"Saving...",cancel:"Cancel",delete:"Delete",edit:"Edit",add:"Add",search:"Search",unit:"Unit",filter:"Filter",loading:"Loading...",retry:"Retry",viewAll:"View All",back:"Back",next:"Next",submit:"Submit",confirm:"Confirm",close:"Close",yes:"Yes",no:"No",error:"Error",success:"Success",warning:"Warning",update:"Update",view:"View",continue:"Continue",signIn:"Sign In",signOut:"Sign Out",signUp:"Sign Up",createAccount:"Create Account",acres:"acres",kg:"kg",quintal:"quintal",quintals:"quintals",tonnes:"tonnes",perKg:"/kg",perQuintal:"/quintal",refresh:"Refresh",configure:"Configure",manage:"Manage",change:"Change",accept:"Accept",reject:"Reject",pending:"Pending",completed:"Completed",active:"Active",inactive:"Inactive",status:"Status",actions:"Actions",details:"Details",date:"Date",time:"Time",name:"Name",phone:"Phone",email:"Email",address:"Address",notes:"Notes",description:"Description",price:"Price",quantity:"Quantity",total:"Total",from:"From",to:"To",all:"All",none:"None",select:"Select",optional:"Optional",required:"Required",unknown:"Unknown",notAvailable:"N/A",flexible:"Flexible",clearFilters:"Clear Filters",clearSearch:"Clear Search",noResultsFound:"No results found",noData:"No data available",tryAgain:"Try again",live:"Live",saved:"Saved",user:"User",unread:"unread",loadMore:"Load more",showAll:"Show all",noMoreItems:"No more items",done:"Done",searchPlaceholderDetailed:"Search by name, ID, village, or location"},auth:{welcome_back:"Welcome back",welcomeBack:"Welcome back",sign_in_continue:"Sign in to your account to continue",signInToContinue:"Sign in to your account to continue",email:"Email",password:"Password",email_placeholder:"you@example.com",emailPlaceholder:"you@example.com",passwordPlaceholder:"",signing_in:"Signing in...",signingIn:"Signing in...",sign_in:"Sign In",or_continue_with:"or continue with",orContinueWith:"or continue with",continue_google:"Continue with Google",continueWithGoogle:"Continue with Google",no_account:"Don't have an account?",dontHaveAccount:"Don't have an account?",sign_up:"Sign Up",already_have_account:"Already have an account?",alreadyHaveAccount:"Already have an account?",joinAgriNextGen:"Join AgriNext Gen",selectRoleToStart:"Select your role to get started",createYourAccount:"Create your account",fillInDetails:"Fill in your details as a",fullName:"Full Name",fullNamePlaceholder:"Your full name",phoneNumber:"Phone Number",phoneOptional:"Phone Number (Optional)",phonePlaceholder:"+91 9876543210",atLeast6Chars:"At least 6 characters",creatingAccount:"Creating account...",welcomeToAgriNextGen:"Welcome to AgriNext Gen",connectWithBuyers:"Connect with buyers, manage your farm, and grow your agricultural business with India's leading agtech platform.",joinOurCommunity:"Join Our Growing Community",becomePartOfNetwork:"Become part of India's largest agricultural network. Connect, trade, and grow with thousands of farmers and buyers.",invalid_credentials:"Invalid email or password. Please try again.",invalidEmailPassword:"Invalid email or password. Please try again.",pleaseEnterValidEmail:"Please enter a valid email address",pleaseFillAllFields:"Please fill in all fields",accountCreated:"Account created!",welcomeSignedIn:"Welcome to AgriNext Gen. You're now signed in.",emailAlreadyRegistered:"This email is already registered. Please sign in instead.",unexpectedError:"An unexpected error occurred. Please try again.",login_failed:"Login failed",loginFailed:"Login failed",login_success:"You have successfully signed in.",successfullySignedIn:"You have successfully signed in.",phone:"Phone",phone_otp_hint:"Enter your 10-digit mobile number. OTP will be sent via SMS.",send_otp:"Send OTP",sending_otp:"Sending OTP...",enter_otp:"Enter OTP",otp_sent_to:"OTP sent to",verify_otp:"Verify OTP",verifying:"Verifying...",change_phone:"Change phone number",otp_sent:"OTP sent",otp_sent_description:"Check your phone for the verification code.",otp_invalid:"Please enter a valid 6-digit OTP.",check_email_confirm:"Check your email to confirm your account. Click the link in the email to get started.",email_confirmation_required:"Email confirmation required",select_role_to_login:"Select your role to sign in",phone_or_email_exists:"This phone number or email is already registered. Please sign in instead.",signup_failed:"Signup failed",account_exists:"Account already exists",rate_limit_exceeded:"Too many signup attempts. Please try again in about an hour.",rate_limit_retry_hint:"Too many signup attempts. Please try again in about an hour.",email_optional:"Email (Optional)",email_optional_hint:"Optional. Used for account recovery.",signOut:"Sign Out"},roles:{farmer:"Farmer",farmerDesc:"Sell your produce directly",farmer_description:"Sell your produce directly",buyer:"Buyer",buyerDesc:"Source quality products",buyer_description:"Source quality products",agent:"Agent",agentDesc:"Collect field data",agent_description:"Collect field data",logistics:"Logistics",logisticsDesc:"Deliver goods",logistics_description:"Deliver goods",admin:"Admin",adminDesc:"Manage platform"},nav:{dashboard:"Dashboard",myDay:"My Day",today:"Today",crops:"My Crops",farmlands:"Farmlands",transport:"Transport",listings:"Listings",orders:"Orders",earnings:"Earnings",settings:"Settings",notifications:"Notifications",cropDiary:"Crop Diary",logout:"Sign Out",browseProducts:"Browse Products",myOrders:"My Orders",profile:"Profile",availableLoads:"Available Loads",activeTrips:"Active Trips",completed:"Completed",myVehicles:"My Vehicles",myTasks:"My Tasks",myFarmers:"My Farmers",farmersAndCrops:"Farmers & Crops",farmers:"Farmers",buyers:"Buyers",agents:"Agents",transporters:"Transporters",allCrops:"All Crops",dataHealth:"Data Health",aiConsole:"AI Console",seedData:"Seed Data",serviceArea:"Service Area",opsInbox:"Ops Inbox",tickets:"Tickets",pendingUpdates:"Pending Updates",aiReview:"AI Review",jobs:"Jobs",finance:"Finance",mysuruDemo:"Mysuru Demo"},dashboardShell:{title:{farmer:"AgriNext Gen",agent:"AgriNext Gen Agent",logistics:"AgriNext Gen Transport",buyer:"AgriNext Gen Market",admin:"AgriNext Gen Admin"},subtitle:{agent:"Field Operations",logistics:"Logistics Partner",buyer:"Marketplace Buyer",admin:"Command Center"}},dashboard:{welcome:"Welcome",locationNotSet:"Location not set",profileCompletion:"Profile Completion",completeProfile:"Complete your profile to unlock all features",almostThere:"Almost there! Add a few more details",justALittle:"Just a little more to complete your profile",totalLand:"Total Land",activeCrops:"Active Crops",readyToHarvest:"Ready to Harvest",pendingTransport:"Pending Transport",completeProfileLink:"Complete Profile ",totalFarmers:"Total Farmers",activeBuyers:"Active Buyers",activeTransporters:"Transporters",harvestReady:"Harvest Ready",newOrdersToday:"New Orders Today",pendingOrders:"Pending Orders",recentActivity:"Recent Activity",noRecentActivity:"No recent activity",quickActions:"Quick Actions"},crops:{title:"My Crops",addCrop:"Add Crop",addNewCrop:"Add New Crop",cropName:"Crop Name",cropNameRequired:"Crop Name *",variety:"Variety",farmland:"Farmland",sowingDate:"Sowing Date",harvestDate:"Harvest Date",expectedQuantity:"Expected Quantity",unit:"Unit",status:"Status",growing:"Growing",oneWeek:"1 Week to Harvest",oneWeekShort:"1 Week",ready:"Ready to Harvest",readyShort:"Ready",readyNow:"Ready Now",oneWeekAway:"1 Week Away",harvested:"Harvested",totalCrops:"Total Crops",noCropsYet:"No crops added yet",noActiveCrops:"No active crops yet",noCropsFound:"No crops found",startByAdding:"Start by adding your first crop to track its growth and manage harvests.",addFirstCrop:"Add Your First Crop",requestTransport:"Request Transport",viewDiary:"View Diary",deleteCrop:"Delete Crop",harvest:"Harvest",est:"Est.",cropDeleted:"Crop deleted",cropHasBeenRemoved:"has been removed.",errorAddingCrop:"Error adding crop",errorDeletingCrop:"Error deleting crop",cropAddedSuccess:"Your crop has been added successfully.",searchPlaceholder:"Search by name, ID, village, or location",selectFarmland:"Select farmland",noFarmlandsYet:"No farmlands added yet.",addFarmlandFirst:"Add farmland first",fieldsMarkedRequired:"Fields marked with * are required.",cropNameHelp:"Enter the name of the crop you are growing, like Rice, Wheat, or Tomato",varietyHelp:"The specific variety of your crop, like Basmati for rice or IR-64",farmlandHelp:"Select which of your farmlands this crop is planted on",sowingDateHelp:"When did you plant this crop?",harvestDateHelp:"When do you expect to harvest?",quantityHelp:"How much crop do you expect to harvest?",tryAdjustingFilters:"Try adjusting your search or filter to find what you're looking for."},farmer:{crops:{viewAllCrops:"View All Crops",myCrops:"My Crops",cropNamePlaceholder:"Enter crop name",varietyPlaceholder:"Enter variety (optional)",editCrop:"Edit Crop",addCropDescription:"Add a crop to track growth, harvest readiness, and transport planning.",diary:"Diary",addSuccess:"Crop added successfully",updateSuccess:"Crop updated successfully",deleted:"Crop deleted",deleteSuccess:"The crop has been removed successfully.",deleteConfirm:"Are you sure you want to delete this crop? This action cannot be undone."},farmlands:{editFarmland:"Edit Farmland",addFarmlandDescription:"Add farmland details to organize crops and logistics planning.",plotNamePlaceholder:"Enter plot name or ID",plotNameHelp:"Use a familiar plot name or ID so your team can identify this farmland easily.",areaHelp:"Enter the total area of this plot in acres.",soilTypeHelp:"Select the closest soil type if known. You can update it later.",selectSoilType:"Select soil type",noFarmlandsFound:"No farmlands found",adjustSearch:"Try adjusting your search to find matching farmlands.",startAddingFarmlands:"Start by adding your first farmland to organize crop records and transport.",addSuccess:"Farmland added successfully",updateSuccess:"Farmland updated successfully",deleted:"Farmland deleted",deleteSuccess:"The farmland has been removed successfully.",deleteConfirm:"Are you sure you want to delete this farmland? Linked crops may lose their location reference."},transport:{crop:"Crop",requestDescription:"Create a transport request to move harvested produce to market or storage.",cropHelp:"Choose the crop that needs pickup.",quantityHelp:"Enter the quantity to be transported.",pickupHelp:"Provide an easy-to-find pickup location for the driver.",timeHelp:"Select the time slot that works best for pickup.",timePlaceholder:"Select a preferred pickup time",selectTime:"Select a time slot",earlyMorning:"Early Morning (5-8 AM)",morning:"Morning (8-11 AM)",afternoon:"Afternoon (12-3 PM)",evening:"Evening (4-6 PM)",noRequestsFound:"No transport requests found",tryDifferentFilter:"Try a different status filter.",startRequestingTransport:"Create your first transport request when your crop is ready to move.",requestSuccess:"Transport request submitted successfully",cancelSuccess:"Transport request cancelled successfully",generalProduce:"General Produce",cancelRequest:"Cancel Request",cancelTransportRequest:"Cancel Transport Request",cancelConfirm:"Are you sure you want to cancel this transport request?",yesCancel:"Yes, Cancel"},market:{title:"Mandi Prices",staleData:"Data may be outdated. Tap refresh for latest prices.",setDistrict:"Set your district for personalized prices.",addCrops:"Add crops to see more relevant prices.",noData:"No price data available",syncPending:"Price sync pending",forecast:"Price Forecast",lastUpdated:"Last updated"}},farmlands:{title:"Farmlands",addFarmland:"Add Farmland",addNewFarmland:"Add New Farmland",plotName:"Name / Plot ID",area:"Area",soilType:"Soil Type",village:"Village",district:"District",totalPlots:"Total Plots",totalAcres:"Total Acres",soilTypes:"Soil Types",villages:"Villages",noFarmlandsYet:"No farmlands added yet",searchPlaceholder:"Search by name, ID, village, or location",addFarmlandsToTrack:"Add your farmlands to track crops, manage harvests, and get better insights.",addFirstFarmland:"Add Your First Farmland",soilReports:"Soil Reports",deleteFarmland:"Delete Farmland",deleteWarning:"Any crops associated with this farmland will lose their location reference.",farmlandDeleted:"Farmland deleted",farmlandDeletedSuccess:"has been removed.",errorDeletingFarmland:"Error deleting farmland",yourVillage:"Your village name",yourDistrict:"Your district"},transport:{title:"Transport Requests",newRequest:"New Request",requestTransport:"Request Transport",activeRequests:"Active Requests",completed:"Completed",inTransit:"In Transit",totalRequests:"Total Requests",quantity:"Quantity",pickupLocation:"Pickup Location",dropLocation:"Drop Location",preferredDate:"Preferred Date",preferredTime:"Preferred Time",notes:"Notes",status:"Status",requested:"Requested",assigned:"Assigned",enRoute:"En Route",pickedUp:"Picked Up",delivered:"Delivered",cancelled:"Cancelled",noTransportYet:"No transport requests yet",whenReady:"When your crops are ready, request transport to get them to market.",createFirstRequest:"Create Transport Request",submitRequest:"Submit Request",selectCrop:"Select crop",enterQuantity:"Enter quantity",enterLocation:"Enter pickup location",addNotes:"Add any special instructions..."},listings:{title:"My Listings",addListing:"Add Listing",addNewListing:"Create Listing",createListing:"Create Listing",updateListing:"Update Listing",editListing:"Edit Listing",addDescription:"Create a new product listing for buyers to discover and order.",editDescription:"Update your listing details, pricing, and availability.",productName:"Product Name",productNamePlaceholder:"Enter product name",description:"Description",descriptionPlaceholder:"Describe quality, freshness, and packaging details",category:"Category",selectCategory:"Select category",price:"Price",quantity:"Quantity",location:"Location",locationPlaceholder:"Village, mandi, or pickup location",available:"Available",active:"Active",inactive:"Inactive",activate:"Activate",deactivate:"Deactivate",noListingsYet:"No listings yet",searchPlaceholder:"Search by name, ID, village, or location",startSelling:"Start selling by creating your first product listing.",addFirstListing:"Add Your First Listing",noDescription:"No description",createSuccess:"Listing created successfully",updateSuccess:"Listing updated successfully",deleteSuccess:"Listing deleted successfully",fetchError:"Failed to load listings",saveError:"Failed to save listing",deleteError:"Failed to delete listing",statusError:"Failed to update listing status",activated:"Listing activated",deactivated:"Listing deactivated",listingCreated:"Listing created successfully",listingUpdated:"Listing updated successfully",listingDeleted:"Listing deleted successfully"},orders:{title:"Orders",subtitle:"View and manage incoming buyer orders",orderId:"Order ID",buyer:"Buyer",seller:"Seller",product:"Product",crop:"Crop",total:"Total",date:"Date",status:"Status",pending:"Pending",confirmed:"Confirmed",shipped:"Shipped",delivered:"Delivered",rejected:"Rejected",noOrdersYet:"You haven't received any orders yet.",viewDetails:"View",confirmOrder:"Confirm Order",rejectOrder:"Reject",markShipped:"Mark as Shipped",markDelivered:"Mark as Delivered",orderUpdated:"Order status updated"},earnings:{title:"Earnings",financialOverview:"Financial Overview",trackEarnings:"Track your earnings and manage payments",totalSales:"Total Sales",pendingPayments:"Pending Payments",completedOrders:"Completed Orders",noEarningsYet:"No earnings yet",startSelling:"Start selling to see your earnings here.",completedOrdersInfo:"completed orders",pendingOrdersInfo:"pending orders",fromSales:"From completed sales",recentTransactions:"Recent Transactions",noTransactions:"No transactions yet",createListing:"Create a Listing"},settings:{title:"Settings",profileSettings:"Profile Settings",profile_information:"Profile Information",profileInfo:"Profile Information",update_info:"Update your personal information and contact details",updateProfile:"Update your personal information and contact details",full_name:"Full Name",fullName:"Full Name",full_name_placeholder:"Your full name",phone:"Phone Number",phoneNumber:"Phone Number",village:"Village",village_placeholder:"Your village name",district:"District",district_placeholder:"Your district",saveChanges:"Save Changes",saving:"Saving...",preferences:"Preferences",push_notifications:"Push Notifications",pushNotifications:"Push Notifications",push_notifications_desc:"Receive alerts about your crops and orders",receiveAlerts:"Receive alerts about your crops and orders",language:"Language",languageLabel:"Language / ",english:"English",kannada:"",account_security:"Account Security",accountSecurity:"Account Security",account_security_desc:"Manage your password and security settings",managePassword:"Manage your password and security settings",configure:"Configure",change:"Change",manage:"Manage",yourFullName:"Your full name",profileUpdated:"Profile updated successfully"},weather:{title:"Weather Today",humidity:"Humidity",wind:"Wind",feels:"Feels",updated:"Updated",cached:"(cached)",offline:"(offline)",setLocation:"Set your location to see weather",lastUpdated:"Last updated"},marketPrices:{title:"Karnataka Mandi Prices",pricesFor:"Prices for",yourCrops:"Prices for your crops",todaysRates:"Today's market rates",setDistrict:"Set your district to see personalized local mandi prices",noPriceData:"No price data available",addCropsForPrices:"Add crops to see relevant market prices",priceForecast:"Price Forecast",dataUpdated:"Data updated",statewidePrices:"Statewide prices",neighborBest:"Nearby best",staleData:"Data may be outdated",confidence:"Confidence",high:"High",medium:"Medium",low:"Low",syncPending:"Sync pending"},advisories:{title:"Advisories & Alerts",setDistrictForAlerts:"Set your district to see local advisories and alerts",noNotifications:"No notifications yet",viewAll:"View all notifications"},emptyStates:{noCrops:"No crops added yet",noFarmlands:"No farmlands added yet",noTransport:"No transport requests yet",noListings:"No listings yet",noOrders:"No orders yet",noData:"No data available",checkBackLater:"Check back later for new updates"},locationPrompt:{setLocation:"Set Your Location",whyImportant:"Your location helps us show local weather, market prices, and advisories.",setNow:"Set Location Now"},validation:{required:"This field is required",name_required:"Please enter your name",phone_required:"Please enter a valid 10-digit phone number",invalidPhone:"Please enter a valid phone number",invalidEmail:"Please enter a valid email",invalid_email:"Please enter a valid email",minLength:"Must be at least {min} characters"},notifications:{view_all:"View all notifications",viewAll:"View all notifications",no_notifications:"No notifications yet",noNotifications:"No notifications yet"},toast:{profileUpdated:"Profile updated successfully",cropAdded:"Crop added successfully",cropDeleted:"Crop deleted",farmlandAdded:"Farmland added successfully",farmlandDeleted:"Farmland deleted",transportRequested:"Transport request submitted",listingCreated:"Listing created successfully",listingUpdated:"Listing updated successfully",listingDeleted:"Listing deleted successfully",orderUpdated:"Order status updated",languageChanged:"Language changed",errorOccurred:"An error occurred",tryAgain:"Please try again",dataSynced:"Data synced successfully",loadAccepted:"Load accepted successfully",tripUpdated:"Trip status updated",messageSent:"Message sent successfully"},marketplace:{welcomeMarketplace:"Welcome to AgriNext Gen Marketplace!",setupBuyerProfile:"Set up your buyer profile to start purchasing fresh produce directly from farmers.",createBuyerProfile:"Create Buyer Profile",creatingProfile:"Creating...",browseProducts:"Browse Products",browseMarketplace:"Browse Marketplace",searchProducts:"Search products...",searchCrops:"Search crops...",allCategories:"All Categories",allStatus:"All Status",sortBy:"Sort by",priceRange:"Price Range",available:"Available",freshHarvest:"Fresh Harvest",comingSoon:"Coming Soon",activeOrdersLabel:"Active Orders",freshHarvestAvailable:"Fresh Harvest Available",yourActiveOrders:"Your Active Orders",addToCart:"Add to Cart",contactSeller:"Contact Seller",productDetails:"Product Details",sellerInfo:"Seller Information",similarProducts:"Similar Products",noProductsFound:"No products found",tryDifferentFilters:"Try different search terms or filters",productsAvailable:"products available",newestFirst:"Newest First",harvestDateSort:"Harvest Date",quantityHigh:"Quantity: High",quantityLow:"Quantity: Low",viewDetails:"View Details",aiStockAdvisor:"AI Stock Advisor",stockAdvisorContext:"Get recommendations on what to stock this week from your market profile and fresh inventory.",stockAdvisorCta:"What Should I Stock?",stockAdvisorAnalyzing:"Analyzing...",stockAdvisorFallback:"Get AI-powered recommendations based on market trends and your buyer profile."},logistics:{welcomeTransporter:"Welcome, Transporter!",setupTransporterProfile:"Set up your transporter profile to start accepting loads and managing trips.",createProfile:"Create Profile",creatingProfile:"Creating...",transporterDashboard:"Transporter Dashboard",setYourLocation:"Set your location",acceptedTrips:"Accepted Trips",inProgress:"In Progress",todaysActiveTrips:"Today's Active Trips",newLoadRequests:"New Load Requests",availableLoads:"Available Loads",loadsWaiting:"loads waiting for pickup",searchLoads:"Search by farmer, crop, or village...",loadRequests:"Load Requests",noLoadsFound:"No available loads found",checkBackLater:"Check back later for new transport requests",farmer:"Farmer",action:"Action",acceptLoad:"Accept Load",confirmAccept:"Confirm Accept",accepting:"Accepting...",aboutToAccept:"You are about to accept this load. Once accepted, it will appear in your Active Trips.",assignVehicle:"Assign Vehicle (Optional)",selectVehicle:"Select a vehicle",activeTrips:"Active Trips",tripHistory:"Trip History",noActiveTrips:"No active trips",completedTrips:"Completed Trips",tripDetails:"Trip Details",updateStatus:"Update Status",proofOfPickup:"Proof of Pickup",proofOfDelivery:"Proof of Delivery",reportIssue:"Report Issue",tripCompleted:"Trip completed successfully",aiSuggestions:"AI-Powered Suggestions",aiSuggestionsContext:"Optimize routing and return loads to reduce idle distance and improve earnings.",suggestBestRoute:"Suggest Best Route",analyzing:"Analyzing...",findReturnLoads:"Find Return Loads",finding:"Finding...",routeOptimization:"Route Optimization",routeOptimizationHint:'Click "Suggest Best Route" to get AI-recommended pickup sequencing.',reverseLogistics:"Reverse Logistics",reverseLogisticsHint:'Click "Find Return Loads" to identify profitable return trips.'},agent:{dashboard:"Agent Dashboard",myTasks:"My Tasks",farmersAndCrops:"Farmers & Crops",transportAssist:"Transport Assist",assignedFarmers:"Assigned Farmers",pendingTasks:"Pending Tasks",completedTasks:"Completed Tasks",cropsNearHarvest:"Crops Near Harvest",addNote:"Add Note",uploadSoilReport:"Upload Soil Report",recordVoiceNote:"Record Voice Note",taskCompleted:"Task completed",taskUpdated:"Task updated",viewFarmerProfile:"View Farmer Profile",fieldVisit:"Field Visit",verifyCrop:"Verify Crop",harvestCheck:"Harvest Check"},admin:{dashboard:"Admin Command Center",commandCenter:"Admin Command Center",completeVisibility:"Complete ecosystem visibility and control",manageFarmers:"Manage Farmers",manageAgents:"Manage Agents",manageBuyers:"Manage Buyers",manageTransporters:"Manage Transporters",aiConsole:"AI Console",dataHealth:"Data Health",seedTestData:"Seed Test Data",clusterHealth:"Cluster Health",supplyDemand:"Supply-Demand",priceAnomaly:"Price Anomaly",efficiency:"Efficiency",aiAnalysis:"AI Analysis Result",aiAnalysisGenerated:"AI analysis generated!",failedToGenerate:"Failed to generate AI analysis",syncNow:"Sync Now",forceSync:"Force Sync",lastSync:"Last Sync",syncSuccess:"Sync completed successfully",syncFailed:"Sync failed"},enum:{crop_status:{growing:"Growing",one_week:"1 Week",ready:"Ready",harvested:"Harvested"},transport_status:{requested:"Requested",assigned:"Assigned",en_route:"En Route",picked_up:"Picked Up",delivered:"Delivered",cancelled:"Cancelled"},order_status:{pending:"Pending",confirmed:"Confirmed",shipped:"Shipped",delivered:"Delivered",cancelled:"Cancelled",rejected:"Rejected"},task_status:{pending:"Pending",in_progress:"In Progress",completed:"Completed"},task_type:{visit:"Visit",verify_crop:"Verify Crop",harvest_check:"Harvest Check",transport_assist:"Transport Assist"},categories:{vegetables:"Vegetables",fruits:"Fruits",grains:"Grains",pulses:"Pulses",dairy:"Dairy",spices:"Spices",other:"Other"},area_units:{acres:"Acres",hectares:"Hectares",bigha:"Bigha",guntha:"Guntha"},soil_types:{alluvial:"Alluvial",black:"Black",red:"Red",laterite:"Laterite",sandy:"Sandy",clay:"Clay",loamy:"Loamy"},units:{piece:"Piece",dozen:"Dozen"}},notificationsPage:{title:"Notifications",markAllRead:"Mark all as read",noNotifications:"No notifications",allCaughtUp:"You're all caught up!"},cropDiary:{title:"Crop Diary",activities:"Activities",photos:"Photos",addActivity:"Add Activity",uploadPhoto:"Upload Photo",reportDisease:"Report Disease",noActivities:"No activities logged yet",noPhotos:"No photos uploaded yet",photoReminder:"Photo Reminder",daysWithoutPhoto:"days without photo"},vehicles:{title:"My Vehicles",addVehicle:"Add Vehicle",vehicleType:"Vehicle Type",numberPlate:"Number Plate",capacity:"Capacity",noVehicles:"No vehicles added yet",addFirstVehicle:"Add your first vehicle to start accepting loads."},contact:{title:"Contact Us",name:"Name",email:"Email",message:"Message",send:"Send Message",sending:"Sending...",success:"Message sent successfully! We'll get back to you soon.",requiredFields:"Please fill in all required fields"}},Db={common:{save:"",save_changes:" ",saveChanges:"Save Changes",saving:"...",cancel:"",delete:"",edit:"",add:"",search:"",unit:"",filter:"",loading:" ...",retry:" ",viewAll:" ",back:"",next:"",submit:"",confirm:"",close:"",yes:"",no:"",error:"",success:"",warning:"",update:"",view:"",continue:"",signIn:" ",signOut:" ",signUp:" ",createAccount:" ",acres:"",kg:"",quintal:"",quintals:"",tonnes:"",perKg:"/",perQuintal:"/",refresh:"",configure:" ",manage:"",change:"",accept:"",reject:"",pending:"",completed:"",active:"",inactive:"",activate:"",deactivate:"",status:"",actions:"",details:"",date:"",time:"",name:"",phone:"",email:"",address:"",notes:"",description:"",descriptionPlaceholder:",     ",price:"",quantity:"",total:"",from:"",to:"",all:"",none:" ",select:" ",optional:"",required:"",unknown:"",notAvailable:"",flexible:"",clearFilters:" ",clearSearch:" ",noResultsFound:"  ",noData:" ",tryAgain:" ",live:"",saved:"",user:"",unread:"",loadMore:"",showAll:" ",noMoreItems:"  ",done:"",searchPlaceholderDetailed:", ,    "},auth:{welcome_back:" ",welcomeBack:" ",sign_in_continue:"     ",signInToContinue:"     ",email:"",password:"",email_placeholder:"you@example.com",emailPlaceholder:"you@example.com",passwordPlaceholder:"",signing_in:"  ...",signingIn:"  ...",sign_in:" ",or_continue_with:" ",orContinueWith:" ",continue_google:"Google  ",continueWithGoogle:"Google  ",no_account:" ?",dontHaveAccount:" ?",sign_up:" ",already_have_account:"  ?",alreadyHaveAccount:"  ?",joinAgriNextGen:"  ",selectRoleToStart:"    ",createYourAccount:"  ",fillInDetails:"   ",fullName:" ",fullNamePlaceholder:"  ",phoneNumber:" ",phoneOptional:"  ()",phonePlaceholder:"+91 9876543210",atLeast6Chars:" 6 ",creatingAccount:" ...",welcomeToAgriNextGen:"  ",connectWithBuyers:" ,          .",joinOurCommunity:"   ",becomePartOfNetwork:"    .     ,    .",invalid_credentials:"   .   .",invalidEmailPassword:"   .   .",pleaseEnterValidEmail:"    ",pleaseFillAllFields:"    ",accountCreated:" !",welcomeSignedIn:"  .     .",emailAlreadyRegistered:"   .    .",unexpectedError:"  .   .",login_failed:" ",loginFailed:" ",login_success:"    .",successfullySignedIn:"    .",phone:"",phone_otp_hint:" 10    . OTP SMS  .",send_otp:"OTP ",sending_otp:"OTP ...",enter_otp:"OTP ",otp_sent_to:"OTP ",verify_otp:"OTP ",verifying:"...",change_phone:"  ",otp_sent:"OTP ",otp_sent_description:"    .",otp_invalid:"  6  OTP .",check_email_confirm:"     .     .",email_confirmation_required:"  ",select_role_to_login:"      ",phone_or_email_exists:"      .    .",signup_failed:"  ",account_exists:"  ",rate_limit_exceeded:"  .       .",rate_limit_retry_hint:"  .       .",email_optional:" ()",email_optional_hint:".   .",signOut:"???? ???"},roles:{farmer:"",farmerDesc:"   ",farmer_description:"   ",buyer:"",buyerDesc:"  ",buyer_description:"  ",agent:"",agentDesc:"  ",agent_description:"  ",logistics:"",logisticsDesc:" ",logistics_description:" ",admin:"",adminDesc:" "},nav:{dashboard:"?????????????",myDay:"???? ???",today:"????",crops:"???? ???????",farmlands:"???? ????",transport:"??????",listings:"????????",orders:"??????????",earnings:"????",settings:"???????????",notifications:"???????????",cropDiary:"???? ????",logout:"???? ???",browseProducts:"????????????? ?????? ????",myOrders:"???? ??????????",profile:"????????",availableLoads:"???? ????????",activeTrips:"?????? ??????????",completed:"????????????",myVehicles:"???? ???????",myTasks:"???? ????????",myFarmers:"???? ?????",farmersAndCrops:"????? ????? ???????",farmers:"?????",buyers:"??????????",agents:"??????????",transporters:"???????????",allCrops:"????? ???????",dataHealth:"???? ??????",aiConsole:"AI ???????",seedData:"Seed Data",serviceArea:"???? ??????",opsInbox:"Ops Inbox",tickets:"??????????",pendingUpdates:"???? ?????????",aiReview:"AI Review",jobs:"Jobs",finance:"Finance",mysuruDemo:"?????? ????"},dashboardShell:{title:{farmer:"AgriNext Gen",agent:"AgriNext Gen Agent",logistics:"AgriNext Gen Transport",buyer:"AgriNext Gen Market",admin:"AgriNext Gen Admin"},subtitle:{agent:"??????? ?????????????",logistics:"???????????? ???????",buyer:"??????????????? ????????",admin:"?????? ??????"}},dashboard:{welcome:"",locationNotSet:"  ",profileCompletion:" ",completeProfile:"      ",almostThere:" !    ",justALittle:"    ",totalLand:" ",activeCrops:" ",readyToHarvest:" ",pendingTransport:" ",completeProfileLink:"  ",totalFarmers:" ",activeBuyers:" ",activeTransporters:"",harvestReady:" ",newOrdersToday:"  ",pendingOrders:" ",recentActivity:" ",noRecentActivity:"  ",quickActions:" "},crops:{title:" ",addCrop:" ",addNewCrop:"  ",cropName:" ",cropNameRequired:"  *",variety:"",farmland:" ",sowingDate:" ",harvestDate:" ",expectedQuantity:" ",unit:"",status:"",growing:"",oneWeek:"1  ",oneWeekShort:"1 ",ready:" ",readyShort:"",readyNow:" ",oneWeekAway:"1  ",harvested:" ",totalCrops:" ",noCropsYet:"  ",noActiveCrops:"  ",noCropsFound:"  ",startByAdding:"         .",addFirstCrop:"   ",requestTransport:" ",viewDiary:" ",deleteCrop:" ",harvest:"",est:"",cropDeleted:" ",cropHasBeenRemoved:".",errorAddingCrop:"  ",errorDeletingCrop:"  ",cropAddedSuccess:"   .",searchPlaceholder:", ,    ",selectFarmland:"  ",noFarmlandsYet:"  .",addFarmlandFirst:"  ",fieldsMarkedRequired:"*   .",cropNameHelp:"    , : , , ",varietyHelp:"   , :   IR-64",farmlandHelp:"       ",sowingDateHelp:"   ?",harvestDateHelp:"   ?",quantityHelp:"     ?",tryAdjustingFilters:"        ."},farmer:{crops:{viewAllCrops:"????? ?????????? ????",myCrops:"???? ???????",cropNamePlaceholder:"???? ????? ???????",varietyPlaceholder:"??? ??????? (??????)",editCrop:"???? ??????",addCropDescription:"???? ????????, ?????? ??????? ????? ?????? ????????? ???? ??????.",diary:"????",addSuccess:"???? ?????????? ???????????",updateSuccess:"???? ?????????? ?????????????",deleted:"???? ??????????",deleteSuccess:"???? ?????????? ???????????????.",deleteConfirm:"? ????????? ?????? ??????? ? ??????????? ???????????????."},farmlands:{editFarmland:"???? ??????",addFarmlandDescription:"???? ????? ?????? ??????? ???? ?????????? ??????.",plotNamePlaceholder:"?????? ????? ???? ??? ???????",plotNameHelp:"??????? ???????? ????????? ????? ???? ??? ????.",areaHelp:"? ???????? ????? ?????????????? ??????? ???????.",soilTypeHelp:"??????????? ????? ?????? ??????????? ?????????. ???? ????????????.",selectSoilType:"?????? ?????? ?????????",noFarmlandsFound:"?????? ??????? ???????????",adjustSearch:"?????? ?????????? ??????? ????? ???????????? ??????.",startAddingFarmlands:"???? ????? ????? ?????? ?????????? ????? ????? ????????? ??????.",addSuccess:"???? ?????????? ???????????",updateSuccess:"???? ?????????? ?????????????",deleted:"???? ??????????",deleteSuccess:"???? ?????????? ???????????????.",deleteConfirm:"? ????????? ?????? ??????? ??????? ??????? ????? ?????? ???????????????."},transport:{crop:"????",requestDescription:"??????? ???????????? ????????? ???? ?????????? ??????? ?????? ?????.",cropHelp:"????? ????? ????????? ?????????.",quantityHelp:"?????????? ?????? ???????.",pickupHelp:"?????????? ???????? ???????? ????? ???? ????.",timeHelp:"???????? ????????? ???????? ?????????.",timePlaceholder:"??????? ????? ??? ?????????",selectTime:"??? ?????? ?????????",earlyMorning:"???????? ??? (5-8 AM)",morning:"???????? (8-11 AM)",afternoon:"???????? (12-3 PM)",evening:"???? (4-6 PM)",noRequestsFound:"?????? ?????? ????????? ???????????",tryDifferentFilter:"???? ?????? ??????? ??????????.",startRequestingTransport:"???? ??????? ?????????? ???? ?????? ?????? ?????.",requestSuccess:"?????? ?????? ?????????? ????????????",cancelSuccess:"?????? ?????? ?????????? ????????????????",generalProduce:"??????? ???????",cancelRequest:"?????? ?????",cancelTransportRequest:"?????? ?????? ?????",cancelConfirm:"? ?????? ??????????? ?????????? ???????",yesCancel:"????, ?????????"},market:{title:"???? ???????",staleData:"???? ??????????????. ???????? ????????? ???????? ?????.",setDistrict:"???????? ??????????? ????? ??????????? ???????.",addCrops:"?????? ??????? ?????????? ????? ?????????? ??????.",noData:"???? ???? ?????????",syncPending:"???? ????? ????????",forecast:"???? ?????????",lastUpdated:"????? ??????"}},farmlands:{title:" ",addFarmland:" ",addNewFarmland:"  ",plotName:" /  ",area:"",soilType:" ",village:"",district:"",totalPlots:" ",totalAcres:" ",soilTypes:" ",villages:"",noFarmlandsYet:"  ",searchPlaceholder:", ,    ",addFarmlandsToTrack:"  ,         .",addFirstFarmland:"   ",soilReports:" ",deleteFarmland:" ",deleteWarning:"        .",farmlandDeleted:" ",farmlandDeletedSuccess:".",errorDeletingFarmland:"  ",yourVillage:"  ",yourDistrict:" "},transport:{title:" ",newRequest:" ",requestTransport:" ",activeRequests:" ",completed:"",inTransit:"",totalRequests:" ",quantity:"",pickupLocation:" ",dropLocation:" ",preferredDate:" ",preferredTime:" ",notes:"",status:"",requested:"",assigned:"",enRoute:"",pickedUp:"  ",delivered:"",cancelled:"",noTransportYet:"  ",whenReady:"  ,    .",createFirstRequest:"  ",submitRequest:" ",selectCrop:" ",enterQuantity:" ",enterLocation:"  ",addNotes:"   ..."},listings:{title:"????????",addListing:"????? ??????",addNewListing:"??? ????? ?????",createListing:"????? ?????",updateListing:"????? ????????",editListing:"????? ??????",addDescription:"?????????? ????? ????? ?????? ????? ??? ??????? ?????????? ?????.",editDescription:"?????? ????, ???? ????? ??????????? ????????.",productName:"???????? ?????",productNamePlaceholder:"???????? ????? ???????",description:"??????",descriptionPlaceholder:"???????, ?????? ????? ??????????? ?????????? ???????",category:"????",selectCategory:"???? ?????????",price:"????",quantity:"??????",location:"????",locationPlaceholder:"?????, ???? ???? ????? ????",available:"????",active:"??????",inactive:"?????????",activate:"????????????",deactivate:"???????????????",noListingsYet:"????? ???????? ????",searchPlaceholder:"?????, ???, ????? ???? ???????? ??????...",startSelling:"????? ???? ??????? ?????????? ????? ????? ??????????.",addFirstListing:"????? ???? ?????????? ??????",noDescription:"?????? ????",createSuccess:"????? ?????????? ??????????",updateSuccess:"????? ?????????? ?????????????",deleteSuccess:"????? ?????????? ??????????",fetchError:"??????????? ???? ????? ????",saveError:"????? ?????? ????",deleteError:"????? ?????? ????",statusError:"????? ?????? ????????? ????",activated:"????? ?????????????????",deactivated:"????? ????????????????????",listingCreated:"????? ?????????? ??????????",listingUpdated:"????? ?????????? ?????????????",listingDeleted:"????? ?????????? ??????????"},orders:{title:"Orders",subtitle:"View and manage incoming buyer orders",orderId:"Order ID",buyer:"Buyer",seller:"Seller",product:"Product",crop:"Crop",total:"Total",date:"Date",status:"Status",pending:"Pending",confirmed:"Confirmed",shipped:"Shipped",delivered:"Delivered",rejected:"Rejected",noOrdersYet:"You haven't received any orders yet.",viewDetails:"View",aiStockAdvisor:"AI Stock Advisor",stockAdvisorContext:"Get recommendations on what to stock this week from your market profile and fresh inventory.",stockAdvisorCta:"What Should I Stock?",stockAdvisorAnalyzing:"Analyzing...",stockAdvisorFallback:"Get AI-powered recommendations based on market trends and your buyer profile.",confirmOrder:"Confirm Order",rejectOrder:"Reject",markShipped:"Mark as Shipped",markDelivered:"Mark as Delivered",orderUpdated:"Order status updated"},earnings:{title:"",financialOverview:" ",trackEarnings:"      ",totalSales:" ",pendingPayments:" ",completedOrders:" ",noEarningsYet:" ",startSelling:"     .",completedOrdersInfo:" ",pendingOrdersInfo:" ",fromSales:" ",recentTransactions:" ",noTransactions:" ",createListing:" "},settings:{title:"",profileSettings:"???????? ????????????",profile_information:" ",profileInfo:" ",update_info:"      ",updateProfile:"      ",full_name:" ",fullName:" ",full_name_placeholder:"  ",phone:" ",phoneNumber:" ",village:"",village_placeholder:"  ",district:"",district_placeholder:" ",saveChanges:" ",saving:"...",preferences:"",push_notifications:" ",pushNotifications:" ",push_notifications_desc:"      ",receiveAlerts:"      ",language:"",languageLabel:"Language / ",english:"English",kannada:"",account_security:" ",accountSecurity:" ",account_security_desc:"     ",managePassword:"     ",configure:" ",change:"",manage:"",yourFullName:"  ",profileUpdated:"  "},weather:{title:" ",humidity:"",wind:"",feels:"",updated:"",cached:"()",offline:"()",setLocation:"     ",lastUpdated:" "},marketPrices:{title:"  ",pricesFor:"",yourCrops:"  ",todaysRates:"  ",setDistrict:"        ",noPriceData:"  ",addCropsForPrices:"     ",priceForecast:" ",dataUpdated:" ",statewidePrices:" ",neighborBest:" ",staleData:" ",confidence:"",high:"",medium:"",low:"",syncPending:" "},advisories:{title:"  ",setDistrictForAlerts:"        ",noNotifications:" ",viewAll:"  "},emptyStates:{noCrops:"  ",noFarmlands:"  ",noTransport:"  ",noListings:" ",noOrders:" ",noData:" ",checkBackLater:"   "},locationPrompt:{setLocation:"   ",whyImportant:"   ,       .",setNow:"   "},validation:{required:"  ",name_required:"   ",phone_required:"  10    ",invalidPhone:"   ",invalidEmail:"  ",invalid_email:"  ",minLength:" {min} "},marketplace:{welcomeMarketplace:"AgriNext Gen Marketplace ?? ??????!",setupBuyerProfile:"??????? ??????? ???? ??????? ???????? ????? ????????? ???????? ??????????.",createBuyerProfile:"????????? ???????? ?????",creatingProfile:"??????????????...",browseProducts:"????????????? ?????? ????",browseMarketplace:"??????????????? ?????? ????",searchProducts:"????????????? ??????...",searchCrops:"?????????? ??????...",allCategories:"????? ???????",allStatus:"????? ?????????",sortBy:"????????",priceRange:"???? ??????",available:"????",freshHarvest:"???? ??????",comingSoon:"??????????",activeOrdersLabel:"?????? ??????????",freshHarvestAvailable:"???? ?????? ????",yourActiveOrders:"????? ?????? ??????????",addToCart:"????????? ??????",contactSeller:"????????????? ?????????",productDetails:"??????? ???????",sellerInfo:"????????? ??????",similarProducts:"???? ??????????",noProductsFound:"?????? ?????????? ???????????",tryDifferentFilters:"???? ??????? ????? ???? ?????????????? ??????????",productsAvailable:"?????????? ????",newestFirst:"????? ?????",harvestDateSort:"?????? ??????",quantityHigh:"??????: ??????",quantityLow:"??????: ?????",viewDetails:"?????????? ????",aiStockAdvisor:"AI ?????? ???????",stockAdvisorContext:"????? ????????? ???????? ????? ???? ?????? ?????? ? ??? ??? ?????? ??????? ?????? ????????????? ???????.",stockAdvisorCta:"??? ?????? ????????",stockAdvisorAnalyzing:"???????????????????...",stockAdvisorFallback:"????????? ???????? ????? ????? ????????? ???????? ?????? AI ????????????? ???????."},logistics:{welcomeTransporter:"??????, ?????????!",setupTransporterProfile:"??????????? ?????????? ????? ????????????? ?????????? ????? ?????? ???????? ??????????.",createProfile:"???????? ?????",creatingProfile:"??????????????...",transporterDashboard:"?????????? ?????????????",setYourLocation:"????? ????????? ???????",acceptedTrips:"?????????? ??????????",inProgress:"?????????????",todaysActiveTrips:"????? ?????? ??????????",newLoadRequests:"??? ???? ?????????",availableLoads:"???? ????????",loadsWaiting:"?????????? ??????????? ????????",searchLoads:"???, ???? ???? ????????? ??????...",loadRequests:"???? ?????????",noLoadsFound:"?????? ???? ???????? ???????????",checkBackLater:"??? ?????? ????????????? ???? ?????????",farmer:"???",action:"??????",acceptLoad:"???? ?????????",confirmAccept:"??????? ?????????",accepting:"??????????????????...",aboutToAccept:"???? ? ???? ????? ????????????????. ?????????? ???? ??? ????? ?????? ????????????? ???????????.",assignVehicle:"???? ???????? (??????)",selectVehicle:"???? ?????????",activeTrips:"?????? ??????????",tripHistory:"?????? ??????",noActiveTrips:"?????? ?????????? ????",completedTrips:"????????? ??????????",tripDetails:"?????? ???????",updateStatus:"?????? ????????",proofOfPickup:"????? ??????",proofOfDelivery:"???????? ??????",reportIssue:"?????? ???? ????",tripCompleted:"?????? ?????????? ????????????",aiSuggestions:"AI ?????? ???????",aiSuggestionsContext:"???? ??????? ????? ???? ???? ????????? ????? ????? ??????? ??????????? ????????.",suggestBestRoute:"????? ????? ??????",analyzing:"???????????????????...",findReturnLoads:"??????? ??????????? ??????",finding:"???????????????...",routeOptimization:"????? ???????",routeOptimizationHint:'AI ??????? ????? ????? ?????????? "????? ????? ??????" ?????.',reverseLogistics:"??????? ????????????",reverseLogisticsHint:'??????? ???? ????????????? ??????????? "??????? ??????????? ??????" ?????.'},agent:{dashboard:" ",myTasks:" ",farmersAndCrops:"  ",transportAssist:" ",assignedFarmers:" ",pendingTasks:" ",completedTasks:" ",cropsNearHarvest:"  ",addNote:" ",uploadSoilReport:"   ",recordVoiceNote:"   ",taskCompleted:" ",taskUpdated:" ",viewFarmerProfile:"  ",fieldVisit:" ",verifyCrop:" ",harvestCheck:" "},admin:{dashboard:"  ",commandCenter:"  ",completeVisibility:"     ",manageFarmers:" ",manageAgents:" ",manageBuyers:" ",manageTransporters:" ",aiConsole:"AI ",dataHealth:" ",seedTestData:"   ",clusterHealth:" ",supplyDemand:"-",priceAnomaly:" ",efficiency:"",aiAnalysis:"AI  ",aiAnalysisGenerated:"AI  !",failedToGenerate:"AI   ",syncNow:"  ",forceSync:" ",lastSync:" ",syncSuccess:"  ",syncFailed:" "},enum:{crop_status:{growing:"",one_week:"1 ",ready:"",harvested:" "},transport_status:{requested:"",assigned:"",en_route:"",picked_up:"  ",delivered:"",cancelled:""},order_status:{pending:"",confirmed:"",shipped:"",delivered:"",cancelled:"",rejected:""},task_status:{pending:"",in_progress:"",completed:""},task_type:{visit:"",verify_crop:" ",harvest_check:" ",transport_assist:" "},categories:{vegetables:"?????????",fruits:"????????",grains:"????????",pulses:"???????",dairy:"???? ??????????",spices:"????????",other:"????"},area_units:{acres:"????",hectares:"????????",bigha:"????",guntha:"?????"},soil_types:{alluvial:"????????",black:"??? ?????",red:"????? ?????",laterite:"?????????",sandy:"???? ?????",clay:"?????????",loamy:"???? ?????"},units:{piece:"?????",dozen:"????"}},notifications:{view_all:"  ",viewAll:"  ",no_notifications:"",noNotifications:""},toast:{profileUpdated:"  ",cropAdded:"  ",cropDeleted:" ",farmlandAdded:"  ",farmlandDeleted:" ",transportRequested:"  ",listingCreated:"  ",listingUpdated:"  ",listingDeleted:"  ",orderUpdated:"  ",languageChanged:" ",errorOccurred:" ",tryAgain:"  ",dataSynced:"   ",loadAccepted:"  ",tripUpdated:"  ",messageSent:"  "},notificationsPage:{title:"",markAllRead:"   ",noNotifications:"",allCaughtUp:"  !"},cropDiary:{title:" ",activities:"",photos:"",addActivity:" ",uploadPhoto:"  ",reportDisease:"  ",noActivities:"   ",noPhotos:"   ",photoReminder:" ",daysWithoutPhoto:"  "},vehicles:{title:" ",addVehicle:" ",vehicleType:" ",numberPlate:" ",capacity:"",noVehicles:"  ",addFirstVehicle:"     ."},contact:{title:" ",name:"",email:"",message:"",send:" ",sending:"...",success:"  !   .",requiredFields:"     "}},Eb={"auth.sign_out":"auth.signOut","settings.profile_settings":"settings.profileSettings","common.saveChanges":"common.save_changes","common.unit":"crops.unit","common.clearSearch":"common.clearFilters","enum.units.kg":"common.kg","enum.units.quintals":"common.quintals","enum.units.tonnes":"common.tonnes","farmer.crops.myCrops":"crops.title","farmer.crops.diary":"crops.viewDiary","farmer.crops.noFarmlands":"crops.noFarmlandsYet","farmer.crops.adjustSearch":"crops.tryAdjustingFilters","farmer.crops.startAddingCrops":"crops.startByAdding","farmer.farmlands.villagePlaceholder":"farmlands.yourVillage","farmer.farmlands.districtPlaceholder":"farmlands.yourDistrict","farmer.transport.pickupPlaceholder":"transport.enterLocation","farmer.transport.notesPlaceholder":"transport.addNotes","farmer.transport.pending":"common.pending","farmer.listings.addNewListing":"listings.createListing","farmer.listings.editListing":"listings.updateListing","farmer.listings.createSuccess":"listings.listingCreated","farmer.listings.updateSuccess":"listings.listingUpdated","farmer.listings.deleteSuccess":"listings.listingDeleted","farmer.listings.quantity":"common.quantity","farmer.listings.available":"listings.available"},Ib=[{from:"farmer.crops.",to:"crops."},{from:"farmer.farmlands.",to:"farmlands."},{from:"farmer.transport.",to:"transport."},{from:"farmer.listings.",to:"listings."}];function Ob(t){for(const s of Ib)if(t.startsWith(s.from))return`${s.to}${t.slice(s.from.length)}`}function Fb(t){return Eb[t]??Ob(t)}const ro={en:Rb,kn:Db},Lb=new Set;function ao(t,s){const r=s.split(".");let a=t;for(const n of r){if(a==null)return;a=a[n]}return typeof a=="string"?a:void 0}function qb(t,s){const r=`${s}:${t}`;Lb.has(r)}function Dp(t,s="en"){const r=ao(ro[s],t);if(r!==void 0)return r;const a=Fb(t);if(a&&a!==t){const n=ao(ro[s],a);if(n!==void 0)return n}if(qb(t,s),s!=="en"){const n=ao(ro.en,t);if(n!==void 0)return n;if(a&&a!==t){const i=ao(ro.en,a);if(i!==void 0)return i}}return t.split(".").pop()||t}const Ep=x.createContext(void 0),Gl="agri-mitra-language";function zb({children:t}){const{user:s}=Fe(),[r,a]=x.useState(()=>localStorage.getItem(Gl)==="kn"?"kn":"en"),[n,i]=x.useState(!1);x.useEffect(()=>{(async()=>{if(s?.id)try{const{data:u,error:d}=await W.from("profiles").select("preferred_language").eq("id",s.id).maybeSingle();if(d)throw d;if(u?.preferred_language&&(u.preferred_language==="en"||u.preferred_language==="kn")){const p=u.preferred_language;a(p),localStorage.setItem(Gl,p)}}catch(u){console.error("Failed to load language preference:",u)}})()},[s?.id]);const o=x.useCallback(async l=>{if(i(!0),a(l),localStorage.setItem(Gl,l),s?.id)try{const{error:u}=await W.from("profiles").update({preferred_language:l}).eq("id",s.id);if(u)throw u;ce.success(l==="kn"?" ":"Language changed")}catch(u){console.error("Failed to save language preference:",u),ce.error("Failed to save language preference")}i(!1)},[s?.id]),c=x.useCallback(l=>Dp(l,r),[r]);return e.jsx(Ep.Provider,{value:{language:r,setLanguage:o,t:c,isLoading:n},children:t})}function Nt(){const t=x.useContext(Ep);return t===void 0?{language:"en",setLanguage:async()=>{},t:s=>Dp(s,"en"),isLoading:!1}:t}const Bb=5e3,$b={farmer:"/farmer/dashboard",buyer:"/marketplace/dashboard",agent:"/agent/dashboard",logistics:"/logistics/dashboard",admin:"/admin/dashboard"},Je=({children:t,allowedRoles:s})=>{const{user:r,loading:a,userRole:n,refreshRole:i,activeRole:o}=Fe(),c=Rn(),[l,u]=x.useState(!1);if(x.useEffect(()=>{if(!s||!r||(o??n))return;const h=setInterval(()=>{i()},1500),f=setTimeout(()=>{clearInterval(h),u(!0)},Bb);return()=>{clearInterval(h),clearTimeout(f)}},[s,r,n,o,i]),l)return e.jsx(ea,{to:"/login",state:{from:c,error:"Unable to load your account. Please try signing in again."},replace:!0});if(a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-primary/20"}),e.jsx(et,{className:"absolute inset-0 w-12 h-12 text-primary animate-spin"})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Loading your dashboard..."})]})});if(!r)return e.jsx(ea,{to:"/login",state:{from:c},replace:!0});const d=o??n;if(s&&d&&!s.includes(d)){const p=$b[d]||"/";return e.jsx(ea,{to:p,replace:!0})}return s&&!d?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-primary/20"}),e.jsx(et,{className:"absolute inset-0 w-12 h-12 text-primary animate-spin"})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Setting up your account..."}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"If this takes too long, you will be redirected to sign in again."})]})}):e.jsx(e.Fragment,{children:t})},xi=yi("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-semibold ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-soft hover:shadow-medium",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-2 border-primary bg-transparent text-primary hover:bg-primary hover:text-primary-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent/20 hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"bg-gradient-hero text-primary-foreground shadow-glow hover:shadow-medium hover:scale-[1.02] active:scale-[0.98]",accent:"bg-gradient-accent text-accent-foreground shadow-accent hover:shadow-medium hover:scale-[1.02] active:scale-[0.98]",glass:"bg-background/80 backdrop-blur-sm border border-border/50 text-foreground hover:bg-background/90 shadow-soft"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-md px-4",lg:"h-12 rounded-lg px-8 text-base",xl:"h-14 rounded-xl px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),z=x.forwardRef(({className:t,variant:s,size:r,asChild:a=!1,...n},i)=>{const o=a?Sy:"button";return e.jsx(o,{className:ke(xi({variant:s,size:r,className:t})),ref:i,...n})});z.displayName="Button";const Co=Ty,So=Py,Ub=x.forwardRef(({className:t,inset:s,children:r,...a},n)=>e.jsxs(nh,{ref:n,className:ke("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",s&&"pl-8",t),...a,children:[r,e.jsx(Wa,{className:"ml-auto h-4 w-4"})]}));Ub.displayName=nh.displayName;const Hb=x.forwardRef(({className:t,...s},r)=>e.jsx(ih,{ref:r,className:ke("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s}));Hb.displayName=ih.displayName;const gi=x.forwardRef(({className:t,sideOffset:s=4,...r},a)=>e.jsx(Ay,{children:e.jsx(oh,{ref:a,sideOffset:s,className:ke("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));gi.displayName=oh.displayName;const Rr=x.forwardRef(({className:t,inset:s,...r},a)=>e.jsx(lh,{ref:a,className:ke("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",s&&"pl-8",t),...r}));Rr.displayName=lh.displayName;const Vb=x.forwardRef(({className:t,children:s,checked:r,...a},n)=>e.jsxs(ch,{ref:n,className:ke("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),checked:r,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(dh,{children:e.jsx(Cr,{className:"h-4 w-4"})})}),s]}));Vb.displayName=ch.displayName;const Kb=x.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(uh,{ref:a,className:ke("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(dh,{children:e.jsx(Zh,{className:"h-2 w-2 fill-current"})})}),s]}));Kb.displayName=uh.displayName;const Rc=x.forwardRef(({className:t,inset:s,...r},a)=>e.jsx(mh,{ref:a,className:ke("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...r}));Rc.displayName=mh.displayName;const dn=x.forwardRef(({className:t,...s},r)=>e.jsx(hh,{ref:r,className:ke("-mx-1 my-1 h-px bg-muted",t),...s}));dn.displayName=hh.displayName;function Wb(){const{user:t,realRole:s,activeRole:r,isDevOverride:a,devExpiresAt:n,switchActiveRole:i}=Fe(),[o,c]=x.useState(r??s??"");return null}const gd=()=>{const[t,s]=x.useState(!1),{user:r,userRole:a,signOut:n}=Fe(),i=Ut(),o=u=>({farmer:"/farmer/dashboard",buyer:"/marketplace/dashboard",agent:"/agent/dashboard",logistics:"/logistics/dashboard",admin:"/admin/dashboard"})[u||""]||"/",c=u=>({farmer:"Farmer",buyer:"Buyer",agent:"Agent",logistics:"Logistics",admin:"Admin"})[u||""]||"User",l=async()=>{await n(),i("/")};return e.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-card/95 backdrop-blur-md border-b border-border/40 shadow-soft",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-6xl",children:[e.jsxs("div",{className:"flex items-center justify-between h-16 md:h-[68px]",children:[e.jsxs(xt,{to:"/",className:"flex items-center gap-2 group",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-gradient-premium flex items-center justify-center group-hover:scale-105 transition-transform",children:e.jsx(Ys,{className:"w-4 h-4 text-primary-foreground"})}),e.jsxs("span",{className:"text-lg font-display font-bold text-foreground",children:["AgriNext ",e.jsx("span",{className:"text-primary",children:"Gen"})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-8",children:[e.jsx(xt,{to:"/",className:"text-muted-foreground hover:text-foreground transition-colors font-medium text-sm",children:"Home"}),e.jsx(xt,{to:"/marketplace",className:"text-muted-foreground hover:text-foreground transition-colors font-medium text-sm",children:"Marketplace"}),e.jsx(xt,{to:"/about",className:"text-muted-foreground hover:text-foreground transition-colors font-medium text-sm",children:"About"}),e.jsx(xt,{to:"/contact",className:"text-muted-foreground hover:text-foreground transition-colors font-medium text-sm",children:"Contact"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[e.jsx(Wb,{}),r?e.jsxs(Co,{children:[e.jsx(So,{asChild:!0,children:e.jsxs(z,{variant:"outline",className:"gap-2 rounded-xl",children:[e.jsx(Ps,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize",children:c(a)})]})}),e.jsxs(gi,{align:"end",className:"w-48",children:[e.jsxs(Rr,{onClick:()=>i(o(a)),children:[e.jsx(Fa,{className:"w-4 h-4 mr-2"}),"My Dashboard"]}),e.jsx(dn,{}),e.jsxs(Rr,{onClick:l,className:"text-destructive",children:[e.jsx(_o,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"outline",asChild:!0,className:"rounded-xl border-border/80 hover:bg-muted/50 font-medium",children:e.jsx(xt,{to:"/login",children:"Log In"})}),e.jsx(z,{variant:"hero",asChild:!0,className:"rounded-xl font-semibold btn-hover-darken",children:e.jsx(xt,{to:"/signup",children:"Get Started"})})]})]}),e.jsx("button",{className:"md:hidden p-2 rounded-lg hover:bg-muted transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",onClick:()=>s(!t),"aria-label":t?"Close menu":"Open menu",children:t?e.jsx(ar,{className:"w-6 h-6"}):e.jsx(np,{className:"w-6 h-6"})})]}),t&&e.jsx("div",{className:"md:hidden py-4 border-t border-border/40 animate-fade-in",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(xt,{to:"/",className:"px-4 py-2.5 text-muted-foreground hover:text-foreground transition-colors font-medium rounded-lg hover:bg-muted/50",onClick:()=>s(!1),children:"Home"}),e.jsx(xt,{to:"/marketplace",className:"px-4 py-2.5 text-muted-foreground hover:text-foreground transition-colors font-medium rounded-lg hover:bg-muted/50",onClick:()=>s(!1),children:"Marketplace"}),e.jsx(xt,{to:"/about",className:"px-4 py-2.5 text-muted-foreground hover:text-foreground transition-colors font-medium rounded-lg hover:bg-muted/50",onClick:()=>s(!1),children:"About"}),e.jsx(xt,{to:"/contact",className:"px-4 py-2.5 text-muted-foreground hover:text-foreground transition-colors font-medium rounded-lg hover:bg-muted/50",onClick:()=>s(!1),children:"Contact"}),e.jsx("div",{className:"flex flex-col gap-3 px-4 pt-4 border-t border-border/40",children:r?e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"outline",asChild:!0,onClick:()=>s(!1),className:"rounded-xl min-h-[44px]",children:e.jsxs(xt,{to:o(a),children:[e.jsx(Fa,{className:"w-4 h-4 mr-2"}),"My Dashboard"]})}),e.jsxs(z,{variant:"ghost",onClick:()=>{l(),s(!1)},className:"text-destructive rounded-xl min-h-[44px]",children:[e.jsx(_o,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"outline",asChild:!0,className:"rounded-xl min-h-[44px]",children:e.jsx(xt,{to:"/login",children:"Log In"})}),e.jsx(z,{variant:"hero",asChild:!0,className:"rounded-xl min-h-[44px]",children:e.jsx(xt,{to:"/signup",children:"Get Started"})})]})})]})})]})})},Yb=()=>{const t=[{icon:Cs,label:"Farmers",desc:"Track crops, request transport, and sell with transparency.",color:"bg-primary"},{icon:tr,label:"Buyers",desc:"Source verified produce with traceable origin.",color:"bg-primary"},{icon:us,label:"Agents",desc:"Onboard and support farmers with field verification.",color:"bg-primary"},{icon:rt,label:"Transport",desc:"Accept loads, optimize routes, reduce empty runs.",color:"bg-primary"}];return e.jsxs("section",{className:"relative min-h-screen flex items-center justify-center overflow-hidden pt-20 pb-16",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-background via-background to-muted/50"}),e.jsx("div",{className:"absolute top-1/3 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] rounded-full bg-primary/5 blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-[400px] h-[400px] rounded-full bg-accent/8 blur-3xl"}),e.jsx("div",{className:"container mx-auto px-4 relative z-10 max-w-6xl",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-full bg-primary/8 border border-primary/15 mb-10 animate-fade-in",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary animate-pulse-soft"}),e.jsx("span",{className:"text-sm font-medium text-primary tracking-wide",children:"Connecting India's Agricultural Ecosystem"})]}),e.jsxs("h1",{className:"text-[32px] sm:text-[44px] md:text-[52px] lg:text-[60px] font-display font-bold leading-[1.1] mb-6 animate-slide-up text-foreground",children:["India's Agricultural"," ",e.jsx("span",{className:"text-gradient-hero",children:"Operating System"})]}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl text-muted-foreground max-w-3xl mx-auto mb-10 leading-relaxed animate-slide-up",style:{animationDelay:"0.1s"},children:"Unifying farmers, agents, transport, and buyers into one real-world platformbuilt for hyperlocal trade, traceability, and efficient logistics."}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mb-8 animate-slide-up",style:{animationDelay:"0.2s"},children:[e.jsx(z,{variant:"hero",size:"xl",asChild:!0,className:"min-h-[48px] px-8 text-base font-semibold rounded-2xl btn-hover-darken",children:e.jsxs(xt,{to:"/signup",className:"gap-2",children:["Join the Pilot Program",e.jsx(Ir,{className:"w-5 h-5"})]})}),e.jsx(z,{variant:"outline",size:"xl",asChild:!0,className:"min-h-[48px] px-8 text-base font-medium rounded-2xl border-2",children:e.jsx(xt,{to:"/login",children:"Sign In"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-3 sm:gap-6 mb-16 animate-slide-up text-sm",style:{animationDelay:"0.25s"},children:[e.jsx("span",{className:"text-muted-foreground font-medium",children:"Choose your path:"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-3",children:[e.jsx(z,{variant:"ghost",size:"sm",asChild:!0,className:"gap-2 text-primary hover:bg-primary/10",children:e.jsxs(xt,{to:"/signup",children:[e.jsx(ts,{className:"w-4 h-4"}),"I'm a Farmer / Agent"]})}),e.jsx(z,{variant:"ghost",size:"sm",asChild:!0,className:"gap-2 text-muted-foreground hover:text-foreground hover:bg-muted",children:e.jsxs(xt,{to:"/contact",children:[e.jsx(Pj,{className:"w-4 h-4"}),"I'm a Buyer / Partner"]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 max-w-5xl mx-auto animate-slide-up",style:{animationDelay:"0.3s"},children:t.map(s=>e.jsxs("div",{className:"group p-5 md:p-6 rounded-2xl bg-card border border-border/60 shadow-soft hover:shadow-medium transition-all duration-300 hover:-translate-y-1 text-left",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-premium flex items-center justify-center mb-4 group-hover:scale-105 transition-transform",children:e.jsx(s.icon,{className:"w-6 h-6 text-primary-foreground"})}),e.jsx("h3",{className:"text-lg font-display font-semibold text-foreground mb-2",children:s.label}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:s.desc})]},s.label))})]})})]})},Gb=[{icon:ep,title:"Multi-Role Platform",description:"Dashboards for each stakeholder with role-based workflows."},{icon:Qo,title:"Multilingual Support",description:"Regional language chat/voice support for adoption."},{icon:rt,title:"Smart Logistics",description:"Route suggestions + reverse-load planning (assistive)."},{icon:_r,title:"Real-time Updates",description:"Live status updates across crops, transport, and orders."},{icon:wo,title:"Market Intelligence",description:"Price signals and demand visibility (decision support)."},{icon:hi,title:"Traceability Ready",description:"Digital identity for produce transparency."}],Qb=()=>e.jsxs("section",{className:"py-20 md:py-24 bg-muted/30 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-80 h-80 rounded-full bg-primary/3 blur-3xl -translate-x-1/2 -translate-y-1/2"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-80 h-80 rounded-full bg-accent/5 blur-3xl translate-x-1/2 translate-y-1/2"}),e.jsxs("div",{className:"container mx-auto px-4 relative z-10 max-w-6xl",children:[e.jsxs("div",{className:"text-center max-w-2xl mx-auto mb-16",children:[e.jsx("span",{className:"text-primary font-semibold text-sm uppercase tracking-wider",children:"Capabilities"}),e.jsx("h2",{className:"text-[22px] sm:text-[28px] md:text-[34px] font-display font-bold mt-3 mb-4 text-foreground",children:"What the Platform Enables"}),e.jsx("p",{className:"text-muted-foreground text-base md:text-lg leading-relaxed",children:"System-grade tools designed for real agricultural operations."})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:Gb.map((t,s)=>e.jsxs("div",{className:"group p-5 md:p-6 rounded-2xl bg-card border border-border/60 shadow-soft hover:shadow-medium transition-all duration-300 hover:-translate-y-1",style:{animationDelay:`${s*.1}s`},children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-premium flex items-center justify-center mb-4 group-hover:scale-105 transition-transform",children:e.jsx(t.icon,{className:"w-7 h-7 text-primary-foreground"})}),e.jsx("h3",{className:"text-lg font-display font-semibold mb-2 text-foreground",children:t.title}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:t.description})]},t.title))})]})]}),hm=[{number:"01",icon:Ba,title:"Farm & Crop Data Captured",description:"Farmers and agents digitize farm records, crop details, and soil reports."},{number:"02",icon:hn,title:"AI-Assisted Planning",description:"Smart advisories, prioritization, and decision support for better outcomes."},{number:"03",icon:rt,title:"Market + Transport Execution",description:"Seamless logistics coordination and marketplace connections."},{number:"04",icon:Hr,title:"Traceability & Trust",description:"Digital identity for produce transparency that buyers can verify."}],Xb=()=>e.jsx("section",{className:"py-20 md:py-24 bg-background relative overflow-hidden",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-6xl",children:[e.jsxs("div",{className:"text-center max-w-2xl mx-auto mb-16",children:[e.jsx("span",{className:"text-primary font-semibold text-sm uppercase tracking-wider",children:"How It Works"}),e.jsx("h2",{className:"text-[22px] sm:text-[28px] md:text-[34px] font-display font-bold mt-3 mb-4 text-foreground",children:"How AgriNext Gen Works"}),e.jsx("p",{className:"text-muted-foreground text-base md:text-lg leading-relaxed",children:"A streamlined flow from farm data to verified delivery."})]}),e.jsxs("div",{className:"hidden lg:grid lg:grid-cols-4 gap-6 relative",children:[e.jsx("div",{className:"absolute top-12 left-[12%] right-[12%] h-0.5 bg-gradient-to-r from-primary/20 via-primary/40 to-primary/20"}),hm.map((t,s)=>e.jsxs("div",{className:"relative text-center",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-2xl bg-gradient-premium flex items-center justify-center shadow-glow relative z-10",children:e.jsx(t.icon,{className:"w-10 h-10 text-primary-foreground"})}),e.jsx("div",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-primary text-primary-foreground text-sm font-bold mb-4",children:s+1}),e.jsx("h3",{className:"text-lg font-display font-semibold text-foreground mb-2",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed px-2",children:t.description})]},t.number))]}),e.jsx("div",{className:"lg:hidden space-y-4",children:hm.map((t,s)=>e.jsxs("div",{className:"flex items-start gap-4 p-5 rounded-2xl bg-card border border-border/60 shadow-soft",children:[e.jsx("div",{className:"flex-shrink-0 w-14 h-14 rounded-xl bg-gradient-premium flex items-center justify-center",children:e.jsx(t.icon,{className:"w-7 h-7 text-primary-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-primary text-primary-foreground text-xs font-bold",children:s+1}),e.jsx("h3",{className:"text-base font-display font-semibold text-foreground",children:t.title})]}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:t.description})]})]},t.number))})]})}),Jb=[{icon:We,text:"District-first rollout approach"},{icon:mi,text:"Multilingual support for adoption"},{icon:va,text:"Real-time visibility across the chain"},{icon:hi,text:"Traceability-ready for premium markets"}],Zb=()=>e.jsx("section",{className:"py-16 md:py-20 bg-background relative overflow-hidden",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-5xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("span",{className:"text-primary font-semibold text-sm uppercase tracking-wider",children:"Built for India"}),e.jsx("h2",{className:"text-[22px] sm:text-[28px] md:text-[34px] font-display font-bold mt-3 mb-4 text-foreground",children:"Designed for Ground Reality"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-12",children:Jb.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-xl bg-card border border-border/60 shadow-soft",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(t.icon,{className:"w-5 h-5 text-primary"})}),e.jsx("span",{className:"text-sm font-medium text-foreground leading-snug",children:t.text})]},t.text))})]})}),ew=()=>e.jsx("section",{className:"py-24 relative overflow-hidden",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-card border border-border/50 shadow-medium -z-10"}),e.jsx("div",{className:"absolute -top-10 -right-10 w-40 h-40 rounded-full bg-accent/20 blur-3xl"}),e.jsx("div",{className:"absolute -bottom-10 -left-10 w-40 h-40 rounded-full bg-primary/20 blur-3xl"})]})})}),vd=()=>e.jsx("footer",{className:"bg-sidebar text-sidebar-foreground py-12 md:py-16",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-6xl",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12 mb-10 md:mb-12",children:[e.jsxs("div",{className:"sm:col-span-2 lg:col-span-1",children:[e.jsxs(xt,{to:"/",className:"inline-flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-sidebar-primary flex items-center justify-center",children:e.jsx(Ys,{className:"w-4 h-4 text-sidebar-primary-foreground"})}),e.jsxs("span",{className:"text-lg font-display font-bold",children:["AgriNext ",e.jsx("span",{className:"text-sidebar-primary",children:"Gen"})]})]}),e.jsx("p",{className:"text-sidebar-foreground/70 text-sm leading-relaxed max-w-xs",children:"India's agricultural operating systemconnecting farmers, agents, transport, and buyers."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-display font-semibold text-base mb-4",children:"Platform"}),e.jsxs("ul",{className:"space-y-2.5 text-sidebar-foreground/70 text-sm",children:[e.jsx("li",{children:e.jsx(xt,{to:"/signup",className:"hover:text-sidebar-primary transition-colors",children:"For Farmers"})}),e.jsx("li",{children:e.jsx(xt,{to:"/signup",className:"hover:text-sidebar-primary transition-colors",children:"For Buyers"})}),e.jsx("li",{children:e.jsx(xt,{to:"/signup",className:"hover:text-sidebar-primary transition-colors",children:"For Agents"})}),e.jsx("li",{children:e.jsx(xt,{to:"/signup",className:"hover:text-sidebar-primary transition-colors",children:"For Logistics"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-display font-semibold text-base mb-4",children:"Company"}),e.jsxs("ul",{className:"space-y-2.5 text-sidebar-foreground/70 text-sm",children:[e.jsx("li",{children:e.jsx(xt,{to:"/about",className:"hover:text-sidebar-primary transition-colors",children:"About Us"})}),e.jsx("li",{children:e.jsx(xt,{to:"/contact",className:"hover:text-sidebar-primary transition-colors",children:"Contact"})}),e.jsx("li",{children:e.jsx(xt,{to:"/login",className:"hover:text-sidebar-primary transition-colors",children:"Sign In"})}),e.jsx("li",{children:e.jsx(xt,{to:"/signup",className:"hover:text-sidebar-primary transition-colors",children:"Sign Up"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-display font-semibold text-base mb-4",children:"Contact"}),e.jsxs("ul",{className:"space-y-2.5 text-sidebar-foreground/70 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2.5",children:[e.jsx(hd,{className:"w-4 h-4 text-sidebar-primary flex-shrink-0"}),e.jsx("a",{href:"mailto:teamAgriNext.Gen@gmail.com",className:"hover:text-sidebar-primary transition-colors break-all",children:"teamAgriNext.Gen@gmail.com"})]}),e.jsxs("li",{className:"flex items-center gap-2.5",children:[e.jsx(hr,{className:"w-4 h-4 text-sidebar-primary flex-shrink-0"}),e.jsx("a",{href:"tel:+919980092461",className:"hover:text-sidebar-primary transition-colors",children:"+91 99800 92461"})]}),e.jsxs("li",{className:"flex items-start gap-2.5",children:[e.jsx(We,{className:"w-4 h-4 text-sidebar-primary mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Bengaluru, Karnataka, India"})]})]})]})]}),e.jsxs("div",{className:"pt-6 md:pt-8 border-t border-sidebar-border flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsx("p",{className:"text-sidebar-foreground/60 text-sm",children:" 2025 AgriNext Gen. All rights reserved."}),e.jsxs("div",{className:"flex items-center gap-4 md:gap-6 text-sm text-sidebar-foreground/60",children:[e.jsx(xt,{to:"/about",className:"hover:text-sidebar-primary transition-colors",children:"Privacy Policy"}),e.jsx(xt,{to:"/about",className:"hover:text-sidebar-primary transition-colors",children:"Terms of Service"})]})]})]})}),pm={farmer:"/farmer/dashboard",buyer:"/marketplace/dashboard",agent:"/agent/dashboard",logistics:"/logistics/dashboard",admin:"/admin/dashboard"},tw=()=>{const{user:t,userRole:s,loading:r}=Fe(),a=Ut(),{toast:n}=hs();return x.useEffect(()=>{const i=window.location.hash;if(i){const o=new URLSearchParams(i.slice(1)),c=o.get("error_code"),l=o.get("error_description")||o.get("error");if(c||l){window.history.replaceState(null,"",window.location.pathname+window.location.search),n({title:"Authentication failed",description:l||"Please try again.",variant:"destructive"}),a("/login",{replace:!0});return}}!r&&t&&s&&pm[s]&&a(pm[s],{replace:!0})},[t,s,r,a,n]),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(gd,{}),e.jsx(Yb,{}),e.jsx(Xb,{}),e.jsx(Qb,{}),e.jsx(Zb,{}),e.jsx(ew,{}),e.jsx(vd,{})]})},Ce=x.forwardRef(({className:t,type:s,...r},a)=>e.jsx("input",{type:s,className:ke("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...r}));Ce.displayName="Input";var sw="Label",Ip=x.forwardRef((t,s)=>e.jsx(ht.label,{...t,ref:s,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(t.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));Ip.displayName=sw;var Op=Ip;const rw=yi("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ie=x.forwardRef(({className:t,...s},r)=>e.jsx(Op,{ref:r,className:ke(rw(),t),...s}));ie.displayName=Op.displayName;function Dc(t){const s=t.replace(/\D/g,"");return s.length===10?`+91${s}`:s.length===12&&s.startsWith("91")?`+${s}`:s.length>=10?`+91${s.slice(-10)}`:""}function aw(t){const s=t.replace(/\D/g,"");return`${s.length===10?`91${s}`:s.startsWith("91")?s:`91${s.slice(-10)}`}@agrinext.local`}const fm={farmer:"/farmer/dashboard",buyer:"/marketplace/dashboard",agent:"/agent/dashboard",logistics:"/logistics/dashboard",admin:"/admin/dashboard"},nw=[{id:"farmer",labelKey:"roles.farmer",icon:Cs},{id:"buyer",labelKey:"roles.buyer",icon:tr},{id:"agent",labelKey:"roles.agent",icon:us},{id:"logistics",labelKey:"roles.logistics",icon:rt}];function Ql(t){const s=Math.max(0,Math.floor(t)),r=Math.floor(s/60),a=s%60;return`${String(r).padStart(2,"0")}:${String(a).padStart(2,"0")}`}function iw(t){if(!t||typeof t!="object")return null;const s=t;if(typeof s.retry_after_seconds=="number"&&Number.isFinite(s.retry_after_seconds)&&s.retry_after_seconds>0)return Date.now()+s.retry_after_seconds*1e3;if(typeof s.retry_at=="string"){const r=Date.parse(s.retry_at);return Number.isNaN(r)?null:r}return null}function ow(t,s,r){if(!s||typeof s!="object")return r;const a=s;return typeof a.message=="string"&&a.message.trim()&&(t===429||a.error==="temporarily_blocked"||a.error==="account_locked")?a.message:r}const lw=()=>{const{t}=Nt(),[s,r]=x.useState(""),[a,n]=x.useState(""),[i,o]=x.useState(""),[c,l]=x.useState(!1),[u,d]=x.useState(!1),[p,h]=x.useState(null),[f,y]=x.useState(null),[v,b]=x.useState(0),N=Ut(),A=Rn(),{toast:j}=hs(),{user:C,userRole:I}=Fe(),k="https://rmtkkzfzdmpjlqexrbme.supabase.co";x.useEffect(()=>{const S=A.state?.error;S&&(h(S),j({title:t("auth.login_failed"),description:S,variant:"destructive"}),N(A.pathname,{replace:!0,state:{}}))},[A.state,j,t,N,A.pathname]),x.useEffect(()=>{C&&I&&N(fm[I]||"/")},[C,I,N]),x.useEffect(()=>{if(!f){b(0);return}const S=()=>{const E=Math.max(0,Math.ceil((f-Date.now())/1e3));b(E),E<=0&&y(null)};S();const T=window.setInterval(S,1e3);return()=>window.clearInterval(T)},[f]);const R=x.useCallback(async S=>{if(S.preventDefault(),h(null),v>0){const E=`Too many failed attempts. Try again in ${Ql(v)}.`;h(E),j({title:t("auth.login_failed"),description:E,variant:"destructive"});return}if(!s){h(t("auth.select_role_to_login")),j({title:t("common.error"),description:t("auth.select_role_to_login"),variant:"destructive"});return}const T=Dc(a);if(!T||T.length<12){h(t("validation.phone_required")),j({title:t("common.error"),description:t("validation.phone_required"),variant:"destructive"});return}if(!i){h(t("validation.required")),j({title:t("common.error"),description:t("validation.required"),variant:"destructive"});return}d(!0);try{const E=await fetch(`${k}/functions/v1/login-by-phone`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:T,password:i,role:s})}),D=await E.json().catch(()=>({}));if(!E.ok){const H=iw(D);H&&H>Date.now()&&y(H);const q=ow(E.status,D,t("auth.invalid_credentials"));h(q),j({title:t("auth.login_failed"),description:q,variant:"destructive"});return}if(!D.access_token||!D.refresh_token){h(t("auth.invalid_credentials")),j({title:t("auth.login_failed"),description:t("auth.invalid_credentials"),variant:"destructive"});return}const{error:F}=await W.auth.setSession({access_token:D.access_token,refresh_token:D.refresh_token});if(F){h(F.message),j({title:t("auth.login_failed"),description:F.message,variant:"destructive"});return}j({title:t("auth.welcome_back"),description:t("auth.login_success")}),y(null),N(fm[s]||"/")}catch{h(t("common.error")),j({title:t("common.error"),description:t("common.error"),variant:"destructive"})}finally{d(!1)}},[s,a,i,k,j,t,N,v]);return e.jsxs("div",{className:"min-h-screen flex",children:[e.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-8",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs(xt,{to:"/",className:"flex items-center gap-2 mb-8",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-hero flex items-center justify-center shadow-glow",children:e.jsx(Ys,{className:"w-5 h-5 text-primary-foreground"})}),e.jsxs("span",{className:"text-xl font-display font-bold text-foreground",children:["AgriNext ",e.jsx("span",{className:"text-primary",children:"Gen"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground mb-2",children:t("auth.welcome_back")}),e.jsx("p",{className:"text-muted-foreground",children:t("auth.sign_in_continue")})]}),p&&e.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-destructive/10 border border-destructive/20 flex items-start gap-3",children:[e.jsx(rr,{className:"w-5 h-5 text-destructive shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-destructive",children:[e.jsx("p",{children:p}),v>0&&e.jsxs("p",{className:"mt-1 font-medium",children:["Retry in ",Ql(v)]})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx(ie,{className:"mb-2 block",children:t("auth.select_role_to_login")}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:nw.map(S=>e.jsxs("button",{type:"button",onClick:()=>{r(S.id),h(null)},className:`flex items-center gap-2 p-3 rounded-lg border-2 text-left transition-all ${s===S.id?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:[e.jsx(S.icon,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:t(S.labelKey)})]},S.id))})]}),e.jsxs("form",{onSubmit:R,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"phone",children:t("auth.phone")}),e.jsxs("div",{className:"relative",children:[e.jsx(hr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(Ce,{id:"phone",type:"tel",placeholder:"+91 9876543210",value:a,onChange:S=>{n(S.target.value),h(null)},className:"pl-10 h-12",disabled:u,autoComplete:"tel"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"password",children:t("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx(md,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(Ce,{id:"password",type:c?"text":"password",placeholder:"",value:i,onChange:S=>{o(S.target.value),h(null)},className:"pl-10 pr-10 h-12",disabled:u,autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>l(!c),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",tabIndex:-1,children:c?e.jsx(dd,{className:"w-5 h-5"}):e.jsx(sa,{className:"w-5 h-5"})})]})]}),e.jsx(z,{type:"submit",variant:"hero",className:"w-full",size:"lg",disabled:u||v>0,children:u?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-2 animate-spin"}),t("auth.signing_in")]}):v>0?e.jsxs(e.Fragment,{children:["Try again in ",Ql(v)]}):e.jsxs(e.Fragment,{children:[t("auth.sign_in"),e.jsx(Ir,{className:"w-4 h-4 ml-2"})]})})]}),e.jsxs("div",{className:"my-6 flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 h-px bg-border"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t("auth.or_continue_with")}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs(z,{variant:"outline",className:"w-full",size:"lg",disabled:u,type:"button",onClick:async()=>{h(null),d(!0);try{const{error:S}=await W.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`,queryParams:{prompt:"select_account"}}});S&&(h(S.message),j({title:t("auth.login_failed"),description:S.message,variant:"destructive"}))}catch{h(t("common.error")),j({title:t("common.error"),description:t("common.error"),variant:"destructive"})}finally{d(!1)}},children:[e.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),t("auth.continue_google")]}),e.jsxs("p",{className:"mt-8 text-center text-muted-foreground",children:[t("auth.no_account")," ",e.jsx(xt,{to:"/signup",className:"text-primary font-medium hover:underline",children:t("auth.sign_up")})]})]})}),e.jsxs("div",{className:"hidden lg:flex w-1/2 bg-gradient-hero items-center justify-center p-12 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 right-20 w-40 h-40 rounded-full border-2 border-primary-foreground/20"}),e.jsx("div",{className:"absolute bottom-20 left-20 w-60 h-60 rounded-full border-2 border-primary-foreground/10"}),e.jsx("div",{className:"absolute top-1/3 left-1/4 w-20 h-20 rounded-full bg-primary-foreground/10"}),e.jsxs("div",{className:"text-center text-primary-foreground relative z-10",children:[e.jsx("h2",{className:"text-4xl font-display font-bold mb-4",children:"Welcome to AgriNext Gen"}),e.jsx("p",{className:"text-primary-foreground/80 text-lg max-w-md",children:"Connect with buyers, manage your farm, and grow your agricultural business with India's leading agtech platform."})]})]})]})},xm=(t,s)=>{if(!s)return;const r=s;console.error(t,{message:r.message,code:r.code,details:r.details,hint:r.hint,status:r.status})},cw=t=>[{id:"farmer",label:t("roles.farmer"),icon:Cs,description:t("roles.farmer_description")},{id:"buyer",label:t("roles.buyer"),icon:tr,description:t("roles.buyer_description")},{id:"agent",label:t("roles.agent"),icon:us,description:t("roles.agent_description")},{id:"logistics",label:t("roles.logistics"),icon:rt,description:t("roles.logistics_description")}],gm={farmer:"/farmer/dashboard",buyer:"/marketplace/dashboard",agent:"/agent/dashboard",logistics:"/logistics/dashboard",admin:"/admin/dashboard"},dw=()=>{const{t}=Nt(),s=cw(t),[r,a]=x.useState(1),[n,i]=x.useState(""),[o,c]=x.useState({name:"",email:"",phone:"",password:""}),[l,u]=x.useState(!1),d=x.useRef(!1),[p,h]=x.useState(null),f=Ut(),{toast:y}=hs(),{user:v,userRole:b,refreshRole:N}=Fe();x.useEffect(()=>{v&&b&&f(gm[b]||"/")},[v,b,f]);const A=x.useCallback(()=>{if(!o.name.trim())return t("validation.name_required");const k=Dc(o.phone);return!k||k.length<12?t("validation.phone_required"):o.password.length<6?t("validation.password_min"):o.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email)?t("validation.invalid_email"):null},[o,t]),j=async k=>{if(k.preventDefault(),h(null),l||d.current){console.warn("Signup already in progress - ignoring duplicate submit");return}if(r===1&&n){a(2);return}if(r===2){const R=A();if(R){h(R),y({title:t("common.error"),description:R,variant:"destructive"});return}d.current=!0,u(!0);try{const S=Dc(o.phone),T=o.email.trim()?o.email.trim().toLowerCase():aw(o.phone),D=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/signup-by-phone",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:n,phone:S,password:o.password,full_name:o.name.trim(),email:T,profile_metadata:{}})}),F=await D.json().catch(()=>null);if(!D.ok||!F||!F.ok){const B=F&&"error_code"in F?F.error_code:null,L=F&&"message"in F?F.message:t("common.error");let P=L;B==="RATE_LIMITED"&&(P=t("auth.rate_limit_retry_hint")),(B==="PHONE_ALREADY_EXISTS"||B==="EMAIL_ALREADY_EXISTS")&&(P=t("auth.phone_or_email_exists")),B==="ROLE_CLOSED"&&(P="Signups for this role are currently closed."),B==="SIGNUP_DISABLED"&&(P="Signups are temporarily disabled."),B==="VALIDATION_ERROR"&&(P=L||t("common.error")),h(P),y({title:t("auth.signup_failed"),description:P,variant:"destructive"});return}const{error:H}=await W.auth.setSession({access_token:F.access_token,refresh_token:F.refresh_token});if(H){xm("Signup setSession error",H),h(H.message),y({title:t("auth.signup_failed"),description:H.message,variant:"destructive"});return}await N(),y({title:t("auth.account_created"),description:t("auth.welcome_agrinext")});const q=F.dashboard_route||gm[n]||"/";f(q)}catch(S){console.error("Signup unexpected error:",S),h(t("common.error")),y({title:t("common.error"),description:t("common.error"),variant:"destructive"})}finally{u(!1),d.current=!1}}},C=x.useCallback((k,R)=>{c(S=>({...S,[k]:R})),h(null)},[]),I=x.useMemo(()=>s.find(k=>k.id===n),[n]);return e.jsxs("div",{className:"min-h-screen flex",children:[e.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-8",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs(xt,{to:"/",className:"flex items-center gap-2 mb-8",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-hero flex items-center justify-center shadow-glow",children:e.jsx(Ys,{className:"w-5 h-5 text-primary-foreground"})}),e.jsxs("span",{className:"text-xl font-display font-bold text-foreground",children:["AgriNext ",e.jsx("span",{className:"text-primary",children:"Gen"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-8",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${r>=1?"bg-primary":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${r>=2?"bg-primary":"bg-muted"}`})]}),p&&e.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-destructive/10 border border-destructive/20 flex items-start gap-3",children:[e.jsx(rr,{className:"w-5 h-5 text-destructive shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-destructive",children:p})]}),r===1?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground mb-2",children:t("auth.joinAgriNextGen")}),e.jsx("p",{className:"text-muted-foreground",children:t("auth.selectRoleToStart")})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:s.map(k=>e.jsxs("button",{type:"button",onClick:()=>i(k.id),className:`p-4 rounded-xl border-2 text-left transition-all duration-300 ${n===k.id?"border-primary bg-primary/5 shadow-glow":"border-border hover:border-primary/50"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center mb-3 ${n===k.id?"bg-gradient-hero":"bg-muted"}`,children:e.jsx(k.icon,{className:`w-5 h-5 ${n===k.id?"text-primary-foreground":"text-muted-foreground"}`})}),e.jsx("h3",{className:"font-display font-semibold text-foreground",children:k.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:k.description})]},k.id))}),e.jsxs(z,{type:"submit",variant:"hero",className:"w-full mt-6",size:"lg",disabled:!n,children:[t("common.continue"),e.jsx(Ir,{className:"w-4 h-4 ml-2"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>{a(1),h(null)},className:"text-sm text-muted-foreground hover:text-foreground mb-4 flex items-center gap-1",disabled:l,type:"button",children:[" ",t("common.back")]}),e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground mb-2",children:t("auth.create_account")}),e.jsxs("p",{className:"text-muted-foreground",children:[t("auth.fill_details")," ",e.jsx("span",{className:"text-primary font-medium capitalize",children:I?.label})]})]}),e.jsxs("form",{onSubmit:j,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"name",children:t("auth.full_name")}),e.jsxs("div",{className:"relative",children:[e.jsx(Ps,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(Ce,{id:"name",type:"text",placeholder:t("auth.name_placeholder"),value:o.name,onChange:k=>C("name",k.target.value),className:"pl-10 h-12",disabled:l,required:!0,autoComplete:"name"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"phone",children:t("auth.phone")}),e.jsxs("div",{className:"relative",children:[e.jsx(hr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(Ce,{id:"phone",type:"tel",placeholder:"+91 9876543210",value:o.phone,onChange:k=>C("phone",k.target.value),className:"pl-10 h-12",disabled:l,required:!0,autoComplete:"tel"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"password",children:t("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx(md,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(Ce,{id:"password",type:"password",placeholder:"",value:o.password,onChange:k=>C("password",k.target.value),className:"pl-10 h-12",disabled:l,required:!0,minLength:6,autoComplete:"new-password"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("auth.password_hint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"email",children:t("auth.email_optional")}),e.jsxs("div",{className:"relative",children:[e.jsx(hd,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(Ce,{id:"email",type:"email",placeholder:t("auth.email_placeholder"),value:o.email,onChange:k=>C("email",k.target.value),className:"pl-10 h-12",disabled:l,autoComplete:"email"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("auth.email_optional_hint")})]}),e.jsx(z,{type:"submit",variant:"hero",className:"w-full",size:"lg",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-2 animate-spin"}),t("auth.creating_account")]}):e.jsxs(e.Fragment,{children:[t("auth.create_account"),e.jsx(Ir,{className:"w-4 h-4 ml-2"})]})}),e.jsxs("div",{className:"my-6 flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 h-px bg-border"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t("auth.or_continue_with")}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs(z,{type:"button",variant:"outline",className:"w-full",size:"lg",disabled:l,onClick:async()=>{h(null),sessionStorage.setItem("signup_role",n),u(!0);try{const{error:k}=await W.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`,queryParams:{prompt:"select_account"}}});k&&(xm("Supabase OAuth error",k),h(k.message),y({title:t("auth.signup_failed"),description:k.message,variant:"destructive"}))}catch{h(t("common.error")),y({title:t("common.error"),description:t("common.error"),variant:"destructive"})}finally{u(!1)}},children:[e.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),t("auth.continue_google")]})]})]}),e.jsxs("p",{className:"mt-8 text-center text-muted-foreground",children:[t("auth.already_have_account")," ",e.jsx(xt,{to:"/login",className:"text-primary font-medium hover:underline",children:t("auth.sign_in")})]})]})}),e.jsxs("div",{className:"hidden lg:flex w-1/2 bg-gradient-hero items-center justify-center p-12 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 right-20 w-40 h-40 rounded-full border-2 border-primary-foreground/20"}),e.jsx("div",{className:"absolute bottom-20 left-20 w-60 h-60 rounded-full border-2 border-primary-foreground/10"}),e.jsx("div",{className:"absolute top-1/3 left-1/4 w-20 h-20 rounded-full bg-primary-foreground/10"}),e.jsxs("div",{className:"text-center text-primary-foreground relative z-10",children:[e.jsx("h2",{className:"text-4xl font-display font-bold mb-4",children:"Join Our Growing Community"}),e.jsx("p",{className:"text-primary-foreground/80 text-lg max-w-md",children:"Become part of India's largest agricultural network. Connect, trade, and grow with thousands of farmers and buyers."})]})]})]})},G=x.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ke("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s}));G.displayName="Card";const je=x.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ke("flex flex-col space-y-1.5 p-4",t),...s}));je.displayName="CardHeader";const we=x.forwardRef(({className:t,...s},r)=>e.jsx("h3",{ref:r,className:ke("text-2xl font-semibold leading-none tracking-tight",t),...s}));we.displayName="CardTitle";const kr=x.forwardRef(({className:t,...s},r)=>e.jsx("p",{ref:r,className:ke("text-sm text-muted-foreground",t),...s}));kr.displayName="CardDescription";const Q=x.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ke("p-4 pt-0",t),...s}));Q.displayName="CardContent";const Fp=x.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ke("flex items-center p-4 pt-0",t),...s}));Fp.displayName="CardFooter";const uw=[{name:"Priya Sharma",role:"Founder & CEO",description:"Former AgTech researcher with 10+ years in agriculture"},{name:"Rajesh Kumar",role:"CTO",description:"Building scalable tech solutions for rural India"},{name:"Anita Patel",role:"Head of Operations",description:"Expert in supply chain and logistics management"},{name:"Vikram Singh",role:"Product Lead",description:"Focused on farmer-first product design"}],mw=[{icon:sp,title:"Farmer First",description:"Every decision we make prioritizes the welfare of our farming community."},{icon:qj,title:"Transparency",description:"Clear pricing, honest communication, and fair practices for all."},{icon:ep,title:"Sustainability",description:"Building an ecosystem that benefits the environment and future generations."},{icon:yj,title:"Quality",description:"Ensuring the highest standards from farm to market."}],hw=()=>e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(gd,{}),e.jsx("section",{className:"pt-32 pb-20 px-4 bg-gradient-earth",children:e.jsxs("div",{className:"container mx-auto max-w-4xl text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 border border-primary/20 mb-6",children:[e.jsx(Ys,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"About Us"})]}),e.jsxs("h1",{className:"text-4xl sm:text-5xl font-display font-bold mb-6",children:["Empowering India's ",e.jsx("span",{className:"text-gradient-hero",children:"Agricultural"})," Future"]}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"AgriNext Gen is on a mission to revolutionize how farmers, buyers, and logistics partners connect across India, creating a transparent and efficient agricultural marketplace."})]})}),e.jsx("section",{className:"py-20 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-display font-bold mb-6",children:"Our Mission"}),e.jsx("p",{className:"text-muted-foreground mb-4 leading-relaxed",children:"We believe every farmer deserves fair access to markets, transparent pricing, and efficient logistics. AgriNext Gen bridges the gap between rural farms and urban markets through technology."}),e.jsx("p",{className:"text-muted-foreground mb-6 leading-relaxed",children:"Founded in 2024, we've grown from a small team with a big vision to a platform serving thousands of farmers across Karnataka, Maharashtra, and beyond."}),e.jsx(z,{variant:"hero",asChild:!0,children:e.jsxs(xt,{to:"/signup",className:"gap-2",children:["Join Our Platform ",e.jsx(Ir,{className:"w-4 h-4"})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(G,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary mb-2",children:"5000+"}),e.jsx("div",{className:"text-muted-foreground",children:"Farmers"})]}),e.jsxs(G,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary mb-2",children:"200+"}),e.jsx("div",{className:"text-muted-foreground",children:"Buyers"})]}),e.jsxs(G,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary mb-2",children:"50+"}),e.jsx("div",{className:"text-muted-foreground",children:"Districts"})]}),e.jsxs(G,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary mb-2",children:"10Cr+"}),e.jsx("div",{className:"text-muted-foreground",children:"Transactions"})]})]})]})})}),e.jsx("section",{className:"py-20 px-4 bg-gradient-card",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-display font-bold mb-4",children:"Our Values"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"The principles that guide everything we do at AgriNext Gen."})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:mw.map(t=>e.jsxs(G,{className:"text-center p-6 hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-hero flex items-center justify-center mx-auto mb-4",children:e.jsx(t.icon,{className:"w-7 h-7 text-primary-foreground"})}),e.jsx("h3",{className:"font-display font-semibold text-lg mb-2",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-sm",children:t.description})]},t.title))})]})}),e.jsx("section",{className:"py-20 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-display font-bold mb-4",children:"Meet Our Team"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Passionate individuals working to transform Indian agriculture."})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:uw.map(t=>e.jsxs(G,{className:"text-center p-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-hero mx-auto mb-4 flex items-center justify-center",children:e.jsx(Cs,{className:"w-10 h-10 text-primary-foreground"})}),e.jsx("h3",{className:"font-display font-semibold text-lg",children:t.name}),e.jsx("p",{className:"text-primary text-sm font-medium mb-2",children:t.role}),e.jsx("p",{className:"text-muted-foreground text-sm",children:t.description})]},t.name))})]})}),e.jsx("section",{className:"py-20 px-4 bg-gradient-hero",children:e.jsxs("div",{className:"container mx-auto max-w-4xl text-center",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl font-display font-bold text-primary-foreground mb-6",children:"Ready to Transform Your Agricultural Journey?"}),e.jsx("p",{className:"text-primary-foreground/80 text-lg mb-8 max-w-2xl mx-auto",children:"Join thousands of farmers and buyers already benefiting from our platform."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(z,{size:"lg",variant:"secondary",asChild:!0,children:e.jsx(xt,{to:"/signup",children:"Get Started Free"})}),e.jsx(z,{size:"lg",variant:"outline",className:"border-primary-foreground/30 text-primary-foreground hover:bg-primary-foreground/10",asChild:!0,children:e.jsx(xt,{to:"/contact",children:"Contact Us"})})]})]})}),e.jsx(vd,{})]}),zs=x.forwardRef(({className:t,...s},r)=>e.jsx("textarea",{className:ke("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...s}));zs.displayName="Textarea";const pw=[{icon:hd,title:"Email",value:"support@agrinextgen.in",description:"We'll respond within 24 hours"},{icon:hr,title:"Phone",value:"+91 1800-XXX-XXXX",description:"Mon-Sat, 9AM-6PM IST"},{icon:We,title:"Office",value:"Bengaluru, Karnataka",description:"Visit us by appointment"}],fw=()=>{const[t,s]=x.useState({name:"",email:"",phone:"",subject:"",message:""}),[r,a]=x.useState(!1),[n,i]=x.useState(!1),o=async c=>{if(c.preventDefault(),!t.name||!t.email||!t.message){ce.error("Please fill in all required fields");return}a(!0),await new Promise(l=>setTimeout(l,1500)),a(!1),i(!0),ce.success("Message sent successfully! We'll get back to you soon."),s({name:"",email:"",phone:"",subject:"",message:""}),setTimeout(()=>i(!1),3e3)};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(gd,{}),e.jsx("section",{className:"pt-32 pb-16 px-4 bg-gradient-earth",children:e.jsxs("div",{className:"container mx-auto max-w-4xl text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 border border-primary/20 mb-6",children:[e.jsx(Qo,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"Get in Touch"})]}),e.jsxs("h1",{className:"text-4xl sm:text-5xl font-display font-bold mb-6",children:["We'd Love to ",e.jsx("span",{className:"text-gradient-hero",children:"Hear"})," From You"]}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Have questions about AgriNext Gen? Want to partner with us? Our team is here to help you every step of the way."})]})}),e.jsx("section",{className:"py-20 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-display font-bold mb-6",children:"Contact Information"}),pw.map(c=>e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(c.icon,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:c.title}),e.jsx("p",{className:"text-foreground font-medium",children:c.value}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.description})]})]})},c.title)),e.jsxs(G,{className:"p-6 bg-gradient-card border-primary/20",children:[e.jsx("h3",{className:"font-display font-semibold mb-2",children:"Frequently Asked Questions"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Find quick answers to common questions about our platform."}),e.jsx(z,{variant:"outline",size:"sm",className:"w-full",children:"View FAQs"})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(_c,{className:"w-5 h-5 text-primary"}),"Send us a Message"]})}),e.jsx(Q,{children:n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(qs,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Message Sent!"}),e.jsx("p",{className:"text-muted-foreground",children:"Thank you for reaching out. We'll get back to you within 24 hours."})]}):e.jsxs("form",{onSubmit:o,className:"space-y-5",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"name",children:"Full Name *"}),e.jsx(Ce,{id:"name",placeholder:"Your name",value:t.name,onChange:c=>s({...t,name:c.target.value}),disabled:r,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"email",children:"Email *"}),e.jsx(Ce,{id:"email",type:"email",placeholder:"you@example.com",value:t.email,onChange:c=>s({...t,email:c.target.value}),disabled:r,required:!0})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"phone",children:"Phone (Optional)"}),e.jsx(Ce,{id:"phone",type:"tel",placeholder:"+91 9876543210",value:t.phone,onChange:c=>s({...t,phone:c.target.value}),disabled:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"subject",children:"Subject"}),e.jsx(Ce,{id:"subject",placeholder:"How can we help?",value:t.subject,onChange:c=>s({...t,subject:c.target.value}),disabled:r})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"message",children:"Message *"}),e.jsx(zs,{id:"message",placeholder:"Tell us more about your inquiry...",value:t.message,onChange:c=>s({...t,message:c.target.value}),rows:5,disabled:r,required:!0})]}),e.jsx(z,{type:"submit",variant:"hero",size:"lg",className:"w-full",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:["Send Message",e.jsx(_c,{className:"w-4 h-4 ml-2"})]})})]})})]})})]})})}),e.jsx("section",{className:"py-12 px-4 bg-muted/50",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx("div",{className:"rounded-2xl bg-gradient-card border h-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(We,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"Interactive map coming soon"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bengaluru, Karnataka, India"})]})})})}),e.jsx(vd,{})]})},xw=()=>{const t=Rn();return x.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},gw="modulepreload",vw=function(t){return"/"+t},vm={},Ya=function(s,r,a){let n=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");n=Promise.allSettled(r.map(l=>{if(l=vw(l),l in vm)return;vm[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":gw,u||(p.as="script"),p.crossOrigin="",p.href=l,c&&p.setAttribute("nonce",c),document.head.appendChild(p),u)return new Promise((h,f)=>{p.addEventListener("load",h),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return n.then(o=>{for(const c of o||[])c.status==="rejected"&&i(c.reason);return s().catch(i)})},Fn=()=>{const{user:t}=Fe();return De({queryKey:["farmer-profile",t?.id],queryFn:async()=>{if(!t?.id)return null;const{data:s,error:r}=await W.from("profiles").select("*").eq("id",t.id).maybeSingle();if(r)throw r;return s},enabled:!!t?.id})},_a=()=>{const{user:t}=Fe();return De({queryKey:["farmlands",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("farmlands").select("*").eq("farmer_id",t.id).order("created_at",{ascending:!1});if(r)throw r;return s},enabled:!!t?.id})},ka=()=>{const{user:t}=Fe();return De({queryKey:["crops",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("crops").select(`
          *,
          farmland:farmlands(*)
        `).eq("farmer_id",t.id).order("created_at",{ascending:!1});if(r)throw r;return s},enabled:!!t?.id})},yd=()=>{const{user:t}=Fe();return De({queryKey:["transport-requests",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("transport_requests").select(`
          *,
          crop:crops(*)
        `).eq("farmer_id",t.id).order("created_at",{ascending:!1});if(r)throw r;return s},enabled:!!t?.id})},tl=()=>{const{user:t}=Fe();return De({queryKey:["farmer-notifications",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("notifications").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(20);if(r)throw r;return s},enabled:!!t?.id,refetchInterval:3e4})},yw=()=>{const{data:t,isLoading:s}=ka(),{data:r,isLoading:a}=yd(),{data:n,isLoading:i}=_a(),o=t?.filter(p=>p.status!=="harvested").length||0,c=t?.filter(p=>p.status==="ready").length||0,l=t?.filter(p=>p.status==="one_week").length||0,u=r?.filter(p=>["requested","assigned"].includes(p.status)).length||0,d=n?.reduce((p,h)=>p+h.area,0)||0;return{activeCrops:o,readyToHarvest:c,oneWeekToHarvest:l,pendingTransport:u,totalLandArea:d,isLoading:s||a||i}},jw=()=>{const{user:t}=Fe();return De({queryKey:["farmer-orders",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.rpc("get_farmer_orders_with_context",{p_farmer_id:t.id});if(r)throw r;return s||[]},enabled:!!t?.id})},bw=()=>{const t=Xe();return dt({mutationFn:async({orderId:s,newStatus:r})=>{const{updateOrderStatus:a}=await Ya(async()=>{const{updateOrderStatus:i}=await Promise.resolve().then(()=>Bv);return{updateOrderStatus:i}},void 0),n=await a(s,r);if(!n||!n.success)throw new Error(n?.error||"Update failed");return n},onSuccess:()=>{t.invalidateQueries({queryKey:["farmer-orders"]}),ce.success("Order status updated!")},onError:s=>{ce.error("Failed to update order: "+s.message)}})},ym=({onClose:t,isOpen:s=!0,isMobile:r=!1})=>{const a=Rn(),{signOut:n,userRole:i}=Fe(),{t:o}=Nt(),{data:c}=tl(),l=c?.filter(N=>!N.is_read).length||0,u=[{icon:bo,label:o("nav.myDay"),href:"/farmer/my-day"},{icon:Fa,label:o("nav.dashboard"),href:"/farmer/dashboard"},{icon:ts,label:o("nav.crops"),href:"/farmer/crops"},{icon:lr,label:o("nav.farmlands"),href:"/farmer/farmlands"},{icon:rt,label:o("nav.transport"),href:"/farmer/transport"},{icon:tr,label:o("nav.listings"),href:"/farmer/listings"},{icon:qt,label:o("nav.orders"),href:"/farmer/orders"},{icon:No,label:o("nav.earnings"),href:"/farmer/earnings"},{icon:_r,label:o("nav.notifications"),href:"/farmer/notifications",badge:l>0?l:void 0},{icon:Xn,label:o("nav.settings"),href:"/farmer/settings"}],d=[{icon:bo,label:o("nav.today"),href:"/agent/today"},{icon:Fa,label:o("nav.dashboard"),href:"/agent/dashboard"},{icon:us,label:o("nav.myTasks"),href:"/agent/tasks"},{icon:Cs,label:o("nav.myFarmers"),href:"/agent/my-farmers"},{icon:Cs,label:o("nav.farmersAndCrops"),href:"/agent/farmers"},{icon:rt,label:o("nav.transport"),href:"/agent/transport"},{icon:We,label:o("nav.serviceArea"),href:"/agent/service-area"},{icon:Xn,label:o("nav.profile"),href:"/agent/profile"}],p=[{icon:Fa,label:o("nav.dashboard"),href:"/logistics/dashboard"},{icon:qt,label:o("nav.availableLoads"),href:"/logistics/loads"},{icon:rt,label:o("nav.activeTrips"),href:"/logistics/trips"},{icon:ts,label:o("nav.completed"),href:"/logistics/completed"},{icon:lr,label:o("nav.myVehicles"),href:"/logistics/vehicles"},{icon:We,label:o("nav.serviceArea"),href:"/logistics/service-area"},{icon:Xn,label:o("nav.profile"),href:"/logistics/profile"}],h=[{icon:Fa,label:o("nav.dashboard"),href:"/marketplace/dashboard"},{icon:tr,label:o("nav.browseProducts"),href:"/marketplace/browse"},{icon:qt,label:o("nav.myOrders"),href:"/marketplace/orders"},{icon:Xn,label:o("nav.profile"),href:"/marketplace/profile"}],f=[{icon:Fa,label:o("nav.dashboard"),href:"/admin/dashboard"},{icon:rp,label:o("nav.opsInbox"),href:"/admin/ops"},{icon:up,label:o("nav.tickets"),href:"/admin/tickets"},{icon:Cs,label:o("nav.farmers"),href:"/admin/farmers"},{icon:Js,label:o("nav.agents"),href:"/admin/agents"},{icon:rt,label:o("nav.transporters"),href:"/admin/transporters"},{icon:tr,label:o("nav.buyers"),href:"/admin/buyers"},{icon:ts,label:o("nav.allCrops"),href:"/admin/crops"},{icon:qt,label:o("nav.transport"),href:"/admin/transport"},{icon:us,label:o("nav.orders"),href:"/admin/orders"},{icon:us,label:o("nav.pendingUpdates"),href:"/admin/pending-updates"},{icon:ni,label:o("nav.aiReview"),href:"/admin/ai-review"},{icon:bj,label:o("nav.jobs"),href:"/admin/jobs"},{icon:No,label:o("nav.finance"),href:"/admin/finance"},{icon:Js,label:o("nav.aiConsole"),href:"/admin/ai-console"},{icon:Ba,label:o("nav.seedData"),href:"/admin/seed-data"},{icon:Bj,label:o("nav.mysuruDemo"),href:"/admin/mysuru-demo"},{icon:Xn,label:o("nav.dataHealth"),href:"/admin/data-health"}],y=i==="agent"?d:i==="logistics"?p:i==="buyer"?h:i==="admin"?f:u,v=o(i==="agent"?"dashboardShell.title.agent":i==="logistics"?"dashboardShell.title.logistics":i==="buyer"?"dashboardShell.title.buyer":i==="admin"?"dashboardShell.title.admin":"dashboardShell.title.farmer"),b=()=>{t&&t()};return e.jsx("aside",{className:ke("h-screen w-64 bg-sidebar border-r border-sidebar-border flex-shrink-0",r&&"fixed inset-y-0 left-0 z-50 transform transition-transform duration-300 ease-in-out",r&&(s?"translate-x-0":"-translate-x-full"),!r&&"relative"),children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between px-6 border-b border-sidebar-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:ke("w-9 h-9 rounded-lg flex items-center justify-center",i==="agent"?"bg-purple-600":i==="logistics"?"bg-blue-600":i==="buyer"?"bg-orange-600":i==="admin"?"bg-rose-600":"bg-sidebar-primary"),children:i==="agent"?e.jsx(Js,{className:"w-5 h-5 text-white"}):i==="logistics"?e.jsx(rt,{className:"w-5 h-5 text-white"}):i==="buyer"?e.jsx(tr,{className:"w-5 h-5 text-white"}):i==="admin"?e.jsx(Js,{className:"w-5 h-5 text-white"}):e.jsx(ts,{className:"w-5 h-5 text-sidebar-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-display font-bold text-lg text-sidebar-foreground leading-tight block",children:v}),i==="agent"&&e.jsx("span",{className:"text-xs text-purple-500 font-medium",children:o("dashboardShell.subtitle.agent")}),i==="logistics"&&e.jsx("span",{className:"text-xs text-blue-500 font-medium",children:o("dashboardShell.subtitle.logistics")}),i==="buyer"&&e.jsx("span",{className:"text-xs text-orange-500 font-medium",children:o("dashboardShell.subtitle.buyer")}),i==="admin"&&e.jsx("span",{className:"text-xs text-rose-500 font-medium",children:o("dashboardShell.subtitle.admin")})]})]}),t&&e.jsx(z,{variant:"ghost",size:"icon",className:"lg:hidden text-sidebar-foreground hover:bg-sidebar-accent pointer-events-auto relative z-10",onClick:N=>{N.stopPropagation(),t()},"aria-label":"Close sidebar",children:e.jsx(ar,{className:"h-5 w-5"})})]}),e.jsx("nav",{className:"flex-1 space-y-1 px-3 py-4 overflow-y-auto",children:y.map(N=>{const A=a.pathname===N.href;return e.jsxs(xt,{to:N.href,onClick:b,className:ke("flex items-center justify-between rounded-lg px-3 py-2.5 text-sm font-medium transition-colors",A?i==="agent"?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300":i==="logistics"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":i==="buyer"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300":i==="admin"?"bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-300":"bg-sidebar-accent text-sidebar-primary":"text-sidebar-foreground/70 hover:bg-sidebar-accent hover:text-sidebar-foreground"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N.icon,{className:"h-5 w-5"}),N.label]}),"badge"in N&&typeof N.badge=="number"&&N.badge>0&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs font-medium bg-destructive text-destructive-foreground rounded-full min-w-[20px] text-center",children:N.badge>9?"9+":N.badge})]},N.href)})}),e.jsx("div",{className:"border-t border-sidebar-border p-3",children:e.jsxs("button",{onClick:()=>{n(),t&&t()},className:"flex w-full items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium text-sidebar-foreground/70 hover:bg-sidebar-accent hover:text-sidebar-foreground transition-colors",children:[e.jsx(_o,{className:"h-5 w-5"}),o("nav.logout")]})})]})})};var Lp={exports:{}},qp={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yn=x;function ww(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var Nw=typeof Object.is=="function"?Object.is:ww,_w=yn.useState,kw=yn.useEffect,Cw=yn.useLayoutEffect,Sw=yn.useDebugValue;function Aw(t,s){var r=s(),a=_w({inst:{value:r,getSnapshot:s}}),n=a[0].inst,i=a[1];return Cw(function(){n.value=r,n.getSnapshot=s,Xl(n)&&i({inst:n})},[t,r,s]),kw(function(){return Xl(n)&&i({inst:n}),t(function(){Xl(n)&&i({inst:n})})},[t]),Sw(r),r}function Xl(t){var s=t.getSnapshot;t=t.value;try{var r=s();return!Nw(t,r)}catch{return!0}}function Tw(t,s){return s()}var Pw=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Tw:Aw;qp.useSyncExternalStore=yn.useSyncExternalStore!==void 0?yn.useSyncExternalStore:Pw;Lp.exports=qp;var Mw=Lp.exports;function Rw(){return Mw.useSyncExternalStore(Dw,()=>!0,()=>!1)}function Dw(){return()=>{}}var jd="Avatar",[Ew]=wr(jd),[Iw,zp]=Ew(jd),Bp=x.forwardRef((t,s)=>{const{__scopeAvatar:r,...a}=t,[n,i]=x.useState("idle");return e.jsx(Iw,{scope:r,imageLoadingStatus:n,onImageLoadingStatusChange:i,children:e.jsx(ht.span,{...a,ref:s})})});Bp.displayName=jd;var $p="AvatarImage",Up=x.forwardRef((t,s)=>{const{__scopeAvatar:r,src:a,onLoadingStatusChange:n=()=>{},...i}=t,o=zp($p,r),c=Ow(a,i),l=yr(u=>{n(u),o.onImageLoadingStatusChange(u)});return mr(()=>{c!=="idle"&&l(c)},[c,l]),c==="loaded"?e.jsx(ht.img,{...i,ref:s,src:a}):null});Up.displayName=$p;var Hp="AvatarFallback",Vp=x.forwardRef((t,s)=>{const{__scopeAvatar:r,delayMs:a,...n}=t,i=zp(Hp,r),[o,c]=x.useState(a===void 0);return x.useEffect(()=>{if(a!==void 0){const l=window.setTimeout(()=>c(!0),a);return()=>window.clearTimeout(l)}},[a]),o&&i.imageLoadingStatus!=="loaded"?e.jsx(ht.span,{...n,ref:s}):null});Vp.displayName=Hp;function jm(t,s){return t?s?(t.src!==s&&(t.src=s),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Ow(t,{referrerPolicy:s,crossOrigin:r}){const a=Rw(),n=x.useRef(null),i=a?(n.current||(n.current=new window.Image),n.current):null,[o,c]=x.useState(()=>jm(i,t));return mr(()=>{c(jm(i,t))},[i,t]),mr(()=>{const l=p=>()=>{c(p)};if(!i)return;const u=l("loaded"),d=l("error");return i.addEventListener("load",u),i.addEventListener("error",d),s&&(i.referrerPolicy=s),typeof r=="string"&&(i.crossOrigin=r),()=>{i.removeEventListener("load",u),i.removeEventListener("error",d)}},[i,r,s]),o}var Kp=Bp,Wp=Up,Yp=Vp;const bd=x.forwardRef(({className:t,...s},r)=>e.jsx(Kp,{ref:r,className:ke("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));bd.displayName=Kp.displayName;const wd=x.forwardRef(({className:t,...s},r)=>e.jsx(Wp,{ref:r,className:ke("aspect-square h-full w-full",t),...s}));wd.displayName=Wp.displayName;const Nd=x.forwardRef(({className:t,...s},r)=>e.jsx(Yp,{ref:r,className:ke("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));Nd.displayName=Yp.displayName;function nt(t){const s=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&s==="[object Date]"?new t.constructor(+t):typeof t=="number"||s==="[object Number]"||typeof t=="string"||s==="[object String]"?new Date(t):new Date(NaN)}function fr(t,s){return t instanceof Date?new t.constructor(s):new Date(s)}function Qs(t,s){const r=nt(t);return isNaN(s)?fr(t,NaN):(s&&r.setDate(r.getDate()+s),r)}function Or(t,s){const r=nt(t);if(isNaN(s))return fr(t,NaN);if(!s)return r;const a=r.getDate(),n=fr(t,r.getTime());n.setMonth(r.getMonth()+s+1,0);const i=n.getDate();return a>=i?n:(r.setFullYear(n.getFullYear(),n.getMonth(),a),r)}const _d=6048e5,Fw=864e5,Gp=6e4,kd=36e5,no=43200,bm=1440;let Lw={};function Ln(){return Lw}function Vr(t,s){const r=Ln(),a=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,n=nt(t),i=n.getDay(),o=(i<a?7:0)+i-a;return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}function $a(t){return Vr(t,{weekStartsOn:1})}function Qp(t){const s=nt(t),r=s.getFullYear(),a=fr(t,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const n=$a(a),i=fr(t,0);i.setFullYear(r,0,4),i.setHours(0,0,0,0);const o=$a(i);return s.getTime()>=n.getTime()?r+1:s.getTime()>=o.getTime()?r:r-1}function jn(t){const s=nt(t);return s.setHours(0,0,0,0),s}function bn(t){const s=nt(t),r=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return r.setUTCFullYear(s.getFullYear()),+t-+r}function Dr(t,s){const r=jn(t),a=jn(s),n=+r-bn(r),i=+a-bn(a);return Math.round((n-i)/Fw)}function qw(t){const s=Qp(t),r=fr(t,0);return r.setFullYear(s,0,4),r.setHours(0,0,0,0),$a(r)}function Ec(t,s){const r=s*7;return Qs(t,r)}function zw(t,s){return Or(t,s*12)}function Bw(t){let s;return t.forEach(function(r){const a=nt(r);(s===void 0||s<a||isNaN(Number(a)))&&(s=a)}),s||new Date(NaN)}function $w(t){let s;return t.forEach(r=>{const a=nt(r);(!s||s>a||isNaN(+a))&&(s=a)}),s||new Date(NaN)}function go(t,s){const r=nt(t),a=nt(s),n=r.getTime()-a.getTime();return n<0?-1:n>0?1:n}function Uw(t){return fr(t,Date.now())}function cr(t,s){const r=jn(t),a=jn(s);return+r==+a}function Cd(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Hw(t){if(!Cd(t)&&typeof t!="number")return!1;const s=nt(t);return!isNaN(Number(s))}function wn(t,s){const r=nt(t),a=nt(s),n=r.getFullYear()-a.getFullYear(),i=r.getMonth()-a.getMonth();return n*12+i}function Vw(t,s,r){const a=Vr(t,r),n=Vr(s,r),i=+a-bn(a),o=+n-bn(n);return Math.round((i-o)/_d)}function wm(t,s){const r=nt(t),a=nt(s),n=Nm(r,a),i=Math.abs(Dr(r,a));r.setDate(r.getDate()-n*i);const o=+(Nm(r,a)===-n),c=n*(i-o);return c===0?0:c}function Nm(t,s){const r=t.getFullYear()-s.getFullYear()||t.getMonth()-s.getMonth()||t.getDate()-s.getDate()||t.getHours()-s.getHours()||t.getMinutes()-s.getMinutes()||t.getSeconds()-s.getSeconds()||t.getMilliseconds()-s.getMilliseconds();return r<0?-1:r>0?1:r}function Xp(t){return s=>{const a=(t?Math[t]:Math.trunc)(s);return a===0?0:a}}function Jp(t,s){return+nt(t)-+nt(s)}function Kw(t,s,r){const a=Jp(t,s)/kd;return Xp(r?.roundingMethod)(a)}function Ww(t){const s=nt(t);return s.setHours(23,59,59,999),s}function sl(t){const s=nt(t),r=s.getMonth();return s.setFullYear(s.getFullYear(),r+1,0),s.setHours(23,59,59,999),s}function Yw(t){const s=nt(t);return+Ww(s)==+sl(s)}function Sd(t,s){const r=nt(t),a=nt(s),n=go(r,a),i=Math.abs(wn(r,a));let o;if(i<1)o=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-n*i);let c=go(r,a)===-n;Yw(nt(t))&&i===1&&go(t,a)===1&&(c=!1),o=n*(i-Number(c))}return o===0?0:o}function Gw(t,s,r){const a=Jp(t,s)/1e3;return Xp(r?.roundingMethod)(a)}function ur(t){const s=nt(t);return s.setDate(1),s.setHours(0,0,0,0),s}function Zp(t){const s=nt(t),r=fr(t,0);return r.setFullYear(s.getFullYear(),0,1),r.setHours(0,0,0,0),r}function Ad(t,s){const r=Ln(),a=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,n=nt(t),i=n.getDay(),o=(i<a?-7:0)+6-(i-a);return n.setDate(n.getDate()+o),n.setHours(23,59,59,999),n}function ef(t){return Ad(t,{weekStartsOn:1})}const Qw={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Xw=(t,s,r)=>{let a;const n=Qw[t];return typeof n=="string"?a=n:s===1?a=n.one:a=n.other.replace("{{count}}",s.toString()),r?.addSuffix?r.comparison&&r.comparison>0?"in "+a:a+" ago":a};function Jl(t){return(s={})=>{const r=s.width?String(s.width):t.defaultWidth;return t.formats[r]||t.formats[t.defaultWidth]}}const Jw={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Zw={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},e1={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},t1={date:Jl({formats:Jw,defaultWidth:"full"}),time:Jl({formats:Zw,defaultWidth:"full"}),dateTime:Jl({formats:e1,defaultWidth:"full"})},s1={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},r1=(t,s,r,a)=>s1[t];function ei(t){return(s,r)=>{const a=r?.context?String(r.context):"standalone";let n;if(a==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,c=r?.width?String(r.width):o;n=t.formattingValues[c]||t.formattingValues[o]}else{const o=t.defaultWidth,c=r?.width?String(r.width):t.defaultWidth;n=t.values[c]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(s):s;return n[i]}}const a1={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},n1={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},i1={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},o1={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},l1={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},c1={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},d1=(t,s)=>{const r=Number(t),a=r%100;if(a>20||a<10)switch(a%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},u1={ordinalNumber:d1,era:ei({values:a1,defaultWidth:"wide"}),quarter:ei({values:n1,defaultWidth:"wide",argumentCallback:t=>t-1}),month:ei({values:i1,defaultWidth:"wide"}),day:ei({values:o1,defaultWidth:"wide"}),dayPeriod:ei({values:l1,defaultWidth:"wide",formattingValues:c1,defaultFormattingWidth:"wide"})};function ti(t){return(s,r={})=>{const a=r.width,n=a&&t.matchPatterns[a]||t.matchPatterns[t.defaultMatchWidth],i=s.match(n);if(!i)return null;const o=i[0],c=a&&t.parsePatterns[a]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(c)?h1(c,p=>p.test(o)):m1(c,p=>p.test(o));let u;u=t.valueCallback?t.valueCallback(l):l,u=r.valueCallback?r.valueCallback(u):u;const d=s.slice(o.length);return{value:u,rest:d}}}function m1(t,s){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&s(t[r]))return r}function h1(t,s){for(let r=0;r<t.length;r++)if(s(t[r]))return r}function p1(t){return(s,r={})=>{const a=s.match(t.matchPattern);if(!a)return null;const n=a[0],i=s.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=r.valueCallback?r.valueCallback(o):o;const c=s.slice(n.length);return{value:o,rest:c}}}const f1=/^(\d+)(th|st|nd|rd)?/i,x1=/\d+/i,g1={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},v1={any:[/^b/i,/^(a|c)/i]},y1={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},j1={any:[/1/i,/2/i,/3/i,/4/i]},b1={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},w1={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},N1={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},_1={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},k1={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},C1={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},S1={ordinalNumber:p1({matchPattern:f1,parsePattern:x1,valueCallback:t=>parseInt(t,10)}),era:ti({matchPatterns:g1,defaultMatchWidth:"wide",parsePatterns:v1,defaultParseWidth:"any"}),quarter:ti({matchPatterns:y1,defaultMatchWidth:"wide",parsePatterns:j1,defaultParseWidth:"any",valueCallback:t=>t+1}),month:ti({matchPatterns:b1,defaultMatchWidth:"wide",parsePatterns:w1,defaultParseWidth:"any"}),day:ti({matchPatterns:N1,defaultMatchWidth:"wide",parsePatterns:_1,defaultParseWidth:"any"}),dayPeriod:ti({matchPatterns:k1,defaultMatchWidth:"any",parsePatterns:C1,defaultParseWidth:"any"})},Td={code:"en-US",formatDistance:Xw,formatLong:t1,formatRelative:r1,localize:u1,match:S1,options:{weekStartsOn:0,firstWeekContainsDate:1}};function A1(t){const s=nt(t);return Dr(s,Zp(s))+1}function tf(t){const s=nt(t),r=+$a(s)-+qw(s);return Math.round(r/_d)+1}function sf(t,s){const r=nt(t),a=r.getFullYear(),n=Ln(),i=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,o=fr(t,0);o.setFullYear(a+1,0,i),o.setHours(0,0,0,0);const c=Vr(o,s),l=fr(t,0);l.setFullYear(a,0,i),l.setHours(0,0,0,0);const u=Vr(l,s);return r.getTime()>=c.getTime()?a+1:r.getTime()>=u.getTime()?a:a-1}function T1(t,s){const r=Ln(),a=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,n=sf(t,s),i=fr(t,0);return i.setFullYear(n,0,a),i.setHours(0,0,0,0),Vr(i,s)}function rf(t,s){const r=nt(t),a=+Vr(r,s)-+T1(r,s);return Math.round(a/_d)+1}function Wt(t,s){const r=t<0?"-":"",a=Math.abs(t).toString().padStart(s,"0");return r+a}const fa={y(t,s){const r=t.getFullYear(),a=r>0?r:1-r;return Wt(s==="yy"?a%100:a,s.length)},M(t,s){const r=t.getMonth();return s==="M"?String(r+1):Wt(r+1,2)},d(t,s){return Wt(t.getDate(),s.length)},a(t,s){const r=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(t,s){return Wt(t.getHours()%12||12,s.length)},H(t,s){return Wt(t.getHours(),s.length)},m(t,s){return Wt(t.getMinutes(),s.length)},s(t,s){return Wt(t.getSeconds(),s.length)},S(t,s){const r=s.length,a=t.getMilliseconds(),n=Math.trunc(a*Math.pow(10,r-3));return Wt(n,s.length)}},on={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},_m={G:function(t,s,r){const a=t.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return r.era(a,{width:"abbreviated"});case"GGGGG":return r.era(a,{width:"narrow"});case"GGGG":default:return r.era(a,{width:"wide"})}},y:function(t,s,r){if(s==="yo"){const a=t.getFullYear(),n=a>0?a:1-a;return r.ordinalNumber(n,{unit:"year"})}return fa.y(t,s)},Y:function(t,s,r,a){const n=sf(t,a),i=n>0?n:1-n;if(s==="YY"){const o=i%100;return Wt(o,2)}return s==="Yo"?r.ordinalNumber(i,{unit:"year"}):Wt(i,s.length)},R:function(t,s){const r=Qp(t);return Wt(r,s.length)},u:function(t,s){const r=t.getFullYear();return Wt(r,s.length)},Q:function(t,s,r){const a=Math.ceil((t.getMonth()+1)/3);switch(s){case"Q":return String(a);case"QQ":return Wt(a,2);case"Qo":return r.ordinalNumber(a,{unit:"quarter"});case"QQQ":return r.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,s,r){const a=Math.ceil((t.getMonth()+1)/3);switch(s){case"q":return String(a);case"qq":return Wt(a,2);case"qo":return r.ordinalNumber(a,{unit:"quarter"});case"qqq":return r.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,s,r){const a=t.getMonth();switch(s){case"M":case"MM":return fa.M(t,s);case"Mo":return r.ordinalNumber(a+1,{unit:"month"});case"MMM":return r.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(a,{width:"wide",context:"formatting"})}},L:function(t,s,r){const a=t.getMonth();switch(s){case"L":return String(a+1);case"LL":return Wt(a+1,2);case"Lo":return r.ordinalNumber(a+1,{unit:"month"});case"LLL":return r.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(a,{width:"wide",context:"standalone"})}},w:function(t,s,r,a){const n=rf(t,a);return s==="wo"?r.ordinalNumber(n,{unit:"week"}):Wt(n,s.length)},I:function(t,s,r){const a=tf(t);return s==="Io"?r.ordinalNumber(a,{unit:"week"}):Wt(a,s.length)},d:function(t,s,r){return s==="do"?r.ordinalNumber(t.getDate(),{unit:"date"}):fa.d(t,s)},D:function(t,s,r){const a=A1(t);return s==="Do"?r.ordinalNumber(a,{unit:"dayOfYear"}):Wt(a,s.length)},E:function(t,s,r){const a=t.getDay();switch(s){case"E":case"EE":case"EEE":return r.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(a,{width:"short",context:"formatting"});case"EEEE":default:return r.day(a,{width:"wide",context:"formatting"})}},e:function(t,s,r,a){const n=t.getDay(),i=(n-a.weekStartsOn+8)%7||7;switch(s){case"e":return String(i);case"ee":return Wt(i,2);case"eo":return r.ordinalNumber(i,{unit:"day"});case"eee":return r.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(n,{width:"short",context:"formatting"});case"eeee":default:return r.day(n,{width:"wide",context:"formatting"})}},c:function(t,s,r,a){const n=t.getDay(),i=(n-a.weekStartsOn+8)%7||7;switch(s){case"c":return String(i);case"cc":return Wt(i,s.length);case"co":return r.ordinalNumber(i,{unit:"day"});case"ccc":return r.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(n,{width:"narrow",context:"standalone"});case"cccccc":return r.day(n,{width:"short",context:"standalone"});case"cccc":default:return r.day(n,{width:"wide",context:"standalone"})}},i:function(t,s,r){const a=t.getDay(),n=a===0?7:a;switch(s){case"i":return String(n);case"ii":return Wt(n,s.length);case"io":return r.ordinalNumber(n,{unit:"day"});case"iii":return r.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(a,{width:"short",context:"formatting"});case"iiii":default:return r.day(a,{width:"wide",context:"formatting"})}},a:function(t,s,r){const n=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(t,s,r){const a=t.getHours();let n;switch(a===12?n=on.noon:a===0?n=on.midnight:n=a/12>=1?"pm":"am",s){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(t,s,r){const a=t.getHours();let n;switch(a>=17?n=on.evening:a>=12?n=on.afternoon:a>=4?n=on.morning:n=on.night,s){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(t,s,r){if(s==="ho"){let a=t.getHours()%12;return a===0&&(a=12),r.ordinalNumber(a,{unit:"hour"})}return fa.h(t,s)},H:function(t,s,r){return s==="Ho"?r.ordinalNumber(t.getHours(),{unit:"hour"}):fa.H(t,s)},K:function(t,s,r){const a=t.getHours()%12;return s==="Ko"?r.ordinalNumber(a,{unit:"hour"}):Wt(a,s.length)},k:function(t,s,r){let a=t.getHours();return a===0&&(a=24),s==="ko"?r.ordinalNumber(a,{unit:"hour"}):Wt(a,s.length)},m:function(t,s,r){return s==="mo"?r.ordinalNumber(t.getMinutes(),{unit:"minute"}):fa.m(t,s)},s:function(t,s,r){return s==="so"?r.ordinalNumber(t.getSeconds(),{unit:"second"}):fa.s(t,s)},S:function(t,s){return fa.S(t,s)},X:function(t,s,r){const a=t.getTimezoneOffset();if(a===0)return"Z";switch(s){case"X":return Cm(a);case"XXXX":case"XX":return Oa(a);case"XXXXX":case"XXX":default:return Oa(a,":")}},x:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"x":return Cm(a);case"xxxx":case"xx":return Oa(a);case"xxxxx":case"xxx":default:return Oa(a,":")}},O:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+km(a,":");case"OOOO":default:return"GMT"+Oa(a,":")}},z:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+km(a,":");case"zzzz":default:return"GMT"+Oa(a,":")}},t:function(t,s,r){const a=Math.trunc(t.getTime()/1e3);return Wt(a,s.length)},T:function(t,s,r){const a=t.getTime();return Wt(a,s.length)}};function km(t,s=""){const r=t>0?"-":"+",a=Math.abs(t),n=Math.trunc(a/60),i=a%60;return i===0?r+String(n):r+String(n)+s+Wt(i,2)}function Cm(t,s){return t%60===0?(t>0?"-":"+")+Wt(Math.abs(t)/60,2):Oa(t,s)}function Oa(t,s=""){const r=t>0?"-":"+",a=Math.abs(t),n=Wt(Math.trunc(a/60),2),i=Wt(a%60,2);return r+n+s+i}const Sm=(t,s)=>{switch(t){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},af=(t,s)=>{switch(t){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},P1=(t,s)=>{const r=t.match(/(P+)(p+)?/)||[],a=r[1],n=r[2];if(!n)return Sm(t,s);let i;switch(a){case"P":i=s.dateTime({width:"short"});break;case"PP":i=s.dateTime({width:"medium"});break;case"PPP":i=s.dateTime({width:"long"});break;case"PPPP":default:i=s.dateTime({width:"full"});break}return i.replace("{{date}}",Sm(a,s)).replace("{{time}}",af(n,s))},M1={p:af,P:P1},R1=/^D+$/,D1=/^Y+$/,E1=["D","DD","YY","YYYY"];function I1(t){return R1.test(t)}function O1(t){return D1.test(t)}function F1(t,s,r){const a=L1(t,s,r);if(console.warn(a),E1.includes(t))throw new RangeError(a)}function L1(t,s,r){const a=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${s}\`) for formatting ${a} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const q1=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,z1=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,B1=/^'([^]*?)'?$/,$1=/''/g,U1=/[a-zA-Z]/;function tt(t,s,r){const a=Ln(),n=r?.locale??a.locale??Td,i=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,o=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,c=nt(t);if(!Hw(c))throw new RangeError("Invalid time value");let l=s.match(z1).map(d=>{const p=d[0];if(p==="p"||p==="P"){const h=M1[p];return h(d,n.formatLong)}return d}).join("").match(q1).map(d=>{if(d==="''")return{isToken:!1,value:"'"};const p=d[0];if(p==="'")return{isToken:!1,value:H1(d)};if(_m[p])return{isToken:!0,value:d};if(p.match(U1))throw new RangeError("Format string contains an unescaped latin alphabet character `"+p+"`");return{isToken:!1,value:d}});n.localize.preprocessor&&(l=n.localize.preprocessor(c,l));const u={firstWeekContainsDate:i,weekStartsOn:o,locale:n};return l.map(d=>{if(!d.isToken)return d.value;const p=d.value;(!r?.useAdditionalWeekYearTokens&&O1(p)||!r?.useAdditionalDayOfYearTokens&&I1(p))&&F1(p,s,String(t));const h=_m[p[0]];return h(c,p,n.localize,u)}).join("")}function H1(t){const s=t.match(B1);return s?s[1].replace($1,"'"):t}function V1(t,s,r){const a=Ln(),n=r?.locale??a.locale??Td,i=2520,o=go(t,s);if(isNaN(o))throw new RangeError("Invalid time value");const c=Object.assign({},r,{addSuffix:r?.addSuffix,comparison:o});let l,u;o>0?(l=nt(s),u=nt(t)):(l=nt(t),u=nt(s));const d=Gw(u,l),p=(bn(u)-bn(l))/1e3,h=Math.round((d-p)/60);let f;if(h<2)return r?.includeSeconds?d<5?n.formatDistance("lessThanXSeconds",5,c):d<10?n.formatDistance("lessThanXSeconds",10,c):d<20?n.formatDistance("lessThanXSeconds",20,c):d<40?n.formatDistance("halfAMinute",0,c):d<60?n.formatDistance("lessThanXMinutes",1,c):n.formatDistance("xMinutes",1,c):h===0?n.formatDistance("lessThanXMinutes",1,c):n.formatDistance("xMinutes",h,c);if(h<45)return n.formatDistance("xMinutes",h,c);if(h<90)return n.formatDistance("aboutXHours",1,c);if(h<bm){const y=Math.round(h/60);return n.formatDistance("aboutXHours",y,c)}else{if(h<i)return n.formatDistance("xDays",1,c);if(h<no){const y=Math.round(h/bm);return n.formatDistance("xDays",y,c)}else if(h<no*2)return f=Math.round(h/no),n.formatDistance("aboutXMonths",f,c)}if(f=Sd(u,l),f<12){const y=Math.round(h/no);return n.formatDistance("xMonths",y,c)}else{const y=f%12,v=Math.trunc(f/12);return y<3?n.formatDistance("aboutXYears",v,c):y<9?n.formatDistance("overXYears",v,c):n.formatDistance("almostXYears",v+1,c)}}function Er(t,s){return V1(t,Uw(t),s)}function K1(t){const s=nt(t),r=s.getFullYear(),a=s.getMonth(),n=fr(t,0);return n.setFullYear(r,a+1,0),n.setHours(0,0,0,0),n.getDate()}function W1(t){return Math.trunc(+nt(t)/1e3)}function Y1(t){const s=nt(t),r=s.getMonth();return s.setFullYear(s.getFullYear(),r+1,0),s.setHours(0,0,0,0),s}function G1(t,s){return Vw(Y1(t),ur(t),s)+1}function Ic(t,s){const r=nt(t),a=nt(s);return r.getTime()>a.getTime()}function nf(t,s){const r=nt(t),a=nt(s);return+r<+a}function Pd(t,s){const r=nt(t),a=nt(s);return r.getFullYear()===a.getFullYear()&&r.getMonth()===a.getMonth()}function Q1(t,s){const r=nt(t),a=nt(s);return r.getFullYear()===a.getFullYear()}function X1(t,s){const r=+nt(t),[a,n]=[+nt(s.start),+nt(s.end)].sort((i,o)=>i-o);return r>=a&&r<=n}function Zl(t,s){return Qs(t,-s)}function ss(t,s){const a=tN(t);let n;if(a.date){const l=sN(a.date,2);n=rN(l.restDateString,l.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);const i=n.getTime();let o=0,c;if(a.time&&(o=aN(a.time),isNaN(o)))return new Date(NaN);if(a.timezone){if(c=nN(a.timezone),isNaN(c))return new Date(NaN)}else{const l=new Date(i+o),u=new Date(0);return u.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),u.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),u}return new Date(i+o+c)}const io={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},J1=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Z1=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,eN=/^([+-])(\d{2})(?::?(\d{2}))?$/;function tN(t){const s={},r=t.split(io.dateTimeDelimiter);let a;if(r.length>2)return s;if(/:/.test(r[0])?a=r[0]:(s.date=r[0],a=r[1],io.timeZoneDelimiter.test(s.date)&&(s.date=t.split(io.timeZoneDelimiter)[0],a=t.substr(s.date.length,t.length))),a){const n=io.timezone.exec(a);n?(s.time=a.replace(n[1],""),s.timezone=n[1]):s.time=a}return s}function sN(t,s){const r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),a=t.match(r);if(!a)return{year:NaN,restDateString:""};const n=a[1]?parseInt(a[1]):null,i=a[2]?parseInt(a[2]):null;return{year:i===null?n:i*100,restDateString:t.slice((a[1]||a[2]).length)}}function rN(t,s){if(s===null)return new Date(NaN);const r=t.match(J1);if(!r)return new Date(NaN);const a=!!r[4],n=si(r[1]),i=si(r[2])-1,o=si(r[3]),c=si(r[4]),l=si(r[5])-1;if(a)return dN(s,c,l)?iN(s,c,l):new Date(NaN);{const u=new Date(0);return!lN(s,i,o)||!cN(s,n)?new Date(NaN):(u.setUTCFullYear(s,i,Math.max(n,o)),u)}}function si(t){return t?parseInt(t):1}function aN(t){const s=t.match(Z1);if(!s)return NaN;const r=ec(s[1]),a=ec(s[2]),n=ec(s[3]);return uN(r,a,n)?r*kd+a*Gp+n*1e3:NaN}function ec(t){return t&&parseFloat(t.replace(",","."))||0}function nN(t){if(t==="Z")return 0;const s=t.match(eN);if(!s)return 0;const r=s[1]==="+"?-1:1,a=parseInt(s[2]),n=s[3]&&parseInt(s[3])||0;return mN(a,n)?r*(a*kd+n*Gp):NaN}function iN(t,s,r){const a=new Date(0);a.setUTCFullYear(t,0,4);const n=a.getUTCDay()||7,i=(s-1)*7+r+1-n;return a.setUTCDate(a.getUTCDate()+i),a}const oN=[31,null,31,30,31,30,31,31,30,31,30,31];function of(t){return t%400===0||t%4===0&&t%100!==0}function lN(t,s,r){return s>=0&&s<=11&&r>=1&&r<=(oN[s]||(of(t)?29:28))}function cN(t,s){return s>=1&&s<=(of(t)?366:365)}function dN(t,s,r){return s>=1&&s<=53&&r>=0&&r<=6}function uN(t,s,r){return t===24?s===0&&r===0:r>=0&&r<60&&s>=0&&s<60&&t>=0&&t<25}function mN(t,s){return s>=0&&s<=59}function tc(t,s){const r=nt(t),a=r.getFullYear(),n=r.getDate(),i=fr(t,0);i.setFullYear(a,s,15),i.setHours(0,0,0,0);const o=K1(i);return r.setMonth(s,Math.min(n,o)),r}function Am(t,s){const r=nt(t);return isNaN(+r)?fr(t,NaN):(r.setFullYear(s),r)}const vo=[];function Ua(){return typeof navigator<"u"?navigator.onLine:!0}function Tm(t){vo.forEach(s=>{try{s(t)}catch{}})}typeof window<"u"&&(window.addEventListener("online",()=>Tm(!0)),window.addEventListener("offline",()=>Tm(!1)));function Md(t){return vo.push(t),()=>{const s=vo.indexOf(t);s>=0&&vo.splice(s,1)}}const Ao={isOnline:Ua,subscribe:Md};function hN(){const[t,s]=x.useState(Ao.isOnline());return x.useEffect(()=>Ao.subscribe(a=>s(a)),[]),e.jsx("div",{className:`px-2 py-1 text-sm ${t?"text-green-700":"text-yellow-800"}`,children:t?"Online":"Offline  Pending sync"})}const pN=({title:t,onMenuClick:s})=>{const{user:r,signOut:a,userRole:n}=Fe(),{t:i}=Nt(),{data:o}=tl(),{data:c}=Fn(),l=Xe(),u=Ut(),[d,p]=x.useState(!1),h=x.useMemo(()=>o?.filter(j=>!j.is_read).length||0,[o]),f=x.useMemo(()=>o?.slice(0,5)||[],[o]);x.useEffect(()=>{if(!r?.id)return;const j=W.channel("notifications-header").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${r.id}`},()=>{l.invalidateQueries({queryKey:["farmer-notifications",r.id]})}).subscribe();return()=>{W.removeChannel(j)}},[r?.id,l]);const y=async j=>{await W.from("notifications").update({is_read:!0}).eq("id",j),l.invalidateQueries({queryKey:["farmer-notifications",r?.id]})},b=((j,C)=>j?j.split(" ").map(I=>I[0]).join("").toUpperCase().slice(0,2):C?.slice(0,2).toUpperCase()||"U")(c?.full_name,r?.email),N=()=>({farmer:"/farmer/settings",buyer:"/marketplace/profile",logistics:"/logistics/profile",agent:"/agent/dashboard",admin:"/admin/dashboard"})[n||""]||"/",A=()=>n==="farmer"?"/farmer/notifications":N();return e.jsxs("header",{className:"sticky top-0 z-30 flex h-16 items-center justify-between border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 px-4 md:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(z,{"aria-label":"Open menu",variant:"ghost",size:"icon",className:"md:hidden",onClick:s,children:e.jsx(np,{className:"h-5 w-5"})}),e.jsx("h1",{className:"font-display text-lg md:text-xl font-semibold text-foreground truncate max-w-[200px] md:max-w-none",children:t}),e.jsx("div",{className:"ml-3",children:e.jsx(hN,{})})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(z,{"aria-label":d?"Close search":"Open search",variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>p(!d),children:d?e.jsx(ar,{className:"h-5 w-5"}):e.jsx(Is,{className:"h-5 w-5"})}),e.jsxs("div",{className:"hidden md:flex relative",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:`${i("common.search")}...`,className:"w-64 pl-9 bg-muted/50 border-0"})]}),e.jsxs(Co,{children:[e.jsx(So,{asChild:!0,children:e.jsxs(z,{"aria-label":"Notifications",variant:"ghost",size:"icon",className:"relative",children:[e.jsx(_r,{className:"h-5 w-5"}),h>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-4 w-4 rounded-full bg-destructive text-[10px] font-medium text-destructive-foreground flex items-center justify-center",children:h>9?"9+":h})]})}),e.jsxs(gi,{align:"end",className:"w-80",children:[e.jsxs(Rc,{className:"flex items-center justify-between",children:[e.jsx("span",{children:i("nav.notifications")}),h>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[h," ",i("common.unread")]})]}),e.jsx(dn,{}),f.length===0?e.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:i("notifications.no_notifications")}):e.jsxs(e.Fragment,{children:[f.map(j=>e.jsxs(Rr,{className:`flex flex-col items-start gap-1 p-3 cursor-pointer ${j.is_read?"":"bg-primary/5"}`,onClick:()=>{j.is_read||y(j.id),u(A())},children:[e.jsxs("div",{className:"flex items-start justify-between w-full",children:[e.jsx("span",{className:"font-medium text-sm",children:j.title}),!j.is_read&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary shrink-0 mt-1"})]}),e.jsx("span",{className:"text-xs text-muted-foreground line-clamp-1",children:j.message}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Er(new Date(j.created_at),{addSuffix:!0})})]},j.id)),e.jsx(dn,{}),e.jsx(Rr,{className:"text-center justify-center text-primary cursor-pointer",onClick:()=>u(A()),children:i("notifications.view_all")})]})]})]}),e.jsxs(Co,{children:[e.jsx(So,{asChild:!0,children:e.jsx(z,{"aria-label":"Open profile menu",variant:"ghost",className:"relative h-9 w-9 rounded-full",children:e.jsxs(bd,{className:"h-9 w-9 border-2 border-primary/20",children:[e.jsx(wd,{src:c?.avatar_url||""}),e.jsx(Nd,{className:"bg-primary text-primary-foreground text-sm font-medium",children:b})]})})}),e.jsxs(gi,{align:"end",className:"w-56",children:[e.jsx(Rc,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:c?.full_name||i("common.user")}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:r?.email})]})}),e.jsx(dn,{}),e.jsx(Rr,{onClick:()=>u(N()),children:i("settings.profileSettings")}),e.jsx(dn,{}),e.jsx(Rr,{className:"text-destructive focus:text-destructive",onClick:a,children:i("auth.signOut")})]})]})]}),d&&e.jsx("div",{className:"absolute top-16 left-0 right-0 p-4 bg-background border-b border-border md:hidden",children:e.jsxs("div",{className:"relative",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:`${i("common.search")}...`,className:"w-full pl-9",autoFocus:!0})]})})]})},sc=768;function fN(){const[t,s]=x.useState(void 0);return x.useEffect(()=>{const r=window.matchMedia(`(max-width: ${sc-1}px)`),a=()=>{s(window.innerWidth<sc)};return r.addEventListener("change",a),s(window.innerWidth<sc),()=>r.removeEventListener("change",a)},[]),!!t}const Oe=({children:t,title:s})=>{const[r,a]=x.useState(!1),n=Rn();fN();const i=x.useCallback(()=>{a(!1)},[]),o=x.useCallback(()=>{a(!0)},[]);return x.useEffect(()=>{i()},[n.pathname,i]),x.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[r]),x.useEffect(()=>{const c=l=>{l.key==="Escape"&&r&&i()};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[r,i]),e.jsxs("div",{className:"min-h-screen bg-background",children:[r&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-40 md:hidden backdrop-blur-sm transition-opacity duration-300",onClick:i,onTouchEnd:i,"aria-hidden":"true"}),e.jsx("div",{className:"hidden md:block fixed inset-y-0 left-0 z-30",children:e.jsx(ym,{onClose:i,isOpen:!0,isMobile:!1})}),e.jsx("div",{className:"md:hidden",children:e.jsx(ym,{onClose:i,isOpen:r,isMobile:!0})}),e.jsxs("div",{className:"md:pl-64",children:[e.jsx(pN,{title:s,onMenuClick:o}),e.jsx("main",{className:"p-4 md:p-6",children:t})]})]})};function Re({className:t,...s}){return e.jsx("div",{className:ke("animate-pulse rounded-md bg-muted",t),...s})}var Rd="Progress",Dd=100,[xN]=wr(Rd),[gN,vN]=xN(Rd),lf=x.forwardRef((t,s)=>{const{__scopeProgress:r,value:a=null,max:n,getValueLabel:i=yN,...o}=t;(n||n===0)&&!Pm(n)&&console.error(jN(`${n}`,"Progress"));const c=Pm(n)?n:Dd;a!==null&&!Mm(a,c)&&console.error(bN(`${a}`,"Progress"));const l=Mm(a,c)?a:null,u=To(l)?i(l,c):void 0;return e.jsx(gN,{scope:r,value:l,max:c,children:e.jsx(ht.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":To(l)?l:void 0,"aria-valuetext":u,role:"progressbar","data-state":uf(l,c),"data-value":l??void 0,"data-max":c,...o,ref:s})})});lf.displayName=Rd;var cf="ProgressIndicator",df=x.forwardRef((t,s)=>{const{__scopeProgress:r,...a}=t,n=vN(cf,r);return e.jsx(ht.div,{"data-state":uf(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...a,ref:s})});df.displayName=cf;function yN(t,s){return`${Math.round(t/s*100)}%`}function uf(t,s){return t==null?"indeterminate":t===s?"complete":"loading"}function To(t){return typeof t=="number"}function Pm(t){return To(t)&&!isNaN(t)&&t>0}function Mm(t,s){return To(t)&&!isNaN(t)&&t<=s&&t>=0}function jN(t,s){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${Dd}\`.`}function bN(t,s){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${Dd} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var mf=lf,wN=df;const Ed=x.forwardRef(({className:t,value:s,...r},a)=>e.jsx(mf,{ref:a,className:ke("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...r,children:e.jsx(wN,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));Ed.displayName=mf.displayName;const NN=({dashboardData:t})=>{const{data:s,isLoading:r}=Fn(),{data:a}=_a(),{activeCrops:n,readyToHarvest:i,pendingTransport:o,isLoading:c}=yw(),l=t||null,u=Ut(),d=l&&l.crops_by_status?Object.values(l.crops_by_status).reduce((v,b)=>v+(b||0),0):null,h=(()=>{if(!s)return 0;let v=0;const b=[s.full_name,s.phone,s.village,s.district,a&&a.length>0];return b.forEach(N=>{N&&v++}),Math.round(v/b.length*100)})(),f=a?.reduce((v,b)=>v+b.area,0)||0;if(r||c)return e.jsx("div",{className:"bg-gradient-to-r from-primary/10 via-primary/5 to-accent/10 rounded-2xl p-4 md:p-5 border border-border",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Re,{className:"h-7 w-44"}),e.jsx(Re,{className:"h-4 w-56"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:[1,2,3,4].map(v=>e.jsx(Re,{className:"h-16 w-28"},v))})]})});const y=[{label:"Total Land",value:`${f.toFixed(1)} acres`,icon:lr,color:"text-amber-600 bg-amber-100"},{label:"Active Crops",value:String(d??n),icon:ts,color:"text-emerald-600 bg-emerald-100"},{label:"Ready to Harvest",value:i.toString(),icon:za,color:"text-primary bg-primary/10"},{label:"Pending Transport",value:(l?.open_transport_requests_count!=null?l.open_transport_requests_count:o).toString(),icon:rt,color:"text-blue-600 bg-blue-100"}];return e.jsx("div",{className:"bg-gradient-to-r from-primary/10 via-primary/5 to-accent/10 rounded-2xl p-4 md:p-5 border border-border shadow-soft",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 md:gap-5",children:[e.jsxs("div",{className:"space-y-3 flex-1 min-w-0",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-display font-bold text-foreground leading-tight",children:["Welcome, ",s?.full_name||"Farmer","! "]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mt-1",children:[e.jsx(We,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"truncate",children:s?.village&&s?.district?`${s.village}, ${s.district}`:"Location not set"})]})]}),h<100&&e.jsxs("div",{className:"bg-card/80 backdrop-blur-sm rounded-xl p-3 border border-border/50 max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h>=80?e.jsx(ys,{className:"h-4 w-4 text-primary"}):e.jsx(rr,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Profile Completion"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[h,"%"]})]}),e.jsx(Ed,{value:h,className:"h-2"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1.5 leading-relaxed",children:h<40?"Complete your profile to unlock all features":h<80?"Almost there! Add a few more details":"Just a little more to complete your profile"}),e.jsx(z,{variant:"link",size:"sm",className:"p-0 h-auto mt-1 text-primary",onClick:()=>u("/farmer/settings"),children:"Complete Profile "})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2.5 md:gap-3 w-full lg:w-auto",children:y.map(v=>e.jsx("div",{className:"bg-card/80 backdrop-blur-sm rounded-xl p-3 border border-border/50 shadow-sm hover:shadow-md transition-shadow min-w-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${v.color}`,children:e.jsx(v.icon,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-lg md:text-xl font-bold text-foreground leading-tight truncate",children:v.value}),e.jsx("p",{className:"text-[11px] md:text-xs text-muted-foreground leading-tight mt-0.5",children:v.label})]})]})},v.label))})]})})},zt=sd,Wr=ph,_N=ed,hf=x.forwardRef(({className:t,...s},r)=>e.jsx(Uo,{ref:r,className:ke("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));hf.displayName=Uo.displayName;const It=x.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(_N,{children:[e.jsx(hf,{}),e.jsxs(Ho,{ref:a,className:ke("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[s,e.jsxs(td,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(ar,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));It.displayName=Ho.displayName;const Bt=({className:t,...s})=>e.jsx("div",{className:ke("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});Bt.displayName="DialogHeader";const br=({className:t,...s})=>e.jsx("div",{className:ke("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});br.displayName="DialogFooter";const $t=x.forwardRef(({className:t,...s},r)=>e.jsx(Vo,{ref:r,className:ke("text-lg font-semibold leading-none tracking-tight",t),...s}));$t.displayName=Vo.displayName;const Ks=x.forwardRef(({className:t,...s},r)=>e.jsx(Ko,{ref:r,className:ke("text-sm text-muted-foreground",t),...s}));Ks.displayName=Ko.displayName;function Oc(t,[s,r]){return Math.min(r,Math.max(s,t))}function rl(t){const s=x.useRef({value:t,previous:t});return x.useMemo(()=>(s.current.value!==t&&(s.current.previous=s.current.value,s.current.value=t),s.current.previous),[t])}var kN=[" ","Enter","ArrowUp","ArrowDown"],CN=[" ","Enter"],Ha="Select",[al,nl,SN]=rh(Ha),[qn]=wr(Ha,[SN,En]),il=En(),[AN,Ca]=qn(Ha),[TN,PN]=qn(Ha),pf=t=>{const{__scopeSelect:s,children:r,open:a,defaultOpen:n,onOpenChange:i,value:o,defaultValue:c,onValueChange:l,dir:u,name:d,autoComplete:p,disabled:h,required:f,form:y}=t,v=il(s),[b,N]=x.useState(null),[A,j]=x.useState(null),[C,I]=x.useState(!1),k=rd(u),[R,S]=ra({prop:a,defaultProp:n??!1,onChange:i,caller:Ha}),[T,E]=ra({prop:o,defaultProp:c,onChange:l,caller:Ha}),D=x.useRef(null),F=b?y||!!b.closest("form"):!0,[H,q]=x.useState(new Set),B=Array.from(H).map(L=>L.props.value).join(";");return e.jsx(Jc,{...v,children:e.jsxs(AN,{required:f,scope:s,trigger:b,onTriggerChange:N,valueNode:A,onValueNodeChange:j,valueNodeHasChildren:C,onValueNodeHasChildrenChange:I,contentId:In(),value:T,onValueChange:E,open:R,onOpenChange:S,dir:k,triggerPointerDownPosRef:D,disabled:h,children:[e.jsx(al.Provider,{scope:s,children:e.jsx(TN,{scope:t.__scopeSelect,onNativeOptionAdd:x.useCallback(L=>{q(P=>new Set(P).add(L))},[]),onNativeOptionRemove:x.useCallback(L=>{q(P=>{const K=new Set(P);return K.delete(L),K})},[]),children:r})}),F?e.jsxs(Lf,{"aria-hidden":!0,required:f,tabIndex:-1,name:d,autoComplete:p,value:T,onChange:L=>E(L.target.value),disabled:h,form:y,children:[T===void 0?e.jsx("option",{value:""}):null,Array.from(H)]},B):null]})})};pf.displayName=Ha;var ff="SelectTrigger",xf=x.forwardRef((t,s)=>{const{__scopeSelect:r,disabled:a=!1,...n}=t,i=il(r),o=Ca(ff,r),c=o.disabled||a,l=Ht(s,o.onTriggerChange),u=nl(r),d=x.useRef("touch"),[p,h,f]=zf(v=>{const b=u().filter(j=>!j.disabled),N=b.find(j=>j.value===o.value),A=Bf(b,v,N);A!==void 0&&o.onValueChange(A.value)}),y=v=>{c||(o.onOpenChange(!0),f()),v&&(o.triggerPointerDownPosRef.current={x:Math.round(v.pageX),y:Math.round(v.pageY)})};return e.jsx($o,{asChild:!0,...i,children:e.jsx(ht.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":qf(o.value)?"":void 0,...n,ref:l,onClick:st(n.onClick,v=>{v.currentTarget.focus(),d.current!=="mouse"&&y(v)}),onPointerDown:st(n.onPointerDown,v=>{d.current=v.pointerType;const b=v.target;b.hasPointerCapture(v.pointerId)&&b.releasePointerCapture(v.pointerId),v.button===0&&v.ctrlKey===!1&&v.pointerType==="mouse"&&(y(v),v.preventDefault())}),onKeyDown:st(n.onKeyDown,v=>{const b=p.current!=="";!(v.ctrlKey||v.altKey||v.metaKey)&&v.key.length===1&&h(v.key),!(b&&v.key===" ")&&kN.includes(v.key)&&(y(),v.preventDefault())})})})});xf.displayName=ff;var gf="SelectValue",vf=x.forwardRef((t,s)=>{const{__scopeSelect:r,className:a,style:n,children:i,placeholder:o="",...c}=t,l=Ca(gf,r),{onValueNodeHasChildrenChange:u}=l,d=i!==void 0,p=Ht(s,l.onValueNodeChange);return mr(()=>{u(d)},[u,d]),e.jsx(ht.span,{...c,ref:p,style:{pointerEvents:"none"},children:qf(l.value)?e.jsx(e.Fragment,{children:o}):i})});vf.displayName=gf;var MN="SelectIcon",yf=x.forwardRef((t,s)=>{const{__scopeSelect:r,children:a,...n}=t;return e.jsx(ht.span,{"aria-hidden":!0,...n,ref:s,children:a||""})});yf.displayName=MN;var RN="SelectPortal",jf=t=>e.jsx(Gc,{asChild:!0,...t});jf.displayName=RN;var Va="SelectContent",bf=x.forwardRef((t,s)=>{const r=Ca(Va,t.__scopeSelect),[a,n]=x.useState();if(mr(()=>{n(new DocumentFragment)},[]),!r.open){const i=a;return i?Bo.createPortal(e.jsx(wf,{scope:t.__scopeSelect,children:e.jsx(al.Slot,{scope:t.__scopeSelect,children:e.jsx("div",{children:t.children})})}),i):null}return e.jsx(Nf,{...t,ref:s})});bf.displayName=Va;var Mr=10,[wf,Sa]=qn(Va),DN="SelectContentImpl",EN=yh("SelectContent.RemoveScroll"),Nf=x.forwardRef((t,s)=>{const{__scopeSelect:r,position:a="item-aligned",onCloseAutoFocus:n,onEscapeKeyDown:i,onPointerDownOutside:o,side:c,sideOffset:l,align:u,alignOffset:d,arrowPadding:p,collisionBoundary:h,collisionPadding:f,sticky:y,hideWhenDetached:v,avoidCollisions:b,...N}=t,A=Ca(Va,r),[j,C]=x.useState(null),[I,k]=x.useState(null),R=Ht(s,Ae=>C(Ae)),[S,T]=x.useState(null),[E,D]=x.useState(null),F=nl(r),[H,q]=x.useState(!1),B=x.useRef(!1);x.useEffect(()=>{if(j)return fh(j)},[j]),xh();const L=x.useCallback(Ae=>{const[Ye,...Ze]=F().map(qe=>qe.ref.current),[Ne]=Ze.slice(-1),Ge=document.activeElement;for(const qe of Ae)if(qe===Ge||(qe?.scrollIntoView({block:"nearest"}),qe===Ye&&I&&(I.scrollTop=0),qe===Ne&&I&&(I.scrollTop=I.scrollHeight),qe?.focus(),document.activeElement!==Ge))return},[F,I]),P=x.useCallback(()=>L([S,j]),[L,S,j]);x.useEffect(()=>{H&&P()},[H,P]);const{onOpenChange:K,triggerPointerDownPosRef:$}=A;x.useEffect(()=>{if(j){let Ae={x:0,y:0};const Ye=Ne=>{Ae={x:Math.abs(Math.round(Ne.pageX)-($.current?.x??0)),y:Math.abs(Math.round(Ne.pageY)-($.current?.y??0))}},Ze=Ne=>{Ae.x<=10&&Ae.y<=10?Ne.preventDefault():j.contains(Ne.target)||K(!1),document.removeEventListener("pointermove",Ye),$.current=null};return $.current!==null&&(document.addEventListener("pointermove",Ye),document.addEventListener("pointerup",Ze,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Ye),document.removeEventListener("pointerup",Ze,{capture:!0})}}},[j,K,$]),x.useEffect(()=>{const Ae=()=>K(!1);return window.addEventListener("blur",Ae),window.addEventListener("resize",Ae),()=>{window.removeEventListener("blur",Ae),window.removeEventListener("resize",Ae)}},[K]);const[se,ne]=zf(Ae=>{const Ye=F().filter(Ge=>!Ge.disabled),Ze=Ye.find(Ge=>Ge.ref.current===document.activeElement),Ne=Bf(Ye,Ae,Ze);Ne&&setTimeout(()=>Ne.ref.current.focus())}),Y=x.useCallback((Ae,Ye,Ze)=>{const Ne=!B.current&&!Ze;(A.value!==void 0&&A.value===Ye||Ne)&&(T(Ae),Ne&&(B.current=!0))},[A.value]),fe=x.useCallback(()=>j?.focus(),[j]),me=x.useCallback((Ae,Ye,Ze)=>{const Ne=!B.current&&!Ze;(A.value!==void 0&&A.value===Ye||Ne)&&D(Ae)},[A.value]),xe=a==="popper"?Fc:_f,He=xe===Fc?{side:c,sideOffset:l,align:u,alignOffset:d,arrowPadding:p,collisionBoundary:h,collisionPadding:f,sticky:y,hideWhenDetached:v,avoidCollisions:b}:{};return e.jsx(wf,{scope:r,content:j,viewport:I,onViewportChange:k,itemRefCallback:Y,selectedItem:S,onItemLeave:fe,itemTextRefCallback:me,focusSelectedItem:P,selectedItemText:E,position:a,isPositioned:H,searchRef:se,children:e.jsx(gh,{as:EN,allowPinchZoom:!0,children:e.jsx(vh,{asChild:!0,trapped:A.open,onMountAutoFocus:Ae=>{Ae.preventDefault()},onUnmountAutoFocus:st(n,Ae=>{A.trigger?.focus({preventScroll:!0}),Ae.preventDefault()}),children:e.jsx(Qc,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:Ae=>Ae.preventDefault(),onDismiss:()=>A.onOpenChange(!1),children:e.jsx(xe,{role:"listbox",id:A.contentId,"data-state":A.open?"open":"closed",dir:A.dir,onContextMenu:Ae=>Ae.preventDefault(),...N,...He,onPlaced:()=>q(!0),ref:R,style:{display:"flex",flexDirection:"column",outline:"none",...N.style},onKeyDown:st(N.onKeyDown,Ae=>{const Ye=Ae.ctrlKey||Ae.altKey||Ae.metaKey;if(Ae.key==="Tab"&&Ae.preventDefault(),!Ye&&Ae.key.length===1&&ne(Ae.key),["ArrowUp","ArrowDown","Home","End"].includes(Ae.key)){let Ne=F().filter(Ge=>!Ge.disabled).map(Ge=>Ge.ref.current);if(["ArrowUp","End"].includes(Ae.key)&&(Ne=Ne.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ae.key)){const Ge=Ae.target,qe=Ne.indexOf(Ge);Ne=Ne.slice(qe+1)}setTimeout(()=>L(Ne)),Ae.preventDefault()}})})})})})})});Nf.displayName=DN;var IN="SelectItemAlignedPosition",_f=x.forwardRef((t,s)=>{const{__scopeSelect:r,onPlaced:a,...n}=t,i=Ca(Va,r),o=Sa(Va,r),[c,l]=x.useState(null),[u,d]=x.useState(null),p=Ht(s,R=>d(R)),h=nl(r),f=x.useRef(!1),y=x.useRef(!0),{viewport:v,selectedItem:b,selectedItemText:N,focusSelectedItem:A}=o,j=x.useCallback(()=>{if(i.trigger&&i.valueNode&&c&&u&&v&&b&&N){const R=i.trigger.getBoundingClientRect(),S=u.getBoundingClientRect(),T=i.valueNode.getBoundingClientRect(),E=N.getBoundingClientRect();if(i.dir!=="rtl"){const Ge=E.left-S.left,qe=T.left-Ge,Ke=R.left-qe,as=R.width+Ke,yt=Math.max(as,S.width),Vt=window.innerWidth-Mr,Pt=Oc(qe,[Mr,Math.max(Mr,Vt-yt)]);c.style.minWidth=as+"px",c.style.left=Pt+"px"}else{const Ge=S.right-E.right,qe=window.innerWidth-T.right-Ge,Ke=window.innerWidth-R.right-qe,as=R.width+Ke,yt=Math.max(as,S.width),Vt=window.innerWidth-Mr,Pt=Oc(qe,[Mr,Math.max(Mr,Vt-yt)]);c.style.minWidth=as+"px",c.style.right=Pt+"px"}const D=h(),F=window.innerHeight-Mr*2,H=v.scrollHeight,q=window.getComputedStyle(u),B=parseInt(q.borderTopWidth,10),L=parseInt(q.paddingTop,10),P=parseInt(q.borderBottomWidth,10),K=parseInt(q.paddingBottom,10),$=B+L+H+K+P,se=Math.min(b.offsetHeight*5,$),ne=window.getComputedStyle(v),Y=parseInt(ne.paddingTop,10),fe=parseInt(ne.paddingBottom,10),me=R.top+R.height/2-Mr,xe=F-me,He=b.offsetHeight/2,Ae=b.offsetTop+He,Ye=B+L+Ae,Ze=$-Ye;if(Ye<=me){const Ge=D.length>0&&b===D[D.length-1].ref.current;c.style.bottom="0px";const qe=u.clientHeight-v.offsetTop-v.offsetHeight,Ke=Math.max(xe,He+(Ge?fe:0)+qe+P),as=Ye+Ke;c.style.height=as+"px"}else{const Ge=D.length>0&&b===D[0].ref.current;c.style.top="0px";const Ke=Math.max(me,B+v.offsetTop+(Ge?Y:0)+He)+Ze;c.style.height=Ke+"px",v.scrollTop=Ye-me+v.offsetTop}c.style.margin=`${Mr}px 0`,c.style.minHeight=se+"px",c.style.maxHeight=F+"px",a?.(),requestAnimationFrame(()=>f.current=!0)}},[h,i.trigger,i.valueNode,c,u,v,b,N,i.dir,a]);mr(()=>j(),[j]);const[C,I]=x.useState();mr(()=>{u&&I(window.getComputedStyle(u).zIndex)},[u]);const k=x.useCallback(R=>{R&&y.current===!0&&(j(),A?.(),y.current=!1)},[j,A]);return e.jsx(FN,{scope:r,contentWrapper:c,shouldExpandOnScrollRef:f,onScrollButtonChange:k,children:e.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:C},children:e.jsx(ht.div,{...n,ref:p,style:{boxSizing:"border-box",maxHeight:"100%",...n.style}})})})});_f.displayName=IN;var ON="SelectPopperPosition",Fc=x.forwardRef((t,s)=>{const{__scopeSelect:r,align:a="start",collisionPadding:n=Mr,...i}=t,o=il(r);return e.jsx(Xc,{...o,...i,ref:s,align:a,collisionPadding:n,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Fc.displayName=ON;var[FN,Id]=qn(Va,{}),Lc="SelectViewport",kf=x.forwardRef((t,s)=>{const{__scopeSelect:r,nonce:a,...n}=t,i=Sa(Lc,r),o=Id(Lc,r),c=Ht(s,i.onViewportChange),l=x.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),e.jsx(al.Slot,{scope:r,children:e.jsx(ht.div,{"data-radix-select-viewport":"",role:"presentation",...n,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...n.style},onScroll:st(n.onScroll,u=>{const d=u.currentTarget,{contentWrapper:p,shouldExpandOnScrollRef:h}=o;if(h?.current&&p){const f=Math.abs(l.current-d.scrollTop);if(f>0){const y=window.innerHeight-Mr*2,v=parseFloat(p.style.minHeight),b=parseFloat(p.style.height),N=Math.max(v,b);if(N<y){const A=N+f,j=Math.min(y,A),C=A-j;p.style.height=j+"px",p.style.bottom==="0px"&&(d.scrollTop=C>0?C:0,p.style.justifyContent="flex-end")}}}l.current=d.scrollTop})})})]})});kf.displayName=Lc;var Cf="SelectGroup",[LN,qN]=qn(Cf),zN=x.forwardRef((t,s)=>{const{__scopeSelect:r,...a}=t,n=In();return e.jsx(LN,{scope:r,id:n,children:e.jsx(ht.div,{role:"group","aria-labelledby":n,...a,ref:s})})});zN.displayName=Cf;var Sf="SelectLabel",Af=x.forwardRef((t,s)=>{const{__scopeSelect:r,...a}=t,n=qN(Sf,r);return e.jsx(ht.div,{id:n.id,...a,ref:s})});Af.displayName=Sf;var Po="SelectItem",[BN,Tf]=qn(Po),Pf=x.forwardRef((t,s)=>{const{__scopeSelect:r,value:a,disabled:n=!1,textValue:i,...o}=t,c=Ca(Po,r),l=Sa(Po,r),u=c.value===a,[d,p]=x.useState(i??""),[h,f]=x.useState(!1),y=Ht(s,A=>l.itemRefCallback?.(A,a,n)),v=In(),b=x.useRef("touch"),N=()=>{n||(c.onValueChange(a),c.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(BN,{scope:r,value:a,disabled:n,textId:v,isSelected:u,onItemTextChange:x.useCallback(A=>{p(j=>j||(A?.textContent??"").trim())},[]),children:e.jsx(al.ItemSlot,{scope:r,value:a,disabled:n,textValue:d,children:e.jsx(ht.div,{role:"option","aria-labelledby":v,"data-highlighted":h?"":void 0,"aria-selected":u&&h,"data-state":u?"checked":"unchecked","aria-disabled":n||void 0,"data-disabled":n?"":void 0,tabIndex:n?void 0:-1,...o,ref:y,onFocus:st(o.onFocus,()=>f(!0)),onBlur:st(o.onBlur,()=>f(!1)),onClick:st(o.onClick,()=>{b.current!=="mouse"&&N()}),onPointerUp:st(o.onPointerUp,()=>{b.current==="mouse"&&N()}),onPointerDown:st(o.onPointerDown,A=>{b.current=A.pointerType}),onPointerMove:st(o.onPointerMove,A=>{b.current=A.pointerType,n?l.onItemLeave?.():b.current==="mouse"&&A.currentTarget.focus({preventScroll:!0})}),onPointerLeave:st(o.onPointerLeave,A=>{A.currentTarget===document.activeElement&&l.onItemLeave?.()}),onKeyDown:st(o.onKeyDown,A=>{l.searchRef?.current!==""&&A.key===" "||(CN.includes(A.key)&&N(),A.key===" "&&A.preventDefault())})})})})});Pf.displayName=Po;var ii="SelectItemText",Mf=x.forwardRef((t,s)=>{const{__scopeSelect:r,className:a,style:n,...i}=t,o=Ca(ii,r),c=Sa(ii,r),l=Tf(ii,r),u=PN(ii,r),[d,p]=x.useState(null),h=Ht(s,N=>p(N),l.onItemTextChange,N=>c.itemTextRefCallback?.(N,l.value,l.disabled)),f=d?.textContent,y=x.useMemo(()=>e.jsx("option",{value:l.value,disabled:l.disabled,children:f},l.value),[l.disabled,l.value,f]),{onNativeOptionAdd:v,onNativeOptionRemove:b}=u;return mr(()=>(v(y),()=>b(y)),[v,b,y]),e.jsxs(e.Fragment,{children:[e.jsx(ht.span,{id:l.textId,...i,ref:h}),l.isSelected&&o.valueNode&&!o.valueNodeHasChildren?Bo.createPortal(i.children,o.valueNode):null]})});Mf.displayName=ii;var Rf="SelectItemIndicator",Df=x.forwardRef((t,s)=>{const{__scopeSelect:r,...a}=t;return Tf(Rf,r).isSelected?e.jsx(ht.span,{"aria-hidden":!0,...a,ref:s}):null});Df.displayName=Rf;var qc="SelectScrollUpButton",Ef=x.forwardRef((t,s)=>{const r=Sa(qc,t.__scopeSelect),a=Id(qc,t.__scopeSelect),[n,i]=x.useState(!1),o=Ht(s,a.onScrollButtonChange);return mr(()=>{if(r.viewport&&r.isPositioned){let c=function(){const u=l.scrollTop>0;i(u)};const l=r.viewport;return c(),l.addEventListener("scroll",c),()=>l.removeEventListener("scroll",c)}},[r.viewport,r.isPositioned]),n?e.jsx(Of,{...t,ref:o,onAutoScroll:()=>{const{viewport:c,selectedItem:l}=r;c&&l&&(c.scrollTop=c.scrollTop-l.offsetHeight)}}):null});Ef.displayName=qc;var zc="SelectScrollDownButton",If=x.forwardRef((t,s)=>{const r=Sa(zc,t.__scopeSelect),a=Id(zc,t.__scopeSelect),[n,i]=x.useState(!1),o=Ht(s,a.onScrollButtonChange);return mr(()=>{if(r.viewport&&r.isPositioned){let c=function(){const u=l.scrollHeight-l.clientHeight,d=Math.ceil(l.scrollTop)<u;i(d)};const l=r.viewport;return c(),l.addEventListener("scroll",c),()=>l.removeEventListener("scroll",c)}},[r.viewport,r.isPositioned]),n?e.jsx(Of,{...t,ref:o,onAutoScroll:()=>{const{viewport:c,selectedItem:l}=r;c&&l&&(c.scrollTop=c.scrollTop+l.offsetHeight)}}):null});If.displayName=zc;var Of=x.forwardRef((t,s)=>{const{__scopeSelect:r,onAutoScroll:a,...n}=t,i=Sa("SelectScrollButton",r),o=x.useRef(null),c=nl(r),l=x.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return x.useEffect(()=>()=>l(),[l]),mr(()=>{c().find(d=>d.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[c]),e.jsx(ht.div,{"aria-hidden":!0,...n,ref:s,style:{flexShrink:0,...n.style},onPointerDown:st(n.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(a,50))}),onPointerMove:st(n.onPointerMove,()=>{i.onItemLeave?.(),o.current===null&&(o.current=window.setInterval(a,50))}),onPointerLeave:st(n.onPointerLeave,()=>{l()})})}),$N="SelectSeparator",Ff=x.forwardRef((t,s)=>{const{__scopeSelect:r,...a}=t;return e.jsx(ht.div,{"aria-hidden":!0,...a,ref:s})});Ff.displayName=$N;var Bc="SelectArrow",UN=x.forwardRef((t,s)=>{const{__scopeSelect:r,...a}=t,n=il(r),i=Ca(Bc,r),o=Sa(Bc,r);return i.open&&o.position==="popper"?e.jsx(Zc,{...n,...a,ref:s}):null});UN.displayName=Bc;var HN="SelectBubbleInput",Lf=x.forwardRef(({__scopeSelect:t,value:s,...r},a)=>{const n=x.useRef(null),i=Ht(a,n),o=rl(s);return x.useEffect(()=>{const c=n.current;if(!c)return;const l=window.HTMLSelectElement.prototype,d=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==s&&d){const p=new Event("change",{bubbles:!0});d.call(c,s),c.dispatchEvent(p)}},[o,s]),e.jsx(ht.select,{...r,style:{...Sh,...r.style},ref:i,defaultValue:s})});Lf.displayName=HN;function qf(t){return t===""||t===void 0}function zf(t){const s=yr(t),r=x.useRef(""),a=x.useRef(0),n=x.useCallback(o=>{const c=r.current+o;s(c),function l(u){r.current=u,window.clearTimeout(a.current),u!==""&&(a.current=window.setTimeout(()=>l(""),1e3))}(c)},[s]),i=x.useCallback(()=>{r.current="",window.clearTimeout(a.current)},[]);return x.useEffect(()=>()=>window.clearTimeout(a.current),[]),[r,n,i]}function Bf(t,s,r){const n=s.length>1&&Array.from(s).every(u=>u===s[0])?s[0]:s,i=r?t.indexOf(r):-1;let o=VN(t,Math.max(i,0));n.length===1&&(o=o.filter(u=>u!==r));const l=o.find(u=>u.textValue.toLowerCase().startsWith(n.toLowerCase()));return l!==r?l:void 0}function VN(t,s){return t.map((r,a)=>t[(s+a)%t.length])}var KN=pf,$f=xf,WN=vf,YN=yf,GN=jf,Uf=bf,QN=kf,Hf=Af,Vf=Pf,XN=Mf,JN=Df,Kf=Ef,Wf=If,Yf=Ff;const lt=KN,ct=WN,it=x.forwardRef(({className:t,children:s,...r},a)=>e.jsxs($f,{ref:a,className:ke("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[s,e.jsx(YN,{asChild:!0,children:e.jsx(qr,{className:"h-4 w-4 opacity-50"})})]}));it.displayName=$f.displayName;const Gf=x.forwardRef(({className:t,...s},r)=>e.jsx(Kf,{ref:r,className:ke("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(ld,{className:"h-4 w-4"})}));Gf.displayName=Kf.displayName;const Qf=x.forwardRef(({className:t,...s},r)=>e.jsx(Wf,{ref:r,className:ke("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(qr,{className:"h-4 w-4"})}));Qf.displayName=Wf.displayName;const ot=x.forwardRef(({className:t,children:s,position:r="popper",...a},n)=>e.jsx(GN,{children:e.jsxs(Uf,{ref:n,className:ke("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...a,children:[e.jsx(Gf,{}),e.jsx(QN,{className:ke("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(Qf,{})]})}));ot.displayName=Uf.displayName;const ZN=x.forwardRef(({className:t,...s},r)=>e.jsx(Hf,{ref:r,className:ke("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}));ZN.displayName=Hf.displayName;const ge=x.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(Vf,{ref:a,className:ke("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(JN,{children:e.jsx(Cr,{className:"h-4 w-4"})})}),e.jsx(XN,{children:s})]}));ge.displayName=Vf.displayName;const e_=x.forwardRef(({className:t,...s},r)=>e.jsx(Yf,{ref:r,className:ke("-mx-1 my-1 h-px bg-muted",t),...s}));e_.displayName=Yf.displayName;const Xf=({crop:t,open:s,onOpenChange:r})=>{const{user:a}=Fe(),{toast:n}=hs(),{t:i}=Nt(),o=Xe(),{data:c}=_a(),[l,u]=x.useState(!1),[d,p]=x.useState({crop_name:"",variety:"",land_id:"",sowing_date:"",harvest_estimate:"",status:"growing",estimated_quantity:"",quantity_unit:"quintals"});x.useEffect(()=>{t&&p({crop_name:t.crop_name,variety:t.variety||"",land_id:t.land_id||"",sowing_date:t.sowing_date||"",harvest_estimate:t.harvest_estimate||"",status:t.status,estimated_quantity:t.estimated_quantity?.toString()||"",quantity_unit:t.quantity_unit||"quintals"})},[t]);const h=async f=>{if(f.preventDefault(),!(!a?.id||!t)){u(!0);try{const{error:y}=await W.from("crops").update({crop_name:d.crop_name,variety:d.variety||null,land_id:d.land_id||null,sowing_date:d.sowing_date||null,harvest_estimate:d.harvest_estimate||null,status:d.status,estimated_quantity:d.estimated_quantity?parseFloat(d.estimated_quantity):null,quantity_unit:d.quantity_unit}).eq("id",t.id);if(y)throw y;n({title:i("farmer.crops.updateSuccess")}),r(!1),o.invalidateQueries({queryKey:["crops",a.id]})}catch(y){n({title:i("common.error"),description:y.message,variant:"destructive"})}finally{u(!1)}}};return e.jsx(zt,{open:s,onOpenChange:r,children:e.jsxs(It,{className:"max-w-md",children:[e.jsx(Bt,{children:e.jsx($t,{children:i("farmer.crops.editCrop")})}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{children:[i("farmer.crops.cropName")," *"]}),e.jsx(Ce,{value:d.crop_name,onChange:f=>p({...d,crop_name:f.target.value}),placeholder:i("farmer.crops.cropNamePlaceholder"),required:!0})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.crops.variety")}),e.jsx(Ce,{value:d.variety,onChange:f=>p({...d,variety:f.target.value}),placeholder:i("farmer.crops.varietyPlaceholder")})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.crops.status")}),e.jsxs(lt,{value:d.status,onValueChange:f=>p({...d,status:f}),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"growing",children:i("enum.crop_status.growing")}),e.jsx(ge,{value:"one_week",children:i("enum.crop_status.one_week")}),e.jsx(ge,{value:"ready",children:i("enum.crop_status.ready")}),e.jsx(ge,{value:"harvested",children:i("enum.crop_status.harvested")})]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.farmlands.title")}),e.jsxs(lt,{value:d.land_id,onValueChange:f=>p({...d,land_id:f}),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:i("farmer.crops.selectFarmland")})}),e.jsx(ot,{children:c?.map(f=>e.jsxs(ge,{value:f.id,children:[f.name," (",f.area," ",f.area_unit,")"]},f.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.crops.sowingDate")}),e.jsx(Ce,{type:"date",value:d.sowing_date,onChange:f=>p({...d,sowing_date:f.target.value})})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.crops.harvestDate")}),e.jsx(Ce,{type:"date",value:d.harvest_estimate,onChange:f=>p({...d,harvest_estimate:f.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.crops.expectedQuantity")}),e.jsx(Ce,{type:"number",value:d.estimated_quantity,onChange:f=>p({...d,estimated_quantity:f.target.value}),placeholder:"50"})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("common.unit")}),e.jsxs(lt,{value:d.quantity_unit,onValueChange:f=>p({...d,quantity_unit:f}),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"quintals",children:i("enum.units.quintals")}),e.jsx(ge,{value:"kg",children:i("enum.units.kg")}),e.jsx(ge,{value:"tonnes",children:i("enum.units.tonnes")})]})]})]})]}),e.jsx(z,{type:"submit",className:"w-full",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),i("common.saving")]}):i("common.saveChanges")})]})]})})},Jf=({crop:t,open:s,onOpenChange:r})=>{const{user:a}=Fe(),{toast:n}=hs(),{t:i}=Nt(),o=Xe(),{data:c}=ka(),[l,u]=x.useState(!1),[d,p]=x.useState({crop_id:"",quantity:"",quantity_unit:"quintals",pickup_location:"",pickup_village:"",preferred_date:"",preferred_time:"",notes:""});x.useEffect(()=>{t&&p(f=>({...f,crop_id:t.id,quantity:t.estimated_quantity?.toString()||"",quantity_unit:t.quantity_unit||"quintals",pickup_location:t.farmland?.name||"",pickup_village:t.farmland?.village||""}))},[t]);const h=async f=>{if(f.preventDefault(),!!a?.id){u(!0);try{const{error:y}=await W.from("transport_requests").insert({farmer_id:a.id,crop_id:d.crop_id||null,quantity:parseFloat(d.quantity),quantity_unit:d.quantity_unit,pickup_location:d.pickup_location,pickup_village:d.pickup_village||null,preferred_date:d.preferred_date||null,preferred_time:d.preferred_time||null,notes:d.notes||null});if(y)throw y;n({title:i("farmer.transport.requestSuccess")}),r(!1),p({crop_id:"",quantity:"",quantity_unit:"quintals",pickup_location:"",pickup_village:"",preferred_date:"",preferred_time:"",notes:""}),o.invalidateQueries({queryKey:["transport-requests",a.id]})}catch(y){n({title:i("common.error"),description:y.message,variant:"destructive"})}finally{u(!1)}}};return e.jsx(zt,{open:s,onOpenChange:r,children:e.jsxs(It,{className:"max-w-md",children:[e.jsx(Bt,{children:e.jsxs($t,{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-5 w-5 text-primary"}),i("farmer.transport.requestTransport")]})}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.transport.crop")}),e.jsxs(lt,{value:d.crop_id,onValueChange:f=>p({...d,crop_id:f}),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:i("farmer.transport.selectCrop")})}),e.jsx(ot,{children:c?.filter(f=>f.status!=="harvested").map(f=>e.jsxs(ge,{value:f.id,children:[f.crop_name," ",f.variety&&`(${f.variety})`]},f.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{children:[i("farmer.transport.quantity")," *"]}),e.jsx(Ce,{type:"number",value:d.quantity,onChange:f=>p({...d,quantity:f.target.value}),placeholder:"50",required:!0})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("common.unit")}),e.jsxs(lt,{value:d.quantity_unit,onValueChange:f=>p({...d,quantity_unit:f}),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"quintals",children:i("enum.units.quintals")}),e.jsx(ge,{value:"kg",children:i("enum.units.kg")}),e.jsx(ge,{value:"tonnes",children:i("enum.units.tonnes")})]})]})]})]}),e.jsxs("div",{children:[e.jsxs(ie,{children:[i("farmer.transport.pickupLocation")," *"]}),e.jsx(Ce,{value:d.pickup_location,onChange:f=>p({...d,pickup_location:f.target.value}),placeholder:i("farmer.transport.pickupPlaceholder"),required:!0})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.farmlands.village")}),e.jsx(Ce,{value:d.pickup_village,onChange:f=>p({...d,pickup_village:f.target.value}),placeholder:i("farmer.farmlands.villagePlaceholder")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.transport.preferredDate")}),e.jsx(Ce,{type:"date",value:d.preferred_date,onChange:f=>p({...d,preferred_date:f.target.value})})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.transport.preferredTime")}),e.jsx(Ce,{value:d.preferred_time,onChange:f=>p({...d,preferred_time:f.target.value}),placeholder:i("farmer.transport.timePlaceholder")})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.transport.notes")}),e.jsx(zs,{value:d.notes,onChange:f=>p({...d,notes:f.target.value}),placeholder:i("farmer.transport.notesPlaceholder"),rows:2})]}),e.jsx(z,{type:"submit",className:"w-full",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),i("common.submitting")]}):i("farmer.transport.submitRequest")})]})]})})},t_=()=>{const{data:t,isLoading:s}=ka(),{t:r}=Nt(),a=Ut(),[n,i]=x.useState(null),[o,c]=x.useState(null),[l,u]=x.useState(!1),[d,p]=x.useState(!1);return r("enum.crop_status.growing"),r("enum.crop_status.one_week"),r("enum.crop_status.ready"),r("enum.crop_status.harvested"),t?.filter(h=>h.status!=="harvested"),s?e.jsxs(G,{children:[e.jsx(je,{className:"flex flex-row items-center justify-between",children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-5 w-5 text-primary"}),r("farmer.crops.myCrops")]})}),e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(h=>e.jsx(Re,{className:"h-48 rounded-xl"},h))})})]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsxs(je,{className:"flex flex-row items-center justify-between pb-4",children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-5 w-5 text-primary"}),r("farmer.crops.myCrops")]}),e.jsxs(z,{size:"sm",onClick:()=>a("/farmer/crops"),children:[e.jsx(Ss,{className:"h-4 w-4 mr-1"}),r("farmer.crops.addCrop")]})]})}),e.jsx(Xf,{crop:n,open:l,onOpenChange:u}),e.jsx(Jf,{crop:o,open:d,onOpenChange:p})]})},s_=yi("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function he({className:t,variant:s,...r}){return e.jsx("div",{className:ke(s_({variant:s}),t),...r})}var ol="Collapsible",[r_]=wr(ol),[a_,Od]=r_(ol),Zf=x.forwardRef((t,s)=>{const{__scopeCollapsible:r,open:a,defaultOpen:n,disabled:i,onOpenChange:o,...c}=t,[l,u]=ra({prop:a,defaultProp:n??!1,onChange:o,caller:ol});return e.jsx(a_,{scope:r,disabled:i,contentId:In(),open:l,onOpenToggle:x.useCallback(()=>u(d=>!d),[u]),children:e.jsx(ht.div,{"data-state":Ld(l),"data-disabled":i?"":void 0,...c,ref:s})})});Zf.displayName=ol;var ex="CollapsibleTrigger",tx=x.forwardRef((t,s)=>{const{__scopeCollapsible:r,...a}=t,n=Od(ex,r);return e.jsx(ht.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":Ld(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...a,ref:s,onClick:st(t.onClick,n.onOpenToggle)})});tx.displayName=ex;var Fd="CollapsibleContent",sx=x.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=Od(Fd,t.__scopeCollapsible);return e.jsx(Lr,{present:r||n.open,children:({present:i})=>e.jsx(n_,{...a,ref:s,present:i})})});sx.displayName=Fd;var n_=x.forwardRef((t,s)=>{const{__scopeCollapsible:r,present:a,children:n,...i}=t,o=Od(Fd,r),[c,l]=x.useState(a),u=x.useRef(null),d=Ht(s,u),p=x.useRef(0),h=p.current,f=x.useRef(0),y=f.current,v=o.open||c,b=x.useRef(v),N=x.useRef(void 0);return x.useEffect(()=>{const A=requestAnimationFrame(()=>b.current=!1);return()=>cancelAnimationFrame(A)},[]),mr(()=>{const A=u.current;if(A){N.current=N.current||{transitionDuration:A.style.transitionDuration,animationName:A.style.animationName},A.style.transitionDuration="0s",A.style.animationName="none";const j=A.getBoundingClientRect();p.current=j.height,f.current=j.width,b.current||(A.style.transitionDuration=N.current.transitionDuration,A.style.animationName=N.current.animationName),l(a)}},[o.open,a]),e.jsx(ht.div,{"data-state":Ld(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!v,...i,ref:d,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":y?`${y}px`:void 0,...t.style},children:v&&n})});function Ld(t){return t?"open":"closed"}var i_=Zf;const Ga=i_,Qa=tx,Xa=sx,o_=()=>{const{data:t,isLoading:s}=ka(),[r,a]=x.useState(!1),n=new Date,i=Qs(n,14),o=t?.filter(u=>{if(!u.harvest_estimate||u.status==="harvested")return!1;const d=new Date(u.harvest_estimate);return X1(d,{start:n,end:i})}).sort((u,d)=>new Date(u.harvest_estimate).getTime()-new Date(d.harvest_estimate).getTime())||[];if(s)return e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-5 w-5 text-primary"}),"Upcoming Harvests"]})}),e.jsx(Q,{children:e.jsx(Re,{className:"h-16 rounded-lg"})})]});const c=o[0],l=c?Math.ceil((new Date(c.harvest_estimate).getTime()-n.getTime())/(1e3*60*60*24)):null;return e.jsx(G,{children:e.jsxs(Ga,{open:r,onOpenChange:a,children:[e.jsx(je,{className:"pb-3",children:e.jsx(Qa,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between cursor-pointer group",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ms,{className:"h-5 w-5 text-primary"}),"Upcoming Harvests",o.length>0&&e.jsxs(he,{variant:"secondary",className:"ml-2",children:[o.length," in 14 days"]})]}),e.jsx(qr,{className:`h-4 w-4 text-muted-foreground transition-transform duration-200 ${r?"rotate-180":""}`})]})})}),e.jsxs(Q,{className:"pt-0",children:[!r&&e.jsxs("div",{className:"space-y-2",children:[o.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No harvests in the next 2 weeks"}):c?e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(za,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:c.crop_name}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[" ",tt(new Date(c.harvest_estimate),"MMM d")]})]}),e.jsx(he,{className:l<=3?"bg-emerald-100 text-emerald-700":l<=7?"bg-amber-100 text-amber-700":"bg-muted text-muted-foreground",children:l===0?"Today":l===1?"Tomorrow":`${l} days`})]}):null,o.length>1&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",o.length-1," more harvests coming up"]})]}),e.jsx(Xa,{className:"data-[state=open]:animate-accordion-down data-[state=closed]:animate-accordion-up",children:o.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(za,{className:"h-10 w-10 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No harvests in the next 2 weeks"})]}):e.jsx("div",{className:"space-y-3 pt-2",children:o.map((u,d)=>{const p=new Date(u.harvest_estimate),h=Math.ceil((p.getTime()-n.getTime())/(1e3*60*60*24));return e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-muted/30 rounded-lg border border-border/50 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${h<=3?"bg-emerald-500":h<=7?"bg-amber-500":"bg-muted-foreground"}`}),d<o.length-1&&e.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 w-0.5 h-8 bg-border"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(za,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium text-foreground truncate",children:u.crop_name})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-muted-foreground",children:[e.jsx("span",{children:tt(p,"MMM d, yyyy")}),u.farmland&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""}),e.jsx("span",{className:"truncate",children:u.farmland.village||u.farmland.name})]})]})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${h<=3?"bg-emerald-100 text-emerald-700":h<=7?"bg-amber-100 text-amber-700":"bg-muted text-muted-foreground"}`,children:h===0?"Today":h===1?"Tomorrow":`${h} days`}),e.jsxs("div",{className:"hidden sm:flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(pr,{className:"h-3 w-3"}),e.jsx("span",{children:"Monitor price"})]})]},u.id)})})})]})]})})},rc={requested:{label:"Requested",color:"bg-blue-100 text-blue-800",step:1},assigned:{label:"Assigned",color:"bg-purple-100 text-purple-800",step:2},en_route:{label:"En Route",color:"bg-amber-100 text-amber-800",step:3},picked_up:{label:"Picked Up",color:"bg-emerald-100 text-emerald-800",step:4},delivered:{label:"Delivered",color:"bg-primary/10 text-primary",step:5},cancelled:{label:"Cancelled",color:"bg-destructive/10 text-destructive",step:0}},l_=()=>{const{data:t,isLoading:s}=yd(),r=Ut(),[a,n]=x.useState(!1),i=t?.filter(c=>!["delivered","cancelled"].includes(c.status)).slice(0,5)||[];if(s)return e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-5 w-5 text-primary"}),"Transport Status"]})}),e.jsx(Q,{children:e.jsx(Re,{className:"h-16 rounded-xl"})})]});const o=i[0];return e.jsx(G,{children:e.jsxs(Ga,{open:a,onOpenChange:n,children:[e.jsx(je,{className:"pb-3",children:e.jsx(Qa,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between cursor-pointer group",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(rt,{className:"h-5 w-5 text-primary"}),"Transport & Pickup",i.length>0&&e.jsxs(he,{variant:"secondary",className:"ml-2",children:[i.length," active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:c=>{c.stopPropagation(),r("/farmer/transport")},children:[e.jsx(Ss,{className:"h-4 w-4 mr-1"}),"New"]}),e.jsx(qr,{className:`h-4 w-4 text-muted-foreground transition-transform duration-200 ${a?"rotate-180":""}`})]})]})})}),e.jsxs(Q,{className:"pt-0",children:[!a&&e.jsxs("div",{className:"space-y-2",children:[i.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No active transport requests"}):o?e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:o.crop?.crop_name||"Crop"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[" ",o.quantity," ",o.quantity_unit]})]}),e.jsx(he,{className:rc[o.status]?.color||"bg-muted",children:rc[o.status]?.label||o.status})]}):null,i.length>1&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",i.length-1," more requests"]})]}),e.jsx(Xa,{className:"data-[state=open]:animate-accordion-down data-[state=closed]:animate-accordion-up",children:i.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(rt,{className:"h-10 w-10 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No active transport requests"}),e.jsx(z,{variant:"outline",className:"mt-4",size:"sm",onClick:()=>r("/farmer/transport"),children:"Request Transport"})]}):e.jsxs("div",{className:"space-y-4 pt-2",children:[i.map(c=>{const l=rc[c.status],d=l.step/5*100;return e.jsxs("div",{className:"bg-muted/30 border border-border/50 rounded-xl p-4 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium text-foreground",children:c.crop?.crop_name||"Crop"}),e.jsxs("span",{className:"text-muted-foreground text-sm",children:[" ",c.quantity," ",c.quantity_unit]})]}),e.jsx(he,{className:l.color,children:l.label})]}),l.step>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-500",style:{width:`${d}%`}})}),e.jsxs("div",{className:"flex justify-between mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:"Requested"}),e.jsx("span",{children:"Assigned"}),e.jsx("span",{children:"En Route"}),e.jsx("span",{children:"Picked Up"}),e.jsx("span",{children:"Delivered"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:c.pickup_village||c.pickup_location})]}),c.preferred_date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:tt(new Date(c.preferred_date),"MMM d")})]})]})]},c.id)}),t&&t.length>5&&e.jsxs(z,{variant:"ghost",className:"w-full text-muted-foreground hover:text-foreground",onClick:()=>r("/farmer/transport"),children:["View all requests",e.jsx(Wa,{className:"h-4 w-4 ml-1"})]})]})})]})]})})},Rm="false".toLowerCase()==="true";function rx(t){return t.map(r=>(r??"").trim()).filter(Boolean).join("|")||crypto.randomUUID()}function ac(t){return{id:t.id||rx([t.crop_name??null,t.district??null,t.date??null]),crop_name:t.crop_name||"Unknown Crop",district:t.district||"Karnataka",state:"Karnataka",modal_price:t.avg_price??null,min_price:null,max_price:null,unit:t.unit??"qtl",confidence:t.confidence??null,sources_count:t.sources_count??null,fetched_at:t.date??t.created_at??null}}function c_(t){return{id:t.id||rx([t.crop_name??null,t.district??null,t.date??null,t.mandi_name??null]),crop_name:t.crop_name||"Unknown Crop",district:t.district||"Karnataka",state:"Karnataka",modal_price:t.modal_price??null,min_price:t.min_price??null,max_price:t.max_price??null,unit:"qtl",confidence:null,sources_count:null,fetched_at:t.date??t.created_at??null}}function d_(t,s){const r=t;return r?.code==="PGRST205"&&`${r?.message??""} ${r?.details??""}`.toLowerCase().includes(s.toLowerCase())}const u_=t=>De({queryKey:["district-neighbors",t],queryFn:async()=>{if(!t)return[];const{data:s,error:r}=await W.from("district_neighbors").select("neighbor_district").eq("district",t);return r?(console.error("Error fetching neighbors:",r),[]):s?.map(a=>a.neighbor_district)||[]},enabled:!!t,staleTime:60*60*1e3}),m_=(t,s=[])=>De({queryKey:["market-prices-tiered",t,s],queryFn:async()=>{if(t&&s.length>0){const{data:c,error:l}=await W.from("market_prices_agg").select("id,crop_name,district,avg_price,date,created_at,trend_direction").eq("district",t).in("crop_name",s).order("date",{ascending:!1}).order("created_at",{ascending:!1}).limit(8);if(!l&&c&&c.length>0)return{tier:"A",data:c.map(ac),label:`Prices for your crops in ${t}`}}if(t){const{data:c,error:l}=await W.from("market_prices_agg").select("id,crop_name,district,avg_price,date,created_at,trend_direction").eq("district",t).order("date",{ascending:!1}).order("created_at",{ascending:!1}).limit(6);if(!l&&c&&c.length>0)return{tier:"B",data:c.map(ac),label:`Top prices in ${t}`}}const{data:r,error:a}=await W.from("market_prices_agg").select("id,crop_name,district,avg_price,date,created_at,trend_direction").order("date",{ascending:!1}).order("created_at",{ascending:!1}).limit(6);if(!a&&r&&r.length>0)return{tier:"C",data:r.map(ac),label:"Karnataka mandi prices"};let n=W.from("market_prices").select("id,crop_name,district,modal_price,min_price,max_price,date,created_at,mandi_name").order("date",{ascending:!1}).order("created_at",{ascending:!1}).limit(6);t&&(n=n.eq("district",t));let{data:i,error:o}=await n;if((!i||i.length===0)&&t){const c=await W.from("market_prices").select("id,crop_name,district,modal_price,min_price,max_price,date,created_at,mandi_name").order("date",{ascending:!1}).order("created_at",{ascending:!1}).limit(6);i=c.data,o=c.error}return!o&&i&&i.length>0?{tier:"C",data:i.map(c_),label:"Karnataka mandi prices"}:{tier:"C",data:[],label:"No price data available"}},staleTime:5*60*1e3}),h_=(t,s)=>De({queryKey:["neighbor-prices",t,s],queryFn:async()=>{if(t.length===0||s.length===0)return{};const{data:r,error:a}=await W.from("market_prices_agg").select("crop_name, district, avg_price, date, created_at").in("district",t).in("crop_name",s).order("date",{ascending:!1}).order("created_at",{ascending:!1});if(a)return console.error("Error fetching neighbor prices:",a),{};const n={};for(const i of r||[]){const o=i.crop_name||"";if(!o)continue;const c={crop_name:o,district:i.district||"Karnataka",modal_price:i.avg_price??null,confidence:null,fetched_at:i.date??i.created_at??null},l=n[o];(!l||c.modal_price&&(!l.modal_price||c.modal_price>l.modal_price))&&(n[o]=c)}return n},enabled:t.length>0&&s.length>0,staleTime:5*60*1e3}),p_=t=>De({queryKey:["price-forecasts",t],queryFn:async()=>{if(!Rm)return[];let s=W.from("price_forecasts").select("*").order("generated_at",{ascending:!1}).limit(20);t&&t.length>0&&(s=s.in("crop_name",t));const{data:r,error:a}=await s;if(a){if(d_(a,"price_forecasts"))return[];throw a}const n={};for(const i of r||[])(!n[i.crop_name]||new Date(i.generated_at)>new Date(n[i.crop_name].generated_at))&&(n[i.crop_name]=i);return Object.values(n)},enabled:Rm}),qd=()=>De({queryKey:["karnataka-districts"],queryFn:async()=>{const{data:t,error:s}=await W.from("karnataka_districts").select("*").order("district",{ascending:!0});if(s)throw s;return t},staleTime:1e3*60*60}),zd=t=>{const{data:s}=qd();return!t||!s?!1:s.some(r=>r.district.toLowerCase()===t.toLowerCase())},f_=()=>{const{user:t}=Fe(),{data:s,isLoading:r}=qd();return De({queryKey:["farmer-needs-district",t?.id],queryFn:async()=>{if(!t?.id)return{needsDistrict:!1,profile:null};const{data:a,error:n}=await W.from("profiles").select("id, district, village, full_name").eq("id",t.id).maybeSingle();if(n)throw n;return{needsDistrict:!(a?.district&&s?.some(o=>o.district.toLowerCase()===a.district?.toLowerCase())),profile:a}},enabled:!!t?.id&&!r&&!!s})},x_=()=>{const t=Xe(),{user:s}=Fe();return dt({mutationFn:async r=>{if(!s?.id)throw new Error("Not authenticated");const{error:a}=await W.from("profiles").update({district:r.district,village:r.village||null,taluk:r.taluk||null,pincode:r.pincode||null,district_source:r.district_source||"user",district_confidence:r.district_confidence||"high",updated_at:new Date().toISOString()}).eq("id",s.id);if(a)throw a;return!0},onSuccess:()=>{t.invalidateQueries({queryKey:["farmer-profile"]}),t.invalidateQueries({queryKey:["farmer-needs-district"]}),t.invalidateQueries({queryKey:["market-prices"]}),t.invalidateQueries({queryKey:["all-market-prices"]}),ce.success("Location saved! You'll now see personalized market data.")},onError:r=>{ce.error("Failed to save location: "+r.message)}})},g_=yi("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Nn=x.forwardRef(({className:t,variant:s,...r},a)=>e.jsx("div",{ref:a,role:"alert",className:ke(g_({variant:s}),t),...r}));Nn.displayName="Alert";const v_=x.forwardRef(({className:t,...s},r)=>e.jsx("h5",{ref:r,className:ke("mb-1 font-medium leading-none tracking-tight",t),...s}));v_.displayName="AlertTitle";const _n=x.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ke("text-sm [&_p]:leading-relaxed",t),...s}));_n.displayName="AlertDescription";const y_=()=>{const{t}=Nt(),{data:s,isLoading:r}=Fn(),{data:a}=ka(),n=[...new Set(a?.map(D=>D.crop_name)||[])],[i,o]=x.useState(!1),c=zd(s?.district),{data:l,isLoading:u,refetch:d,isFetching:p,error:h}=m_(c?s?.district:null,n),{data:f}=p_(n),{data:y=[]}=u_(c?s?.district:null),{data:v={}}=h_(y,n),b=r||u,N=l?.data||[],A=l?.tier||"C",j=l?.label||"Market Prices",C=D=>f?.find(F=>F.crop_name===D),I=D=>D?Kw(new Date,new Date(D))>48:!0,k=(D,F)=>{const H=v[D];if(!H||!H.modal_price||!F)return null;const q=H.modal_price-F,B=(q/F*100).toFixed(1);return{district:H.district,price:H.modal_price,delta:q,percentDelta:B,isBetter:q>0}},R=D=>{if(!D)return null;const F={up:"bg-emerald-100 text-emerald-700 border-emerald-200",down:"bg-red-100 text-red-700 border-red-200",stable:"bg-gray-100 text-gray-700 border-gray-200"},H={low:"",medium:"",high:""};return e.jsxs(he,{variant:"outline",className:`text-[10px] px-1.5 py-0 ${F[D.direction]}`,children:[D.direction==="up"?"":D.direction==="down"?"":""," ",H[D.confidence]]})},S=N.length>0?N.reduce((D,F)=>{const H=F.fetched_at||new Date().toISOString();return new Date(H)>new Date(D)?H:D},N[0].fetched_at||new Date().toISOString()):null,T=S?I(S):!1,E=N.slice(0,2);return b?e.jsxs(G,{children:[e.jsx(je,{className:"pb-2",children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Zr,{className:"h-5 w-5 text-primary"}),t("farmer.market.title")]})}),e.jsx(Q,{children:e.jsx("div",{className:"space-y-2",children:[1,2].map(D=>e.jsx(Re,{className:"h-10 rounded-lg"},D))})})]}):e.jsx(G,{children:e.jsxs(Ga,{open:i,onOpenChange:o,children:[e.jsxs(je,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Zr,{className:"h-5 w-5 text-primary"}),t("farmer.market.title")]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[N.length," crops  ",j]})]}),e.jsx(z,{variant:"ghost",size:"sm",onClick:D=>{D.stopPropagation(),d()},disabled:p,children:e.jsx(jr,{className:`h-4 w-4 ${p?"animate-spin":""}`})})]}),e.jsx(Q,{className:"pt-0",children:h?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(rr,{className:"h-6 w-6 mx-auto text-destructive/50 mb-2"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:t("common.error")}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>d(),className:"mt-2",children:[e.jsx(jr,{className:"h-3 w-3 mr-1"}),t("common.retry")]})]}):N.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Zr,{className:"h-6 w-6 mx-auto text-muted-foreground/50 mb-2"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:t("farmer.market.noData")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:E.map(D=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/30 border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded bg-primary/10 text-primary",children:e.jsx(Zr,{className:"h-3 w-3"})}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[100px]",children:D.crop_name})]}),e.jsxs("div",{className:"flex items-center gap-1 font-semibold text-sm",children:[e.jsx(Zr,{className:"h-3 w-3"}),D.modal_price?.toLocaleString("en-IN")||"N/A",e.jsxs("span",{className:"text-xs text-muted-foreground font-normal",children:["/",D.unit||"qtl"]})]})]},D.id))}),N.length>2&&e.jsx(Qa,{asChild:!0,children:e.jsxs(z,{variant:"ghost",className:"w-full mt-2 h-8 text-muted-foreground hover:text-foreground text-xs",children:[i?"Show less":`+${N.length-2} more crops`,e.jsx(qr,{className:`h-3 w-3 ml-1 transition-transform ${i?"rotate-180":""}`})]})}),e.jsx(Xa,{className:"data-[state=open]:animate-accordion-down data-[state=closed]:animate-accordion-up overflow-hidden",children:e.jsxs("div",{className:"space-y-2 pt-2",children:[T&&e.jsxs(Nn,{className:"border-amber-200 bg-amber-50 dark:bg-amber-950/30 dark:border-amber-800 py-2",children:[e.jsx(vs,{className:"h-3 w-3 text-amber-600"}),e.jsx(_n,{className:"text-amber-800 dark:text-amber-200 text-xs",children:t("farmer.market.staleData")})]}),A==="C"&&!c&&e.jsxs(Nn,{className:"border-amber-200 bg-amber-50 dark:bg-amber-950/30 dark:border-amber-800 py-2",children:[e.jsx(We,{className:"h-3 w-3 text-amber-600"}),e.jsx(_n,{className:"text-amber-800 dark:text-amber-200 text-xs",children:t("farmer.market.setDistrict")})]}),N.slice(2).map(D=>{const F=C(D.crop_name),H=k(D.crop_name,D.modal_price),q=I(D.fetched_at);return e.jsxs("div",{className:`p-2 rounded-lg border transition-colors ${q?"bg-muted/20 border-dashed border-muted-foreground/30":"bg-muted/30 border-border/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"p-1 rounded bg-primary/10 text-primary",children:e.jsx(Zr,{className:"h-3 w-3"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:D.crop_name}),R(F)]}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(We,{className:"h-2 w-2"}),e.jsx("span",{className:"truncate",children:D.district})]})]})]}),e.jsx("div",{className:"text-right shrink-0",children:e.jsxs("p",{className:"font-semibold text-sm flex items-center gap-0.5 justify-end",children:[e.jsx(Zr,{className:"h-3 w-3"}),D.modal_price?.toLocaleString("en-IN")||"N/A",e.jsxs("span",{className:"text-xs text-muted-foreground font-normal",children:["/",D.unit||"qtl"]})]})})]}),H&&e.jsxs("div",{className:`mt-1 pt-1 border-t border-border/30 flex items-center gap-1 text-[10px] ${H.isBetter?"text-emerald-600":"text-muted-foreground"}`,children:[H.isBetter?e.jsx(vj,{className:"h-2 w-2"}):e.jsx(Yh,{className:"h-2 w-2"}),e.jsxs("span",{children:[H.district,": ",H.price.toLocaleString("en-IN"),e.jsxs("span",{className:H.isBetter?"text-emerald-600 font-medium":"",children:[" ","(",H.isBetter?"+":"",H.percentDelta,"%)"]})]})]})]},D.id)}),f&&f.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/50",children:[e.jsx("p",{className:"text-[10px] font-medium text-muted-foreground mb-1",children:t("farmer.market.forecast")}),e.jsx("div",{className:"space-y-1",children:f.slice(0,2).map((D,F)=>e.jsxs("div",{className:"text-[10px] text-muted-foreground flex items-start gap-1",children:[e.jsx("span",{className:D.direction==="up"?"text-emerald-600":D.direction==="down"?"text-red-600":"",children:D.direction==="up"?"":D.direction==="down"?"":""}),e.jsxs("span",{className:"font-medium",children:[D.crop_name,":"]}),e.jsx("span",{className:"line-clamp-1",children:D.reason})]},F))})]}),S&&e.jsxs("div",{className:`flex items-center gap-1 pt-2 border-t border-border/30 text-[10px] ${T?"text-amber-600":"text-muted-foreground/70"}`,children:[e.jsx(vs,{className:"h-2 w-2"}),e.jsxs("span",{children:[t("farmer.market.lastUpdated")," ",Er(new Date(S),{addSuffix:!0})]})]})]})})]})})]})})},oo={price:{icon:pr,color:"text-emerald-600 bg-emerald-100"},weather:{icon:La,color:"text-blue-600 bg-blue-100"},crop:{icon:ts,color:"text-primary bg-primary/10"},scheme:{icon:sr,color:"text-purple-600 bg-purple-100"},alert:{icon:ks,color:"text-amber-600 bg-amber-100"},pickup:{icon:_r,color:"text-primary bg-primary/10"},info:{icon:_r,color:"text-muted-foreground bg-muted"}},j_=()=>{const{data:t,isLoading:s}=tl(),{data:r}=Fn(),a=zd(r?.district),{user:n}=Fe(),i=Xe(),[o,c]=x.useState(!1),l=async p=>{await W.from("notifications").update({is_read:!0}).eq("id",p),i.invalidateQueries({queryKey:["farmer-notifications",n?.id]})};if(s)return e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(_r,{className:"h-5 w-5 text-primary"}),"Advisories & Alerts"]})}),e.jsx(Q,{children:e.jsx(Re,{className:"h-16 rounded-lg"})})]});const u=t?.filter(p=>!p.is_read).length||0,d=t?.[0];return e.jsx(G,{children:e.jsxs(Ga,{open:o,onOpenChange:c,children:[e.jsx(je,{className:"pb-3",children:e.jsx(Qa,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between cursor-pointer group",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(_r,{className:"h-5 w-5 text-primary"}),"Advisories & Alerts",u>0&&e.jsxs(he,{className:"ml-2 bg-primary text-primary-foreground",children:[u," new"]})]}),e.jsx(qr,{className:`h-4 w-4 text-muted-foreground transition-transform duration-200 ${o?"rotate-180":""}`})]})})}),e.jsxs(Q,{className:"pt-0",children:[!a&&e.jsxs(Nn,{className:"mb-4 border-amber-200 bg-amber-50 dark:bg-amber-950/30 dark:border-amber-800",children:[e.jsx(rr,{className:"h-4 w-4 text-amber-600"}),e.jsx(_n,{className:"text-amber-800 dark:text-amber-200 text-sm",children:"Set your district to see local advisories and alerts"})]}),!o&&e.jsxs("div",{className:"space-y-2",children:[!t||t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No notifications yet"}):d?e.jsxs("div",{className:`flex gap-3 p-2 rounded-lg ${d.is_read?"bg-muted/30":"bg-primary/5"}`,children:[(()=>{const p=oo[d.type.toLowerCase()]||oo.info,h=p.icon;return e.jsx("div",{className:`p-1.5 rounded-lg h-fit ${p.color}`,children:e.jsx(h,{className:"h-3.5 w-3.5"})})})(),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:d.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:d.message})]})]}):null,t&&t.length>1&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",t.length-1," more notifications"]})]}),e.jsx(Xa,{className:"data-[state=open]:animate-accordion-down data-[state=closed]:animate-accordion-up",children:!t||t.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(_r,{className:"h-10 w-10 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No notifications yet"})]}):e.jsxs("div",{className:"space-y-3 pt-2",children:[t.slice(0,5).map(p=>{const h=oo[p.type.toLowerCase()]||oo.info,f=h.icon;return e.jsxs("div",{className:`flex gap-3 p-3 rounded-lg border transition-colors ${p.is_read?"bg-card border-border/50":"bg-primary/5 border-primary/20"}`,children:[e.jsx("div",{className:`p-2 rounded-lg h-fit ${h.color}`,children:e.jsx(f,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:p.title}),!p.is_read&&e.jsx(z,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 shrink-0",onClick:()=>l(p.id),children:e.jsx(Cr,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mt-0.5",children:p.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Er(new Date(p.created_at),{addSuffix:!0})})]})]},p.id)}),t.length>5&&e.jsxs(z,{variant:"ghost",className:"w-full text-muted-foreground hover:text-foreground",onClick:()=>window.location.href="/farmer/notifications",children:["View all notifications",e.jsx(Wa,{className:"h-4 w-4 ml-1"})]})]})})]})]})})},b_=()=>{const t=Ut(),s=[{label:"Add Crop",icon:Ss,color:"bg-primary hover:bg-primary/90 text-primary-foreground",onClick:()=>t("/farmer/crops")},{label:"Add Farmland",icon:lr,color:"bg-amber-600 hover:bg-amber-700 text-white",onClick:()=>t("/farmer/farmlands")},{label:"Request Transport",icon:rt,color:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>t("/farmer/transport")},{label:"Create Listing",icon:tr,color:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>t("/farmer/listings")},{label:"Call Agent",icon:hr,color:"bg-purple-600 hover:bg-purple-700 text-white",onClick:()=>{window.location.href="tel:+919876543210"}}];return e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsx(we,{className:"text-lg",children:"Quick Actions"})}),e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3",children:s.map(r=>e.jsxs(z,{onClick:r.onClick,className:`h-auto flex-col gap-2 py-4 px-3 shadow-sm ${r.color}`,children:[e.jsx(r.icon,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:r.label})]},r.label))})})]})},w_=t=>{const r=(t instanceof Error?t.message:String(t)).toLowerCase();return r.includes("404")||r.includes("not found")||r.includes("failed to fetch")||r.includes("cors")},N_=(t,s="lg")=>{const r=s==="sm"?"h-6 w-6":"h-10 w-10";switch(t){case"sun":return e.jsx(im,{className:`${r} text-amber-500`});case"cloud":return e.jsx(La,{className:`${r} text-gray-200`});case"rain":return e.jsx(Cj,{className:`${r} text-blue-300`});case"drizzle":return e.jsx(_j,{className:`${r} text-blue-200`});case"snow":return e.jsx(Sj,{className:`${r} text-sky-200`});case"thunderstorm":return e.jsx(kj,{className:`${r} text-yellow-400`});default:return e.jsx(im,{className:`${r} text-amber-500`})}},__=()=>{const{data:t,isLoading:s}=Fn();zd(t?.district);const r=!!(t?.village||t?.district||t?.pincode),[a,n]=x.useState(null),[i,o]=x.useState(!0),[c,l]=x.useState(!1),[u,d]=x.useState(null),[p,h]=x.useState(!1),[f,y]=x.useState(!1),[v,b]=x.useState(!1),N=async(j=!1)=>{if(!r){o(!1);return}j?l(!0):o(!0),d(null);try{const{data:{session:C}}=await W.auth.getSession();if(!C)throw new Error("Not authenticated");const{data:I,error:k}=await W.functions.invoke("get-weather",{headers:{Authorization:`Bearer ${C.access_token}`}});if(k)throw k;I?.data?(n(I.data),h(I.cached||!1),y(I.stale||!1),d(null)):(n(null),d(I?.message||"Could not load weather"))}catch(C){w_(C)?console.warn("Weather unavailable:",C instanceof Error?C.message:String(C)):console.error("Weather fetch error:",C),d("Could not load weather"),n(null)}finally{o(!1),l(!1)}};if(x.useEffect(()=>{!s&&r?N():!s&&!r&&o(!1)},[s,r,t?.village]),i||s)return e.jsxs(G,{className:"bg-gradient-to-br from-sky-500 to-blue-600 text-white border-0",children:[e.jsx(je,{className:"pb-2",children:e.jsxs(we,{className:"flex items-center gap-2 text-white",children:[e.jsx(La,{className:"h-5 w-5"}),"Weather"]})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Re,{className:"h-12 w-12 rounded-full bg-white/20"}),e.jsx(Re,{className:"h-8 w-20 bg-white/20"})]})})]});if(!r)return e.jsxs(G,{className:"bg-gradient-to-br from-slate-400 to-slate-500 text-white border-0 overflow-hidden relative",children:[e.jsx(je,{className:"pb-2 relative",children:e.jsxs(we,{className:"flex items-center gap-2 text-white/90 text-base",children:[e.jsx(La,{className:"h-4 w-4"}),"Weather Today"]})}),e.jsx(Q,{className:"relative",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-2 text-center",children:[e.jsx(We,{className:"h-6 w-6 text-white/80 mb-2"}),e.jsx("p",{className:"text-white/90 text-sm",children:"Set your location"})]})})]});if(u&&!a)return e.jsxs(G,{className:"bg-gradient-to-br from-slate-500 to-slate-600 text-white border-0 overflow-hidden relative",children:[e.jsx(je,{className:"pb-2 relative",children:e.jsxs(we,{className:"flex items-center gap-2 text-white/90 text-base",children:[e.jsx(La,{className:"h-4 w-4"}),"Weather Today"]})}),e.jsx(Q,{className:"relative",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rr,{className:"h-6 w-6 text-white/80"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/90 text-sm",children:"Unavailable"}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>N(!0),disabled:c,className:"text-white/70 hover:text-white p-0 h-auto text-xs",children:[e.jsx(jr,{className:`h-3 w-3 mr-1 ${c?"animate-spin":""}`}),"Retry"]})]})]})})]});if(!a)return null;const A=a.fetched_at?Er(new Date(a.fetched_at),{addSuffix:!0}):"unknown";return e.jsxs(G,{className:"bg-gradient-to-br from-sky-500 to-blue-600 text-white border-0 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"}),e.jsxs(Ga,{open:v,onOpenChange:b,children:[e.jsx(je,{className:"pb-2 relative",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(we,{className:"flex items-center gap-2 text-white/90 text-base",children:[e.jsx(La,{className:"h-4 w-4"}),"Weather Today"]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(z,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-white/70 hover:text-white hover:bg-white/10",onClick:j=>{j.stopPropagation(),N(!0)},disabled:c,children:e.jsx(jr,{className:`h-4 w-4 ${c?"animate-spin":""}`})})})]})}),e.jsxs(Q,{className:"relative pt-0",children:[e.jsx(Qa,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between cursor-pointer hover:bg-white/5 rounded-lg p-2 -mx-2 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:N_(a.icon,"sm")}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[a.temp_c,"C"]}),e.jsx("p",{className:"text-white/80 text-xs",children:a.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-white/60",children:[e.jsx("span",{className:"text-xs",children:v?"Less":"More"}),e.jsx(qr,{className:`h-4 w-4 transition-transform ${v?"rotate-180":""}`})]})]})}),e.jsx(Xa,{className:"data-[state=open]:animate-accordion-down data-[state=closed]:animate-accordion-up overflow-hidden",children:e.jsxs("div",{className:"pt-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-white/70 text-xs",children:[e.jsx(We,{className:"h-3 w-3"}),e.jsx("span",{children:a.location||t?.village||"Your Location"})]}),a.forecast_short&&e.jsx("p",{className:"text-xs text-white/60 italic line-clamp-2",children:a.forecast_short}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-3 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Go,{className:"h-4 w-4 text-white/70"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60",children:"Humidity"}),e.jsxs("p",{className:"text-sm font-medium",children:[a.humidity,"%"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vj,{className:"h-4 w-4 text-white/70"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60",children:"Wind"}),e.jsxs("p",{className:"text-sm font-medium",children:[a.wind_kmh," km/h"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($j,{className:"h-4 w-4 text-white/70"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/60",children:"Feels"}),e.jsxs("p",{className:"text-sm font-medium",children:[a.temp_c+2,"C"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 pt-2 border-t border-white/10 text-white/50 text-[10px]",children:[e.jsx(vs,{className:"h-3 w-3"}),e.jsxs("span",{children:["Updated ",A]}),f&&e.jsx("span",{className:"text-amber-300 ml-1",children:"(cached)"})]})]})})]})]})]})},k_=()=>{const{data:t,isLoading:s}=_a(),r=Ut(),[a,n]=x.useState(!1),i=t?.reduce((l,u)=>l+u.area,0)||0,o=t?.slice(0,4)||[],c=t?.slice(0,2)||[];return s?e.jsxs(G,{children:[e.jsx(je,{className:"pb-2",children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(lr,{className:"h-5 w-5 text-primary"}),"My Farmlands"]})}),e.jsx(Q,{children:e.jsx("div",{className:"space-y-2",children:[1,2].map(l=>e.jsx(Re,{className:"h-12 rounded-lg"},l))})})]}):e.jsx(G,{children:e.jsxs(Ga,{open:a,onOpenChange:n,children:[e.jsxs(je,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(lr,{className:"h-5 w-5 text-primary"}),"My Farmlands"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[t?.length||0," plots  ",i.toFixed(1)," acres total"]})]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>r("/farmer/farmlands"),children:[e.jsx(Ss,{className:"h-4 w-4 mr-1"}),"Add"]})]}),e.jsx(Q,{className:"pt-0",children:o.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(lr,{className:"h-6 w-6 mx-auto text-muted-foreground/50 mb-2"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No farmlands added yet"}),e.jsx(z,{variant:"outline",className:"mt-3",size:"sm",onClick:()=>r("/farmer/farmlands"),children:"Add Your First Farmland"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:c.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/30 border border-border/50 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>r("/farmer/farmlands"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-amber-100 text-amber-600",children:e.jsx(lr,{className:"h-3 w-3"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm truncate max-w-[120px]",children:l.name}),l.village&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(We,{className:"h-2 w-2"}),e.jsx("span",{className:"truncate max-w-[80px]",children:l.village})]})]})]}),e.jsxs(he,{variant:"outline",className:"text-xs px-1.5 py-0",children:[l.area," ",l.area_unit]})]},l.id))}),o.length>2&&e.jsx(Qa,{asChild:!0,children:e.jsxs(z,{variant:"ghost",className:"w-full mt-2 h-8 text-muted-foreground hover:text-foreground text-xs",children:[a?"Show less":`+${o.length-2} more plots`,e.jsx(qr,{className:`h-3 w-3 ml-1 transition-transform ${a?"rotate-180":""}`})]})}),e.jsx(Xa,{className:"data-[state=open]:animate-accordion-down data-[state=closed]:animate-accordion-up overflow-hidden",children:e.jsxs("div",{className:"space-y-2 pt-2",children:[o.slice(2).map(l=>e.jsx("div",{className:"bg-muted/30 border border-border/50 rounded-lg p-2 hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>r("/farmer/farmlands"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-amber-100 text-amber-600",children:e.jsx(lr,{className:"h-3 w-3"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:l.name}),e.jsxs(he,{variant:"outline",className:"text-xs px-1.5 py-0 ml-2",children:[l.area," ",l.area_unit]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 text-[10px] text-muted-foreground",children:[l.soil_type&&e.jsx("span",{className:"capitalize",children:l.soil_type}),l.village&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-2 w-2"}),e.jsx("span",{className:"truncate",children:l.village})]})]})]})]})},l.id)),t&&t.length>4&&e.jsxs(z,{variant:"ghost",className:"w-full h-8 text-muted-foreground hover:text-foreground text-xs",onClick:()=>r("/farmer/farmlands"),children:["View all farmlands (",t.length,")"]})]})})]})})]})})},C_=()=>{const t=Ut();Rn();const{data:s,isLoading:r}=_a(),{data:a,isLoading:n}=ka(),[i,o]=x.useState(!1),[c,l]=x.useState(!1);x.useEffect(()=>{localStorage.getItem("onboarding-dismissed")==="true"&&o(!0)},[]);const u=[{id:"farmland",title:"Add Your Farmland",description:"Start by registering your farmland plots. This helps track which crops are grown where.",icon:lr,route:"/farmer/farmlands",checkComplete:()=>(s?.length||0)>0,action:"Add Farmland"},{id:"crop",title:"Add Your First Crop",description:"Register the crops you are growing. Track their growth status and expected harvest dates.",icon:ts,route:"/farmer/crops",checkComplete:()=>(a?.length||0)>0,action:"Add Crop"}],d=u.filter(b=>b.checkComplete()).length,p=d/u.length*100,h=d===u.length,f=u.findIndex(b=>!b.checkComplete());x.useEffect(()=>{if(h&&!i){l(!0);const b=setTimeout(()=>{l(!1)},5e3);return()=>clearTimeout(b)}},[h,i]);const y=()=>{localStorage.setItem("onboarding-dismissed","true"),o(!0)},v=b=>{t(b.route)};return r||n||i||h&&!c?null:h&&c?e.jsxs(G,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-emerald-50 dark:from-primary/10 dark:to-emerald-950 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full -translate-y-1/2 translate-x-1/2"}),e.jsx(je,{className:"pb-3 relative",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-primary/10 text-primary",children:e.jsx(Oj,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx(we,{className:"text-lg",children:"Welcome to Agri Mitra! "}),e.jsx(kr,{children:"You're all set up and ready to go"})]})]}),e.jsx(z,{variant:"ghost",size:"icon",onClick:y,children:e.jsx(ar,{className:"h-4 w-4"})})]})}),e.jsxs(Q,{className:"pb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Great job! You've added your farmland and crops. Now you can track harvests, request transport, and monitor market prices."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>t("/farmer/transport"),children:[e.jsx(rt,{className:"h-4 w-4 mr-1"}),"Request Transport"]}),e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>t("/farmer/dashboard"),children:[e.jsx(wo,{className:"h-4 w-4 mr-1"}),"View Dashboard"]})]})]}),e.jsx(Fp,{className:"pt-0",children:e.jsx(z,{variant:"ghost",size:"sm",onClick:y,className:"text-muted-foreground",children:"Don't show this again"})})]}):e.jsxs(G,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-amber-50/50 dark:from-primary/10 dark:to-amber-950/30 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full -translate-y-1/2 translate-x-1/2"}),e.jsx(je,{className:"pb-3 relative",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(we,{className:"text-lg flex items-center gap-2",children:" Welcome! Let's Get Started"}),e.jsx(kr,{children:"Complete these steps to set up your farm"})]}),e.jsx(z,{variant:"ghost",size:"sm",onClick:y,className:"text-muted-foreground text-xs",children:"Skip for now"})]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Setup Progress"}),e.jsxs("span",{className:"font-medium text-primary",children:[d," of ",u.length," complete"]})]}),e.jsx(Ed,{value:p,className:"h-2"})]}),e.jsx("div",{className:"space-y-3",children:u.map((b,N)=>{const A=b.checkComplete(),j=N===f,C=b.icon;return e.jsxs("div",{className:ke("flex items-center gap-4 p-3 rounded-xl transition-all",A&&"bg-emerald-50 dark:bg-emerald-950/30",j&&"bg-primary/5 border border-primary/20",!A&&!j&&"opacity-60"),children:[e.jsx("div",{className:ke("w-10 h-10 rounded-xl flex items-center justify-center shrink-0",A&&"bg-emerald-100 text-emerald-600 dark:bg-emerald-900 dark:text-emerald-400",j&&"bg-primary/10 text-primary",!A&&!j&&"bg-muted text-muted-foreground"),children:A?e.jsx(qs,{className:"h-5 w-5"}):e.jsx(C,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:ke("font-medium text-sm",A&&"text-emerald-700 dark:text-emerald-400",j&&"text-foreground"),children:A?` ${b.title}`:b.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:b.description})]}),j&&e.jsxs(z,{size:"sm",onClick:()=>v(b),className:"shrink-0",children:[b.action,e.jsx(Ir,{className:"h-4 w-4 ml-1"})]})]},b.id)})})]})]})};function S_(t,s){return x.useReducer((r,a)=>s[r][a]??r,t)}var Bd="ScrollArea",[ax]=wr(Bd),[A_,Sr]=ax(Bd),nx=x.forwardRef((t,s)=>{const{__scopeScrollArea:r,type:a="hover",dir:n,scrollHideDelay:i=600,...o}=t,[c,l]=x.useState(null),[u,d]=x.useState(null),[p,h]=x.useState(null),[f,y]=x.useState(null),[v,b]=x.useState(null),[N,A]=x.useState(0),[j,C]=x.useState(0),[I,k]=x.useState(!1),[R,S]=x.useState(!1),T=Ht(s,D=>l(D)),E=rd(n);return e.jsx(A_,{scope:r,type:a,dir:E,scrollHideDelay:i,scrollArea:c,viewport:u,onViewportChange:d,content:p,onContentChange:h,scrollbarX:f,onScrollbarXChange:y,scrollbarXEnabled:I,onScrollbarXEnabledChange:k,scrollbarY:v,onScrollbarYChange:b,scrollbarYEnabled:R,onScrollbarYEnabledChange:S,onCornerWidthChange:A,onCornerHeightChange:C,children:e.jsx(ht.div,{dir:E,...o,ref:T,style:{position:"relative","--radix-scroll-area-corner-width":N+"px","--radix-scroll-area-corner-height":j+"px",...t.style}})})});nx.displayName=Bd;var ix="ScrollAreaViewport",ox=x.forwardRef((t,s)=>{const{__scopeScrollArea:r,children:a,nonce:n,...i}=t,o=Sr(ix,r),c=x.useRef(null),l=Ht(s,c,o.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(ht.div,{"data-radix-scroll-area-viewport":"",...i,ref:l,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});ox.displayName=ix;var Yr="ScrollAreaScrollbar",$d=x.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=Sr(Yr,t.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:o}=n,c=t.orientation==="horizontal";return x.useEffect(()=>(c?i(!0):o(!0),()=>{c?i(!1):o(!1)}),[c,i,o]),n.type==="hover"?e.jsx(T_,{...a,ref:s,forceMount:r}):n.type==="scroll"?e.jsx(P_,{...a,ref:s,forceMount:r}):n.type==="auto"?e.jsx(lx,{...a,ref:s,forceMount:r}):n.type==="always"?e.jsx(Ud,{...a,ref:s}):null});$d.displayName=Yr;var T_=x.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=Sr(Yr,t.__scopeScrollArea),[i,o]=x.useState(!1);return x.useEffect(()=>{const c=n.scrollArea;let l=0;if(c){const u=()=>{window.clearTimeout(l),o(!0)},d=()=>{l=window.setTimeout(()=>o(!1),n.scrollHideDelay)};return c.addEventListener("pointerenter",u),c.addEventListener("pointerleave",d),()=>{window.clearTimeout(l),c.removeEventListener("pointerenter",u),c.removeEventListener("pointerleave",d)}}},[n.scrollArea,n.scrollHideDelay]),e.jsx(Lr,{present:r||i,children:e.jsx(lx,{"data-state":i?"visible":"hidden",...a,ref:s})})}),P_=x.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=Sr(Yr,t.__scopeScrollArea),i=t.orientation==="horizontal",o=cl(()=>l("SCROLL_END"),100),[c,l]=S_("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return x.useEffect(()=>{if(c==="idle"){const u=window.setTimeout(()=>l("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(u)}},[c,n.scrollHideDelay,l]),x.useEffect(()=>{const u=n.viewport,d=i?"scrollLeft":"scrollTop";if(u){let p=u[d];const h=()=>{const f=u[d];p!==f&&(l("SCROLL"),o()),p=f};return u.addEventListener("scroll",h),()=>u.removeEventListener("scroll",h)}},[n.viewport,i,l,o]),e.jsx(Lr,{present:r||c!=="hidden",children:e.jsx(Ud,{"data-state":c==="hidden"?"hidden":"visible",...a,ref:s,onPointerEnter:st(t.onPointerEnter,()=>l("POINTER_ENTER")),onPointerLeave:st(t.onPointerLeave,()=>l("POINTER_LEAVE"))})})}),lx=x.forwardRef((t,s)=>{const r=Sr(Yr,t.__scopeScrollArea),{forceMount:a,...n}=t,[i,o]=x.useState(!1),c=t.orientation==="horizontal",l=cl(()=>{if(r.viewport){const u=r.viewport.offsetWidth<r.viewport.scrollWidth,d=r.viewport.offsetHeight<r.viewport.scrollHeight;o(c?u:d)}},10);return kn(r.viewport,l),kn(r.content,l),e.jsx(Lr,{present:a||i,children:e.jsx(Ud,{"data-state":i?"visible":"hidden",...n,ref:s})})}),Ud=x.forwardRef((t,s)=>{const{orientation:r="vertical",...a}=t,n=Sr(Yr,t.__scopeScrollArea),i=x.useRef(null),o=x.useRef(0),[c,l]=x.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=hx(c.viewport,c.content),d={...a,sizes:c,onSizesChange:l,hasThumb:u>0&&u<1,onThumbChange:h=>i.current=h,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:h=>o.current=h};function p(h,f){return O_(h,o.current,c,f)}return r==="horizontal"?e.jsx(M_,{...d,ref:s,onThumbPositionChange:()=>{if(n.viewport&&i.current){const h=n.viewport.scrollLeft,f=Dm(h,c,n.dir);i.current.style.transform=`translate3d(${f}px, 0, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollLeft=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollLeft=p(h,n.dir))}}):r==="vertical"?e.jsx(R_,{...d,ref:s,onThumbPositionChange:()=>{if(n.viewport&&i.current){const h=n.viewport.scrollTop,f=Dm(h,c);i.current.style.transform=`translate3d(0, ${f}px, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollTop=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollTop=p(h))}}):null}),M_=x.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...n}=t,i=Sr(Yr,t.__scopeScrollArea),[o,c]=x.useState(),l=x.useRef(null),u=Ht(s,l,i.onScrollbarXChange);return x.useEffect(()=>{l.current&&c(getComputedStyle(l.current))},[l]),e.jsx(dx,{"data-orientation":"horizontal",...n,ref:u,sizes:r,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":ll(r)+"px",...t.style},onThumbPointerDown:d=>t.onThumbPointerDown(d.x),onDragScroll:d=>t.onDragScroll(d.x),onWheelScroll:(d,p)=>{if(i.viewport){const h=i.viewport.scrollLeft+d.deltaX;t.onWheelScroll(h),fx(h,p)&&d.preventDefault()}},onResize:()=>{l.current&&i.viewport&&o&&a({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:l.current.clientWidth,paddingStart:Ro(o.paddingLeft),paddingEnd:Ro(o.paddingRight)}})}})}),R_=x.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...n}=t,i=Sr(Yr,t.__scopeScrollArea),[o,c]=x.useState(),l=x.useRef(null),u=Ht(s,l,i.onScrollbarYChange);return x.useEffect(()=>{l.current&&c(getComputedStyle(l.current))},[l]),e.jsx(dx,{"data-orientation":"vertical",...n,ref:u,sizes:r,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":ll(r)+"px",...t.style},onThumbPointerDown:d=>t.onThumbPointerDown(d.y),onDragScroll:d=>t.onDragScroll(d.y),onWheelScroll:(d,p)=>{if(i.viewport){const h=i.viewport.scrollTop+d.deltaY;t.onWheelScroll(h),fx(h,p)&&d.preventDefault()}},onResize:()=>{l.current&&i.viewport&&o&&a({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:l.current.clientHeight,paddingStart:Ro(o.paddingTop),paddingEnd:Ro(o.paddingBottom)}})}})}),[D_,cx]=ax(Yr),dx=x.forwardRef((t,s)=>{const{__scopeScrollArea:r,sizes:a,hasThumb:n,onThumbChange:i,onThumbPointerUp:o,onThumbPointerDown:c,onThumbPositionChange:l,onDragScroll:u,onWheelScroll:d,onResize:p,...h}=t,f=Sr(Yr,r),[y,v]=x.useState(null),b=Ht(s,T=>v(T)),N=x.useRef(null),A=x.useRef(""),j=f.viewport,C=a.content-a.viewport,I=yr(d),k=yr(l),R=cl(p,10);function S(T){if(N.current){const E=T.clientX-N.current.left,D=T.clientY-N.current.top;u({x:E,y:D})}}return x.useEffect(()=>{const T=E=>{const D=E.target;y?.contains(D)&&I(E,C)};return document.addEventListener("wheel",T,{passive:!1}),()=>document.removeEventListener("wheel",T,{passive:!1})},[j,y,C,I]),x.useEffect(k,[a,k]),kn(y,R),kn(f.content,R),e.jsx(D_,{scope:r,scrollbar:y,hasThumb:n,onThumbChange:yr(i),onThumbPointerUp:yr(o),onThumbPositionChange:k,onThumbPointerDown:yr(c),children:e.jsx(ht.div,{...h,ref:b,style:{position:"absolute",...h.style},onPointerDown:st(t.onPointerDown,T=>{T.button===0&&(T.target.setPointerCapture(T.pointerId),N.current=y.getBoundingClientRect(),A.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",f.viewport&&(f.viewport.style.scrollBehavior="auto"),S(T))}),onPointerMove:st(t.onPointerMove,S),onPointerUp:st(t.onPointerUp,T=>{const E=T.target;E.hasPointerCapture(T.pointerId)&&E.releasePointerCapture(T.pointerId),document.body.style.webkitUserSelect=A.current,f.viewport&&(f.viewport.style.scrollBehavior=""),N.current=null})})})}),Mo="ScrollAreaThumb",ux=x.forwardRef((t,s)=>{const{forceMount:r,...a}=t,n=cx(Mo,t.__scopeScrollArea);return e.jsx(Lr,{present:r||n.hasThumb,children:e.jsx(E_,{ref:s,...a})})}),E_=x.forwardRef((t,s)=>{const{__scopeScrollArea:r,style:a,...n}=t,i=Sr(Mo,r),o=cx(Mo,r),{onThumbPositionChange:c}=o,l=Ht(s,p=>o.onThumbChange(p)),u=x.useRef(void 0),d=cl(()=>{u.current&&(u.current(),u.current=void 0)},100);return x.useEffect(()=>{const p=i.viewport;if(p){const h=()=>{if(d(),!u.current){const f=F_(p,c);u.current=f,c()}};return c(),p.addEventListener("scroll",h),()=>p.removeEventListener("scroll",h)}},[i.viewport,d,c]),e.jsx(ht.div,{"data-state":o.hasThumb?"visible":"hidden",...n,ref:l,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:st(t.onPointerDownCapture,p=>{const f=p.target.getBoundingClientRect(),y=p.clientX-f.left,v=p.clientY-f.top;o.onThumbPointerDown({x:y,y:v})}),onPointerUp:st(t.onPointerUp,o.onThumbPointerUp)})});ux.displayName=Mo;var Hd="ScrollAreaCorner",mx=x.forwardRef((t,s)=>{const r=Sr(Hd,t.__scopeScrollArea),a=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&a?e.jsx(I_,{...t,ref:s}):null});mx.displayName=Hd;var I_=x.forwardRef((t,s)=>{const{__scopeScrollArea:r,...a}=t,n=Sr(Hd,r),[i,o]=x.useState(0),[c,l]=x.useState(0),u=!!(i&&c);return kn(n.scrollbarX,()=>{const d=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(d),l(d)}),kn(n.scrollbarY,()=>{const d=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(d),o(d)}),u?e.jsx(ht.div,{...a,ref:s,style:{width:i,height:c,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function Ro(t){return t?parseInt(t,10):0}function hx(t,s){const r=t/s;return isNaN(r)?0:r}function ll(t){const s=hx(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-r)*s;return Math.max(a,18)}function O_(t,s,r,a="ltr"){const n=ll(r),i=n/2,o=s||i,c=n-o,l=r.scrollbar.paddingStart+o,u=r.scrollbar.size-r.scrollbar.paddingEnd-c,d=r.content-r.viewport,p=a==="ltr"?[0,d]:[d*-1,0];return px([l,u],p)(t)}function Dm(t,s,r="ltr"){const a=ll(s),n=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,i=s.scrollbar.size-n,o=s.content-s.viewport,c=i-a,l=r==="ltr"?[0,o]:[o*-1,0],u=Oc(t,l);return px([0,o],[0,c])(u)}function px(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(t[1]-t[0]);return s[0]+a*(r-t[0])}}function fx(t,s){return t>0&&t<s}var F_=(t,s=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},a=0;return function n(){const i={left:t.scrollLeft,top:t.scrollTop},o=r.left!==i.left,c=r.top!==i.top;(o||c)&&s(),r=i,a=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(a)};function cl(t,s){const r=yr(t),a=x.useRef(0);return x.useEffect(()=>()=>window.clearTimeout(a.current),[]),x.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(r,s)},[r,s])}function kn(t,s){const r=yr(s);mr(()=>{let a=0;if(t){const n=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(r)});return n.observe(t),()=>{window.cancelAnimationFrame(a),n.unobserve(t)}}},[t,r])}var xx=nx,L_=ox,q_=mx;const Cn=x.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(xx,{ref:a,className:ke("relative overflow-hidden",t),...r,children:[e.jsx(L_,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(gx,{}),e.jsx(q_,{})]}));Cn.displayName=xx.displayName;const gx=x.forwardRef(({className:t,orientation:s="vertical",...r},a)=>e.jsx($d,{ref:a,orientation:s,className:ke("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:e.jsx(ux,{className:"relative flex-1 rounded-full bg-border"})}));gx.displayName=$d.displayName;var dl="Switch",[z_]=wr(dl),[B_,$_]=z_(dl),vx=x.forwardRef((t,s)=>{const{__scopeSwitch:r,name:a,checked:n,defaultChecked:i,required:o,disabled:c,value:l="on",onCheckedChange:u,form:d,...p}=t,[h,f]=x.useState(null),y=Ht(s,j=>f(j)),v=x.useRef(!1),b=h?d||!!h.closest("form"):!0,[N,A]=ra({prop:n,defaultProp:i??!1,onChange:u,caller:dl});return e.jsxs(B_,{scope:r,checked:N,disabled:c,children:[e.jsx(ht.button,{type:"button",role:"switch","aria-checked":N,"aria-required":o,"data-state":wx(N),"data-disabled":c?"":void 0,disabled:c,value:l,...p,ref:y,onClick:st(t.onClick,j=>{A(C=>!C),b&&(v.current=j.isPropagationStopped(),v.current||j.stopPropagation())})}),b&&e.jsx(bx,{control:h,bubbles:!v.current,name:a,value:l,checked:N,required:o,disabled:c,form:d,style:{transform:"translateX(-100%)"}})]})});vx.displayName=dl;var yx="SwitchThumb",jx=x.forwardRef((t,s)=>{const{__scopeSwitch:r,...a}=t,n=$_(yx,r);return e.jsx(ht.span,{"data-state":wx(n.checked),"data-disabled":n.disabled?"":void 0,...a,ref:s})});jx.displayName=yx;var U_="SwitchBubbleInput",bx=x.forwardRef(({__scopeSwitch:t,control:s,checked:r,bubbles:a=!0,...n},i)=>{const o=x.useRef(null),c=Ht(o,i),l=rl(r),u=ad(s);return x.useEffect(()=>{const d=o.current;if(!d)return;const p=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(p,"checked").set;if(l!==r&&f){const y=new Event("click",{bubbles:a});f.call(d,r),d.dispatchEvent(y)}},[l,r,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:c,style:{...n.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});bx.displayName=U_;function wx(t){return t?"checked":"unchecked"}var Nx=vx,H_=jx;const xa=x.forwardRef(({className:t,...s},r)=>e.jsx(Nx,{className:ke("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",t),...s,ref:r,children:e.jsx(H_,{className:ke("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));xa.displayName=Nx.displayName;const nc={"en-IN":"English","hi-IN":"","kn-IN":""},V_=()=>{const[t,s]=x.useState(!1),[r,a]=x.useState([]),[n,i]=x.useState(""),[o,c]=x.useState(!1),[l,u]=x.useState(!1),[d,p]=x.useState("en-IN"),[h,f]=x.useState(()=>{const E=localStorage.getItem("voiceReplyEnabled");return E!==null?E==="true":!0}),[y,v]=x.useState(null),b=x.useRef(null),N=x.useRef(null),A=x.useRef(null);x.useEffect(()=>{localStorage.setItem("voiceReplyEnabled",String(h))},[h]),x.useEffect(()=>{const E=window.SpeechRecognition||window.webkitSpeechRecognition;return typeof window<"u"&&E&&(b.current=new E,b.current.continuous=!1,b.current.interimResults=!1,b.current.lang=d,b.current.onresult=D=>{const F=D.results[0][0].transcript;i(F),c(!1),R(F)},b.current.onerror=D=>{console.error("Speech recognition error:",D.error),c(!1),D.error==="not-allowed"?ce.error("Microphone access denied. Please enable it in your browser settings."):ce.error("Voice input error. Please try again or type your message.")},b.current.onend=()=>{c(!1)}),()=>{b.current&&b.current.abort(),N.current&&N.current.pause()}},[d]),x.useEffect(()=>{b.current&&(b.current.lang=d)},[d]),x.useEffect(()=>{A.current&&(A.current.scrollTop=A.current.scrollHeight)},[r]);const j=async()=>{if(!b.current){ce.error("Voice input is not supported in your browser. Please use Chrome or Edge.");return}try{await navigator.mediaDevices.getUserMedia({audio:!0}),b.current.lang=d,b.current.start(),c(!0)}catch(E){console.error("Microphone error:",E),ce.error("Could not access microphone. Please check permissions.")}},C=()=>{b.current&&b.current.stop(),c(!1)},I=x.useCallback(async(E,D)=>{try{const{data:{session:F}}=await W.auth.getSession();if(!F)return null;const q=await(await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/tts-elevenlabs",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${F.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({text:E.substring(0,1200),language_code:d,voice_role:"farmer"})})).json();return q.audio_url?(a(B=>B.map(L=>L.id===D?{...L,audioUrl:q.audio_url,audioLoading:!1}:L)),q.audio_url):null}catch(F){return console.error("TTS fetch error:",F),a(H=>H.map(q=>q.id===D?{...q,audioLoading:!1}:q)),null}},[d]),k=x.useCallback(async(E,D)=>{if(N.current&&(N.current.pause(),N.current=null),y===E){v(null);return}const F=r.find(q=>q.id===E);if(!F)return;let H=D||F.audioUrl;if(!H&&!F.audioLoading&&(a(q=>q.map(B=>B.id===E?{...B,audioLoading:!0}:B)),H=await I(F.content,E)),!H){ce.error("Voice unavailable for this message");return}try{N.current=new Audio(H),N.current.onended=()=>{v(null)},N.current.onerror=()=>{v(null),ce.error("Could not play audio")},await N.current.play(),v(E)}catch(q){console.error("Audio play error:",q),ce.error("Could not play audio")}},[r,y,I]),R=async E=>{const D=E||n.trim();if(!D||l)return;const F={id:Date.now().toString(),role:"user",content:D,timestamp:new Date};a(H=>[...H,F]),i(""),u(!0);try{const{data:{session:H}}=await W.auth.getSession();if(!H)throw new Error("Not authenticated");const q=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/ai-gateway/farmer-assistant",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${H.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({message:D,language:d})}),B=await q.json();if(!q.ok)throw new Error(B?.error?.message||"Function error");const L=(Date.now()+1).toString(),P={id:L,role:"assistant",content:B.reply,timestamp:new Date,personalized:B.metadata?.personalized??!0,webVerified:B.metadata?.webVerified??!1,audioLoading:h};if(a(K=>[...K,P]),h){const K=await I(B.reply,L);K&&k(L,K)}}catch(H){console.error("Error:",H),ce.error("Could not get a response. Please try again.")}finally{u(!1)}},S=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),R())},T=()=>{const E=["en-IN","hi-IN","kn-IN"],F=(E.indexOf(d)+1)%E.length;p(E[F]),ce.success(`Language: ${nc[E[F]]}`)};return t?e.jsxs(G,{className:"fixed bottom-6 right-6 w-[360px] max-w-[calc(100vw-3rem)] h-[520px] max-h-[calc(100vh-6rem)] shadow-xl z-50 flex flex-col",children:[e.jsxs(je,{className:"pb-2 border-b flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ni,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(we,{className:"text-base",children:"Krishi Mitra"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your Farming Assistant"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:T,title:"Change language",children:e.jsx(ap,{className:"h-4 w-4"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>s(!1),children:e.jsx(ar,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx(he,{variant:"secondary",className:"text-xs",children:nc[d]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{htmlFor:"voice-reply",className:"text-xs text-muted-foreground cursor-pointer",children:"Voice Reply"}),e.jsx(xa,{id:"voice-reply",checked:h,onCheckedChange:f,className:"scale-75"})]})]})]}),e.jsxs(Q,{className:"flex-1 flex flex-col p-0 overflow-hidden",children:[e.jsx(Cn,{className:"flex-1 p-4",ref:A,children:r.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-4",children:[e.jsx(ni,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),e.jsx("h3",{className:"font-medium text-sm mb-1",children:"Namaste! "}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Ask me about crops, weather, market prices, or any farming questions."}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx(he,{variant:"outline",className:"cursor-pointer hover:bg-accent text-xs",onClick:()=>R("What crops should I plant this season?"),children:"Season crops"}),e.jsx(he,{variant:"outline",className:"cursor-pointer hover:bg-accent text-xs",onClick:()=>R("      ,  ?"),children:" "}),e.jsx(he,{variant:"outline",className:"cursor-pointer hover:bg-accent text-xs",onClick:()=>R("   ?"),children:""})]})]}):e.jsxs("div",{className:"space-y-4",children:[r.map(E=>e.jsxs("div",{className:`flex gap-2 ${E.role==="user"?"justify-end":"justify-start"}`,children:[E.role==="assistant"&&e.jsx("div",{className:"h-7 w-7 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ni,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex flex-col gap-1 max-w-[80%]",children:[E.role==="assistant"&&e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[E.personalized&&e.jsxs(he,{variant:"secondary",className:"text-[10px] px-1.5 py-0 h-4 gap-0.5",children:[e.jsx(Js,{className:"h-2.5 w-2.5"}),"Personalized"]}),E.webVerified&&e.jsxs(he,{variant:"outline",className:"text-[10px] px-1.5 py-0 h-4 gap-0.5 border-blue-300 text-blue-600",children:[e.jsx(mi,{className:"h-2.5 w-2.5"}),"Web verified"]})]}),e.jsx("div",{className:`rounded-lg px-3 py-2 text-sm ${E.role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:E.content}),E.role==="assistant"&&e.jsxs(z,{variant:"ghost",size:"sm",className:"h-6 w-fit px-2 text-xs gap-1 self-start",onClick:()=>k(E.id),disabled:E.audioLoading,children:[E.audioLoading?e.jsx(et,{className:"h-3 w-3 animate-spin"}):y===E.id?e.jsx(lp,{className:"h-3 w-3"}):e.jsx(aa,{className:"h-3 w-3"}),E.audioLoading?"Loading...":y===E.id?"Stop":"Play"]})]}),E.role==="user"&&e.jsx("div",{className:"h-7 w-7 rounded-full bg-secondary flex items-center justify-center flex-shrink-0",children:e.jsx(Ps,{className:"h-4 w-4"})})]},E.id)),l&&e.jsxs("div",{className:"flex gap-2 justify-start",children:[e.jsx("div",{className:"h-7 w-7 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ni,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"bg-muted rounded-lg px-3 py-2",children:e.jsx(et,{className:"h-4 w-4 animate-spin"})})]})]})}),e.jsxs("div",{className:"p-3 border-t flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{variant:o?"destructive":"outline",size:"icon",className:"h-10 w-10 flex-shrink-0",onClick:o?C:j,disabled:l,children:o?e.jsx(ip,{className:"h-4 w-4"}):e.jsx(Xo,{className:"h-4 w-4"})}),e.jsx(Ce,{value:n,onChange:E=>i(E.target.value),onKeyPress:S,placeholder:o?"Listening...":"Type or speak...",className:"flex-1",disabled:o||l}),e.jsx(z,{size:"icon",className:"h-10 w-10 flex-shrink-0",onClick:()=>R(),disabled:!n.trim()||l,children:l?e.jsx(et,{className:"h-4 w-4 animate-spin"}):e.jsx(_c,{className:"h-4 w-4"})})]}),o&&e.jsxs("p",{className:"text-xs text-center text-muted-foreground mt-2 animate-pulse",children:[" Speak now in ",nc[d],"..."]})]})]})]}):e.jsx(z,{onClick:()=>s(!0),className:"fixed bottom-6 right-6 h-14 w-14 rounded-full shadow-lg bg-primary hover:bg-primary/90 z-50",size:"icon",children:e.jsx(Qo,{className:"h-6 w-6"})})},K_={"en-IN":"English","hi-IN":"Hindi","kn-IN":"Kannada"},W_=()=>{const{user:t}=Fe(),[s,r]=x.useState(null),[a,n]=x.useState(null),[i,o]=x.useState(!1),c=x.useRef(null),{data:l,isLoading:u}=De({queryKey:["agent-notes-for-farmer",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:f,error:y}=await W.from("agent_voice_notes").select("*").eq("farmer_id",t.id).order("created_at",{ascending:!1}).limit(10);return y?(console.error("Error fetching agent notes:",y),[]):f},enabled:!!t?.id}),d=x.useMemo(()=>l?i?l:l.slice(0,2):[],[l,i]),p=(l?.length||0)>2,h=x.useCallback(async f=>{if(f.audio_path){if(c.current&&(c.current.pause(),c.current=null),s===f.id){r(null);return}n(f.id);try{let y=null;if(/^[0-9a-fA-F-]{36}$/.test(f.audio_path))try{const{data:b}=await W.functions.invoke("storage-sign-read-v1",{body:{file_id:f.audio_path}});y=b?.signed_read_url||null}catch(b){console.warn("storage-sign-read-v1 failed:",b)}if(!y){const{data:b,error:N}=await W.storage.from("voice_media").createSignedUrl(f.audio_path,300);if(N||!b?.signedUrl)throw new Error("Could not get audio URL");y=b.signedUrl}c.current=new Audio(y),c.current.onended=()=>{r(null)},c.current.onerror=()=>{r(null),console.error("Audio playback error")},await c.current.play(),r(f.id)}catch(y){console.error("Error playing audio:",y)}finally{n(null)}}},[s]);return u?e.jsxs(G,{className:"overflow-hidden",children:[e.jsx(je,{className:"py-3 px-4",children:e.jsxs(we,{className:"text-base flex items-center gap-2",children:[e.jsx(pn,{className:"h-5 w-5 text-primary"}),"Agent Notes"]})}),e.jsx(Q,{className:"px-4 pb-3 pt-0",children:e.jsx(Re,{className:"h-12 w-full"})})]}):!l||l.length===0?e.jsxs(G,{className:"overflow-hidden",children:[e.jsx(je,{className:"py-3 px-4",children:e.jsxs(we,{className:"text-base flex items-center gap-2",children:[e.jsx(pn,{className:"h-4 w-4 text-muted-foreground"}),"Agent Notes"]})}),e.jsx(Q,{className:"px-4 pb-3 pt-0",children:e.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[e.jsx(Qo,{className:"h-4 w-4 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No notes from your agent yet"})]})})]}):e.jsxs(G,{className:"overflow-hidden",children:[e.jsx(je,{className:"py-3 px-4",children:e.jsxs(we,{className:"text-base flex items-center gap-2",children:[e.jsx(pn,{className:"h-5 w-5 text-primary"}),"Agent Notes",e.jsxs(he,{variant:"secondary",className:"ml-auto text-xs",children:[l.length," notes"]})]})}),e.jsxs(Q,{className:"px-4 pb-3 pt-0",children:[e.jsx("div",{className:"space-y-2",children:d.map(f=>e.jsx("div",{className:"p-2.5 rounded-lg border bg-muted/30 hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ps,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Field Agent"}),e.jsx(he,{variant:"outline",className:"text-[10px] px-1 py-0",children:K_[f.language_code]||f.language_code}),e.jsx("span",{className:"text-[10px] text-muted-foreground/70 ml-auto",children:tt(new Date(f.created_at),"MMM d")})]}),f.note_text&&e.jsx("p",{className:ke("text-sm",!i&&"line-clamp-2"),children:f.note_text})]}),f.audio_path&&e.jsx(z,{variant:"ghost",size:"icon",className:"h-7 w-7 flex-shrink-0",onClick:()=>h(f),disabled:a===f.id,children:a===f.id?e.jsx("div",{className:"h-3.5 w-3.5 animate-spin rounded-full border-2 border-primary border-t-transparent"}):s===f.id?e.jsx(lp,{className:"h-3.5 w-3.5"}):e.jsx(aa,{className:"h-3.5 w-3.5"})})]})},f.id))}),p&&e.jsx(z,{variant:"ghost",size:"sm",className:"w-full mt-2 h-7 text-xs text-muted-foreground hover:text-foreground",onClick:()=>o(!i),children:i?e.jsxs(e.Fragment,{children:[e.jsx(ld,{className:"h-3 w-3 mr-1"}),"Show less"]}):e.jsxs(e.Fragment,{children:[e.jsx(qr,{className:"h-3 w-3 mr-1"}),"Show ",l.length-2," more notes"]})})]})]})},Y_=()=>{const{user:t,userRole:s}=Fe(),{data:r,isLoading:a}=qd(),{data:n,isLoading:i}=f_(),o=x_(),[c,l]=x.useState(!1),[u,d]=x.useState(!1),[p,h]=x.useState(""),[f,y]=x.useState(""),[v,b]=x.useState("");x.useEffect(()=>{if(s==="farmer"&&!i&&n?.needsDistrict&&!u){const j=setTimeout(()=>l(!0),1500);return()=>clearTimeout(j)}},[s,i,n,u]),x.useEffect(()=>{n?.profile?.village&&y(n.profile.village)},[n]);const N=async()=>{p&&(await o.mutateAsync({district:p,village:f.trim()||void 0,pincode:v.trim()||void 0,district_source:"user",district_confidence:"high"}),l(!1))},A=()=>{d(!0),l(!1)};return s!=="farmer"||i||!n?.needsDistrict||u?null:e.jsxs(e.Fragment,{children:[!c&&n?.needsDistrict&&e.jsxs(Nn,{className:"mb-4 border-amber-200 bg-amber-50 dark:bg-amber-950/30 dark:border-amber-800 cursor-pointer",onClick:()=>l(!0),children:[e.jsx(We,{className:"h-4 w-4 text-amber-600"}),e.jsxs(_n,{className:"text-amber-800 dark:text-amber-200 flex items-center justify-between",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Set your district"})," to see local mandi prices and advisories"]}),e.jsx(z,{variant:"outline",size:"sm",className:"ml-4 shrink-0",children:"Set Now"})]})]}),e.jsx(zt,{open:c,onOpenChange:l,children:e.jsxs(It,{className:"sm:max-w-md",children:[e.jsxs(Bt,{children:[e.jsxs($t,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-primary"}),"Set Your Location"]}),e.jsx(Ks,{children:"We'll use this to show you local mandi prices, weather forecasts, and relevant advisories."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ie,{htmlFor:"district",className:"flex items-center gap-1",children:["District ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(lt,{value:p,onValueChange:h,disabled:a,children:[e.jsx(it,{id:"district",children:e.jsx(ct,{placeholder:a?"Loading...":"Select your district"})}),e.jsx(ot,{className:"max-h-60",children:r?.map(j=>e.jsx(ge,{value:j.district,children:j.district},j.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"village",children:"Village (Optional)"}),e.jsx(Ce,{id:"village",placeholder:"Enter your village name",value:f,onChange:j=>y(j.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"pincode",children:"Pincode (Optional)"}),e.jsx(Ce,{id:"pincode",placeholder:"e.g., 560001",value:v,onChange:j=>b(j.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pincode can help us provide more accurate local data"})]})]}),e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx(z,{variant:"ghost",onClick:A,className:"text-muted-foreground",children:"Skip for now"}),e.jsx(z,{onClick:N,disabled:!p||o.isPending,children:o.isPending?"Saving...":"Save Location"})]})]})})]})};var _x={exports:{}};(function(t,s){((r,a)=>{t.exports=a()})(Qu,function(){var r=function(m,g){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(w,_){w.__proto__=_}:function(w,_){for(var M in _)Object.prototype.hasOwnProperty.call(_,M)&&(w[M]=_[M])}))(m,g)},a=function(){return(a=Object.assign||function(m){for(var g,w=1,_=arguments.length;w<_;w++)for(var M in g=arguments[w])Object.prototype.hasOwnProperty.call(g,M)&&(m[M]=g[M]);return m}).apply(this,arguments)};function n(m,g,w){for(var _,M=0,O=g.length;M<O;M++)!_&&M in g||((_=_||Array.prototype.slice.call(g,0,M))[M]=g[M]);return m.concat(_||Array.prototype.slice.call(g))}var i=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Qu,o=Object.keys,c=Array.isArray;function l(m,g){return typeof g=="object"&&o(g).forEach(function(w){m[w]=g[w]}),m}typeof Promise>"u"||i.Promise||(i.Promise=Promise);var u=Object.getPrototypeOf,d={}.hasOwnProperty;function p(m,g){return d.call(m,g)}function h(m,g){typeof g=="function"&&(g=g(u(m))),(typeof Reflect>"u"?o:Reflect.ownKeys)(g).forEach(function(w){y(m,w,g[w])})}var f=Object.defineProperty;function y(m,g,w,_){f(m,g,l(w&&p(w,"get")&&typeof w.get=="function"?{get:w.get,set:w.set,configurable:!0}:{value:w,configurable:!0,writable:!0},_))}function v(m){return{from:function(g){return m.prototype=Object.create(g.prototype),y(m.prototype,"constructor",m),{extend:h.bind(null,m.prototype)}}}}var b=Object.getOwnPropertyDescriptor,N=[].slice;function A(m,g,w){return N.call(m,g,w)}function j(m,g){return g(m)}function C(m){if(!m)throw new Error("Assertion Failed")}function I(m){i.setImmediate?setImmediate(m):setTimeout(m,0)}function k(m,g){if(typeof g=="string"&&p(m,g))return m[g];if(!g)return m;if(typeof g!="string"){for(var w=[],_=0,M=g.length;_<M;++_){var O=k(m,g[_]);w.push(O)}return w}var U,V=g.indexOf(".");return V===-1||(U=m[g.substr(0,V)])==null?void 0:k(U,g.substr(V+1))}function R(m,g,w){if(m&&g!==void 0&&!("isFrozen"in Object&&Object.isFrozen(m)))if(typeof g!="string"&&"length"in g){C(typeof w!="string"&&"length"in w);for(var _=0,M=g.length;_<M;++_)R(m,g[_],w[_])}else{var O,U,V=g.indexOf(".");V!==-1?(O=g.substr(0,V),(V=g.substr(V+1))===""?w===void 0?c(m)&&!isNaN(parseInt(O))?m.splice(O,1):delete m[O]:m[O]=w:R(U=(U=m[O])&&p(m,O)?U:m[O]={},V,w)):w===void 0?c(m)&&!isNaN(parseInt(g))?m.splice(g,1):delete m[g]:m[g]=w}}function S(m){var g,w={};for(g in m)p(m,g)&&(w[g]=m[g]);return w}var T=[].concat;function E(m){return T.apply([],m)}var Y="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(E([8,16,32,64].map(function(m){return["Int","Uint","Float"].map(function(g){return g+m+"Array"})}))).filter(function(m){return i[m]}),D=new Set(Y.map(function(m){return i[m]})),F=null;function H(m){return F=new WeakMap,m=function g(w){if(!w||typeof w!="object")return w;var _=F.get(w);if(_)return _;if(c(w)){_=[],F.set(w,_);for(var M=0,O=w.length;M<O;++M)_.push(g(w[M]))}else if(D.has(w.constructor))_=w;else{var U,V=u(w);for(U in _=V===Object.prototype?{}:Object.create(V),F.set(w,_),w)p(w,U)&&(_[U]=g(w[U]))}return _}(m),F=null,m}var q={}.toString;function B(m){return q.call(m).slice(8,-1)}var L=typeof Symbol<"u"?Symbol.iterator:"@@iterator",P=typeof L=="symbol"?function(m){var g;return m!=null&&(g=m[L])&&g.apply(m)}:function(){return null};function K(m,g){g=m.indexOf(g),0<=g&&m.splice(g,1)}var $={};function se(m){var g,w,_,M;if(arguments.length===1){if(c(m))return m.slice();if(this===$&&typeof m=="string")return[m];if(M=P(m))for(w=[];!(_=M.next()).done;)w.push(_.value);else{if(m==null)return[m];if(typeof(g=m.length)!="number")return[m];for(w=new Array(g);g--;)w[g]=m[g]}}else for(g=arguments.length,w=new Array(g);g--;)w[g]=arguments[g];return w}var ne=typeof Symbol<"u"?function(m){return m[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Y=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],_t=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Y),fe={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function me(m,g){this.name=m,this.message=g}function xe(m,g){return m+". Errors: "+Object.keys(g).map(function(w){return g[w].toString()}).filter(function(w,_,M){return M.indexOf(w)===_}).join(`
`)}function He(m,g,w,_){this.failures=g,this.failedKeys=_,this.successCount=w,this.message=xe(m,g)}function Ae(m,g){this.name="BulkError",this.failures=Object.keys(g).map(function(w){return g[w]}),this.failuresByPos=g,this.message=xe(m,this.failures)}v(me).from(Error).extend({toString:function(){return this.name+": "+this.message}}),v(He).from(me),v(Ae).from(me);var Ye=_t.reduce(function(m,g){return m[g]=g+"Error",m},{}),Ze=me,Ne=_t.reduce(function(m,g){var w=g+"Error";function _(M,O){this.name=w,M?typeof M=="string"?(this.message="".concat(M).concat(O?`
 `+O:""),this.inner=O||null):typeof M=="object"&&(this.message="".concat(M.name," ").concat(M.message),this.inner=M):(this.message=fe[g]||w,this.inner=null)}return v(_).from(Ze),m[g]=_,m},{}),Ge=(Ne.Syntax=SyntaxError,Ne.Type=TypeError,Ne.Range=RangeError,Y.reduce(function(m,g){return m[g+"Error"]=Ne[g],m},{}));Y=_t.reduce(function(m,g){return["Syntax","Type","Range"].indexOf(g)===-1&&(m[g+"Error"]=Ne[g]),m},{});function qe(){}function Ke(m){return m}function as(m,g){return m==null||m===Ke?g:function(w){return g(m(w))}}function yt(m,g){return function(){m.apply(this,arguments),g.apply(this,arguments)}}function Vt(m,g){return m===qe?g:function(){var w=m.apply(this,arguments),_=(w!==void 0&&(arguments[0]=w),this.onsuccess),M=this.onerror,O=(this.onsuccess=null,this.onerror=null,g.apply(this,arguments));return _&&(this.onsuccess=this.onsuccess?yt(_,this.onsuccess):_),M&&(this.onerror=this.onerror?yt(M,this.onerror):M),O!==void 0?O:w}}function Pt(m,g){return m===qe?g:function(){m.apply(this,arguments);var w=this.onsuccess,_=this.onerror;this.onsuccess=this.onerror=null,g.apply(this,arguments),w&&(this.onsuccess=this.onsuccess?yt(w,this.onsuccess):w),_&&(this.onerror=this.onerror?yt(_,this.onerror):_)}}function Dt(m,g){return m===qe?g:function(M){var _=m.apply(this,arguments),M=(l(M,_),this.onsuccess),O=this.onerror,U=(this.onsuccess=null,this.onerror=null,g.apply(this,arguments));return M&&(this.onsuccess=this.onsuccess?yt(M,this.onsuccess):M),O&&(this.onerror=this.onerror?yt(O,this.onerror):O),_===void 0?U===void 0?void 0:U:l(_,U)}}function Gt(m,g){return m===qe?g:function(){return g.apply(this,arguments)!==!1&&m.apply(this,arguments)}}function ns(m,g){return m===qe?g:function(){var w=m.apply(this,arguments);if(w&&typeof w.then=="function"){for(var _=this,M=arguments.length,O=new Array(M);M--;)O[M]=arguments[M];return w.then(function(){return g.apply(_,O)})}return g.apply(this,arguments)}}Y.ModifyError=He,Y.DexieError=me,Y.BulkError=Ae;var jt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function is(m){jt=m}var Ct={},Et=100,ps=typeof Promise>"u"?[]:(_t=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[ps=crypto.subtle.digest("SHA-512",new Uint8Array([0])),u(ps),_t]:[_t,u(_t),_t]),_t=ps[0],an=ps[1],an=an&&an.then,ls=_t&&_t.constructor,cs=!!ps[2],Us=function(m,g){Ar.push([m,g]),ds&&(queueMicrotask(gt),ds=!1)},Jt=!0,ds=!0,Zt=[],As=[],fs=Ke,ws={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:qe,pgp:!1,env:{},finalize:qe},Be=ws,Ar=[],Qe=0,bt=[];function _e(m){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var g=this._PSD=Be;if(typeof m!="function"){if(m!==Ct)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Mt(this,this._value)}else this._state=null,this._value=null,++g.ref,function w(_,M){try{M(function(O){if(_._state===null){if(O===_)throw new TypeError("A promise cannot be resolved with itself.");var U=_._lib&&At();O&&typeof O.then=="function"?w(_,function(V,Z){O instanceof _e?O._then(V,Z):O.then(V,Z)}):(_._state=!0,_._value=O,Qt(_)),U&&Kt()}},Mt.bind(null,_))}catch(O){Mt(_,O)}}(this,m)}var Ot={get:function(){var m=Be,g=Ei;function w(_,M){var O=this,U=!m.global&&(m!==Be||g!==Ei),V=U&&!la(),Z=new _e(function(le,ee){Ue(O,new ft(ju(_,m,U,V),ju(M,m,U,V),le,ee,m))});return this._consoleTask&&(Z._consoleTask=this._consoleTask),Z}return w.prototype=Ct,w},set:function(m){y(this,"then",m&&m.prototype===Ct?Ot:{get:function(){return m},set:Ot.set})}};function ft(m,g,w,_,M){this.onFulfilled=typeof m=="function"?m:null,this.onRejected=typeof g=="function"?g:null,this.resolve=w,this.reject=_,this.psd=M}function Mt(m,g){var w,_;As.push(g),m._state===null&&(w=m._lib&&At(),g=fs(g),m._state=!1,m._value=g,_=m,Zt.some(function(M){return M._value===_._value})||Zt.push(_),Qt(m),w)&&Kt()}function Qt(m){var g=m._listeners;m._listeners=[];for(var w=0,_=g.length;w<_;++w)Ue(m,g[w]);var M=m._PSD;--M.ref||M.finalize(),Qe===0&&(++Qe,Us(function(){--Qe==0&&Ws()},[]))}function Ue(m,g){if(m._state===null)m._listeners.push(g);else{var w=m._state?g.onFulfilled:g.onRejected;if(w===null)return(m._state?g.resolve:g.reject)(m._value);++g.psd.ref,++Qe,Us(pt,[w,m,g])}}function pt(m,g,w){try{var _,M=g._value;!g._state&&As.length&&(As=[]),_=jt&&g._consoleTask?g._consoleTask.run(function(){return m(M)}):m(M),g._state||As.indexOf(M)!==-1||(O=>{for(var U=Zt.length;U;)if(Zt[--U]._value===O._value)return Zt.splice(U,1)})(g),w.resolve(_)}catch(O){w.reject(O)}finally{--Qe==0&&Ws(),--w.psd.ref||w.psd.finalize()}}function gt(){Ta(ws,function(){At()&&Kt()})}function At(){var m=Jt;return ds=Jt=!1,m}function Kt(){var m,g,w;do for(;0<Ar.length;)for(m=Ar,Ar=[],w=m.length,g=0;g<w;++g){var _=m[g];_[0].apply(null,_[1])}while(0<Ar.length);ds=Jt=!0}function Ws(){for(var m=Zt,g=(Zt=[],m.forEach(function(_){_._PSD.onunhandled.call(null,_._value,_)}),bt.slice(0)),w=g.length;w;)g[--w]()}function er(m){return new _e(Ct,!1,m)}function St(m,g){var w=Be;return function(){var _=At(),M=Be;try{return ca(w,!0),m.apply(this,arguments)}catch(O){g&&g(O)}finally{ca(M,!1),_&&Kt()}}}h(_e.prototype,{then:Ot,_then:function(m,g){Ue(this,new ft(null,null,m,g,Be))},catch:function(m){var g,w;return arguments.length===1?this.then(null,m):(g=m,w=arguments[1],typeof g=="function"?this.then(null,function(_){return(_ instanceof g?w:er)(_)}):this.then(null,function(_){return(_&&_.name===g?w:er)(_)}))},finally:function(m){return this.then(function(g){return _e.resolve(m()).then(function(){return g})},function(g){return _e.resolve(m()).then(function(){return er(g)})})},timeout:function(m,g){var w=this;return m<1/0?new _e(function(_,M){var O=setTimeout(function(){return M(new Ne.Timeout(g))},m);w.then(_,M).finally(clearTimeout.bind(null,O))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&y(_e.prototype,Symbol.toStringTag,"Dexie.Promise"),ws.env=yu(),h(_e,{all:function(){var m=se.apply(null,arguments).map(Ii);return new _e(function(g,w){m.length===0&&g([]);var _=m.length;m.forEach(function(M,O){return _e.resolve(M).then(function(U){m[O]=U,--_||g(m)},w)})})},resolve:function(m){return m instanceof _e?m:m&&typeof m.then=="function"?new _e(function(g,w){m.then(g,w)}):new _e(Ct,!0,m)},reject:er,race:function(){var m=se.apply(null,arguments).map(Ii);return new _e(function(g,w){m.map(function(_){return _e.resolve(_).then(g,w)})})},PSD:{get:function(){return Be},set:function(m){return Be=m}},totalEchoes:{get:function(){return Ei}},newPSD:oa,usePSD:Ta,scheduler:{get:function(){return Us},set:function(m){Us=m}},rejectionMapper:{get:function(){return fs},set:function(m){fs=m}},follow:function(m,g){return new _e(function(w,_){return oa(function(M,O){var U=Be;U.unhandleds=[],U.onunhandled=O,U.finalize=yt(function(){var V,Z=this;V=function(){Z.unhandleds.length===0?M():O(Z.unhandleds[0])},bt.push(function le(){V(),bt.splice(bt.indexOf(le),1)}),++Qe,Us(function(){--Qe==0&&Ws()},[])},U.finalize),m()},g,w,_)})}}),ls&&(ls.allSettled&&y(_e,"allSettled",function(){var m=se.apply(null,arguments).map(Ii);return new _e(function(g){m.length===0&&g([]);var w=m.length,_=new Array(w);m.forEach(function(M,O){return _e.resolve(M).then(function(U){return _[O]={status:"fulfilled",value:U}},function(U){return _[O]={status:"rejected",reason:U}}).then(function(){return--w||g(_)})})})}),ls.any&&typeof AggregateError<"u"&&y(_e,"any",function(){var m=se.apply(null,arguments).map(Ii);return new _e(function(g,w){m.length===0&&w(new AggregateError([]));var _=m.length,M=new Array(_);m.forEach(function(O,U){return _e.resolve(O).then(function(V){return g(V)},function(V){M[U]=V,--_||w(new AggregateError(M))})})})}),ls.withResolvers)&&(_e.withResolvers=ls.withResolvers);var Xt={awaits:0,echoes:0,id:0},Wv=0,Ri=[],Di=0,Ei=0,Yv=0;function oa(m,U,w,_){var M=Be,O=Object.create(M),U=(O.parent=M,O.ref=0,O.global=!1,O.id=++Yv,ws.env,O.env=cs?{Promise:_e,PromiseProp:{value:_e,configurable:!0,writable:!0},all:_e.all,race:_e.race,allSettled:_e.allSettled,any:_e.any,resolve:_e.resolve,reject:_e.reject}:{},U&&l(O,U),++M.ref,O.finalize=function(){--this.parent.ref||this.parent.finalize()},Ta(O,m,w,_));return O.ref===0&&O.finalize(),U}function Za(){return Xt.id||(Xt.id=++Wv),++Xt.awaits,Xt.echoes+=Et,Xt.id}function la(){return!!Xt.awaits&&(--Xt.awaits==0&&(Xt.id=0),Xt.echoes=Xt.awaits*Et,!0)}function Ii(m){return Xt.echoes&&m&&m.constructor===ls?(Za(),m.then(function(g){return la(),g},function(g){return la(),Ns(g)})):m}function Gv(){var m=Ri[Ri.length-1];Ri.pop(),ca(m,!1)}function ca(m,g){var w,_,M=Be;(g?!Xt.echoes||Di++&&m===Be:!Di||--Di&&m===Be)||queueMicrotask(g?function(O){++Ei,Xt.echoes&&--Xt.echoes!=0||(Xt.echoes=Xt.awaits=Xt.id=0),Ri.push(Be),ca(O,!0)}.bind(null,m):Gv),m!==Be&&(Be=m,M===ws&&(ws.env=yu()),cs)&&(w=ws.env.Promise,_=m.env,M.global||m.global)&&(Object.defineProperty(i,"Promise",_.PromiseProp),w.all=_.all,w.race=_.race,w.resolve=_.resolve,w.reject=_.reject,_.allSettled&&(w.allSettled=_.allSettled),_.any)&&(w.any=_.any)}function yu(){var m=i.Promise;return cs?{Promise:m,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:m.all,race:m.race,allSettled:m.allSettled,any:m.any,resolve:m.resolve,reject:m.reject}:{}}function Ta(m,g,w,_,M){var O=Be;try{return ca(m,!0),g(w,_,M)}finally{ca(O,!1)}}function ju(m,g,w,_){return typeof m!="function"?m:function(){var M=Be;w&&Za(),ca(g,!0);try{return m.apply(this,arguments)}finally{ca(M,!1),_&&queueMicrotask(la)}}}function vl(m){Promise===ls&&Xt.echoes===0?Di===0?m():enqueueNativeMicroTask(m):setTimeout(m,0)}(""+an).indexOf("[native code]")===-1&&(Za=la=qe);var Ns=_e.reject,Pa="",Gr="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",bu="String expected.",en=[],Oi="__dbnames",yl="readonly",jl="readwrite";function Ma(m,g){return m?g?function(){return m.apply(this,arguments)&&g.apply(this,arguments)}:m:g}var wu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Fi(m){return typeof m!="string"||/\./.test(m)?function(g){return g}:function(g){return g[m]===void 0&&m in g&&delete(g=H(g))[m],g}}function Nu(){throw Ne.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Tt(m,g){try{var w=_u(m),_=_u(g);if(w!==_)return w==="Array"?1:_==="Array"?-1:w==="binary"?1:_==="binary"?-1:w==="string"?1:_==="string"?-1:w==="Date"?1:_!=="Date"?NaN:-1;switch(w){case"number":case"Date":case"string":return g<m?1:m<g?-1:0;case"binary":for(var M=ku(m),O=ku(g),U=M.length,V=O.length,Z=U<V?U:V,le=0;le<Z;++le)if(M[le]!==O[le])return M[le]<O[le]?-1:1;return U===V?0:U<V?-1:1;case"Array":for(var ee=m,X=g,re=ee.length,ae=X.length,te=re<ae?re:ae,J=0;J<te;++J){var de=Tt(ee[J],X[J]);if(de!==0)return de}return re===ae?0:re<ae?-1:1}}catch{}return NaN}function _u(m){var g=typeof m;return g=="object"&&(ArrayBuffer.isView(m)||(g=B(m))==="ArrayBuffer")?"binary":g}function ku(m){return m instanceof Uint8Array?m:ArrayBuffer.isView(m)?new Uint8Array(m.buffer,m.byteOffset,m.byteLength):new Uint8Array(m)}function Li(m,g,w){var _=m.schema.yProps;return _?(g&&0<w.numFailures&&(g=g.filter(function(M,O){return!w.failures[O]})),Promise.all(_.map(function(M){return M=M.updatesTable,g?m.db.table(M).where("k").anyOf(g).delete():m.db.table(M).clear()})).then(function(){return w})):w}Cu.prototype.execute=function(m){var g=this["@@propmod"];if(g.add!==void 0){var w=g.add;if(c(w))return n(n([],c(m)?m:[],!0),w).sort();if(typeof w=="number")return(Number(m)||0)+w;if(typeof w=="bigint")try{return BigInt(m)+w}catch{return BigInt(0)+w}throw new TypeError("Invalid term ".concat(w))}if(g.remove!==void 0){var _=g.remove;if(c(_))return c(m)?m.filter(function(M){return!_.includes(M)}).sort():[];if(typeof _=="number")return Number(m)-_;if(typeof _=="bigint")try{return BigInt(m)-_}catch{return BigInt(0)-_}throw new TypeError("Invalid subtrahend ".concat(_))}return w=(w=g.replacePrefix)==null?void 0:w[0],w&&typeof m=="string"&&m.startsWith(w)?g.replacePrefix[1]+m.substring(w.length):m};var $n=Cu;function Cu(m){this["@@propmod"]=m}function Su(m,g){for(var w=o(g),_=w.length,M=!1,O=0;O<_;++O){var U=w[O],V=g[U],Z=k(m,U);V instanceof $n?(R(m,U,V.execute(Z)),M=!0):Z!==V&&(R(m,U,V),M=!0)}return M}es.prototype._trans=function(m,g,w){var _=this._tx||Be.trans,M=this.name,O=jt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(m==="readonly"?"read":"write"," ").concat(this.name));function U(le,ee,X){if(X.schema[M])return g(X.idbtrans,X);throw new Ne.NotFound("Table "+M+" not part of transaction")}var V=At();try{var Z=_&&_.db._novip===this.db._novip?_===Be.trans?_._promise(m,U,w):oa(function(){return _._promise(m,U,w)},{trans:_,transless:Be.transless||Be}):function le(ee,X,re,ae){if(ee.idbdb&&(ee._state.openComplete||Be.letThrough||ee._vip)){var te=ee._createTransaction(X,re,ee._dbSchema);try{te.create(),ee._state.PR1398_maxLoop=3}catch(J){return J.name===Ye.InvalidState&&ee.isOpen()&&0<--ee._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),ee.close({disableAutoOpen:!1}),ee.open().then(function(){return le(ee,X,re,ae)})):Ns(J)}return te._promise(X,function(J,de){return oa(function(){return Be.trans=te,ae(J,de,te)})}).then(function(J){if(X==="readwrite")try{te.idbtrans.commit()}catch{}return X==="readonly"?J:te._completion.then(function(){return J})})}if(ee._state.openComplete)return Ns(new Ne.DatabaseClosed(ee._state.dbOpenError));if(!ee._state.isBeingOpened){if(!ee._state.autoOpen)return Ns(new Ne.DatabaseClosed);ee.open().catch(qe)}return ee._state.dbReadyPromise.then(function(){return le(ee,X,re,ae)})}(this.db,m,[this.name],U);return O&&(Z._consoleTask=O,Z=Z.catch(function(le){return console.trace(le),Ns(le)})),Z}finally{V&&Kt()}},es.prototype.get=function(m,g){var w=this;return m&&m.constructor===Object?this.where(m).first(g):m==null?Ns(new Ne.Type("Invalid argument to Table.get()")):this._trans("readonly",function(_){return w.core.get({trans:_,key:m}).then(function(M){return w.hook.reading.fire(M)})}).then(g)},es.prototype.where=function(m){if(typeof m=="string")return new this.db.WhereClause(this,m);if(c(m))return new this.db.WhereClause(this,"[".concat(m.join("+"),"]"));var g=o(m);if(g.length===1)return this.where(g[0]).equals(m[g[0]]);var w=this.schema.indexes.concat(this.schema.primKey).filter(function(V){if(V.compound&&g.every(function(le){return 0<=V.keyPath.indexOf(le)})){for(var Z=0;Z<g.length;++Z)if(g.indexOf(V.keyPath[Z])===-1)return!1;return!0}return!1}).sort(function(V,Z){return V.keyPath.length-Z.keyPath.length})[0];if(w&&this.db._maxKey!==Pa)return U=w.keyPath.slice(0,g.length),this.where(U).equals(U.map(function(V){return m[V]}));!w&&jt&&console.warn("The query ".concat(JSON.stringify(m)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(g.join("+"),"]"));var _=this.schema.idxByName;function M(V,Z){return Tt(V,Z)===0}var U=g.reduce(function(ee,Z){var le=ee[0],ee=ee[1],X=_[Z],re=m[Z];return[le||X,le||!X?Ma(ee,X&&X.multi?function(ae){return ae=k(ae,Z),c(ae)&&ae.some(function(te){return M(re,te)})}:function(ae){return M(re,k(ae,Z))}):ee]},[null,null]),O=U[0],U=U[1];return O?this.where(O.name).equals(m[O.keyPath]).filter(U):w?this.filter(U):this.where(g).equals("")},es.prototype.filter=function(m){return this.toCollection().and(m)},es.prototype.count=function(m){return this.toCollection().count(m)},es.prototype.offset=function(m){return this.toCollection().offset(m)},es.prototype.limit=function(m){return this.toCollection().limit(m)},es.prototype.each=function(m){return this.toCollection().each(m)},es.prototype.toArray=function(m){return this.toCollection().toArray(m)},es.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},es.prototype.orderBy=function(m){return new this.db.Collection(new this.db.WhereClause(this,c(m)?"[".concat(m.join("+"),"]"):m))},es.prototype.reverse=function(){return this.toCollection().reverse()},es.prototype.mapToClass=function(m){for(var g=this.db,w=this.name,_=((this.schema.mappedClass=m).prototype instanceof Nu&&(m=(U=>{var V=ee,Z=U;if(typeof Z!="function"&&Z!==null)throw new TypeError("Class extends value "+String(Z)+" is not a constructor or null");function le(){this.constructor=V}function ee(){return U!==null&&U.apply(this,arguments)||this}return r(V,Z),V.prototype=Z===null?Object.create(Z):(le.prototype=Z.prototype,new le),Object.defineProperty(ee.prototype,"db",{get:function(){return g},enumerable:!1,configurable:!0}),ee.prototype.table=function(){return w},ee})(m)),new Set),M=m.prototype;M;M=u(M))Object.getOwnPropertyNames(M).forEach(function(U){return _.add(U)});function O(U){if(!U)return U;var V,Z=Object.create(m.prototype);for(V in U)if(!_.has(V))try{Z[V]=U[V]}catch{}return Z}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=O,this.hook("reading",O),m},es.prototype.defineClass=function(){return this.mapToClass(function(m){l(this,m)})},es.prototype.add=function(m,g){var w=this,_=this.schema.primKey,M=_.auto,O=_.keyPath,U=m;return O&&M&&(U=Fi(O)(m)),this._trans("readwrite",function(V){return w.core.mutate({trans:V,type:"add",keys:g!=null?[g]:null,values:[U]})}).then(function(V){return V.numFailures?_e.reject(V.failures[0]):V.lastResult}).then(function(V){if(O)try{R(m,O,V)}catch{}return V})},es.prototype.upsert=function(m,g){var w=this,_=this.schema.primKey.keyPath;return this._trans("readwrite",function(M){return w.core.get({trans:M,key:m}).then(function(O){var U=O??{};return Su(U,g),_&&R(U,_,m),w.core.mutate({trans:M,type:"put",values:[U],keys:[m],upsert:!0,updates:{keys:[m],changeSpecs:[g]}}).then(function(V){return V.numFailures?_e.reject(V.failures[0]):!!O})})})},es.prototype.update=function(m,g){return typeof m!="object"||c(m)?this.where(":id").equals(m).modify(g):(m=k(m,this.schema.primKey.keyPath))===void 0?Ns(new Ne.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(m).modify(g)},es.prototype.put=function(m,g){var w=this,_=this.schema.primKey,M=_.auto,O=_.keyPath,U=m;return O&&M&&(U=Fi(O)(m)),this._trans("readwrite",function(V){return w.core.mutate({trans:V,type:"put",values:[U],keys:g!=null?[g]:null})}).then(function(V){return V.numFailures?_e.reject(V.failures[0]):V.lastResult}).then(function(V){if(O)try{R(m,O,V)}catch{}return V})},es.prototype.delete=function(m){var g=this;return this._trans("readwrite",function(w){return g.core.mutate({trans:w,type:"delete",keys:[m]}).then(function(_){return Li(g,[m],_)}).then(function(_){return _.numFailures?_e.reject(_.failures[0]):void 0})})},es.prototype.clear=function(){var m=this;return this._trans("readwrite",function(g){return m.core.mutate({trans:g,type:"deleteRange",range:wu}).then(function(w){return Li(m,null,w)})}).then(function(g){return g.numFailures?_e.reject(g.failures[0]):void 0})},es.prototype.bulkGet=function(m){var g=this;return this._trans("readonly",function(w){return g.core.getMany({keys:m,trans:w}).then(function(_){return _.map(function(M){return g.hook.reading.fire(M)})})})},es.prototype.bulkAdd=function(m,g,w){var _=this,M=Array.isArray(g)?g:void 0,O=(w=w||(M?void 0:g))?w.allKeys:void 0;return this._trans("readwrite",function(U){var V=_.schema.primKey,le=V.auto,V=V.keyPath;if(V&&M)throw new Ne.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(M&&M.length!==m.length)throw new Ne.InvalidArgument("Arguments objects and keys must have the same length");var Z=m.length,le=V&&le?m.map(Fi(V)):m;return _.core.mutate({trans:U,type:"add",keys:M,values:le,wantResults:O}).then(function(ee){var X=ee.numFailures,re=ee.failures;if(X===0)return O?ee.results:ee.lastResult;throw new Ae("".concat(_.name,".bulkAdd(): ").concat(X," of ").concat(Z," operations failed"),re)})})},es.prototype.bulkPut=function(m,g,w){var _=this,M=Array.isArray(g)?g:void 0,O=(w=w||(M?void 0:g))?w.allKeys:void 0;return this._trans("readwrite",function(U){var V=_.schema.primKey,le=V.auto,V=V.keyPath;if(V&&M)throw new Ne.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(M&&M.length!==m.length)throw new Ne.InvalidArgument("Arguments objects and keys must have the same length");var Z=m.length,le=V&&le?m.map(Fi(V)):m;return _.core.mutate({trans:U,type:"put",keys:M,values:le,wantResults:O}).then(function(ee){var X=ee.numFailures,re=ee.failures;if(X===0)return O?ee.results:ee.lastResult;throw new Ae("".concat(_.name,".bulkPut(): ").concat(X," of ").concat(Z," operations failed"),re)})})},es.prototype.bulkUpdate=function(m){var g=this,w=this.core,_=m.map(function(U){return U.key}),M=m.map(function(U){return U.changes}),O=[];return this._trans("readwrite",function(U){return w.getMany({trans:U,keys:_,cache:"clone"}).then(function(V){var Z=[],le=[],ee=(m.forEach(function(X,re){var ae=X.key,te=X.changes,J=V[re];if(J){for(var de=0,pe=Object.keys(te);de<pe.length;de++){var oe=pe[de],ye=te[oe];if(oe===g.schema.primKey.keyPath){if(Tt(ye,ae)!==0)throw new Ne.Constraint("Cannot update primary key in bulkUpdate()")}else R(J,oe,ye)}O.push(re),Z.push(ae),le.push(J)}}),Z.length);return w.mutate({trans:U,type:"put",keys:Z,values:le,updates:{keys:_,changeSpecs:M}}).then(function(X){var re=X.numFailures,ae=X.failures;if(re===0)return ee;for(var te=0,J=Object.keys(ae);te<J.length;te++){var de,pe=J[te],oe=O[Number(pe)];oe!=null&&(de=ae[pe],delete ae[pe],ae[oe]=de)}throw new Ae("".concat(g.name,".bulkUpdate(): ").concat(re," of ").concat(ee," operations failed"),ae)})})})},es.prototype.bulkDelete=function(m){var g=this,w=m.length;return this._trans("readwrite",function(_){return g.core.mutate({trans:_,type:"delete",keys:m}).then(function(M){return Li(g,m,M)})}).then(function(_){var M=_.numFailures,O=_.failures;if(M===0)return _.lastResult;throw new Ae("".concat(g.name,".bulkDelete(): ").concat(M," of ").concat(w," operations failed"),O)})};var Au=es;function es(){}function Un(m){function g(U,V){if(V){for(var Z=arguments.length,le=new Array(Z-1);--Z;)le[Z-1]=arguments[Z];return w[U].subscribe.apply(null,le),m}if(typeof U=="string")return w[U]}var w={};g.addEventType=O;for(var _=1,M=arguments.length;_<M;++_)O(arguments[_]);return g;function O(U,V,Z){var le,ee;if(typeof U!="object")return V=V||Gt,ee={subscribers:[],fire:Z=Z||qe,subscribe:function(X){ee.subscribers.indexOf(X)===-1&&(ee.subscribers.push(X),ee.fire=V(ee.fire,X))},unsubscribe:function(X){ee.subscribers=ee.subscribers.filter(function(re){return re!==X}),ee.fire=ee.subscribers.reduce(V,Z)}},w[U]=g[U]=ee;o(le=U).forEach(function(X){var re=le[X];if(c(re))O(X,le[X][0],le[X][1]);else{if(re!=="asap")throw new Ne.InvalidArgument("Invalid event config");var ae=O(X,Ke,function(){for(var te=arguments.length,J=new Array(te);te--;)J[te]=arguments[te];ae.subscribers.forEach(function(de){I(function(){de.apply(null,J)})})})}})}}function Hn(m,g){return v(g).from({prototype:m}),g}function tn(m,g){return!(m.filter||m.algorithm||m.or)&&(g?m.justLimit:!m.replayFilter)}function bl(m,g){m.filter=Ma(m.filter,g)}function wl(m,g,w){var _=m.replayFilter;m.replayFilter=_?function(){return Ma(_(),g())}:g,m.justLimit=w&&!_}function qi(m,g){if(m.isPrimKey)return g.primaryKey;var w=g.getIndexByKeyPath(m.index);if(w)return w;throw new Ne.Schema("KeyPath "+m.index+" on object store "+g.name+" is not indexed")}function Tu(m,g,w){var _=qi(m,g.schema);return g.openCursor({trans:w,values:!m.keysOnly,reverse:m.dir==="prev",unique:!!m.unique,query:{index:_,range:m.range}})}function zi(m,g,w,_){var M,O,U=m.replayFilter?Ma(m.filter,m.replayFilter()):m.filter;return m.or?(M={},O=function(V,Z,le){var ee,X;U&&!U(Z,le,function(re){return Z.stop(re)},function(re){return Z.fail(re)})||((X=""+(ee=Z.primaryKey))=="[object ArrayBuffer]"&&(X=""+new Uint8Array(ee)),p(M,X))||(M[X]=!0,g(V,Z,le))},Promise.all([m.or._iterate(O,w),Pu(Tu(m,_,w),m.algorithm,O,!m.keysOnly&&m.valueMapper)])):Pu(Tu(m,_,w),Ma(m.algorithm,U),g,!m.keysOnly&&m.valueMapper)}function Pu(m,g,w,_){var M=St(_?function(O,U,V){return w(_(O),U,V)}:w);return m.then(function(O){if(O)return O.start(function(){var U=function(){return O.continue()};g&&!g(O,function(V){return U=V},function(V){O.stop(V),U=qe},function(V){O.fail(V),U=qe})||M(O.value,O,function(V){return U=V}),U()})})}Ft.prototype._read=function(m,g){var w=this._ctx;return w.error?w.table._trans(null,Ns.bind(null,w.error)):w.table._trans("readonly",m).then(g)},Ft.prototype._write=function(m){var g=this._ctx;return g.error?g.table._trans(null,Ns.bind(null,g.error)):g.table._trans("readwrite",m,"locked")},Ft.prototype._addAlgorithm=function(m){var g=this._ctx;g.algorithm=Ma(g.algorithm,m)},Ft.prototype._iterate=function(m,g){return zi(this._ctx,m,g,this._ctx.table.core)},Ft.prototype.clone=function(m){var g=Object.create(this.constructor.prototype),w=Object.create(this._ctx);return m&&l(w,m),g._ctx=w,g},Ft.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ft.prototype.each=function(m){var g=this._ctx;return this._read(function(w){return zi(g,m,w,g.table.core)})},Ft.prototype.count=function(m){var g=this;return this._read(function(w){var _,M=g._ctx,O=M.table.core;return tn(M,!0)?O.count({trans:w,query:{index:qi(M,O.schema),range:M.range}}).then(function(U){return Math.min(U,M.limit)}):(_=0,zi(M,function(){return++_,!1},w,O).then(function(){return _}))}).then(m)},Ft.prototype.sortBy=function(m,g){var w=m.split(".").reverse(),_=w[0],M=w.length-1;function O(Z,le){return le?O(Z[w[le]],le-1):Z[_]}var U=this._ctx.dir==="next"?1:-1;function V(Z,le){return Tt(O(Z,M),O(le,M))*U}return this.toArray(function(Z){return Z.sort(V)}).then(g)},Ft.prototype.toArray=function(m){var g=this;return this._read(function(w){var _,M,O,U=g._ctx;return U.dir==="next"&&tn(U,!0)&&0<U.limit?(_=U.valueMapper,M=qi(U,U.table.core.schema),U.table.core.query({trans:w,limit:U.limit,values:!0,query:{index:M,range:U.range}}).then(function(V){return V=V.result,_?V.map(_):V})):(O=[],zi(U,function(V){return O.push(V)},w,U.table.core).then(function(){return O}))},m)},Ft.prototype.offset=function(m){var g=this._ctx;return m<=0||(g.offset+=m,tn(g)?wl(g,function(){var w=m;return function(_,M){return w===0||(w===1?--w:M(function(){_.advance(w),w=0}),!1)}}):wl(g,function(){var w=m;return function(){return--w<0}})),this},Ft.prototype.limit=function(m){return this._ctx.limit=Math.min(this._ctx.limit,m),wl(this._ctx,function(){var g=m;return function(w,_,M){return--g<=0&&_(M),0<=g}},!0),this},Ft.prototype.until=function(m,g){return bl(this._ctx,function(w,_,M){return!m(w.value)||(_(M),g)}),this},Ft.prototype.first=function(m){return this.limit(1).toArray(function(g){return g[0]}).then(m)},Ft.prototype.last=function(m){return this.reverse().first(m)},Ft.prototype.filter=function(m){var g;return bl(this._ctx,function(w){return m(w.value)}),(g=this._ctx).isMatch=Ma(g.isMatch,m),this},Ft.prototype.and=function(m){return this.filter(m)},Ft.prototype.or=function(m){return new this.db.WhereClause(this._ctx.table,m,this)},Ft.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ft.prototype.desc=function(){return this.reverse()},Ft.prototype.eachKey=function(m){var g=this._ctx;return g.keysOnly=!g.isMatch,this.each(function(w,_){m(_.key,_)})},Ft.prototype.eachUniqueKey=function(m){return this._ctx.unique="unique",this.eachKey(m)},Ft.prototype.eachPrimaryKey=function(m){var g=this._ctx;return g.keysOnly=!g.isMatch,this.each(function(w,_){m(_.primaryKey,_)})},Ft.prototype.keys=function(m){var g=this._ctx,w=(g.keysOnly=!g.isMatch,[]);return this.each(function(_,M){w.push(M.key)}).then(function(){return w}).then(m)},Ft.prototype.primaryKeys=function(m){var g=this._ctx;if(g.dir==="next"&&tn(g,!0)&&0<g.limit)return this._read(function(_){var M=qi(g,g.table.core.schema);return g.table.core.query({trans:_,values:!1,limit:g.limit,query:{index:M,range:g.range}})}).then(function(_){return _.result}).then(m);g.keysOnly=!g.isMatch;var w=[];return this.each(function(_,M){w.push(M.primaryKey)}).then(function(){return w}).then(m)},Ft.prototype.uniqueKeys=function(m){return this._ctx.unique="unique",this.keys(m)},Ft.prototype.firstKey=function(m){return this.limit(1).keys(function(g){return g[0]}).then(m)},Ft.prototype.lastKey=function(m){return this.reverse().firstKey(m)},Ft.prototype.distinct=function(){var m,g=this._ctx,g=g.index&&g.table.schema.idxByName[g.index];return g&&g.multi&&(m={},bl(this._ctx,function(_){var _=_.primaryKey.toString(),M=p(m,_);return m[_]=!0,!M})),this},Ft.prototype.modify=function(m){var g=this,w=this._ctx;return this._write(function(_){function M(J,de){var pe=de.failures;re+=J-de.numFailures;for(var oe=0,ye=o(pe);oe<ye.length;oe++){var Te=ye[oe];X.push(pe[Te])}}var O=typeof m=="function"?m:function(J){return Su(J,m)},U=w.table.core,ee=U.schema.primaryKey,V=ee.outbound,Z=ee.extractKey,le=200,ee=g.db._options.modifyChunkSize,X=(ee&&(le=typeof ee=="object"?ee[U.name]||ee["*"]||200:ee),[]),re=0,ae=[],te=m===Mu;return g.clone().primaryKeys().then(function(J){function de(oe){var ye=Math.min(le,J.length-oe),Te=J.slice(oe,oe+ye);return(te?Promise.resolve([]):U.getMany({trans:_,keys:Te,cache:"immutable"})).then(function(Ee){var Ie=[],Pe=[],$e=V?[]:null,ze=te?Te:[];if(!te)for(var Me=0;Me<ye;++Me){var Ve=Ee[Me],Rt={value:H(Ve),primKey:J[oe+Me]};O.call(Rt,Rt.value,Rt)!==!1&&(Rt.value==null?ze.push(J[oe+Me]):V||Tt(Z(Ve),Z(Rt.value))===0?(Pe.push(Rt.value),V&&$e.push(J[oe+Me])):(ze.push(J[oe+Me]),Ie.push(Rt.value)))}return Promise.resolve(0<Ie.length&&U.mutate({trans:_,type:"add",values:Ie}).then(function(Lt){for(var at in Lt.failures)ze.splice(parseInt(at),1);M(Ie.length,Lt)})).then(function(){return(0<Pe.length||pe&&typeof m=="object")&&U.mutate({trans:_,type:"put",keys:$e,values:Pe,criteria:pe,changeSpec:typeof m!="function"&&m,isAdditionalChunk:0<oe}).then(function(Lt){return M(Pe.length,Lt)})}).then(function(){return(0<ze.length||pe&&te)&&U.mutate({trans:_,type:"delete",keys:ze,criteria:pe,isAdditionalChunk:0<oe}).then(function(Lt){return Li(w.table,ze,Lt)}).then(function(Lt){return M(ze.length,Lt)})}).then(function(){return J.length>oe+ye&&de(oe+le)})})}var pe=tn(w)&&w.limit===1/0&&(typeof m!="function"||te)&&{index:w.index,range:w.range};return de(0).then(function(){if(0<X.length)throw new He("Error modifying one or more objects",X,re,ae);return J.length})})})},Ft.prototype.delete=function(){var m=this._ctx,g=m.range;return!tn(m)||m.table.schema.yProps||!m.isPrimKey&&g.type!==3?this.modify(Mu):this._write(function(w){var _=m.table.core.schema.primaryKey,M=g;return m.table.core.count({trans:w,query:{index:_,range:M}}).then(function(O){return m.table.core.mutate({trans:w,type:"deleteRange",range:M}).then(function(Z){var V=Z.failures,Z=Z.numFailures;if(Z)throw new He("Could not delete some values",Object.keys(V).map(function(le){return V[le]}),O-Z);return O-Z})})})};var Qv=Ft;function Ft(){}var Mu=function(m,g){return g.value=null};function Xv(m,g){return m<g?-1:m===g?0:1}function Jv(m,g){return g<m?-1:m===g?0:1}function gr(m,g,w){return m=m instanceof Du?new m.Collection(m):m,m._ctx.error=new(w||TypeError)(g),m}function sn(m){return new m.Collection(m,function(){return Ru("")}).limit(0)}function Bi(ae,g,w,_){var M,O,U,V,Z,le,ee,X=w.length;if(!w.every(function(J){return typeof J=="string"}))return gr(ae,bu);function re(J){M=J==="next"?function(pe){return pe.toUpperCase()}:function(pe){return pe.toLowerCase()},O=J==="next"?function(pe){return pe.toLowerCase()}:function(pe){return pe.toUpperCase()},U=J==="next"?Xv:Jv;var de=w.map(function(pe){return{lower:O(pe),upper:M(pe)}}).sort(function(pe,oe){return U(pe.lower,oe.lower)});V=de.map(function(pe){return pe.upper}),Z=de.map(function(pe){return pe.lower}),ee=(le=J)==="next"?"":_}re("next");var ae=new ae.Collection(ae,function(){return da(V[0],Z[X-1]+_)}),te=(ae._ondirectionchange=function(J){re(J)},0);return ae._addAlgorithm(function(J,de,pe){var oe=J.key;if(typeof oe=="string"){var ye=O(oe);if(g(ye,Z,te))return!0;for(var Te=null,Ee=te;Ee<X;++Ee){var Ie=((Pe,$e,ze,Me,Ve,Rt)=>{for(var Lt=Math.min(Pe.length,Me.length),at=-1,wt=0;wt<Lt;++wt){var xs=$e[wt];if(xs!==Me[wt])return Ve(Pe[wt],ze[wt])<0?Pe.substr(0,wt)+ze[wt]+ze.substr(wt+1):Ve(Pe[wt],Me[wt])<0?Pe.substr(0,wt)+Me[wt]+ze.substr(wt+1):0<=at?Pe.substr(0,at)+$e[at]+ze.substr(at+1):null;Ve(Pe[wt],xs)<0&&(at=wt)}return Lt<Me.length&&Rt==="next"?Pe+ze.substr(Pe.length):Lt<Pe.length&&Rt==="prev"?Pe.substr(0,ze.length):at<0?null:Pe.substr(0,at)+Me[at]+ze.substr(at+1)})(oe,ye,V[Ee],Z[Ee],U,le);Ie===null&&Te===null?te=Ee+1:(Te===null||0<U(Te,Ie))&&(Te=Ie)}de(Te!==null?function(){J.continue(Te+ee)}:pe)}return!1}),ae}function da(m,g,w,_){return{type:2,lower:m,upper:g,lowerOpen:w,upperOpen:_}}function Ru(m){return{type:1,lower:m,upper:m}}Object.defineProperty(Hs.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Hs.prototype.between=function(m,g,w,_){w=w!==!1,_=_===!0;try{return 0<this._cmp(m,g)||this._cmp(m,g)===0&&(w||_)&&(!w||!_)?sn(this):new this.Collection(this,function(){return da(m,g,!w,!_)})}catch{return gr(this,Gr)}},Hs.prototype.equals=function(m){return m==null?gr(this,Gr):new this.Collection(this,function(){return Ru(m)})},Hs.prototype.above=function(m){return m==null?gr(this,Gr):new this.Collection(this,function(){return da(m,void 0,!0)})},Hs.prototype.aboveOrEqual=function(m){return m==null?gr(this,Gr):new this.Collection(this,function(){return da(m,void 0,!1)})},Hs.prototype.below=function(m){return m==null?gr(this,Gr):new this.Collection(this,function(){return da(void 0,m,!1,!0)})},Hs.prototype.belowOrEqual=function(m){return m==null?gr(this,Gr):new this.Collection(this,function(){return da(void 0,m)})},Hs.prototype.startsWith=function(m){return typeof m!="string"?gr(this,bu):this.between(m,m+Pa,!0,!0)},Hs.prototype.startsWithIgnoreCase=function(m){return m===""?this.startsWith(m):Bi(this,function(g,w){return g.indexOf(w[0])===0},[m],Pa)},Hs.prototype.equalsIgnoreCase=function(m){return Bi(this,function(g,w){return g===w[0]},[m],"")},Hs.prototype.anyOfIgnoreCase=function(){var m=se.apply($,arguments);return m.length===0?sn(this):Bi(this,function(g,w){return w.indexOf(g)!==-1},m,"")},Hs.prototype.startsWithAnyOfIgnoreCase=function(){var m=se.apply($,arguments);return m.length===0?sn(this):Bi(this,function(g,w){return w.some(function(_){return g.indexOf(_)===0})},m,Pa)},Hs.prototype.anyOf=function(){var m,g,w=this,_=se.apply($,arguments),M=this._cmp;try{_.sort(M)}catch{return gr(this,Gr)}return _.length===0?sn(this):((m=new this.Collection(this,function(){return da(_[0],_[_.length-1])}))._ondirectionchange=function(O){M=O==="next"?w._ascending:w._descending,_.sort(M)},g=0,m._addAlgorithm(function(O,U,V){for(var Z=O.key;0<M(Z,_[g]);)if(++g===_.length)return U(V),!1;return M(Z,_[g])===0||(U(function(){O.continue(_[g])}),!1)}),m)},Hs.prototype.notEqual=function(m){return this.inAnyRange([[-1/0,m],[m,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Hs.prototype.noneOf=function(){var m=se.apply($,arguments);if(m.length===0)return new this.Collection(this);try{m.sort(this._ascending)}catch{return gr(this,Gr)}var g=m.reduce(function(w,_){return w?w.concat([[w[w.length-1][1],_]]):[[-1/0,_]]},null);return g.push([m[m.length-1],this.db._maxKey]),this.inAnyRange(g,{includeLowers:!1,includeUppers:!1})},Hs.prototype.inAnyRange=function(m,pe){var w=this,_=this._cmp,M=this._ascending,O=this._descending,U=this._min,V=this._max;if(m.length===0)return sn(this);if(!m.every(function(oe){return oe[0]!==void 0&&oe[1]!==void 0&&M(oe[0],oe[1])<=0}))return gr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Ne.InvalidArgument);var Z=!pe||pe.includeLowers!==!1,le=pe&&pe.includeUppers===!0,ee,X=M;function re(oe,ye){return X(oe[0],ye[0])}try{(ee=m.reduce(function(oe,ye){for(var Te=0,Ee=oe.length;Te<Ee;++Te){var Ie=oe[Te];if(_(ye[0],Ie[1])<0&&0<_(ye[1],Ie[0])){Ie[0]=U(Ie[0],ye[0]),Ie[1]=V(Ie[1],ye[1]);break}}return Te===Ee&&oe.push(ye),oe},[])).sort(re)}catch{return gr(this,Gr)}var ae=0,te=le?function(oe){return 0<M(oe,ee[ae][1])}:function(oe){return 0<=M(oe,ee[ae][1])},J=Z?function(oe){return 0<O(oe,ee[ae][0])}:function(oe){return 0<=O(oe,ee[ae][0])},de=te,pe=new this.Collection(this,function(){return da(ee[0][0],ee[ee.length-1][1],!Z,!le)});return pe._ondirectionchange=function(oe){X=oe==="next"?(de=te,M):(de=J,O),ee.sort(re)},pe._addAlgorithm(function(oe,ye,Te){for(var Ee,Ie=oe.key;de(Ie);)if(++ae===ee.length)return ye(Te),!1;return!te(Ee=Ie)&&!J(Ee)||(w._cmp(Ie,ee[ae][1])===0||w._cmp(Ie,ee[ae][0])===0||ye(function(){X===M?oe.continue(ee[ae][0]):oe.continue(ee[ae][1])}),!1)}),pe},Hs.prototype.startsWithAnyOf=function(){var m=se.apply($,arguments);return m.every(function(g){return typeof g=="string"})?m.length===0?sn(this):this.inAnyRange(m.map(function(g){return[g,g+Pa]})):gr(this,"startsWithAnyOf() only works with strings")};var Du=Hs;function Hs(){}function zr(m){return St(function(g){return Vn(g),m(g.target.error),!1})}function Vn(m){m.stopPropagation&&m.stopPropagation(),m.preventDefault&&m.preventDefault()}var Kn="storagemutated",Nl="x-storagemutated-1",ua=Un(null,Kn),Zv=(Br.prototype._lock=function(){return C(!Be.global),++this._reculock,this._reculock!==1||Be.global||(Be.lockOwnerFor=this),this},Br.prototype._unlock=function(){if(C(!Be.global),--this._reculock==0)for(Be.global||(Be.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var m=this._blockedFuncs.shift();try{Ta(m[1],m[0])}catch{}}return this},Br.prototype._locked=function(){return this._reculock&&Be.lockOwnerFor!==this},Br.prototype.create=function(m){var g=this;if(this.mode){var w=this.db.idbdb,_=this.db._state.dbOpenError;if(C(!this.idbtrans),!m&&!w)switch(_&&_.name){case"DatabaseClosedError":throw new Ne.DatabaseClosed(_);case"MissingAPIError":throw new Ne.MissingAPI(_.message,_);default:throw new Ne.OpenFailed(_)}if(!this.active)throw new Ne.TransactionInactive;C(this._completion._state===null),(m=this.idbtrans=m||(this.db.core||w).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=St(function(M){Vn(M),g._reject(m.error)}),m.onabort=St(function(M){Vn(M),g.active&&g._reject(new Ne.Abort(m.error)),g.active=!1,g.on("abort").fire(M)}),m.oncomplete=St(function(){g.active=!1,g._resolve(),"mutatedParts"in m&&ua.storagemutated.fire(m.mutatedParts)})}return this},Br.prototype._promise=function(m,g,w){var _,M=this;return m==="readwrite"&&this.mode!=="readwrite"?Ns(new Ne.ReadOnly("Transaction is readonly")):this.active?this._locked()?new _e(function(O,U){M._blockedFuncs.push([function(){M._promise(m,g,w).then(O,U)},Be])}):w?oa(function(){var O=new _e(function(U,V){M._lock();var Z=g(U,V,M);Z&&Z.then&&Z.then(U,V)});return O.finally(function(){return M._unlock()}),O._lib=!0,O}):((_=new _e(function(O,U){var V=g(O,U,M);V&&V.then&&V.then(O,U)}))._lib=!0,_):Ns(new Ne.TransactionInactive)},Br.prototype._root=function(){return this.parent?this.parent._root():this},Br.prototype.waitFor=function(m){var g,w=this._root(),_=_e.resolve(m),M=(w._waitingFor?w._waitingFor=w._waitingFor.then(function(){return _}):(w._waitingFor=_,w._waitingQueue=[],g=w.idbtrans.objectStore(w.storeNames[0]),function O(){for(++w._spinCount;w._waitingQueue.length;)w._waitingQueue.shift()();w._waitingFor&&(g.get(-1/0).onsuccess=O)}()),w._waitingFor);return new _e(function(O,U){_.then(function(V){return w._waitingQueue.push(St(O.bind(null,V)))},function(V){return w._waitingQueue.push(St(U.bind(null,V)))}).finally(function(){w._waitingFor===M&&(w._waitingFor=null)})})},Br.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Ne.Abort))},Br.prototype.table=function(m){var g=this._memoizedTables||(this._memoizedTables={});if(p(g,m))return g[m];var w=this.schema[m];if(w)return(w=new this.db.Table(m,w,this)).core=this.db.core.table(m),g[m]=w;throw new Ne.NotFound("Table "+m+" not part of transaction")},Br);function Br(){}function _l(m,g,w,_,M,O,U,V){return{name:m,keyPath:g,unique:w,multi:_,auto:M,compound:O,src:(w&&!U?"&":"")+(_?"*":"")+(M?"++":"")+Eu(g),type:V}}function Eu(m){return typeof m=="string"?m:m?"["+[].join.call(m,"+")+"]":""}function kl(m,g,w){return{name:m,primKey:g,indexes:w,mappedClass:null,idxByName:(_=function(M){return[M.name,M]},w.reduce(function(M,O,U){return O=_(O,U),O&&(M[O[0]]=O[1]),M},{}))};var _}var Wn=function(m){try{return m.only([[]]),Wn=function(){return[[]]},[[]]}catch{return Wn=function(){return Pa},Pa}};function Cl(m){return m==null?function(){}:typeof m=="string"?(g=m).split(".").length===1?function(w){return w[g]}:function(w){return k(w,g)}:function(w){return k(w,m)};var g}function Iu(m){return[].slice.call(m)}var ey=0;function Yn(m){return m==null?":id":typeof m=="string"?m:"[".concat(m.join("+"),"]")}function ty(m,g,Z){function _(te){if(te.type===3)return null;if(te.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var X=te.lower,re=te.upper,ae=te.lowerOpen,te=te.upperOpen;return X===void 0?re===void 0?null:g.upperBound(re,!!te):re===void 0?g.lowerBound(X,!!ae):g.bound(X,re,!!ae,!!te)}function M(ee){var X,re=ee.name;return{name:re,schema:ee,mutate:function(ae){var te=ae.trans,J=ae.type,de=ae.keys,pe=ae.values,oe=ae.range;return new Promise(function(ye,Te){ye=St(ye);var Ee=te.objectStore(re),Ie=Ee.keyPath==null,Pe=J==="put"||J==="add";if(!Pe&&J!=="delete"&&J!=="deleteRange")throw new Error("Invalid operation type: "+J);var $e,ze=(de||pe||{length:1}).length;if(de&&pe&&de.length!==pe.length)throw new Error("Given keys array must have same length as given values array.");if(ze===0)return ye({numFailures:0,failures:{},results:[],lastResult:void 0});function Me(js){++Lt,Vn(js)}var Ve=[],Rt=[],Lt=0;if(J==="deleteRange"){if(oe.type===4)return ye({numFailures:Lt,failures:Rt,results:[],lastResult:void 0});oe.type===3?Ve.push($e=Ee.clear()):Ve.push($e=Ee.delete(_(oe)))}else{var Ie=Pe?Ie?[pe,de]:[pe,null]:[de,null],at=Ie[0],wt=Ie[1];if(Pe)for(var xs=0;xs<ze;++xs)Ve.push($e=wt&&wt[xs]!==void 0?Ee[J](at[xs],wt[xs]):Ee[J](at[xs])),$e.onerror=Me;else for(xs=0;xs<ze;++xs)Ve.push($e=Ee[J](at[xs])),$e.onerror=Me}function Nr(js){js=js.target.result,Ve.forEach(function(Ea,Hl){return Ea.error!=null&&(Rt[Hl]=Ea.error)}),ye({numFailures:Lt,failures:Rt,results:J==="delete"?de:Ve.map(function(Ea){return Ea.result}),lastResult:js})}$e.onerror=function(js){Me(js),Nr(js)},$e.onsuccess=Nr})},getMany:function(ae){var te=ae.trans,J=ae.keys;return new Promise(function(de,pe){de=St(de);for(var oe,ye=te.objectStore(re),Te=J.length,Ee=new Array(Te),Ie=0,Pe=0,$e=function(Ve){Ve=Ve.target,Ee[Ve._pos]=Ve.result,++Pe===Ie&&de(Ee)},ze=zr(pe),Me=0;Me<Te;++Me)J[Me]!=null&&((oe=ye.get(J[Me]))._pos=Me,oe.onsuccess=$e,oe.onerror=ze,++Ie);Ie===0&&de(Ee)})},get:function(ae){var te=ae.trans,J=ae.key;return new Promise(function(de,pe){de=St(de);var oe=te.objectStore(re).get(J);oe.onsuccess=function(ye){return de(ye.target.result)},oe.onerror=zr(pe)})},query:(X=V,function(ae){return new Promise(function(te,J){te=St(te);var de,pe,oe,Pe=ae.trans,ye=ae.values,Te=ae.limit,Ie=ae.query,Ee=Te===1/0?void 0:Te,$e=Ie.index,Ie=Ie.range,Pe=Pe.objectStore(re),Pe=$e.isPrimaryKey?Pe:Pe.index($e.name),$e=_(Ie);if(Te===0)return te({result:[]});X?((Ie=ye?Pe.getAll($e,Ee):Pe.getAllKeys($e,Ee)).onsuccess=function(ze){return te({result:ze.target.result})},Ie.onerror=zr(J)):(de=0,pe=!ye&&"openKeyCursor"in Pe?Pe.openKeyCursor($e):Pe.openCursor($e),oe=[],pe.onsuccess=function(ze){var Me=pe.result;return!Me||(oe.push(ye?Me.value:Me.primaryKey),++de===Te)?te({result:oe}):void Me.continue()},pe.onerror=zr(J))})}),openCursor:function(ae){var te=ae.trans,J=ae.values,de=ae.query,pe=ae.reverse,oe=ae.unique;return new Promise(function(ye,Te){ye=St(ye);var Pe=de.index,Ee=de.range,Ie=te.objectStore(re),Ie=Pe.isPrimaryKey?Ie:Ie.index(Pe.name),Pe=pe?oe?"prevunique":"prev":oe?"nextunique":"next",$e=!J&&"openKeyCursor"in Ie?Ie.openKeyCursor(_(Ee),Pe):Ie.openCursor(_(Ee),Pe);$e.onerror=zr(Te),$e.onsuccess=St(function(ze){var Me,Ve,Rt,Lt,at=$e.result;at?(at.___id=++ey,at.done=!1,Me=at.continue.bind(at),Ve=(Ve=at.continuePrimaryKey)&&Ve.bind(at),Rt=at.advance.bind(at),Lt=function(){throw new Error("Cursor not stopped")},at.trans=te,at.stop=at.continue=at.continuePrimaryKey=at.advance=function(){throw new Error("Cursor not started")},at.fail=St(Te),at.next=function(){var wt=this,xs=1;return this.start(function(){return xs--?wt.continue():wt.stop()}).then(function(){return wt})},at.start=function(wt){function xs(){if($e.result)try{wt()}catch(js){at.fail(js)}else at.done=!0,at.start=function(){throw new Error("Cursor behind last entry")},at.stop()}var Nr=new Promise(function(js,Ea){js=St(js),$e.onerror=zr(Ea),at.fail=Ea,at.stop=function(Hl){at.stop=at.continue=at.continuePrimaryKey=at.advance=Lt,js(Hl)}});return $e.onsuccess=St(function(js){$e.onsuccess=xs,xs()}),at.continue=Me,at.continuePrimaryKey=Ve,at.advance=Rt,xs(),Nr},ye(at)):ye(null)},Te)})},count:function(ae){var te=ae.query,J=ae.trans,de=te.index,pe=te.range;return new Promise(function(oe,ye){var Te=J.objectStore(re),Te=de.isPrimaryKey?Te:Te.index(de.name),Ee=_(pe),Ee=Ee?Te.count(Ee):Te.count();Ee.onsuccess=St(function(Ie){return oe(Ie.target.result)}),Ee.onerror=zr(ye)})}}}O=Z,U=Iu((Z=m).objectStoreNames);var O,Z={schema:{name:Z.name,tables:U.map(function(ee){return O.objectStore(ee)}).map(function(ee){var X=ee.keyPath,re=ee.autoIncrement,te=c(X),ae={},te={name:ee.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:X==null,compound:te,keyPath:X,autoIncrement:re,unique:!0,extractKey:Cl(X)},indexes:Iu(ee.indexNames).map(function(J){return ee.index(J)}).map(function(oe){var ye=oe.name,de=oe.unique,pe=oe.multiEntry,oe=oe.keyPath,ye={name:ye,compound:c(oe),keyPath:oe,unique:de,multiEntry:pe,extractKey:Cl(oe)};return ae[Yn(oe)]=ye}),getIndexByKeyPath:function(J){return ae[Yn(J)]}};return ae[":id"]=te.primaryKey,X!=null&&(ae[Yn(X)]=te.primaryKey),te})},hasGetAll:0<U.length&&"getAll"in O.objectStore(U[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},U=Z.schema,V=Z.hasGetAll,Z=U.tables.map(M),le={};return Z.forEach(function(ee){return le[ee.name]=ee}),{stack:"dbcore",transaction:m.transaction.bind(m),table:function(ee){if(le[ee])return le[ee];throw new Error("Table '".concat(ee,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Wn(g),schema:U}}function sy(m,g,w,_){return w=w.IDBKeyRange,g=ty(g,w,_),{dbcore:m.dbcore.reduce(function(M,O){return O=O.create,a(a({},M),O(M))},g)}}function $i(m,g){var w=g.db,w=sy(m._middlewares,w,m._deps,g);m.core=w.dbcore,m.tables.forEach(function(_){var M=_.name;m.core.schema.tables.some(function(O){return O.name===M})&&(_.core=m.core.table(M),m[M]instanceof m.Table)&&(m[M].core=_.core)})}function Ui(m,g,w,_){w.forEach(function(M){var O=_[M];g.forEach(function(U){var V=function Z(le,ee){return b(le,ee)||(le=u(le))&&Z(le,ee)}(U,M);(!V||"value"in V&&V.value===void 0)&&(U===m.Transaction.prototype||U instanceof m.Transaction?y(U,M,{get:function(){return this.table(M)},set:function(Z){f(this,M,{value:Z,writable:!0,configurable:!0,enumerable:!0})}}):U[M]=new m.Table(M,O))})})}function Sl(m,g){g.forEach(function(w){for(var _ in w)w[_]instanceof m.Table&&delete w[_]})}function ry(m,g){return m._cfg.version-g._cfg.version}function ay(m,g,w,_){var M=m._dbSchema,O=(w.objectStoreNames.contains("$meta")&&!M.$meta&&(M.$meta=kl("$meta",Fu("")[0],[]),m._storeNames.push("$meta")),m._createTransaction("readwrite",m._storeNames,M)),U=(O.create(w),O._completion.catch(_),O._reject.bind(O)),V=Be.transless||Be;oa(function(){if(Be.trans=O,Be.transless=V,g!==0)return $i(m,w),le=g,((Z=O).storeNames.includes("$meta")?Z.table("$meta").get("version").then(function(ee){return ee??le}):_e.resolve(le)).then(function(de){var X=m,re=de,ae=O,te=w,J=[],de=X._versions,pe=X._dbSchema=Vi(0,X.idbdb,te);return(de=de.filter(function(oe){return oe._cfg.version>=re})).length===0?_e.resolve():(de.forEach(function(oe){J.push(function(){var ye,Te,Ee,Ie=pe,Pe=oe._cfg.dbschema,$e=(Ki(X,Ie,te),Ki(X,Pe,te),pe=X._dbSchema=Pe,Al(Ie,Pe)),ze=($e.add.forEach(function(Me){Tl(te,Me[0],Me[1].primKey,Me[1].indexes)}),$e.change.forEach(function(Me){if(Me.recreate)throw new Ne.Upgrade("Not yet support for changing primary key");var Ve=te.objectStore(Me.name);Me.add.forEach(function(Rt){return Hi(Ve,Rt)}),Me.change.forEach(function(Rt){Ve.deleteIndex(Rt.name),Hi(Ve,Rt)}),Me.del.forEach(function(Rt){return Ve.deleteIndex(Rt)})}),oe._cfg.contentUpgrade);if(ze&&oe._cfg.version>re)return $i(X,te),ae._memoizedTables={},ye=S(Pe),$e.del.forEach(function(Me){ye[Me]=Ie[Me]}),Sl(X,[X.Transaction.prototype]),Ui(X,[X.Transaction.prototype],o(ye),ye),ae.schema=ye,(Te=ne(ze))&&Za(),Pe=_e.follow(function(){var Me;(Ee=ze(ae))&&Te&&(Me=la.bind(null,null),Ee.then(Me,Me))}),Ee&&typeof Ee.then=="function"?_e.resolve(Ee):Pe.then(function(){return Ee})}),J.push(function(ye){var Te,Ee,Ie=oe._cfg.dbschema;Te=Ie,Ee=ye,[].slice.call(Ee.db.objectStoreNames).forEach(function(Pe){return Te[Pe]==null&&Ee.db.deleteObjectStore(Pe)}),Sl(X,[X.Transaction.prototype]),Ui(X,[X.Transaction.prototype],X._storeNames,X._dbSchema),ae.schema=X._dbSchema}),J.push(function(ye){X.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(X.idbdb.version/10)===oe._cfg.version?(X.idbdb.deleteObjectStore("$meta"),delete X._dbSchema.$meta,X._storeNames=X._storeNames.filter(function(Te){return Te!=="$meta"})):ye.objectStore("$meta").put(oe._cfg.version,"version"))})}),function oe(){return J.length?_e.resolve(J.shift()(ae.idbtrans)).then(oe):_e.resolve()}().then(function(){Ou(pe,te)}))}).catch(U);var Z,le;o(M).forEach(function(ee){Tl(w,ee,M[ee].primKey,M[ee].indexes)}),$i(m,w),_e.follow(function(){return m.on.populate.fire(O)}).catch(U)})}function ny(m,g){Ou(m._dbSchema,g),g.db.version%10!=0||g.objectStoreNames.contains("$meta")||g.db.createObjectStore("$meta").add(Math.ceil(g.db.version/10-1),"version");var w=Vi(0,m.idbdb,g);Ki(m,m._dbSchema,g);for(var _=0,M=Al(w,m._dbSchema).change;_<M.length;_++){var O=(U=>{if(U.change.length||U.recreate)return console.warn("Unable to patch indexes of table ".concat(U.name," because it has changes on the type of index or primary key.")),{value:void 0};var V=g.objectStore(U.name);U.add.forEach(function(Z){jt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(U.name,".").concat(Z.src)),Hi(V,Z)})})(M[_]);if(typeof O=="object")return O.value}}function Al(m,g){var w,_={del:[],add:[],change:[]};for(w in m)g[w]||_.del.push(w);for(w in g){var M=m[w],O=g[w];if(M){var U={name:w,def:O,recreate:!1,del:[],add:[],change:[]};if(""+(M.primKey.keyPath||"")!=""+(O.primKey.keyPath||"")||M.primKey.auto!==O.primKey.auto)U.recreate=!0,_.change.push(U);else{var V=M.idxByName,Z=O.idxByName,le=void 0;for(le in V)Z[le]||U.del.push(le);for(le in Z){var ee=V[le],X=Z[le];ee?ee.src!==X.src&&U.change.push(X):U.add.push(X)}(0<U.del.length||0<U.add.length||0<U.change.length)&&_.change.push(U)}}else _.add.push([w,O])}return _}function Tl(m,g,w,_){var M=m.db.createObjectStore(g,w.keyPath?{keyPath:w.keyPath,autoIncrement:w.auto}:{autoIncrement:w.auto});_.forEach(function(O){return Hi(M,O)})}function Ou(m,g){o(m).forEach(function(w){g.db.objectStoreNames.contains(w)||(jt&&console.debug("Dexie: Creating missing table",w),Tl(g,w,m[w].primKey,m[w].indexes))})}function Hi(m,g){m.createIndex(g.name,g.keyPath,{unique:g.unique,multiEntry:g.multi})}function Vi(m,g,w){var _={};return A(g.objectStoreNames,0).forEach(function(M){for(var O=w.objectStore(M),U=_l(Eu(le=O.keyPath),le||"",!0,!1,!!O.autoIncrement,le&&typeof le!="string",!0),V=[],Z=0;Z<O.indexNames.length;++Z){var ee=O.index(O.indexNames[Z]),le=ee.keyPath,ee=_l(ee.name,le,!!ee.unique,!!ee.multiEntry,!1,le&&typeof le!="string",!1);V.push(ee)}_[M]=kl(M,U,V)}),_}function Ki(m,g,w){for(var _=w.db.objectStoreNames,M=0;M<_.length;++M){var O=_[M],U=w.objectStore(O);m._hasGetAll="getAll"in U;for(var V=0;V<U.indexNames.length;++V){var Z,le=U.indexNames[V],ee=U.index(le).keyPath,ee=typeof ee=="string"?ee:"["+A(ee).join("+")+"]";g[O]&&(Z=g[O].idxByName[ee])&&(Z.name=le,delete g[O].idxByName[ee],g[O].idxByName[le]=Z)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(m._hasGetAll=!1)}function Fu(m){return m.split(",").map(function(g,w){var M=g.split(":"),_=(_=M[1])==null?void 0:_.trim(),M=(g=M[0].trim()).replace(/([&*]|\+\+)/g,""),O=/^\[/.test(M)?M.match(/^\[(.*)\]$/)[1].split("+"):M;return _l(M,O||null,/\&/.test(g),/\*/.test(g),/\+\+/.test(g),c(O),w===0,_)})}rn.prototype._createTableSchema=kl,rn.prototype._parseIndexSyntax=Fu,rn.prototype._parseStoresSpec=function(m,g){var w=this;o(m).forEach(function(_){if(m[_]!==null){var M=w._parseIndexSyntax(m[_]),O=M.shift();if(!O)throw new Ne.Schema("Invalid schema for table "+_+": "+m[_]);if(O.unique=!0,O.multi)throw new Ne.Schema("Primary key cannot be multiEntry*");M.forEach(function(U){if(U.auto)throw new Ne.Schema("Only primary key can be marked as autoIncrement (++)");if(!U.keyPath)throw new Ne.Schema("Index must have a name and cannot be an empty string")}),O=w._createTableSchema(_,O,M),g[_]=O}})},rn.prototype.stores=function(w){var g=this.db,w=(this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,w):w,g._versions),_={},M={};return w.forEach(function(O){l(_,O._cfg.storesSource),M=O._cfg.dbschema={},O._parseStoresSpec(_,M)}),g._dbSchema=M,Sl(g,[g._allTables,g,g.Transaction.prototype]),Ui(g,[g._allTables,g,g.Transaction.prototype,this._cfg.tables],o(M),M),g._storeNames=o(M),this},rn.prototype.upgrade=function(m){return this._cfg.contentUpgrade=ns(this._cfg.contentUpgrade||qe,m),this};var iy=rn;function rn(){}function Pl(m,g){var w=m._dbNamesDB;return w||(w=m._dbNamesDB=new Qr(Oi,{addons:[],indexedDB:m,IDBKeyRange:g})).version(1).stores({dbnames:"name"}),w.table("dbnames")}function Ml(m){return m&&typeof m.databases=="function"}function Rl(m){return oa(function(){return Be.letThrough=!0,m()})}function Dl(m){return!("from"in m)}var Gs=function(m,g){var w;if(!this)return w=new Gs,m&&"d"in m&&l(w,m),w;l(this,arguments.length?{d:1,from:m,to:1<arguments.length?g:m}:{d:0})};function Gn(m,g,w){var _=Tt(g,w);if(!isNaN(_)){if(0<_)throw RangeError();if(Dl(m))return l(m,{from:g,to:w,d:1});var _=m.l,M=m.r;if(Tt(w,m.from)<0)return _?Gn(_,g,w):m.l={from:g,to:w,d:1,l:null,r:null},qu(m);if(0<Tt(g,m.to))return M?Gn(M,g,w):m.r={from:g,to:w,d:1,l:null,r:null},qu(m);Tt(g,m.from)<0&&(m.from=g,m.l=null,m.d=M?M.d+1:1),0<Tt(w,m.to)&&(m.to=w,m.r=null,m.d=m.l?m.l.d+1:1),g=!m.r,_&&!m.l&&Qn(m,_),M&&g&&Qn(m,M)}}function Qn(m,g){Dl(g)||function w(_,M){var O=M.from,U=M.l,V=M.r;Gn(_,O,M.to),U&&w(_,U),V&&w(_,V)}(m,g)}function Lu(m,g){var w=Wi(g),_=w.next();if(!_.done)for(var M=_.value,O=Wi(m),U=O.next(M.from),V=U.value;!_.done&&!U.done;){if(Tt(V.from,M.to)<=0&&0<=Tt(V.to,M.from))return!0;Tt(M.from,V.from)<0?M=(_=w.next(V.from)).value:V=(U=O.next(M.from)).value}return!1}function Wi(m){var g=Dl(m)?null:{s:0,n:m};return{next:function(w){for(var _=0<arguments.length;g;)switch(g.s){case 0:if(g.s=1,_)for(;g.n.l&&Tt(w,g.n.from)<0;)g={up:g,n:g.n.l,s:1};else for(;g.n.l;)g={up:g,n:g.n.l,s:1};case 1:if(g.s=2,!_||Tt(w,g.n.to)<=0)return{value:g.n,done:!1};case 2:if(g.n.r){g.s=3,g={up:g,n:g.n.r,s:0};continue}case 3:g=g.up}return{done:!0}}}}function qu(m){var g,w,_,M=(((M=m.r)==null?void 0:M.d)||0)-(((M=m.l)==null?void 0:M.d)||0),M=1<M?"r":M<-1?"l":"";M&&(g=M=="r"?"l":"r",w=a({},m),_=m[M],m.from=_.from,m.to=_.to,m[M]=_[M],w[M]=_[g],(m[g]=w).d=zu(w)),m.d=zu(m)}function zu(w){var g=w.r,w=w.l;return(g?w?Math.max(g.d,w.d):g.d:w?w.d:0)+1}function Yi(m,g){return o(g).forEach(function(w){m[w]?Qn(m[w],g[w]):m[w]=function _(M){var O,U,V={};for(O in M)p(M,O)&&(U=M[O],V[O]=!U||typeof U!="object"||D.has(U.constructor)?U:_(U));return V}(g[w])}),m}function El(m,g){return m.all||g.all||Object.keys(m).some(function(w){return g[w]&&Lu(g[w],m[w])})}h(Gs.prototype,((_t={add:function(m){return Qn(this,m),this},addKey:function(m){return Gn(this,m,m),this},addKeys:function(m){var g=this;return m.forEach(function(w){return Gn(g,w,w)}),this},hasKey:function(m){var g=Wi(this).next(m).value;return g&&Tt(g.from,m)<=0&&0<=Tt(g.to,m)}})[L]=function(){return Wi(this)},_t));var Ra={},Il={},Ol=!1;function Gi(m){Yi(Il,m),Ol||(Ol=!0,setTimeout(function(){Ol=!1,Fl(Il,!(Il={}))},0))}function Fl(m,g){g===void 0&&(g=!1);var w=new Set;if(m.all)for(var _=0,M=Object.values(Ra);_<M.length;_++)Bu(V=M[_],m,w,g);else for(var O in m){var U,V,O=/^idb\:\/\/(.*)\/(.*)\//.exec(O);O&&(U=O[1],O=O[2],V=Ra["idb://".concat(U,"/").concat(O)])&&Bu(V,m,w,g)}w.forEach(function(Z){return Z()})}function Bu(m,g,w,_){for(var M=[],O=0,U=Object.entries(m.queries.query);O<U.length;O++){for(var V=U[O],Z=V[0],le=[],ee=0,X=V[1];ee<X.length;ee++){var re=X[ee];El(g,re.obsSet)?re.subscribers.forEach(function(de){return w.add(de)}):_&&le.push(re)}_&&M.push([Z,le])}if(_)for(var ae=0,te=M;ae<te.length;ae++){var J=te[ae],Z=J[0],le=J[1];m.queries.query[Z]=le}}function oy(m){var g=m._state,w=m._deps.indexedDB;if(g.isBeingOpened||m.idbdb)return g.dbReadyPromise.then(function(){return g.dbOpenError?Ns(g.dbOpenError):m});g.isBeingOpened=!0,g.dbOpenError=null,g.openComplete=!1;var _=g.openCanceller,M=Math.round(10*m.verno),O=!1;function U(){if(g.openCanceller!==_)throw new Ne.DatabaseClosed("db.open() was cancelled")}function V(){return new _e(function(re,ae){if(U(),!w)throw new Ne.MissingAPI;var te=m.name,J=g.autoSchema||!M?w.open(te):w.open(te,M);if(!J)throw new Ne.MissingAPI;J.onerror=zr(ae),J.onblocked=St(m._fireOnBlocked),J.onupgradeneeded=St(function(de){var pe;ee=J.transaction,g.autoSchema&&!m._options.allowEmptyDB?(J.onerror=Vn,ee.abort(),J.result.close(),(pe=w.deleteDatabase(te)).onsuccess=pe.onerror=St(function(){ae(new Ne.NoSuchDatabase("Database ".concat(te," doesnt exist")))})):(ee.onerror=zr(ae),pe=de.oldVersion>Math.pow(2,62)?0:de.oldVersion,X=pe<1,m.idbdb=J.result,O&&ny(m,ee),ay(m,pe/10,ee,ae))},ae),J.onsuccess=St(function(){ee=null;var de,pe,oe,ye,Te,Ee,Ie=m.idbdb=J.result,Pe=A(Ie.objectStoreNames);if(0<Pe.length)try{var $e=Ie.transaction((Te=Pe).length===1?Te[0]:Te,"readonly");if(g.autoSchema)Ee=Ie,ye=$e,(oe=m).verno=Ee.version/10,ye=oe._dbSchema=Vi(0,Ee,ye),oe._storeNames=A(Ee.objectStoreNames,0),Ui(oe,[oe._allTables],o(ye),ye);else if(Ki(m,m._dbSchema,$e),pe=$e,((pe=Al(Vi(0,(de=m).idbdb,pe),de._dbSchema)).add.length||pe.change.some(function(ze){return ze.add.length||ze.change.length}))&&!O)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Ie.close(),M=Ie.version+1,O=!0,re(V());$i(m,$e)}catch{}en.push(m),Ie.onversionchange=St(function(ze){g.vcFired=!0,m.on("versionchange").fire(ze)}),Ie.onclose=St(function(){m.close({disableAutoOpen:!1})}),X&&(Pe=m._deps,Te=te,Ml(Ee=Pe.indexedDB)||Te===Oi||Pl(Ee,Pe.IDBKeyRange).put({name:Te}).catch(qe)),re()},ae)}).catch(function(re){switch(re?.name){case"UnknownError":if(0<g.PR1398_maxLoop)return g.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),V();break;case"VersionError":if(0<M)return M=0,V()}return _e.reject(re)})}var Z,le=g.dbReadyResolve,ee=null,X=!1;return _e.race([_,(typeof navigator>"u"?_e.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(re){function ae(){return indexedDB.databases().finally(re)}Z=setInterval(ae,100),ae()}).finally(function(){return clearInterval(Z)}):Promise.resolve()).then(V)]).then(function(){return U(),g.onReadyBeingFired=[],_e.resolve(Rl(function(){return m.on.ready.fire(m.vip)})).then(function re(){var ae;if(0<g.onReadyBeingFired.length)return ae=g.onReadyBeingFired.reduce(ns,qe),g.onReadyBeingFired=[],_e.resolve(Rl(function(){return ae(m.vip)})).then(re)})}).finally(function(){g.openCanceller===_&&(g.onReadyBeingFired=null,g.isBeingOpened=!1)}).catch(function(re){g.dbOpenError=re;try{ee&&ee.abort()}catch{}return _===g.openCanceller&&m._close(),Ns(re)}).finally(function(){g.openComplete=!0,le()}).then(function(){var re;return X&&(re={},m.tables.forEach(function(ae){ae.schema.indexes.forEach(function(te){te.name&&(re["idb://".concat(m.name,"/").concat(ae.name,"/").concat(te.name)]=new Gs(-1/0,[[[]]]))}),re["idb://".concat(m.name,"/").concat(ae.name,"/")]=re["idb://".concat(m.name,"/").concat(ae.name,"/:dels")]=new Gs(-1/0,[[[]]])}),ua(Kn).fire(re),Fl(re,!0)),m})}function Ll(m){function g(O){return m.next(O)}var w=M(g),_=M(function(O){return m.throw(O)});function M(O){return function(V){var V=O(V),Z=V.value;return V.done?Z:Z&&typeof Z.then=="function"?Z.then(w,_):c(Z)?Promise.all(Z).then(w,_):w(Z)}}return M(g)()}function Qi(m,g,w){for(var _=c(m)?m.slice():[m],M=0;M<w;++M)_.push(g);return _}var ly={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(m){return a(a({},m),{table:function(_){var w=m.table(_),_=w.schema,M={},O=[];function U(re,ae,te){var oe=Yn(re),J=M[oe]=M[oe]||[],de=re==null?0:typeof re=="string"?1:re.length,pe=0<ae,oe=a(a({},te),{name:pe?"".concat(oe,"(virtual-from:").concat(te.name,")"):te.name,lowLevelIndex:te,isVirtual:pe,keyTail:ae,keyLength:de,extractKey:Cl(re),unique:!pe&&te.unique});return J.push(oe),oe.isPrimaryKey||O.push(oe),1<de&&U(de===2?re[0]:re.slice(0,de-1),ae+1,te),J.sort(function(ye,Te){return ye.keyTail-Te.keyTail}),oe}var V=U(_.primaryKey.keyPath,0,_.primaryKey);M[":id"]=[V];for(var Z=0,le=_.indexes;Z<le.length;Z++){var ee=le[Z];U(ee.keyPath,0,ee)}function X(re){var ae,te=re.query.index;return te.isVirtual?a(a({},re),{query:{index:te.lowLevelIndex,range:(ae=re.query.range,te=te.keyTail,{type:ae.type===1?2:ae.type,lower:Qi(ae.lower,ae.lowerOpen?m.MAX_KEY:m.MIN_KEY,te),lowerOpen:!0,upper:Qi(ae.upper,ae.upperOpen?m.MIN_KEY:m.MAX_KEY,te),upperOpen:!0})}}):re}return a(a({},w),{schema:a(a({},_),{primaryKey:V,indexes:O,getIndexByKeyPath:function(re){return(re=M[Yn(re)])&&re[0]}}),count:function(re){return w.count(X(re))},query:function(re){return w.query(X(re))},openCursor:function(re){var ae=re.query.index,te=ae.keyTail,J=ae.keyLength;return ae.isVirtual?w.openCursor(X(re)).then(function(pe){return pe&&de(pe)}):w.openCursor(re);function de(pe){return Object.create(pe,{continue:{value:function(oe){oe!=null?pe.continue(Qi(oe,re.reverse?m.MAX_KEY:m.MIN_KEY,te)):re.unique?pe.continue(pe.key.slice(0,J).concat(re.reverse?m.MIN_KEY:m.MAX_KEY,te)):pe.continue()}},continuePrimaryKey:{value:function(oe,ye){pe.continuePrimaryKey(Qi(oe,m.MAX_KEY,te),ye)}},primaryKey:{get:function(){return pe.primaryKey}},key:{get:function(){var oe=pe.key;return J===1?oe[0]:oe.slice(0,J)}},value:{get:function(){return pe.value}}})}}})}})}};function ql(m,g,w,_){return w=w||{},_=_||"",o(m).forEach(function(M){var O,U,V;p(g,M)?(O=m[M],U=g[M],typeof O=="object"&&typeof U=="object"&&O&&U?(V=B(O))!==B(U)?w[_+M]=g[M]:V==="Object"?ql(O,U,w,_+M+"."):O!==U&&(w[_+M]=g[M]):O!==U&&(w[_+M]=g[M])):w[_+M]=void 0}),o(g).forEach(function(M){p(m,M)||(w[_+M]=g[M])}),w}function zl(m,g){return g.type==="delete"?g.keys:g.keys||g.values.map(m.extractKey)}var cy={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(m){return a(a({},m),{table:function(g){var w=m.table(g),_=w.schema.primaryKey;return a(a({},w),{mutate:function(M){var O=Be.trans,U=O.table(g).hook,V=U.deleting,Z=U.creating,le=U.updating;switch(M.type){case"add":if(Z.fire===qe)break;return O._promise("readwrite",function(){return ee(M)},!0);case"put":if(Z.fire===qe&&le.fire===qe)break;return O._promise("readwrite",function(){return ee(M)},!0);case"delete":if(V.fire===qe)break;return O._promise("readwrite",function(){return ee(M)},!0);case"deleteRange":if(V.fire===qe)break;return O._promise("readwrite",function(){return function X(re,ae,te){return w.query({trans:re,values:!1,query:{index:_,range:ae},limit:te}).then(function(J){var de=J.result;return ee({type:"delete",keys:de,trans:re}).then(function(pe){return 0<pe.numFailures?Promise.reject(pe.failures[0]):de.length<te?{failures:[],numFailures:0,lastResult:void 0}:X(re,a(a({},ae),{lower:de[de.length-1],lowerOpen:!0}),te)})})}(M.trans,M.range,1e4)},!0)}return w.mutate(M);function ee(X){var re,ae,te,J=Be.trans,de=X.keys||zl(_,X);if(de)return(X=X.type==="add"||X.type==="put"?a(a({},X),{keys:de}):a({},X)).type!=="delete"&&(X.values=n([],X.values)),X.keys&&(X.keys=n([],X.keys)),re=w,te=de,((ae=X).type==="add"?Promise.resolve([]):re.getMany({trans:ae.trans,keys:te,cache:"immutable"})).then(function(pe){var oe=de.map(function(ye,Te){var Ee,Ie,Pe,$e=pe[Te],ze={onerror:null,onsuccess:null};return X.type==="delete"?V.fire.call(ze,ye,$e,J):X.type==="add"||$e===void 0?(Ee=Z.fire.call(ze,ye,X.values[Te],J),ye==null&&Ee!=null&&(X.keys[Te]=ye=Ee,_.outbound||R(X.values[Te],_.keyPath,ye))):(Ee=ql($e,X.values[Te]),(Ie=le.fire.call(ze,Ee,ye,$e,J))&&(Pe=X.values[Te],Object.keys(Ie).forEach(function(Me){p(Pe,Me)?Pe[Me]=Ie[Me]:R(Pe,Me,Ie[Me])}))),ze});return w.mutate(X).then(function(ye){for(var Te=ye.failures,Ee=ye.results,Ie=ye.numFailures,ye=ye.lastResult,Pe=0;Pe<de.length;++Pe){var $e=(Ee||de)[Pe],ze=oe[Pe];$e==null?ze.onerror&&ze.onerror(Te[Pe]):ze.onsuccess&&ze.onsuccess(X.type==="put"&&pe[Pe]?X.values[Pe]:$e)}return{failures:Te,results:Ee,numFailures:Ie,lastResult:ye}}).catch(function(ye){return oe.forEach(function(Te){return Te.onerror&&Te.onerror(ye)}),Promise.reject(ye)})});throw new Error("Keys missing")}}})}})}};function $u(m,g,w){try{if(!g||g.keys.length<m.length)return null;for(var _=[],M=0,O=0;M<g.keys.length&&O<m.length;++M)Tt(g.keys[M],m[O])===0&&(_.push(w?H(g.values[M]):g.values[M]),++O);return _.length===m.length?_:null}catch{return null}}var dy={stack:"dbcore",level:-1,create:function(m){return{table:function(g){var w=m.table(g);return a(a({},w),{getMany:function(_){var M;return _.cache?(M=$u(_.keys,_.trans._cache,_.cache==="clone"))?_e.resolve(M):w.getMany(_).then(function(O){return _.trans._cache={keys:_.keys,values:_.cache==="clone"?H(O):O},O}):w.getMany(_)},mutate:function(_){return _.type!=="add"&&(_.trans._cache=null),w.mutate(_)}})}}}};function Uu(m,g){return m.trans.mode==="readonly"&&!!m.subscr&&!m.trans.explicit&&m.trans.db._options.cache!=="disabled"&&!g.schema.primaryKey.outbound}function Hu(m,g){switch(m){case"query":return g.values&&!g.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var uy={stack:"dbcore",level:0,name:"Observability",create:function(m){var g=m.schema.name,w=new Gs(m.MIN_KEY,m.MAX_KEY);return a(a({},m),{transaction:function(_,M,O){if(Be.subscr&&M!=="readonly")throw new Ne.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Be.querier));return m.transaction(_,M,O)},table:function(_){function M(de){var J,de=de.query;return[J=de.index,new Gs((J=(de=de.range).lower)!=null?J:m.MIN_KEY,(J=de.upper)!=null?J:m.MAX_KEY)]}var O=m.table(_),U=O.schema,V=U.primaryKey,Z=U.indexes,le=V.extractKey,ee=V.outbound,X=V.autoIncrement&&Z.filter(function(te){return te.compound&&te.keyPath.includes(V.keyPath)}),re=a(a({},O),{mutate:function(te){function J(Ve){return Ve="idb://".concat(g,"/").concat(_,"/").concat(Ve),Te[Ve]||(Te[Ve]=new Gs)}var de,pe,oe,ye=te.trans,Te=te.mutatedParts||(te.mutatedParts={}),Ee=J(""),Ie=J(":dels"),Pe=te.type,ze=te.type==="deleteRange"?[te.range]:te.type==="delete"?[te.keys]:te.values.length<50?[zl(V,te).filter(function(Ve){return Ve}),te.values]:[],$e=ze[0],ze=ze[1],Me=te.trans._cache;return c($e)?(Ee.addKeys($e),(Pe=Pe==="delete"||$e.length===ze.length?$u($e,Me):null)||Ie.addKeys($e),(Pe||ze)&&(de=J,pe=Pe,oe=ze,U.indexes.forEach(function(Ve){var Rt=de(Ve.name||"");function Lt(wt){return wt!=null?Ve.extractKey(wt):null}function at(wt){Ve.multiEntry&&c(wt)?wt.forEach(function(xs){return Rt.addKey(xs)}):Rt.addKey(wt)}(pe||oe).forEach(function(wt,js){var Nr=pe&&Lt(pe[js]),js=oe&&Lt(oe[js]);Tt(Nr,js)!==0&&(Nr!=null&&at(Nr),js!=null)&&at(js)})}))):$e?(ze={from:(Me=$e.lower)!=null?Me:m.MIN_KEY,to:(Pe=$e.upper)!=null?Pe:m.MAX_KEY},Ie.add(ze),Ee.add(ze)):(Ee.add(w),Ie.add(w),U.indexes.forEach(function(Ve){return J(Ve.name).add(w)})),O.mutate(te).then(function(Ve){return!$e||te.type!=="add"&&te.type!=="put"||(Ee.addKeys(Ve.results),X&&X.forEach(function(Rt){for(var Lt=te.values.map(function(Nr){return Rt.extractKey(Nr)}),at=Rt.keyPath.findIndex(function(Nr){return Nr===V.keyPath}),wt=0,xs=Ve.results.length;wt<xs;++wt)Lt[wt][at]=Ve.results[wt];J(Rt.name).addKeys(Lt)})),ye.mutatedParts=Yi(ye.mutatedParts||{},Te),Ve})}}),ae={get:function(te){return[V,new Gs(te.key)]},getMany:function(te){return[V,new Gs().addKeys(te.keys)]},count:M,query:M,openCursor:M};return o(ae).forEach(function(te){re[te]=function(J){var de=Be.subscr,pe=!!de,oe=Uu(Be,O)&&Hu(te,J)?J.obsSet={}:de;if(pe){var ye,de=function(ze){return ze="idb://".concat(g,"/").concat(_,"/").concat(ze),oe[ze]||(oe[ze]=new Gs)},Te=de(""),Ee=de(":dels"),pe=ae[te](J),Ie=pe[0],pe=pe[1];if((te==="query"&&Ie.isPrimaryKey&&!J.values?Ee:de(Ie.name||"")).add(pe),!Ie.isPrimaryKey){if(te!=="count")return ye=te==="query"&&ee&&J.values&&O.query(a(a({},J),{values:!1})),O[te].apply(this,arguments).then(function(ze){if(te==="query"){if(ee&&J.values)return ye.then(function(Lt){return Lt=Lt.result,Te.addKeys(Lt),ze});var Me=J.values?ze.result.map(le):ze.result;(J.values?Te:Ee).addKeys(Me)}else{var Ve,Rt;if(te==="openCursor")return Rt=J.values,(Ve=ze)&&Object.create(Ve,{key:{get:function(){return Ee.addKey(Ve.primaryKey),Ve.key}},primaryKey:{get:function(){var Lt=Ve.primaryKey;return Ee.addKey(Lt),Lt}},value:{get:function(){return Rt&&Te.addKey(Ve.primaryKey),Ve.value}}})}return ze});Ee.add(w)}}return O[te].apply(this,arguments)}}),re}})}};function Vu(m,g,w){var _;return w.numFailures===0?g:g.type==="deleteRange"||(_=g.keys?g.keys.length:"values"in g&&g.values?g.values.length:1,w.numFailures===_)?null:(_=a({},g),c(_.keys)&&(_.keys=_.keys.filter(function(M,O){return!(O in w.failures)})),"values"in _&&c(_.values)&&(_.values=_.values.filter(function(M,O){return!(O in w.failures)})),_)}function Bl(m,g){return w=m,((_=g).lower===void 0||(_.lowerOpen?0<Tt(w,_.lower):0<=Tt(w,_.lower)))&&(w=m,(_=g).upper===void 0||(_.upperOpen?Tt(w,_.upper)<0:Tt(w,_.upper)<=0));var w,_}function Ku(m,g,w,_,M,O){var U,V,Z,le,ee,X;return!w||w.length===0||(U=g.query.index,V=U.multiEntry,Z=g.query.range,le=_.schema.primaryKey.extractKey,ee=U.extractKey,X=(U.lowLevelIndex||U).extractKey,(_=w.reduce(function(re,ae){var te=re,J=[];if(ae.type==="add"||ae.type==="put")for(var de=new Gs,pe=ae.values.length-1;0<=pe;--pe){var oe,ye=ae.values[pe],Te=le(ye);!de.hasKey(Te)&&(oe=ee(ye),V&&c(oe)?oe.some(function(ze){return Bl(ze,Z)}):Bl(oe,Z))&&(de.addKey(Te),J.push(ye))}switch(ae.type){case"add":var Ee=new Gs().addKeys(g.values?re.map(function(Me){return le(Me)}):re),te=re.concat(g.values?J.filter(function(Me){return Me=le(Me),!Ee.hasKey(Me)&&(Ee.addKey(Me),!0)}):J.map(function(Me){return le(Me)}).filter(function(Me){return!Ee.hasKey(Me)&&(Ee.addKey(Me),!0)}));break;case"put":var Ie=new Gs().addKeys(ae.values.map(function(Me){return le(Me)}));te=re.filter(function(Me){return!Ie.hasKey(g.values?le(Me):Me)}).concat(g.values?J:J.map(function(Me){return le(Me)}));break;case"delete":var Pe=new Gs().addKeys(ae.keys);te=re.filter(function(Me){return!Pe.hasKey(g.values?le(Me):Me)});break;case"deleteRange":var $e=ae.range;te=re.filter(function(Me){return!Bl(le(Me),$e)})}return te},m))===m)?m:(_.sort(function(re,ae){return Tt(X(re),X(ae))||Tt(le(re),le(ae))}),g.limit&&g.limit<1/0&&(_.length>g.limit?_.length=g.limit:m.length===g.limit&&_.length<g.limit&&(M.dirty=!0)),O?Object.freeze(_):_)}function Wu(m,g){return Tt(m.lower,g.lower)===0&&Tt(m.upper,g.upper)===0&&!!m.lowerOpen==!!g.lowerOpen&&!!m.upperOpen==!!g.upperOpen}function my(m,g){return((w,_,M,O)=>{if(w===void 0)return _!==void 0?-1:0;if(_===void 0)return 1;if((w=Tt(w,_))===0){if(M&&O)return 0;if(M)return 1;if(O)return-1}return w})(m.lower,g.lower,m.lowerOpen,g.lowerOpen)<=0&&0<=((w,_,M,O)=>{if(w===void 0)return _!==void 0?1:0;if(_===void 0)return-1;if((w=Tt(w,_))===0){if(M&&O)return 0;if(M)return-1;if(O)return 1}return w})(m.upper,g.upper,m.upperOpen,g.upperOpen)}function hy(m,g,w,_){m.subscribers.add(w),_.addEventListener("abort",function(){var M,O;m.subscribers.delete(w),m.subscribers.size===0&&(M=m,O=g,setTimeout(function(){M.subscribers.size===0&&K(O,M)},3e3))})}var py={stack:"dbcore",level:0,name:"Cache",create:function(m){var g=m.schema.name;return a(a({},m),{transaction:function(w,_,M){var O,U,V=m.transaction(w,_,M);return _==="readwrite"&&(M=(O=new AbortController).signal,V.addEventListener("abort",(U=function(Z){return function(){if(O.abort(),_==="readwrite"){for(var le=new Set,ee=0,X=w;ee<X.length;ee++){var re=X[ee],ae=Ra["idb://".concat(g,"/").concat(re)];if(ae){var te=m.table(re),J=ae.optimisticOps.filter(function(Ve){return Ve.trans===V});if(V._explicit&&Z&&V.mutatedParts)for(var de=0,pe=Object.values(ae.queries.query);de<pe.length;de++)for(var oe=0,ye=(Ie=pe[de]).slice();oe<ye.length;oe++)El((Pe=ye[oe]).obsSet,V.mutatedParts)&&(K(Ie,Pe),Pe.subscribers.forEach(function(Ve){return le.add(Ve)}));else if(0<J.length){ae.optimisticOps=ae.optimisticOps.filter(function(Ve){return Ve.trans!==V});for(var Te=0,Ee=Object.values(ae.queries.query);Te<Ee.length;Te++)for(var Ie,Pe,$e,ze=0,Me=(Ie=Ee[Te]).slice();ze<Me.length;ze++)(Pe=Me[ze]).res!=null&&V.mutatedParts&&(Z&&!Pe.dirty?($e=Object.isFrozen(Pe.res),$e=Ku(Pe.res,Pe.req,J,te,Pe,$e),Pe.dirty?(K(Ie,Pe),Pe.subscribers.forEach(function(Ve){return le.add(Ve)})):$e!==Pe.res&&(Pe.res=$e,Pe.promise=_e.resolve({result:$e}))):(Pe.dirty&&K(Ie,Pe),Pe.subscribers.forEach(function(Ve){return le.add(Ve)})))}}}le.forEach(function(Ve){return Ve()})}}})(!1),{signal:M}),V.addEventListener("error",U(!1),{signal:M}),V.addEventListener("complete",U(!0),{signal:M})),V},table:function(w){var _=m.table(w),M=_.schema.primaryKey;return a(a({},_),{mutate:function(O){var U,V=Be.trans;return!M.outbound&&V.db._options.cache!=="disabled"&&!V.explicit&&V.idbtrans.mode==="readwrite"&&(U=Ra["idb://".concat(g,"/").concat(w)])?(V=_.mutate(O),O.type!=="add"&&O.type!=="put"||!(50<=O.values.length||zl(M,O).some(function(Z){return Z==null}))?(U.optimisticOps.push(O),O.mutatedParts&&Gi(O.mutatedParts),V.then(function(Z){0<Z.numFailures&&(K(U.optimisticOps,O),(Z=Vu(0,O,Z))&&U.optimisticOps.push(Z),O.mutatedParts)&&Gi(O.mutatedParts)}),V.catch(function(){K(U.optimisticOps,O),O.mutatedParts&&Gi(O.mutatedParts)})):V.then(function(Z){var le=Vu(0,a(a({},O),{values:O.values.map(function(ee,X){var re;return Z.failures[X]?ee:(R(re=(re=M.keyPath)!=null&&re.includes(".")?H(ee):a({},ee),M.keyPath,Z.results[X]),re)})}),Z);U.optimisticOps.push(le),queueMicrotask(function(){return O.mutatedParts&&Gi(O.mutatedParts)})}),V):_.mutate(O)},query:function(O){var U,V,Z,le,ee,X,re;return Uu(Be,_)&&Hu("query",O)?(U=((Z=Be.trans)==null?void 0:Z.db._options.cache)==="immutable",V=(Z=Be).requery,Z=Z.signal,X=((ae,te,J,de)=>{var pe=Ra["idb://".concat(ae,"/").concat(te)];if(!pe)return[];if(!(ae=pe.queries[J]))return[null,!1,pe,null];var oe=ae[(de.query?de.query.index.name:null)||""];if(!oe)return[null,!1,pe,null];switch(J){case"query":var ye=oe.find(function(Te){return Te.req.limit===de.limit&&Te.req.values===de.values&&Wu(Te.req.query.range,de.query.range)});return ye?[ye,!0,pe,oe]:[oe.find(function(Te){return("limit"in Te.req?Te.req.limit:1/0)>=de.limit&&(!de.values||Te.req.values)&&my(Te.req.query.range,de.query.range)}),!1,pe,oe];case"count":return ye=oe.find(function(Te){return Wu(Te.req.query.range,de.query.range)}),[ye,!!ye,pe,oe]}})(g,w,"query",O),re=X[0],le=X[2],ee=X[3],re&&X[1]?re.obsSet=O.obsSet:(X=_.query(O).then(function(ae){var te=ae.result;if(re&&(re.res=te),U){for(var J=0,de=te.length;J<de;++J)Object.freeze(te[J]);Object.freeze(te)}else ae.result=H(te);return ae}).catch(function(ae){return ee&&re&&K(ee,re),Promise.reject(ae)}),re={obsSet:O.obsSet,promise:X,subscribers:new Set,type:"query",req:O,dirty:!1},ee?ee.push(re):(ee=[re],(le=le||(Ra["idb://".concat(g,"/").concat(w)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[O.query.index.name||""]=ee)),hy(re,ee,V,Z),re.promise.then(function(ae){return{result:Ku(ae.result,O,le?.optimisticOps,_,re,U)}})):_.query(O)}})}})}};function Xi(m,g){return new Proxy(m,{get:function(w,_,M){return _==="db"?g:Reflect.get(w,_,M)}})}_s.prototype.version=function(m){if(isNaN(m)||m<.1)throw new Ne.Type("Given version is not a positive number");if(m=Math.round(10*m)/10,this.idbdb||this._state.isBeingOpened)throw new Ne.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,m);var g=this._versions,w=g.filter(function(_){return _._cfg.version===m})[0];return w||(w=new this.Version(m),g.push(w),g.sort(ry),w.stores({}),this._state.autoSchema=!1),w},_s.prototype._whenReady=function(m){var g=this;return this.idbdb&&(this._state.openComplete||Be.letThrough||this._vip)?m():new _e(function(w,_){if(g._state.openComplete)return _(new Ne.DatabaseClosed(g._state.dbOpenError));if(!g._state.isBeingOpened){if(!g._state.autoOpen)return void _(new Ne.DatabaseClosed);g.open().catch(qe)}g._state.dbReadyPromise.then(w,_)}).then(m)},_s.prototype.use=function(M){var g=M.stack,w=M.create,_=M.level,M=M.name,O=(M&&this.unuse({stack:g,name:M}),this._middlewares[g]||(this._middlewares[g]=[]));return O.push({stack:g,create:w,level:_??10,name:M}),O.sort(function(U,V){return U.level-V.level}),this},_s.prototype.unuse=function(m){var g=m.stack,w=m.name,_=m.create;return g&&this._middlewares[g]&&(this._middlewares[g]=this._middlewares[g].filter(function(M){return _?M.create!==_:!!w&&M.name!==w})),this},_s.prototype.open=function(){var m=this;return Ta(ws,function(){return oy(m)})},_s.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var m=this._state,g=en.indexOf(this);if(0<=g&&en.splice(g,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}m.isBeingOpened||(m.dbReadyPromise=new _e(function(w){m.dbReadyResolve=w}),m.openCanceller=new _e(function(w,_){m.cancelOpen=_}))},_s.prototype.close=function(g){var g=(g===void 0?{disableAutoOpen:!0}:g).disableAutoOpen,w=this._state;g?(w.isBeingOpened&&w.cancelOpen(new Ne.DatabaseClosed),this._close(),w.autoOpen=!1,w.dbOpenError=new Ne.DatabaseClosed):(this._close(),w.autoOpen=this._options.autoOpen||w.isBeingOpened,w.openComplete=!1,w.dbOpenError=null)},_s.prototype.delete=function(m){var g=this,w=(m===void 0&&(m={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),_=this._state;return new _e(function(M,O){function U(){g.close(m);var V=g._deps.indexedDB.deleteDatabase(g.name);V.onsuccess=St(function(){var Z,le,ee;Z=g._deps,le=g.name,Ml(ee=Z.indexedDB)||le===Oi||Pl(ee,Z.IDBKeyRange).delete(le).catch(qe),M()}),V.onerror=zr(O),V.onblocked=g._fireOnBlocked}if(w)throw new Ne.InvalidArgument("Invalid closeOptions argument to db.delete()");_.isBeingOpened?_.dbReadyPromise.then(U):U()})},_s.prototype.backendDB=function(){return this.idbdb},_s.prototype.isOpen=function(){return this.idbdb!==null},_s.prototype.hasBeenClosed=function(){var m=this._state.dbOpenError;return m&&m.name==="DatabaseClosed"},_s.prototype.hasFailed=function(){return this._state.dbOpenError!==null},_s.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(_s.prototype,"tables",{get:function(){var m=this;return o(this._allTables).map(function(g){return m._allTables[g]})},enumerable:!1,configurable:!0}),_s.prototype.transaction=function(){var m=function(g,w,_){var M=arguments.length;if(M<2)throw new Ne.InvalidArgument("Too few arguments");for(var O=new Array(M-1);--M;)O[M-1]=arguments[M];return _=O.pop(),[g,E(O),_]}.apply(this,arguments);return this._transaction.apply(this,m)},_s.prototype._transaction=function(m,g,w){var _,M,O=this,U=Be.trans,V=(U&&U.db===this&&m.indexOf("!")===-1||(U=null),m.indexOf("?")!==-1);m=m.replace("!","").replace("?","");try{if(M=g.map(function(le){if(le=le instanceof O.Table?le.name:le,typeof le!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return le}),m=="r"||m===yl)_=yl;else{if(m!="rw"&&m!=jl)throw new Ne.InvalidArgument("Invalid transaction mode: "+m);_=jl}if(U){if(U.mode===yl&&_===jl){if(!V)throw new Ne.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");U=null}U&&M.forEach(function(le){if(U&&U.storeNames.indexOf(le)===-1){if(!V)throw new Ne.SubTransaction("Table "+le+" not included in parent transaction.");U=null}}),V&&U&&!U.active&&(U=null)}}catch(le){return U?U._promise(null,function(ee,X){X(le)}):Ns(le)}var Z=function le(ee,X,re,ae,te){return _e.resolve().then(function(){var oe=Be.transless||Be,J=ee._createTransaction(X,re,ee._dbSchema,ae),oe=(J.explicit=!0,{trans:J,transless:oe});if(ae)J.idbtrans=ae.idbtrans;else try{J.create(),J.idbtrans._explicit=!0,ee._state.PR1398_maxLoop=3}catch(ye){return ye.name===Ye.InvalidState&&ee.isOpen()&&0<--ee._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),ee.close({disableAutoOpen:!1}),ee.open().then(function(){return le(ee,X,re,null,te)})):Ns(ye)}var de,pe=ne(te),oe=(pe&&Za(),_e.follow(function(){var ye;(de=te.call(J,J))&&(pe?(ye=la.bind(null,null),de.then(ye,ye)):typeof de.next=="function"&&typeof de.throw=="function"&&(de=Ll(de)))},oe));return(de&&typeof de.then=="function"?_e.resolve(de).then(function(ye){return J.active?ye:Ns(new Ne.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):oe.then(function(){return de})).then(function(ye){return ae&&J._resolve(),J._completion.then(function(){return ye})}).catch(function(ye){return J._reject(ye),Ns(ye)})})}.bind(null,this,_,M,U,w);return U?U._promise(_,Z,"lock"):Be.trans?Ta(Be.transless,function(){return O._whenReady(Z)}):this._whenReady(Z)},_s.prototype.table=function(m){if(p(this._allTables,m))return this._allTables[m];throw new Ne.InvalidTable("Table ".concat(m," does not exist"))};var Qr=_s;function _s(m,g){var w,_,M,O,U,V=this,Z=(this._middlewares={},this.verno=0,_s.dependencies),Z=(this._options=g=a({addons:_s.addons,autoOpen:!0,indexedDB:Z.indexedDB,IDBKeyRange:Z.IDBKeyRange,cache:"cloned"},g),this._deps={indexedDB:g.indexedDB,IDBKeyRange:g.IDBKeyRange},g.addons),le=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:qe,dbReadyPromise:null,cancelOpen:qe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:g.autoOpen}),ee=(le.dbReadyPromise=new _e(function(X){le.dbReadyResolve=X}),le.openCanceller=new _e(function(X,re){le.cancelOpen=re}),this._state=le,this.name=m,this.on=Un(this,"populate","blocked","versionchange","close",{ready:[ns,qe]}),this.once=function(X,re){var ae=function(){for(var te=[],J=0;J<arguments.length;J++)te[J]=arguments[J];V.on(X).unsubscribe(ae),re.apply(V,te)};return V.on(X,ae)},this.on.ready.subscribe=j(this.on.ready.subscribe,function(X){return function(re,ae){_s.vip(function(){var te,J=V._state;J.openComplete?(J.dbOpenError||_e.resolve().then(re),ae&&X(re)):J.onReadyBeingFired?(J.onReadyBeingFired.push(re),ae&&X(re)):(X(re),te=V,ae||X(function de(){te.on.ready.unsubscribe(re),te.on.ready.unsubscribe(de)}))})}}),this.Collection=(w=this,Hn(Qv.prototype,function(de,J){this.db=w;var ae=wu,te=null;if(J)try{ae=J()}catch(oe){te=oe}var J=de._ctx,de=J.table,pe=de.hook.reading.fire;this._ctx={table:de,index:J.index,isPrimKey:!J.index||de.schema.primKey.keyPath&&J.index===de.schema.primKey.name,range:ae,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:te,or:J.or,valueMapper:pe!==Ke?pe:null}})),this.Table=(_=this,Hn(Au.prototype,function(X,re,ae){this.db=_,this._tx=ae,this.name=X,this.schema=re,this.hook=_._allTables[X]?_._allTables[X].hook:Un(null,{creating:[Vt,qe],reading:[as,Ke],updating:[Dt,qe],deleting:[Pt,qe]})})),this.Transaction=(M=this,Hn(Zv.prototype,function(X,re,ae,te,J){var de=this;X!=="readonly"&&re.forEach(function(pe){pe=(pe=ae[pe])==null?void 0:pe.yProps,pe&&(re=re.concat(pe.map(function(oe){return oe.updatesTable})))}),this.db=M,this.mode=X,this.storeNames=re,this.schema=ae,this.chromeTransactionDurability=te,this.idbtrans=null,this.on=Un(this,"complete","error","abort"),this.parent=J||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new _e(function(pe,oe){de._resolve=pe,de._reject=oe}),this._completion.then(function(){de.active=!1,de.on.complete.fire()},function(pe){var oe=de.active;return de.active=!1,de.on.error.fire(pe),de.parent?de.parent._reject(pe):oe&&de.idbtrans&&de.idbtrans.abort(),Ns(pe)})})),this.Version=(O=this,Hn(iy.prototype,function(X){this.db=O,this._cfg={version:X,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(U=this,Hn(Du.prototype,function(X,re,ae){if(this.db=U,this._ctx={table:X,index:re===":id"?null:re,or:ae},this._cmp=this._ascending=Tt,this._descending=function(te,J){return Tt(J,te)},this._max=function(te,J){return 0<Tt(te,J)?te:J},this._min=function(te,J){return Tt(te,J)<0?te:J},this._IDBKeyRange=U._deps.IDBKeyRange,!this._IDBKeyRange)throw new Ne.MissingAPI})),this.on("versionchange",function(X){0<X.newVersion?console.warn("Another connection wants to upgrade database '".concat(V.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(V.name,"'. Closing db now to resume the delete request.")),V.close({disableAutoOpen:!1})}),this.on("blocked",function(X){!X.newVersion||X.newVersion<X.oldVersion?console.warn("Dexie.delete('".concat(V.name,"') was blocked")):console.warn("Upgrade '".concat(V.name,"' blocked by other connection holding version ").concat(X.oldVersion/10))}),this._maxKey=Wn(g.IDBKeyRange),this._createTransaction=function(X,re,ae,te){return new V.Transaction(X,re,ae,V._options.chromeTransactionDurability,te)},this._fireOnBlocked=function(X){V.on("blocked").fire(X),en.filter(function(re){return re.name===V.name&&re!==V&&!re._state.vcFired}).map(function(re){return re.on("versionchange").fire(X)})},this.use(dy),this.use(py),this.use(uy),this.use(ly),this.use(cy),new Proxy(this,{get:function(X,re,ae){var te;return re==="_vip"||(re==="table"?function(J){return Xi(V.table(J),ee)}:(te=Reflect.get(X,re,ae))instanceof Au?Xi(te,ee):re==="tables"?te.map(function(J){return Xi(J,ee)}):re==="_createTransaction"?function(){return Xi(te.apply(this,arguments),ee)}:te)}}));this.vip=ee,Z.forEach(function(X){return X(V)})}var Ji,an=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",fy=($l.prototype.subscribe=function(m,g,w){return this._subscribe(m&&typeof m!="function"?m:{next:m,error:g,complete:w})},$l.prototype[an]=function(){return this},$l);function $l(m){this._subscribe=m}try{Ji={indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch{Ji={indexedDB:null,IDBKeyRange:null}}function Yu(m){var g,w=!1,_=new fy(function(M){var O=ne(m),U,V=!1,Z={},le={},ee={get closed(){return V},unsubscribe:function(){V||(V=!0,U&&U.abort(),X&&ua.storagemutated.unsubscribe(ae))}},X=(M.start&&M.start(ee),!1),re=function(){return vl(te)},ae=function(J){Yi(Z,J),El(le,Z)&&re()},te=function(){var J,de,pe;!V&&Ji.indexedDB&&(Z={},J={},U&&U.abort(),U=new AbortController,pe=(oe=>{var ye=At();try{O&&Za();var Te=oa(m,oe);return Te=O?Te.finally(la):Te}finally{ye&&Kt()}})(de={subscr:J,signal:U.signal,requery:re,querier:m,trans:null}),Promise.resolve(pe).then(function(oe){w=!0,g=oe,V||de.signal.aborted||(Z={},(ye=>{for(var Te in ye)if(p(ye,Te))return;return 1})(le=J)||X||(ua(Kn,ae),X=!0),vl(function(){return!V&&M.next&&M.next(oe)}))},function(oe){w=!1,["DatabaseClosedError","AbortError"].includes(oe?.name)||V||vl(function(){V||M.error&&M.error(oe)})}))};return setTimeout(re,0),ee});return _.hasValue=function(){return w},_.getValue=function(){return g},_}var Da=Qr;function Ul(m){var g=ma;try{ma=!0,ua.storagemutated.fire(m),Fl(m,!0)}finally{ma=g}}h(Da,a(a({},Y),{delete:function(m){return new Da(m,{addons:[]}).delete()},exists:function(m){return new Da(m,{addons:[]}).open().then(function(g){return g.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(m){try{return g=Da.dependencies,w=g.indexedDB,g=g.IDBKeyRange,(Ml(w)?Promise.resolve(w.databases()).then(function(_){return _.map(function(M){return M.name}).filter(function(M){return M!==Oi})}):Pl(w,g).toCollection().primaryKeys()).then(m)}catch{return Ns(new Ne.MissingAPI)}var g,w},defineClass:function(){return function(m){l(this,m)}},ignoreTransaction:function(m){return Be.trans?Ta(Be.transless,m):m()},vip:Rl,async:function(m){return function(){try{var g=Ll(m.apply(this,arguments));return g&&typeof g.then=="function"?g:_e.resolve(g)}catch(w){return Ns(w)}}},spawn:function(m,g,w){try{var _=Ll(m.apply(w,g||[]));return _&&typeof _.then=="function"?_:_e.resolve(_)}catch(M){return Ns(M)}},currentTransaction:{get:function(){return Be.trans||null}},waitFor:function(m,g){return m=_e.resolve(typeof m=="function"?Da.ignoreTransaction(m):m).timeout(g||6e4),Be.trans?Be.trans.waitFor(m):m},Promise:_e,debug:{get:function(){return jt},set:function(m){is(m)}},derive:v,extend:l,props:h,override:j,Events:Un,on:ua,liveQuery:Yu,extendObservabilitySet:Yi,getByKeyPath:k,setByKeyPath:R,delByKeyPath:function(m,g){typeof g=="string"?R(m,g,void 0):"length"in g&&[].map.call(g,function(w){R(m,w,void 0)})},shallowClone:S,deepClone:H,getObjectDiff:ql,cmp:Tt,asap:I,minKey:-1/0,addons:[],connections:en,errnames:Ye,dependencies:Ji,cache:Ra,semVer:"4.3.0",version:"4.3.0".split(".").map(function(m){return parseInt(m)}).reduce(function(m,g,w){return m+g/Math.pow(10,2*w)})})),Da.maxKey=Wn(Da.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ua(Kn,function(m){ma||(m=new CustomEvent(Nl,{detail:m}),ma=!0,dispatchEvent(m),ma=!1)}),addEventListener(Nl,function(m){m=m.detail,ma||Ul(m)}));var nn,ma=!1,Gu=function(){};return typeof BroadcastChannel<"u"&&((Gu=function(){(nn=new BroadcastChannel(Nl)).onmessage=function(m){return m.data&&Ul(m.data)}})(),typeof nn.unref=="function"&&nn.unref(),ua(Kn,function(m){ma||nn.postMessage(m)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(m){if(!Qr.disableBfCache&&m.persisted){jt&&console.debug("Dexie: handling persisted pagehide"),nn?.close();for(var g=0,w=en;g<w.length;g++)w[g].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(m){!Qr.disableBfCache&&m.persisted&&(jt&&console.debug("Dexie: handling persisted pageshow"),Gu(),Ul({all:new Gs(-1/0,[[]])}))})),_e.rejectionMapper=function(m,g){return!m||m instanceof me||m instanceof TypeError||m instanceof SyntaxError||!m.name||!Ge[m.name]?m:(g=new Ge[m.name](g||m.message,m),"stack"in m&&y(g,"stack",{get:function(){return this.inner.stack}}),g)},is(jt),a(Qr,Object.freeze({__proto__:null,Dexie:Qr,Entity:Nu,PropModification:$n,RangeSet:Gs,add:function(m){return new $n({add:m})},cmp:Tt,default:Qr,liveQuery:Yu,mergeRanges:Qn,rangesOverlap:Lu,remove:function(m){return new $n({remove:m})},replacePrefix:function(m,g){return new $n({replacePrefix:[m,g]})}}),{default:Qr}),Qr})})(_x);var G_=_x.exports;const $c=vy(G_),Em=Symbol.for("Dexie"),Do=globalThis[Em]||(globalThis[Em]=$c);if($c.semVer!==Do.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${$c.semVer} and ${Do.semVer}`);const{liveQuery:VA,mergeRanges:KA,rangesOverlap:WA,RangeSet:YA,cmp:GA,Entity:QA,PropModification:XA,replacePrefix:JA,add:ZA,remove:eT,DexieYProvider:tT}=Do;class Q_ extends Do{constructor(){super("agrinext_offline");Zi(this,"actions");Zi(this,"uploads");Zi(this,"cache_meta");this.version(1).stores({actions:"id, status, nextRunAt, idempotencyKey, createdAt",uploads:"id, status, nextRunAt, createdAt",cache_meta:"key"}),this.actions=this.table("actions"),this.uploads=this.table("uploads"),this.cache_meta=this.table("cache_meta")}}const Ts=new Q_;function X_(t){return new Promise(s=>setTimeout(s,t))}const J_=6,li=new EventTarget;async function Z_(t){try{await Ts.uploads.update(t.id,{status:"uploading"});const{data:s,error:r}=await W.functions.invoke("storage-sign-upload-v1",{body:{bucket:t.purpose==="proof"?"trip-proofs":"crop-media",content_type:t.mimeType,size_bytes:t.size,entity:{type:t.entityType,id:t.entityId,purpose:t.purpose}}});if(r||s?.error)throw new Error(r?.message||s?.error||"sign_failed");const a=s,n=a.token||a.signed_url||a.signedUrl,i=await fetch(n,{method:"PUT",body:t.blob,headers:{"Content-Type":t.mimeType}});if(!i.ok)throw new Error(`upload_failed:${i.status}`);a.file_id&&await W.rpc("public.files_confirm_upload_v1",{p_file_id:a.file_id}),await Ts.uploads.delete(t.id),li.dispatchEvent(new CustomEvent("succeeded",{detail:t}))}catch(s){const r=(t.retryCount||0)+1;if(r>(t.retryCount||J_)){await Ts.uploads.update(t.id,{status:"dead",retryCount:r,lastError:String(s?.message||s)}),li.dispatchEvent(new CustomEvent("dead",{detail:t}));return}else{const a=Math.min(3e5*r,864e5),n=Date.now()+a+Math.floor(Math.random()*400)+200;await Ts.uploads.update(t.id,{status:"failed",retryCount:r,lastError:String(s?.message||s),nextRunAt:n}),li.dispatchEvent(new CustomEvent("retry",{detail:{upload:t,nextRun:n}}))}}}let ic=!1;async function Vd(){if(Ua()&&!ic){ic=!0;try{const t=Date.now(),s=await Ts.uploads.orderBy("createdAt").filter(r=>!r.nextRunAt||r.nextRunAt<=t).toArray();for(const r of s)if(await Z_(r),await X_(500+Math.floor(Math.random()*700)),!Ua())break}finally{ic=!1}}}async function e2(t){const s=t.id||crypto.randomUUID(),r=Date.now(),a={id:s,fileName:t.fileName,mimeType:t.mimeType,size:t.size,blob:t.blob,purpose:t.purpose,entityType:t.entityType,entityId:t.entityId,status:"queued",retryCount:0,nextRunAt:null,lastError:null,idempotencyKey:t.idempotencyKey,createdAt:r};return await Ts.uploads.put(a),li.dispatchEvent(new CustomEvent("enqueue",{detail:a})),Ua()&&Vd().catch(()=>{}),s}Md(t=>{t&&Vd().catch(()=>{})});const t2={enqueueUpload:e2,processUploadsOnce:Vd,uploadEvents:li};async function bi(t,s){if(!Ao.isOnline()){const o=crypto.randomUUID();return await t2.enqueueUpload({id:crypto.randomUUID(),fileName:t.name||"blob",mimeType:s.contentType,size:s.sizeBytes,blob:t,purpose:s.entity.type,entityType:s.entity.type,entityId:s.entity.id,idempotencyKey:o})}const{data:r,error:a}=await W.functions.invoke("storage-sign-upload-v1",{body:{bucket:s.bucket,content_type:s.contentType,size_bytes:s.sizeBytes,entity:s.entity}});if(a)throw new Error(`Sign upload failed: ${a.message}`);if(r?.error)throw new Error(r.error);const n=r,i=await W.storage.from(s.bucket).uploadToSignedUrl(n.path,n.token,t,{contentType:s.contentType});if(i.error)throw new Error(`Upload failed: ${i.error.message}`);if(n.file_id)try{await W.functions.invoke("storage-confirm-upload-v1",{body:{file_id:n.file_id}})}catch(o){console.warn("storage-confirm-upload-v1 failed:",o)}return n.file_id||n.path}const s2=t=>{const{user:s}=Fe();return De({queryKey:["crop-detail",t],queryFn:async()=>{if(!t||!s?.id)return null;const{data:r,error:a}=await W.from("crops").select(`
          *,
          farmland:farmlands(id, name, district, village)
        `).eq("id",t).eq("farmer_id",s.id).maybeSingle();if(a)throw a;return r},enabled:!!t&&!!s?.id})},r2=(t,s=30)=>{const{user:r}=Fe();return De({queryKey:["crop-media",t,s],queryFn:async()=>{if(!t||!r?.id)return[];const{data:a,error:n}=await W.from("crop_media").select("*").eq("crop_id",t).eq("owner_farmer_id",r.id).order("captured_at",{ascending:!1}).limit(s);if(n)throw n;return a},enabled:!!t&&!!r?.id})},a2=(t,s=50)=>{const{user:r}=Fe();return De({queryKey:["crop-activity-logs",t,s],queryFn:async()=>{if(!t||!r?.id)return[];const{data:a,error:n}=await W.from("crop_activity_logs").select(`
          *,
          media:crop_media(*)
        `).eq("crop_id",t).eq("owner_farmer_id",r.id).order("activity_at",{ascending:!1}).limit(s);if(n)throw n;return a},enabled:!!t&&!!r?.id})},kx=()=>dt({mutationFn:async t=>{if(/^[0-9a-fA-F-]{36}$/.test(t)){const{data:n,error:i}=await W.functions.invoke("storage-sign-read-v1",{body:{file_id:t}});if(i)throw i;if(n?.error)throw new Error(n.error);return n.signed_read_url}const{data:r,error:a}=await W.storage.from("crop-media").createSignedUrl(t,600);if(a)throw a;return r.signedUrl}}),n2=()=>{const t=Xe(),{user:s}=Fe();return dt({mutationFn:async({cropId:r,file:a,caption:n,tags:i,latitude:o,longitude:c})=>{if(!s?.id)throw new Error("Not authenticated");const l=await bi(a,{bucket:"crop-media",contentType:a.type,sizeBytes:a.size,entity:{type:"crop",id:r}}),{data:u,error:d}=await W.from("crop_media").insert({crop_id:r,owner_farmer_id:s.id,uploaded_by:s.id,uploader_role:"farmer",file_path:l,mime_type:a.type,caption:n||null,tags:i||null,latitude:o??null,longitude:c??null,geo_verified:!!(o&&c)}).select().single();if(d)throw d;return await W.from("crop_activity_logs").insert({crop_id:r,owner_farmer_id:s.id,created_by:s.id,creator_role:"farmer",activity_type:"photo",media_id:u.id,notes:n||null}),u},onSuccess:(r,a)=>{t.invalidateQueries({queryKey:["crop-media",a.cropId]}),t.invalidateQueries({queryKey:["crop-activity-logs",a.cropId]}),t.invalidateQueries({queryKey:["crop-detail",a.cropId]}),t.invalidateQueries({queryKey:["crops"]}),ce.success("Photo uploaded successfully!")},onError:r=>{ce.error("Failed to upload photo: "+r.message)}})},i2=()=>{const t=Xe(),{user:s}=Fe();return dt({mutationFn:async({cropId:r,activityType:a,notes:n,severity:i,meta:o})=>{if(!s?.id)throw new Error("Not authenticated");const{data:c,error:l}=await W.from("crop_activity_logs").insert({crop_id:r,owner_farmer_id:s.id,created_by:s.id,creator_role:"farmer",activity_type:a,notes:n||null,severity:i||null,meta:o?JSON.parse(JSON.stringify(o)):null}).select().single();if(l)throw l;return c},onSuccess:(r,a)=>{t.invalidateQueries({queryKey:["crop-activity-logs",a.cropId]}),ce.success("Activity logged successfully!")},onError:r=>{ce.error("Failed to log activity: "+r.message)}})},o2=()=>{const t=Xe(),{user:s}=Fe();return dt({mutationFn:async({cropId:r,growthStage:a})=>{if(!s?.id)throw new Error("Not authenticated");const{error:n}=await W.from("crops").update({growth_stage:a}).eq("id",r).eq("farmer_id",s.id);if(n)throw n;await W.from("crop_activity_logs").insert([{crop_id:r,owner_farmer_id:s.id,created_by:s.id,creator_role:"farmer",activity_type:"growth_update",notes:`Growth stage updated to ${a}`}])},onSuccess:(r,a)=>{t.invalidateQueries({queryKey:["crop-detail",a.cropId]}),t.invalidateQueries({queryKey:["crop-activity-logs",a.cropId]}),t.invalidateQueries({queryKey:["crops"]}),ce.success("Growth stage updated!")},onError:r=>{ce.error("Failed to update: "+r.message)}})},l2=()=>{const t=Xe(),{user:s}=Fe();return dt({mutationFn:async({cropId:r,notes:a,severity:n,file:i})=>{if(!s?.id)throw new Error("Not authenticated");let o=null;if(i){const u=await bi(i,{bucket:"crop-media",contentType:i.type,sizeBytes:i.size,entity:{type:"crop",id:r}}),{data:d,error:p}=await W.from("crop_media").insert({crop_id:r,owner_farmer_id:s.id,uploaded_by:s.id,uploader_role:"farmer",file_path:u,mime_type:i.type,caption:"Disease report photo",tags:["disease"]}).select().single();if(p)throw p;o=d.id}const{error:c}=await W.from("crops").update({health_status:"diseased",last_observed_issue_at:new Date().toISOString()}).eq("id",r).eq("farmer_id",s.id);if(c)throw c;const{error:l}=await W.from("crop_activity_logs").insert({crop_id:r,owner_farmer_id:s.id,created_by:s.id,creator_role:"farmer",activity_type:"disease",notes:a,severity:n,media_id:o});if(l)throw l},onSuccess:(r,a)=>{t.invalidateQueries({queryKey:["crop-detail",a.cropId]}),t.invalidateQueries({queryKey:["crop-activity-logs",a.cropId]}),t.invalidateQueries({queryKey:["crop-media",a.cropId]}),t.invalidateQueries({queryKey:["crops"]}),ce.success("Disease reported successfully!")},onError:r=>{ce.error("Failed to report disease: "+r.message)}})},c2=()=>{const t=Xe();return dt({mutationFn:async({mediaId:s,filePath:r,cropId:a})=>{try{const{error:i}=await W.functions.invoke("storage-delete-v1",{body:{bucket:"crop-media",path:r}});i&&console.warn("storage-delete-v1 warning:",i)}catch(i){console.warn("storage-delete-v1 failed:",i)}const{error:n}=await W.from("crop_media").delete().eq("id",s);if(n)throw n;return a},onSuccess:s=>{t.invalidateQueries({queryKey:["crop-media",s]}),t.invalidateQueries({queryKey:["crop-activity-logs",s]}),ce.success("Photo deleted!")},onError:s=>{ce.error("Failed to delete: "+s.message)}})},d2=()=>{const{user:t}=Fe();return De({queryKey:["crop-photo-reminders",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("crops").select("id, crop_name, variety, sowing_date, last_photo_at, created_at").eq("farmer_id",t.id).neq("status","harvested").order("created_at",{ascending:!1});if(r)throw r;const a=new Date,n=[];for(const i of s||[]){const o=i.sowing_date?new Date(i.sowing_date):new Date(i.created_at),c=Math.floor((a.getTime()-o.getTime())/(1e3*60*60*24)),l=Math.floor(c/30)+1;let u=!i.last_photo_at;i.last_photo_at&&(u=Math.floor((a.getTime()-new Date(i.last_photo_at).getTime())/864e5)>25),u&&n.push({cropId:i.id,cropName:i.crop_name,variety:i.variety,monthIndex:l,needsPhoto:!0})}return n.slice(0,3)},enabled:!!t?.id})},u2=()=>{const t=Ut(),{data:s,isLoading:r}=d2();return r?e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs(we,{className:"flex items-center gap-2 text-base",children:[e.jsx(dr,{className:"h-5 w-5"}),"Crop Photo Reminders"]})}),e.jsx(Q,{children:e.jsx(Re,{className:"h-16 w-full"})})]}):!s||s.length===0?null:e.jsxs(G,{className:"border-amber-200 bg-amber-50/50",children:[e.jsx(je,{className:"pb-3",children:e.jsxs(we,{className:"flex items-center gap-2 text-base",children:[e.jsx(_r,{className:"h-5 w-5 text-amber-600"}),"Crop Photo Reminders",e.jsxs(he,{variant:"secondary",className:"ml-auto bg-amber-100 text-amber-800",children:[s.length," pending"]})]})}),e.jsx(Q,{className:"space-y-3",children:s.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:e.jsx(ts,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm",children:[a.cropName,a.variety&&e.jsxs("span",{className:"text-muted-foreground",children:[" (",a.variety,")"]})]}),e.jsxs("p",{className:"text-xs text-amber-700",children:[" Upload Month-",a.monthIndex," photo"]})]})]}),e.jsxs(z,{size:"sm",variant:"outline",className:"border-primary text-primary hover:bg-primary hover:text-primary-foreground",onClick:()=>t(`/farmer/crops/${a.cropId}`),children:[e.jsx(dr,{className:"h-4 w-4 mr-1"}),"Upload"]})]},a.cropId))})]})};var ut=function(){return ut=Object.assign||function(s){for(var r,a=1,n=arguments.length;a<n;a++){r=arguments[a];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(s[i]=r[i])}return s},ut.apply(this,arguments)};function m2(t,s){var r={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&s.indexOf(a)<0&&(r[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(t);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(t,a[n])&&(r[a[n]]=t[a[n]]);return r}function Cx(t,s,r){for(var a=0,n=s.length,i;a<n;a++)(i||!(a in s))&&(i||(i=Array.prototype.slice.call(s,0,a)),i[a]=s[a]);return t.concat(i||Array.prototype.slice.call(s))}function wi(t){return t.mode==="multiple"}function Ni(t){return t.mode==="range"}function ul(t){return t.mode==="single"}var h2={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function p2(t,s){return tt(t,"LLLL y",s)}function f2(t,s){return tt(t,"d",s)}function x2(t,s){return tt(t,"LLLL",s)}function g2(t){return"".concat(t)}function v2(t,s){return tt(t,"cccccc",s)}function y2(t,s){return tt(t,"yyyy",s)}var j2=Object.freeze({__proto__:null,formatCaption:p2,formatDay:f2,formatMonthCaption:x2,formatWeekNumber:g2,formatWeekdayName:v2,formatYearCaption:y2}),b2=function(t,s,r){return tt(t,"do MMMM (EEEE)",r)},w2=function(){return"Month: "},N2=function(){return"Go to next month"},_2=function(){return"Go to previous month"},k2=function(t,s){return tt(t,"cccc",s)},C2=function(t){return"Week n. ".concat(t)},S2=function(){return"Year: "},A2=Object.freeze({__proto__:null,labelDay:b2,labelMonthDropdown:w2,labelNext:N2,labelPrevious:_2,labelWeekNumber:C2,labelWeekday:k2,labelYearDropdown:S2});function T2(){var t="buttons",s=h2,r=Td,a={},n={},i=1,o={},c=new Date;return{captionLayout:t,classNames:s,formatters:j2,labels:A2,locale:r,modifiersClassNames:a,modifiers:n,numberOfMonths:i,styles:o,today:c,mode:"default"}}function P2(t){var s=t.fromYear,r=t.toYear,a=t.fromMonth,n=t.toMonth,i=t.fromDate,o=t.toDate;return a?i=ur(a):s&&(i=new Date(s,0,1)),n?o=sl(n):r&&(o=new Date(r,11,31)),{fromDate:i?jn(i):void 0,toDate:o?jn(o):void 0}}var Sx=x.createContext(void 0);function M2(t){var s,r=t.initialProps,a=T2(),n=P2(r),i=n.fromDate,o=n.toDate,c=(s=r.captionLayout)!==null&&s!==void 0?s:a.captionLayout;c!=="buttons"&&(!i||!o)&&(c="buttons");var l;(ul(r)||wi(r)||Ni(r))&&(l=r.onSelect);var u=ut(ut(ut({},a),r),{captionLayout:c,classNames:ut(ut({},a.classNames),r.classNames),components:ut({},r.components),formatters:ut(ut({},a.formatters),r.formatters),fromDate:i,labels:ut(ut({},a.labels),r.labels),mode:r.mode||a.mode,modifiers:ut(ut({},a.modifiers),r.modifiers),modifiersClassNames:ut(ut({},a.modifiersClassNames),r.modifiersClassNames),onSelect:l,styles:ut(ut({},a.styles),r.styles),toDate:o});return e.jsx(Sx.Provider,{value:u,children:t.children})}function rs(){var t=x.useContext(Sx);if(!t)throw new Error("useDayPicker must be used within a DayPickerProvider.");return t}function Ax(t){var s=rs(),r=s.locale,a=s.classNames,n=s.styles,i=s.formatters.formatCaption;return e.jsx("div",{className:a.caption_label,style:n.caption_label,"aria-live":"polite",role:"presentation",id:t.id,children:i(t.displayMonth,{locale:r})})}function R2(t){return e.jsx("svg",ut({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},t,{children:e.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Tx(t){var s,r,a=t.onChange,n=t.value,i=t.children,o=t.caption,c=t.className,l=t.style,u=rs(),d=(r=(s=u.components)===null||s===void 0?void 0:s.IconDropdown)!==null&&r!==void 0?r:R2;return e.jsxs("div",{className:c,style:l,children:[e.jsx("span",{className:u.classNames.vhidden,children:t["aria-label"]}),e.jsx("select",{name:t.name,"aria-label":t["aria-label"],className:u.classNames.dropdown,style:u.styles.dropdown,value:n,onChange:a,children:i}),e.jsxs("div",{className:u.classNames.caption_label,style:u.styles.caption_label,"aria-hidden":"true",children:[o,e.jsx(d,{className:u.classNames.dropdown_icon,style:u.styles.dropdown_icon})]})]})}function D2(t){var s,r=rs(),a=r.fromDate,n=r.toDate,i=r.styles,o=r.locale,c=r.formatters.formatMonthCaption,l=r.classNames,u=r.components,d=r.labels.labelMonthDropdown;if(!a)return e.jsx(e.Fragment,{});if(!n)return e.jsx(e.Fragment,{});var p=[];if(Q1(a,n))for(var h=ur(a),f=a.getMonth();f<=n.getMonth();f++)p.push(tc(h,f));else for(var h=ur(new Date),f=0;f<=11;f++)p.push(tc(h,f));var y=function(b){var N=Number(b.target.value),A=tc(ur(t.displayMonth),N);t.onChange(A)},v=(s=u?.Dropdown)!==null&&s!==void 0?s:Tx;return e.jsx(v,{name:"months","aria-label":d(),className:l.dropdown_month,style:i.dropdown_month,onChange:y,value:t.displayMonth.getMonth(),caption:c(t.displayMonth,{locale:o}),children:p.map(function(b){return e.jsx("option",{value:b.getMonth(),children:c(b,{locale:o})},b.getMonth())})})}function E2(t){var s,r=t.displayMonth,a=rs(),n=a.fromDate,i=a.toDate,o=a.locale,c=a.styles,l=a.classNames,u=a.components,d=a.formatters.formatYearCaption,p=a.labels.labelYearDropdown,h=[];if(!n)return e.jsx(e.Fragment,{});if(!i)return e.jsx(e.Fragment,{});for(var f=n.getFullYear(),y=i.getFullYear(),v=f;v<=y;v++)h.push(Am(Zp(new Date),v));var b=function(A){var j=Am(ur(r),Number(A.target.value));t.onChange(j)},N=(s=u?.Dropdown)!==null&&s!==void 0?s:Tx;return e.jsx(N,{name:"years","aria-label":p(),className:l.dropdown_year,style:c.dropdown_year,onChange:b,value:r.getFullYear(),caption:d(r,{locale:o}),children:h.map(function(A){return e.jsx("option",{value:A.getFullYear(),children:d(A,{locale:o})},A.getFullYear())})})}function I2(t,s){var r=x.useState(t),a=r[0],n=r[1],i=s===void 0?a:s;return[i,n]}function O2(t){var s=t.month,r=t.defaultMonth,a=t.today,n=s||r||a||new Date,i=t.toDate,o=t.fromDate,c=t.numberOfMonths,l=c===void 0?1:c;if(i&&wn(i,n)<0){var u=-1*(l-1);n=Or(i,u)}return o&&wn(n,o)<0&&(n=o),ur(n)}function F2(){var t=rs(),s=O2(t),r=I2(s,t.month),a=r[0],n=r[1],i=function(o){var c;if(!t.disableNavigation){var l=ur(o);n(l),(c=t.onMonthChange)===null||c===void 0||c.call(t,l)}};return[a,i]}function L2(t,s){for(var r=s.reverseMonths,a=s.numberOfMonths,n=ur(t),i=ur(Or(n,a)),o=wn(i,n),c=[],l=0;l<o;l++){var u=Or(n,l);c.push(u)}return r&&(c=c.reverse()),c}function q2(t,s){if(!s.disableNavigation){var r=s.toDate,a=s.pagedNavigation,n=s.numberOfMonths,i=n===void 0?1:n,o=a?i:1,c=ur(t);if(!r)return Or(c,o);var l=wn(r,t);if(!(l<i))return Or(c,o)}}function z2(t,s){if(!s.disableNavigation){var r=s.fromDate,a=s.pagedNavigation,n=s.numberOfMonths,i=n===void 0?1:n,o=a?i:1,c=ur(t);if(!r)return Or(c,-o);var l=wn(c,r);if(!(l<=0))return Or(c,-o)}}var Px=x.createContext(void 0);function B2(t){var s=rs(),r=F2(),a=r[0],n=r[1],i=L2(a,s),o=q2(a,s),c=z2(a,s),l=function(p){return i.some(function(h){return Pd(p,h)})},u=function(p,h){l(p)||(h&&nf(p,h)?n(Or(p,1+s.numberOfMonths*-1)):n(p))},d={currentMonth:a,displayMonths:i,goToMonth:n,goToDate:u,previousMonth:c,nextMonth:o,isDateDisplayed:l};return e.jsx(Px.Provider,{value:d,children:t.children})}function _i(){var t=x.useContext(Px);if(!t)throw new Error("useNavigation must be used within a NavigationProvider");return t}function Im(t){var s,r=rs(),a=r.classNames,n=r.styles,i=r.components,o=_i().goToMonth,c=function(d){o(Or(d,t.displayIndex?-t.displayIndex:0))},l=(s=i?.CaptionLabel)!==null&&s!==void 0?s:Ax,u=e.jsx(l,{id:t.id,displayMonth:t.displayMonth});return e.jsxs("div",{className:a.caption_dropdowns,style:n.caption_dropdowns,children:[e.jsx("div",{className:a.vhidden,children:u}),e.jsx(D2,{onChange:c,displayMonth:t.displayMonth}),e.jsx(E2,{onChange:c,displayMonth:t.displayMonth})]})}function $2(t){return e.jsx("svg",ut({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:e.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function U2(t){return e.jsx("svg",ut({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:e.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var Eo=x.forwardRef(function(t,s){var r=rs(),a=r.classNames,n=r.styles,i=[a.button_reset,a.button];t.className&&i.push(t.className);var o=i.join(" "),c=ut(ut({},n.button_reset),n.button);return t.style&&Object.assign(c,t.style),e.jsx("button",ut({},t,{ref:s,type:"button",className:o,style:c}))});function H2(t){var s,r,a=rs(),n=a.dir,i=a.locale,o=a.classNames,c=a.styles,l=a.labels,u=l.labelPrevious,d=l.labelNext,p=a.components;if(!t.nextMonth&&!t.previousMonth)return e.jsx(e.Fragment,{});var h=u(t.previousMonth,{locale:i}),f=[o.nav_button,o.nav_button_previous].join(" "),y=d(t.nextMonth,{locale:i}),v=[o.nav_button,o.nav_button_next].join(" "),b=(s=p?.IconRight)!==null&&s!==void 0?s:U2,N=(r=p?.IconLeft)!==null&&r!==void 0?r:$2;return e.jsxs("div",{className:o.nav,style:c.nav,children:[!t.hidePrevious&&e.jsx(Eo,{name:"previous-month","aria-label":h,className:f,style:c.nav_button_previous,disabled:!t.previousMonth,onClick:t.onPreviousClick,children:n==="rtl"?e.jsx(b,{className:o.nav_icon,style:c.nav_icon}):e.jsx(N,{className:o.nav_icon,style:c.nav_icon})}),!t.hideNext&&e.jsx(Eo,{name:"next-month","aria-label":y,className:v,style:c.nav_button_next,disabled:!t.nextMonth,onClick:t.onNextClick,children:n==="rtl"?e.jsx(N,{className:o.nav_icon,style:c.nav_icon}):e.jsx(b,{className:o.nav_icon,style:c.nav_icon})})]})}function Om(t){var s=rs().numberOfMonths,r=_i(),a=r.previousMonth,n=r.nextMonth,i=r.goToMonth,o=r.displayMonths,c=o.findIndex(function(y){return Pd(t.displayMonth,y)}),l=c===0,u=c===o.length-1,d=s>1&&(l||!u),p=s>1&&(u||!l),h=function(){a&&i(a)},f=function(){n&&i(n)};return e.jsx(H2,{displayMonth:t.displayMonth,hideNext:d,hidePrevious:p,nextMonth:n,previousMonth:a,onPreviousClick:h,onNextClick:f})}function V2(t){var s,r=rs(),a=r.classNames,n=r.disableNavigation,i=r.styles,o=r.captionLayout,c=r.components,l=(s=c?.CaptionLabel)!==null&&s!==void 0?s:Ax,u;return n?u=e.jsx(l,{id:t.id,displayMonth:t.displayMonth}):o==="dropdown"?u=e.jsx(Im,{displayMonth:t.displayMonth,id:t.id}):o==="dropdown-buttons"?u=e.jsxs(e.Fragment,{children:[e.jsx(Im,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id}),e.jsx(Om,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id})]}):u=e.jsxs(e.Fragment,{children:[e.jsx(l,{id:t.id,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),e.jsx(Om,{displayMonth:t.displayMonth,id:t.id})]}),e.jsx("div",{className:a.caption,style:i.caption,children:u})}function K2(t){var s=rs(),r=s.footer,a=s.styles,n=s.classNames.tfoot;return r?e.jsx("tfoot",{className:n,style:a.tfoot,children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:r})})}):e.jsx(e.Fragment,{})}function W2(t,s,r){for(var a=r?$a(new Date):Vr(new Date,{locale:t,weekStartsOn:s}),n=[],i=0;i<7;i++){var o=Qs(a,i);n.push(o)}return n}function Y2(){var t=rs(),s=t.classNames,r=t.styles,a=t.showWeekNumber,n=t.locale,i=t.weekStartsOn,o=t.ISOWeek,c=t.formatters.formatWeekdayName,l=t.labels.labelWeekday,u=W2(n,i,o);return e.jsxs("tr",{style:r.head_row,className:s.head_row,children:[a&&e.jsx("td",{style:r.head_cell,className:s.head_cell}),u.map(function(d,p){return e.jsx("th",{scope:"col",className:s.head_cell,style:r.head_cell,"aria-label":l(d,{locale:n}),children:c(d,{locale:n})},p)})]})}function G2(){var t,s=rs(),r=s.classNames,a=s.styles,n=s.components,i=(t=n?.HeadRow)!==null&&t!==void 0?t:Y2;return e.jsx("thead",{style:a.head,className:r.head,children:e.jsx(i,{})})}function Q2(t){var s=rs(),r=s.locale,a=s.formatters.formatDay;return e.jsx(e.Fragment,{children:a(t.date,{locale:r})})}var Kd=x.createContext(void 0);function X2(t){if(!wi(t.initialProps)){var s={selected:void 0,modifiers:{disabled:[]}};return e.jsx(Kd.Provider,{value:s,children:t.children})}return e.jsx(J2,{initialProps:t.initialProps,children:t.children})}function J2(t){var s=t.initialProps,r=t.children,a=s.selected,n=s.min,i=s.max,o=function(u,d,p){var h,f;(h=s.onDayClick)===null||h===void 0||h.call(s,u,d,p);var y=!!(d.selected&&n&&a?.length===n);if(!y){var v=!!(!d.selected&&i&&a?.length===i);if(!v){var b=a?Cx([],a):[];if(d.selected){var N=b.findIndex(function(A){return cr(u,A)});b.splice(N,1)}else b.push(u);(f=s.onSelect)===null||f===void 0||f.call(s,b,u,d,p)}}},c={disabled:[]};a&&c.disabled.push(function(u){var d=i&&a.length>i-1,p=a.some(function(h){return cr(h,u)});return!!(d&&!p)});var l={selected:a,onDayClick:o,modifiers:c};return e.jsx(Kd.Provider,{value:l,children:r})}function Wd(){var t=x.useContext(Kd);if(!t)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return t}function Z2(t,s){var r=s||{},a=r.from,n=r.to;return a&&n?cr(n,t)&&cr(a,t)?void 0:cr(n,t)?{from:n,to:void 0}:cr(a,t)?void 0:Ic(a,t)?{from:t,to:n}:{from:a,to:t}:n?Ic(t,n)?{from:n,to:t}:{from:t,to:n}:a?nf(t,a)?{from:t,to:a}:{from:a,to:t}:{from:t,to:void 0}}var Yd=x.createContext(void 0);function ek(t){if(!Ni(t.initialProps)){var s={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return e.jsx(Yd.Provider,{value:s,children:t.children})}return e.jsx(tk,{initialProps:t.initialProps,children:t.children})}function tk(t){var s=t.initialProps,r=t.children,a=s.selected,n=a||{},i=n.from,o=n.to,c=s.min,l=s.max,u=function(f,y,v){var b,N;(b=s.onDayClick)===null||b===void 0||b.call(s,f,y,v);var A=Z2(f,a);(N=s.onSelect)===null||N===void 0||N.call(s,A,f,y,v)},d={range_start:[],range_end:[],range_middle:[],disabled:[]};if(i?(d.range_start=[i],o?(d.range_end=[o],cr(i,o)||(d.range_middle=[{after:i,before:o}])):d.range_end=[i]):o&&(d.range_start=[o],d.range_end=[o]),c&&(i&&!o&&d.disabled.push({after:Zl(i,c-1),before:Qs(i,c-1)}),i&&o&&d.disabled.push({after:i,before:Qs(i,c-1)}),!i&&o&&d.disabled.push({after:Zl(o,c-1),before:Qs(o,c-1)})),l){if(i&&!o&&(d.disabled.push({before:Qs(i,-l+1)}),d.disabled.push({after:Qs(i,l-1)})),i&&o){var p=Dr(o,i)+1,h=l-p;d.disabled.push({before:Zl(i,h)}),d.disabled.push({after:Qs(o,h)})}!i&&o&&(d.disabled.push({before:Qs(o,-l+1)}),d.disabled.push({after:Qs(o,l-1)}))}return e.jsx(Yd.Provider,{value:{selected:a,onDayClick:u,modifiers:d},children:r})}function Gd(){var t=x.useContext(Yd);if(!t)throw new Error("useSelectRange must be used within a SelectRangeProvider");return t}function yo(t){return Array.isArray(t)?Cx([],t):t!==void 0?[t]:[]}function sk(t){var s={};return Object.entries(t).forEach(function(r){var a=r[0],n=r[1];s[a]=yo(n)}),s}var Fr;(function(t){t.Outside="outside",t.Disabled="disabled",t.Selected="selected",t.Hidden="hidden",t.Today="today",t.RangeStart="range_start",t.RangeEnd="range_end",t.RangeMiddle="range_middle"})(Fr||(Fr={}));var rk=Fr.Selected,Jr=Fr.Disabled,ak=Fr.Hidden,nk=Fr.Today,oc=Fr.RangeEnd,lc=Fr.RangeMiddle,cc=Fr.RangeStart,ik=Fr.Outside;function ok(t,s,r){var a,n=(a={},a[rk]=yo(t.selected),a[Jr]=yo(t.disabled),a[ak]=yo(t.hidden),a[nk]=[t.today],a[oc]=[],a[lc]=[],a[cc]=[],a[ik]=[],a);return t.fromDate&&n[Jr].push({before:t.fromDate}),t.toDate&&n[Jr].push({after:t.toDate}),wi(t)?n[Jr]=n[Jr].concat(s.modifiers[Jr]):Ni(t)&&(n[Jr]=n[Jr].concat(r.modifiers[Jr]),n[cc]=r.modifiers[cc],n[lc]=r.modifiers[lc],n[oc]=r.modifiers[oc]),n}var Mx=x.createContext(void 0);function lk(t){var s=rs(),r=Wd(),a=Gd(),n=ok(s,r,a),i=sk(s.modifiers),o=ut(ut({},n),i);return e.jsx(Mx.Provider,{value:o,children:t.children})}function Rx(){var t=x.useContext(Mx);if(!t)throw new Error("useModifiers must be used within a ModifiersProvider");return t}function ck(t){return!!(t&&typeof t=="object"&&"before"in t&&"after"in t)}function dk(t){return!!(t&&typeof t=="object"&&"from"in t)}function uk(t){return!!(t&&typeof t=="object"&&"after"in t)}function mk(t){return!!(t&&typeof t=="object"&&"before"in t)}function hk(t){return!!(t&&typeof t=="object"&&"dayOfWeek"in t)}function pk(t,s){var r,a=s.from,n=s.to;if(a&&n){var i=Dr(n,a)<0;i&&(r=[n,a],a=r[0],n=r[1]);var o=Dr(t,a)>=0&&Dr(n,t)>=0;return o}return n?cr(n,t):a?cr(a,t):!1}function fk(t){return Cd(t)}function xk(t){return Array.isArray(t)&&t.every(Cd)}function gk(t,s){return s.some(function(r){if(typeof r=="boolean")return r;if(fk(r))return cr(t,r);if(xk(r))return r.includes(t);if(dk(r))return pk(t,r);if(hk(r))return r.dayOfWeek.includes(t.getDay());if(ck(r)){var a=Dr(r.before,t),n=Dr(r.after,t),i=a>0,o=n<0,c=Ic(r.before,r.after);return c?o&&i:i||o}return uk(r)?Dr(t,r.after)>0:mk(r)?Dr(r.before,t)>0:typeof r=="function"?r(t):!1})}function Qd(t,s,r){var a=Object.keys(s).reduce(function(i,o){var c=s[o];return gk(t,c)&&i.push(o),i},[]),n={};return a.forEach(function(i){return n[i]=!0}),r&&!Pd(t,r)&&(n.outside=!0),n}function vk(t,s){for(var r=ur(t[0]),a=sl(t[t.length-1]),n,i,o=r;o<=a;){var c=Qd(o,s),l=!c.disabled&&!c.hidden;if(!l){o=Qs(o,1);continue}if(c.selected)return o;c.today&&!i&&(i=o),n||(n=o),o=Qs(o,1)}return i||n}var yk=365;function Dx(t,s){var r=s.moveBy,a=s.direction,n=s.context,i=s.modifiers,o=s.retry,c=o===void 0?{count:0,lastFocused:t}:o,l=n.weekStartsOn,u=n.fromDate,d=n.toDate,p=n.locale,h={day:Qs,week:Ec,month:Or,year:zw,startOfWeek:function(b){return n.ISOWeek?$a(b):Vr(b,{locale:p,weekStartsOn:l})},endOfWeek:function(b){return n.ISOWeek?ef(b):Ad(b,{locale:p,weekStartsOn:l})}},f=h[r](t,a==="after"?1:-1);a==="before"&&u?f=Bw([u,f]):a==="after"&&d&&(f=$w([d,f]));var y=!0;if(i){var v=Qd(f,i);y=!v.disabled&&!v.hidden}return y?f:c.count>yk?c.lastFocused:Dx(f,{moveBy:r,direction:a,context:n,modifiers:i,retry:ut(ut({},c),{count:c.count+1})})}var Ex=x.createContext(void 0);function jk(t){var s=_i(),r=Rx(),a=x.useState(),n=a[0],i=a[1],o=x.useState(),c=o[0],l=o[1],u=vk(s.displayMonths,r),d=n??(c&&s.isDateDisplayed(c))?c:u,p=function(){l(n),i(void 0)},h=function(b){i(b)},f=rs(),y=function(b,N){if(n){var A=Dx(n,{moveBy:b,direction:N,context:f,modifiers:r});cr(n,A)||(s.goToDate(A,n),h(A))}},v={focusedDay:n,focusTarget:d,blur:p,focus:h,focusDayAfter:function(){return y("day","after")},focusDayBefore:function(){return y("day","before")},focusWeekAfter:function(){return y("week","after")},focusWeekBefore:function(){return y("week","before")},focusMonthBefore:function(){return y("month","before")},focusMonthAfter:function(){return y("month","after")},focusYearBefore:function(){return y("year","before")},focusYearAfter:function(){return y("year","after")},focusStartOfWeek:function(){return y("startOfWeek","before")},focusEndOfWeek:function(){return y("endOfWeek","after")}};return e.jsx(Ex.Provider,{value:v,children:t.children})}function Xd(){var t=x.useContext(Ex);if(!t)throw new Error("useFocusContext must be used within a FocusProvider");return t}function bk(t,s){var r=Rx(),a=Qd(t,r,s);return a}var Jd=x.createContext(void 0);function wk(t){if(!ul(t.initialProps)){var s={selected:void 0};return e.jsx(Jd.Provider,{value:s,children:t.children})}return e.jsx(Nk,{initialProps:t.initialProps,children:t.children})}function Nk(t){var s=t.initialProps,r=t.children,a=function(i,o,c){var l,u,d;if((l=s.onDayClick)===null||l===void 0||l.call(s,i,o,c),o.selected&&!s.required){(u=s.onSelect)===null||u===void 0||u.call(s,void 0,i,o,c);return}(d=s.onSelect)===null||d===void 0||d.call(s,i,i,o,c)},n={selected:s.selected,onDayClick:a};return e.jsx(Jd.Provider,{value:n,children:r})}function Ix(){var t=x.useContext(Jd);if(!t)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return t}function _k(t,s){var r=rs(),a=Ix(),n=Wd(),i=Gd(),o=Xd(),c=o.focusDayAfter,l=o.focusDayBefore,u=o.focusWeekAfter,d=o.focusWeekBefore,p=o.blur,h=o.focus,f=o.focusMonthBefore,y=o.focusMonthAfter,v=o.focusYearBefore,b=o.focusYearAfter,N=o.focusStartOfWeek,A=o.focusEndOfWeek,j=function(P){var K,$,se,ne;ul(r)?(K=a.onDayClick)===null||K===void 0||K.call(a,t,s,P):wi(r)?($=n.onDayClick)===null||$===void 0||$.call(n,t,s,P):Ni(r)?(se=i.onDayClick)===null||se===void 0||se.call(i,t,s,P):(ne=r.onDayClick)===null||ne===void 0||ne.call(r,t,s,P)},C=function(P){var K;h(t),(K=r.onDayFocus)===null||K===void 0||K.call(r,t,s,P)},I=function(P){var K;p(),(K=r.onDayBlur)===null||K===void 0||K.call(r,t,s,P)},k=function(P){var K;(K=r.onDayMouseEnter)===null||K===void 0||K.call(r,t,s,P)},R=function(P){var K;(K=r.onDayMouseLeave)===null||K===void 0||K.call(r,t,s,P)},S=function(P){var K;(K=r.onDayPointerEnter)===null||K===void 0||K.call(r,t,s,P)},T=function(P){var K;(K=r.onDayPointerLeave)===null||K===void 0||K.call(r,t,s,P)},E=function(P){var K;(K=r.onDayTouchCancel)===null||K===void 0||K.call(r,t,s,P)},D=function(P){var K;(K=r.onDayTouchEnd)===null||K===void 0||K.call(r,t,s,P)},F=function(P){var K;(K=r.onDayTouchMove)===null||K===void 0||K.call(r,t,s,P)},H=function(P){var K;(K=r.onDayTouchStart)===null||K===void 0||K.call(r,t,s,P)},q=function(P){var K;(K=r.onDayKeyUp)===null||K===void 0||K.call(r,t,s,P)},B=function(P){var K;switch(P.key){case"ArrowLeft":P.preventDefault(),P.stopPropagation(),r.dir==="rtl"?c():l();break;case"ArrowRight":P.preventDefault(),P.stopPropagation(),r.dir==="rtl"?l():c();break;case"ArrowDown":P.preventDefault(),P.stopPropagation(),u();break;case"ArrowUp":P.preventDefault(),P.stopPropagation(),d();break;case"PageUp":P.preventDefault(),P.stopPropagation(),P.shiftKey?v():f();break;case"PageDown":P.preventDefault(),P.stopPropagation(),P.shiftKey?b():y();break;case"Home":P.preventDefault(),P.stopPropagation(),N();break;case"End":P.preventDefault(),P.stopPropagation(),A();break}(K=r.onDayKeyDown)===null||K===void 0||K.call(r,t,s,P)},L={onClick:j,onFocus:C,onBlur:I,onKeyDown:B,onKeyUp:q,onMouseEnter:k,onMouseLeave:R,onPointerEnter:S,onPointerLeave:T,onTouchCancel:E,onTouchEnd:D,onTouchMove:F,onTouchStart:H};return L}function kk(){var t=rs(),s=Ix(),r=Wd(),a=Gd(),n=ul(t)?s.selected:wi(t)?r.selected:Ni(t)?a.selected:void 0;return n}function Ck(t){return Object.values(Fr).includes(t)}function Sk(t,s){var r=[t.classNames.day];return Object.keys(s).forEach(function(a){var n=t.modifiersClassNames[a];if(n)r.push(n);else if(Ck(a)){var i=t.classNames["day_".concat(a)];i&&r.push(i)}}),r}function Ak(t,s){var r=ut({},t.styles.day);return Object.keys(s).forEach(function(a){var n;r=ut(ut({},r),(n=t.modifiersStyles)===null||n===void 0?void 0:n[a])}),r}function Tk(t,s,r){var a,n,i,o=rs(),c=Xd(),l=bk(t,s),u=_k(t,l),d=kk(),p=!!(o.onDayClick||o.mode!=="default");x.useEffect(function(){var k;l.outside||c.focusedDay&&p&&cr(c.focusedDay,t)&&((k=r.current)===null||k===void 0||k.focus())},[c.focusedDay,t,r,p,l.outside]);var h=Sk(o,l).join(" "),f=Ak(o,l),y=!!(l.outside&&!o.showOutsideDays||l.hidden),v=(i=(n=o.components)===null||n===void 0?void 0:n.DayContent)!==null&&i!==void 0?i:Q2,b=e.jsx(v,{date:t,displayMonth:s,activeModifiers:l}),N={style:f,className:h,children:b,role:"gridcell"},A=c.focusTarget&&cr(c.focusTarget,t)&&!l.outside,j=c.focusedDay&&cr(c.focusedDay,t),C=ut(ut(ut({},N),(a={disabled:l.disabled,role:"gridcell"},a["aria-selected"]=l.selected,a.tabIndex=j||A?0:-1,a)),u),I={isButton:p,isHidden:y,activeModifiers:l,selectedDays:d,buttonProps:C,divProps:N};return I}function Pk(t){var s=x.useRef(null),r=Tk(t.date,t.displayMonth,s);return r.isHidden?e.jsx("div",{role:"gridcell"}):r.isButton?e.jsx(Eo,ut({name:"day",ref:s},r.buttonProps)):e.jsx("div",ut({},r.divProps))}function Mk(t){var s=t.number,r=t.dates,a=rs(),n=a.onWeekNumberClick,i=a.styles,o=a.classNames,c=a.locale,l=a.labels.labelWeekNumber,u=a.formatters.formatWeekNumber,d=u(Number(s),{locale:c});if(!n)return e.jsx("span",{className:o.weeknumber,style:i.weeknumber,children:d});var p=l(Number(s),{locale:c}),h=function(f){n(s,r,f)};return e.jsx(Eo,{name:"week-number","aria-label":p,className:o.weeknumber,style:i.weeknumber,onClick:h,children:d})}function Rk(t){var s,r,a=rs(),n=a.styles,i=a.classNames,o=a.showWeekNumber,c=a.components,l=(s=c?.Day)!==null&&s!==void 0?s:Pk,u=(r=c?.WeekNumber)!==null&&r!==void 0?r:Mk,d;return o&&(d=e.jsx("td",{className:i.cell,style:n.cell,children:e.jsx(u,{number:t.weekNumber,dates:t.dates})})),e.jsxs("tr",{className:i.row,style:n.row,children:[d,t.dates.map(function(p){return e.jsx("td",{className:i.cell,style:n.cell,role:"presentation",children:e.jsx(l,{displayMonth:t.displayMonth,date:p})},W1(p))})]})}function Fm(t,s,r){for(var a=r?.ISOWeek?ef(s):Ad(s,r),n=r?.ISOWeek?$a(t):Vr(t,r),i=Dr(a,n),o=[],c=0;c<=i;c++)o.push(Qs(n,c));var l=o.reduce(function(u,d){var p=r?.ISOWeek?tf(d):rf(d,r),h=u.find(function(f){return f.weekNumber===p});return h?(h.dates.push(d),u):(u.push({weekNumber:p,dates:[d]}),u)},[]);return l}function Dk(t,s){var r=Fm(ur(t),sl(t),s);if(s?.useFixedWeeks){var a=G1(t,s);if(a<6){var n=r[r.length-1],i=n.dates[n.dates.length-1],o=Ec(i,6-a),c=Fm(Ec(i,1),o,s);r.push.apply(r,c)}}return r}function Ek(t){var s,r,a,n=rs(),i=n.locale,o=n.classNames,c=n.styles,l=n.hideHead,u=n.fixedWeeks,d=n.components,p=n.weekStartsOn,h=n.firstWeekContainsDate,f=n.ISOWeek,y=Dk(t.displayMonth,{useFixedWeeks:!!u,ISOWeek:f,locale:i,weekStartsOn:p,firstWeekContainsDate:h}),v=(s=d?.Head)!==null&&s!==void 0?s:G2,b=(r=d?.Row)!==null&&r!==void 0?r:Rk,N=(a=d?.Footer)!==null&&a!==void 0?a:K2;return e.jsxs("table",{id:t.id,className:o.table,style:c.table,role:"grid","aria-labelledby":t["aria-labelledby"],children:[!l&&e.jsx(v,{}),e.jsx("tbody",{className:o.tbody,style:c.tbody,children:y.map(function(A){return e.jsx(b,{displayMonth:t.displayMonth,dates:A.dates,weekNumber:A.weekNumber},A.weekNumber)})}),e.jsx(N,{displayMonth:t.displayMonth})]})}function Ik(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Ok=Ik()?x.useLayoutEffect:x.useEffect,dc=!1,Fk=0;function Lm(){return"react-day-picker-".concat(++Fk)}function Lk(t){var s,r=t??(dc?Lm():null),a=x.useState(r),n=a[0],i=a[1];return Ok(function(){n===null&&i(Lm())},[]),x.useEffect(function(){dc===!1&&(dc=!0)},[]),(s=t??n)!==null&&s!==void 0?s:void 0}function qk(t){var s,r,a=rs(),n=a.dir,i=a.classNames,o=a.styles,c=a.components,l=_i().displayMonths,u=Lk(a.id?"".concat(a.id,"-").concat(t.displayIndex):void 0),d=a.id?"".concat(a.id,"-grid-").concat(t.displayIndex):void 0,p=[i.month],h=o.month,f=t.displayIndex===0,y=t.displayIndex===l.length-1,v=!f&&!y;n==="rtl"&&(s=[f,y],y=s[0],f=s[1]),f&&(p.push(i.caption_start),h=ut(ut({},h),o.caption_start)),y&&(p.push(i.caption_end),h=ut(ut({},h),o.caption_end)),v&&(p.push(i.caption_between),h=ut(ut({},h),o.caption_between));var b=(r=c?.Caption)!==null&&r!==void 0?r:V2;return e.jsxs("div",{className:p.join(" "),style:h,children:[e.jsx(b,{id:u,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),e.jsx(Ek,{id:d,"aria-labelledby":u,displayMonth:t.displayMonth})]},t.displayIndex)}function zk(t){var s=rs(),r=s.classNames,a=s.styles;return e.jsx("div",{className:r.months,style:a.months,children:t.children})}function Bk(t){var s,r,a=t.initialProps,n=rs(),i=Xd(),o=_i(),c=x.useState(!1),l=c[0],u=c[1];x.useEffect(function(){n.initialFocus&&i.focusTarget&&(l||(i.focus(i.focusTarget),u(!0)))},[n.initialFocus,l,i.focus,i.focusTarget,i]);var d=[n.classNames.root,n.className];n.numberOfMonths>1&&d.push(n.classNames.multiple_months),n.showWeekNumber&&d.push(n.classNames.with_weeknumber);var p=ut(ut({},n.styles.root),n.style),h=Object.keys(a).filter(function(y){return y.startsWith("data-")}).reduce(function(y,v){var b;return ut(ut({},y),(b={},b[v]=a[v],b))},{}),f=(r=(s=a.components)===null||s===void 0?void 0:s.Months)!==null&&r!==void 0?r:zk;return e.jsx("div",ut({className:d.join(" "),style:p,dir:n.dir,id:n.id,nonce:a.nonce,title:a.title,lang:a.lang},h,{children:e.jsx(f,{children:o.displayMonths.map(function(y,v){return e.jsx(qk,{displayIndex:v,displayMonth:y},v)})})}))}function $k(t){var s=t.children,r=m2(t,["children"]);return e.jsx(M2,{initialProps:r,children:e.jsx(B2,{children:e.jsx(wk,{initialProps:r,children:e.jsx(X2,{initialProps:r,children:e.jsx(ek,{initialProps:r,children:e.jsx(lk,{children:e.jsx(jk,{children:s})})})})})})})}function Uk(t){return e.jsx($k,ut({},t,{children:e.jsx(Bk,{initialProps:t})}))}function Ox({className:t,classNames:s,showOutsideDays:r=!0,...a}){return e.jsx(Uk,{showOutsideDays:r,className:ke("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:ke(xi({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:ke(xi({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:({...n})=>e.jsx(Jh,{className:"h-4 w-4"}),IconRight:({...n})=>e.jsx(Wa,{className:"h-4 w-4"})},...a})}Ox.displayName="Calendar";var ml="Popover",[Fx]=wr(ml,[En]),ki=En(),[Hk,Aa]=Fx(ml),Lx=t=>{const{__scopePopover:s,children:r,open:a,defaultOpen:n,onOpenChange:i,modal:o=!1}=t,c=ki(s),l=x.useRef(null),[u,d]=x.useState(!1),[p,h]=ra({prop:a,defaultProp:n??!1,onChange:i,caller:ml});return e.jsx(Jc,{...c,children:e.jsx(Hk,{scope:s,contentId:In(),triggerRef:l,open:p,onOpenChange:h,onOpenToggle:x.useCallback(()=>h(f=>!f),[h]),hasCustomAnchor:u,onCustomAnchorAdd:x.useCallback(()=>d(!0),[]),onCustomAnchorRemove:x.useCallback(()=>d(!1),[]),modal:o,children:r})})};Lx.displayName=ml;var qx="PopoverAnchor",Vk=x.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Aa(qx,r),i=ki(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:c}=n;return x.useEffect(()=>(o(),()=>c()),[o,c]),e.jsx($o,{...i,...a,ref:s})});Vk.displayName=qx;var zx="PopoverTrigger",Bx=x.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Aa(zx,r),i=ki(r),o=Ht(s,n.triggerRef),c=e.jsx(ht.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":Kx(n.open),...a,ref:o,onClick:st(t.onClick,n.onOpenToggle)});return n.hasCustomAnchor?c:e.jsx($o,{asChild:!0,...i,children:c})});Bx.displayName=zx;var Zd="PopoverPortal",[Kk,Wk]=Fx(Zd,{forceMount:void 0}),$x=t=>{const{__scopePopover:s,forceMount:r,children:a,container:n}=t,i=Aa(Zd,s);return e.jsx(Kk,{scope:s,forceMount:r,children:e.jsx(Lr,{present:r||i.open,children:e.jsx(Gc,{asChild:!0,container:n,children:a})})})};$x.displayName=Zd;var Sn="PopoverContent",Ux=x.forwardRef((t,s)=>{const r=Wk(Sn,t.__scopePopover),{forceMount:a=r.forceMount,...n}=t,i=Aa(Sn,t.__scopePopover);return e.jsx(Lr,{present:a||i.open,children:i.modal?e.jsx(Gk,{...n,ref:s}):e.jsx(Qk,{...n,ref:s})})});Ux.displayName=Sn;var Yk=yh("PopoverContent.RemoveScroll"),Gk=x.forwardRef((t,s)=>{const r=Aa(Sn,t.__scopePopover),a=x.useRef(null),n=Ht(s,a),i=x.useRef(!1);return x.useEffect(()=>{const o=a.current;if(o)return fh(o)},[]),e.jsx(gh,{as:Yk,allowPinchZoom:!0,children:e.jsx(Hx,{...t,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:st(t.onCloseAutoFocus,o=>{o.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:st(t.onPointerDownOutside,o=>{const c=o.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,u=c.button===2||l;i.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:st(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),Qk=x.forwardRef((t,s)=>{const r=Aa(Sn,t.__scopePopover),a=x.useRef(!1),n=x.useRef(!1);return e.jsx(Hx,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(a.current||r.triggerRef.current?.focus(),i.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(a.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;r.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),Hx=x.forwardRef((t,s)=>{const{__scopePopover:r,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:c,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:d,...p}=t,h=Aa(Sn,r),f=ki(r);return xh(),e.jsx(vh,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:i,children:e.jsx(Qc,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:d,onEscapeKeyDown:c,onPointerDownOutside:l,onFocusOutside:u,onDismiss:()=>h.onOpenChange(!1),children:e.jsx(Xc,{"data-state":Kx(h.open),role:"dialog",id:h.contentId,...f,...p,ref:s,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Vx="PopoverClose",Xk=x.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=Aa(Vx,r);return e.jsx(ht.button,{type:"button",...a,ref:s,onClick:st(t.onClick,()=>n.onOpenChange(!1))})});Xk.displayName=Vx;var Jk="PopoverArrow",Zk=x.forwardRef((t,s)=>{const{__scopePopover:r,...a}=t,n=ki(r);return e.jsx(Zc,{...n,...a,ref:s})});Zk.displayName=Jk;function Kx(t){return t?"open":"closed"}var eC=Lx,tC=Bx,sC=$x,Wx=Ux;const rC=eC,aC=tC,Yx=x.forwardRef(({className:t,align:s="center",sideOffset:r=4,...a},n)=>e.jsx(sC,{children:e.jsx(Wx,{ref:n,align:s,sideOffset:r,className:ke("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}));Yx.displayName=Wx.displayName;const An=t=>W.from(t),nC=()=>{const{user:t}=Fe();return De({queryKey:["assigned-farmers",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await An("agent_farmer_assignments").select("farmer_id").eq("agent_id",t.id).eq("active",!0);if(r)throw r;if(!s?.length)return[];const a=s.map(d=>d.farmer_id),{data:n,error:i}=await W.from("profiles").select("id, full_name, phone, village, taluk, district, avatar_url").in("id",a);if(i)throw i;const[o,c]=await Promise.all([W.from("crops").select("farmer_id, status").in("farmer_id",a).neq("status","harvested"),W.from("transport_requests").select("farmer_id, status").in("farmer_id",a).eq("status","requested")]),l={},u={};return o.data?.forEach(d=>{l[d.farmer_id]||(l[d.farmer_id]={total:0,ready:0}),l[d.farmer_id].total++,(d.status==="ready"||d.status==="one_week")&&l[d.farmer_id].ready++}),c.data?.forEach(d=>{u[d.farmer_id]=(u[d.farmer_id]||0)+1}),(n||[]).map(d=>({...d,crops_count:l[d.id]?.total||0,ready_crops_count:l[d.id]?.ready||0,pending_transport_count:u[d.id]||0}))},enabled:!!t?.id})},iC=()=>{const{user:t}=Fe();return De({queryKey:["farmer-agent",t?.id],queryFn:async()=>{if(!t?.id)return null;const{data:s,error:r}=await An("agent_farmer_assignments").select("agent_id").eq("farmer_id",t.id).eq("active",!0).maybeSingle();if(r)throw r;if(!s)return null;const{data:a,error:n}=await W.from("user_profiles").select("display_name, phone").eq("user_id",s.agent_id).eq("is_active",!0).maybeSingle();return n&&console.warn("useFarmerAgent user_profiles lookup failed:",n.message),{id:s.agent_id,agent_id:s.agent_id,agent_name:a?.display_name||"Field Agent",agent_phone:a?.phone||null,agent_village:null,agent_district:null}},enabled:!!t?.id})},oC=()=>{const{user:t}=Fe(),s=Xe();return dt({mutationFn:async({agentId:r,taskType:a,notes:n,dueDate:i})=>{if(!t?.id)throw new Error("Not authenticated");const{data:o,error:c}=await W.from("agent_tasks").insert({farmer_id:t.id,agent_id:r,task_type:a,task_status:"pending",notes:n,due_date:i||new Date().toISOString().split("T")[0],created_by:t.id,created_by_role:"farmer"}).select().single();if(c)throw c;return o},onSuccess:()=>{s.invalidateQueries({queryKey:["agent-tasks"]}),s.invalidateQueries({queryKey:["farmer-help-requests"]}),ce.success("Help request sent to your agent")},onError:r=>{console.error("Error creating help request:",r),ce.error("Failed to send help request")}})},lC=()=>{const{user:t}=Fe();return De({queryKey:["farmer-help-requests",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("agent_tasks").select("*").eq("farmer_id",t.id).order("created_at",{ascending:!1}).limit(20);if(r)throw r;return s||[]},enabled:!!t?.id})},eu=()=>{const{user:t}=Fe(),s=Xe();return dt({mutationFn:async({farmerId:r,taskId:a})=>{if(!t?.id)throw new Error("Not authenticated");const{data:n,error:i}=await An("agent_visits").insert({agent_id:t.id,farmer_id:r,task_id:a||null}).select().single();if(i)throw i;return n},onSuccess:()=>{s.invalidateQueries({queryKey:["agent-visits"]}),s.invalidateQueries({queryKey:["active-visit"]}),ce.success("Visit started")},onError:r=>{console.error("Error starting visit:",r),ce.error("Failed to start visit")}})},tu=()=>{const{user:t}=Fe();return De({queryKey:["active-visit",t?.id],queryFn:async()=>{if(!t?.id)return null;const{data:s,error:r}=await An("agent_visits").select("*").eq("agent_id",t.id).is("check_out_at",null).order("check_in_at",{ascending:!1}).maybeSingle();if(r)throw r;return s},enabled:!!t?.id})},cC=()=>{const{user:t}=Fe(),s=Xe();return dt({mutationFn:async({farmerId:r,agentId:a})=>{if(!t?.id)throw new Error("Not authenticated");await An("agent_farmer_assignments").update({active:!1}).eq("farmer_id",r).eq("active",!0);const{data:n,error:i}=await An("agent_farmer_assignments").upsert({agent_id:a,farmer_id:r,assigned_by:t.id,active:!0,assigned_at:new Date().toISOString()},{onConflict:"agent_id,farmer_id"}).select().single();if(i)throw i;return n},onSuccess:(r,a)=>{s.invalidateQueries({queryKey:["assigned-farmers"]}),s.invalidateQueries({queryKey:["agent-farmer-assignments"]}),s.invalidateQueries({queryKey:["farmer-agent"]}),s.invalidateQueries({queryKey:["all-farmers"]}),t?.id&&W.from("agent_activity_logs").insert({actor_id:t.id,actor_role:"agent",farmer_id:a.farmerId,action_type:"ASSIGN_FARMER",details:{agent_id:a.agentId}}),ce.success("Farmer assigned to agent")},onError:r=>{console.error("Error assigning farmer:",r),ce.error("Failed to assign farmer")}})},dC=[{value:"visit",label:"Request Visit",labelKn:" "},{value:"verify_crop",label:"Crop Verification",labelKn:" "},{value:"harvest_check",label:"Harvest Check",labelKn:" "},{value:"transport_assist",label:"Transport Help",labelKn:" "}];function uC(){const{t,language:s}=Nt(),{data:r,isLoading:a}=iC(),n=oC(),[i,o]=x.useState(!1),[c,l]=x.useState(""),[u,d]=x.useState(""),[p,h]=x.useState(),f=()=>{r?.agent_phone&&(window.location.href=`tel:${r.agent_phone}`)},y=()=>{if(r?.agent_phone){const b=r.agent_phone.replace(/[^0-9]/g,""),N=encodeURIComponent("Hello, I need help with my farm.");window.open(`https://wa.me/91${b}?text=${N}`,"_blank")}},v=()=>{!r?.agent_id||!c||n.mutate({agentId:r.agent_id,taskType:c,notes:u||void 0,dueDate:p?.toISOString().split("T")[0]},{onSuccess:()=>{o(!1),l(""),d(""),h(void 0)}})};return a?e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsx(Re,{className:"h-6 w-32"})}),e.jsx(Q,{children:e.jsx(Re,{className:"h-20 w-full"})})]}):r?e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs(we,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5 text-primary"}),s==="kn"?" ":"My Agent"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Ps,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:r.agent_name||(s==="kn"?"":"Agent")}),r.agent_phone&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(hr,{className:"h-3 w-3"}),r.agent_phone]}),(r.agent_village||r.agent_district)&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),[r.agent_village,r.agent_district].filter(Boolean).join(", ")]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:f,disabled:!r.agent_phone,children:[e.jsx(hr,{className:"h-4 w-4 mr-1"}),s==="kn"?" ":"Call"]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:y,disabled:!r.agent_phone,className:"text-green-600 hover:text-green-700",children:[e.jsx(pd,{className:"h-4 w-4 mr-1"}),"WhatsApp"]}),e.jsxs(zt,{open:i,onOpenChange:o,children:[e.jsx(Wr,{asChild:!0,children:e.jsxs(z,{size:"sm",className:"ml-auto",children:[e.jsx(cd,{className:"h-4 w-4 mr-1"}),s==="kn"?" ":"Request Help"]})}),e.jsxs(It,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:s==="kn"?" ":"Request Help"}),e.jsx(Ks,{children:s==="kn"?"    ":"Send a help request to your agent"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:s==="kn"?" ":"Type of Help"}),e.jsxs(lt,{value:c,onValueChange:l,children:[e.jsx(it,{children:e.jsx(ct,{placeholder:s==="kn"?" ...":"Select type..."})}),e.jsx(ot,{children:dC.map(b=>e.jsx(ge,{value:b.value,children:s==="kn"?b.labelKn:b.label},b.value))})]})]}),e.jsxs("div",{children:[e.jsxs(ie,{children:[s==="kn"?"":"Notes"," (",t("common.optional"),")"]}),e.jsx(zs,{value:u,onChange:b=>d(b.target.value),placeholder:s==="kn"?"  ...":"Describe your issue...",rows:3})]}),e.jsxs("div",{children:[e.jsxs(ie,{children:[s==="kn"?" ":"Preferred Date"," (",t("common.optional"),")"]}),e.jsxs(rC,{children:[e.jsx(aC,{asChild:!0,children:e.jsxs(z,{variant:"outline",className:ke("w-full justify-start text-left font-normal",!p&&"text-muted-foreground"),children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),p?tt(p,"PPP"):s==="kn"?" ":"Pick a date"]})}),e.jsx(Yx,{className:"w-auto p-0",children:e.jsx(Ox,{mode:"single",selected:p,onSelect:h,initialFocus:!0,disabled:b=>b<new Date})})]})]}),e.jsx(z,{onClick:v,disabled:!c||n.isPending,className:"w-full",children:n.isPending?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),s==="kn"?"...":"Sending..."]}):s==="kn"?" ":"Send Request"})]})]})]})]})]})]}):e.jsxs(G,{className:"border-dashed",children:[e.jsx(je,{className:"pb-3",children:e.jsxs(we,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5"}),s==="kn"?" ":"My Agent"]})}),e.jsx(Q,{children:e.jsx("p",{className:"text-muted-foreground text-sm",children:s==="kn"?"   .":"No agent assigned to you yet."})})]})}const qm={visit:{en:"Visit Request",kn:" "},verify_crop:{en:"Crop Verification",kn:" "},harvest_check:{en:"Harvest Check",kn:" "},transport_assist:{en:"Transport Help",kn:" "}},zm={pending:{icon:vs,color:"bg-amber-100 text-amber-800",label:{en:"Pending",kn:""}},in_progress:{icon:rr,color:"bg-blue-100 text-blue-800",label:{en:"In Progress",kn:""}},completed:{icon:ys,color:"bg-green-100 text-green-800",label:{en:"Completed",kn:""}},cancelled:{icon:Ur,color:"bg-gray-100 text-gray-800",label:{en:"Cancelled",kn:""}}};function mC(){const{language:t}=Nt(),{data:s,isLoading:r}=lC();return r?e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsx(Re,{className:"h-6 w-40"})}),e.jsx(Q,{children:e.jsx("div",{className:"space-y-3",children:[1,2,3].map(a=>e.jsx(Re,{className:"h-16 w-full"},a))})})]}):e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs(we,{className:"text-lg flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5 text-primary"}),t==="kn"?" ":"My Requests"]})}),e.jsx(Q,{children:s?.length?e.jsx(Cn,{className:"h-[300px] pr-4",children:e.jsx("div",{className:"space-y-3",children:s.map(a=>{const n=zm[a.task_status]||zm.pending,i=n.icon,o=qm[a.task_type]||qm.visit_request;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-card",children:[e.jsx("div",{className:`p-2 rounded-full ${n.color}`,children:e.jsx(i,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:t==="kn"?o.kn:o.en}),e.jsx(he,{variant:"outline",className:n.color,children:t==="kn"?n.label.kn:n.label.en})]}),a.notes&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:a.notes}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:tt(ss(a.created_at),"MMM d, yyyy")})]})]},a.id)})})}):e.jsx("p",{className:"text-muted-foreground text-sm text-center py-6",children:t==="kn"?" ":"No requests yet"})})]})}const hC=()=>{const{user:t}=Fe(),s=Xe();x.useEffect(()=>{if(!t?.id)return;const r=W.channel("crops-changes").on("postgres_changes",{event:"*",schema:"public",table:"crops",filter:`farmer_id=eq.${t.id}`},()=>{console.log("Crops updated - refreshing data"),s.invalidateQueries({queryKey:["crops",t.id]})}).subscribe(),a=W.channel("farmlands-changes").on("postgres_changes",{event:"*",schema:"public",table:"farmlands",filter:`farmer_id=eq.${t.id}`},()=>{console.log("Farmlands updated - refreshing data"),s.invalidateQueries({queryKey:["farmlands",t.id]})}).subscribe(),n=W.channel("transport-changes").on("postgres_changes",{event:"*",schema:"public",table:"transport_requests",filter:`farmer_id=eq.${t.id}`},()=>{console.log("Transport requests updated - refreshing data"),s.invalidateQueries({queryKey:["transport-requests",t.id]})}).subscribe(),i=W.channel("notifications-realtime").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${t.id}`},()=>{console.log("Notifications updated - refreshing data"),s.invalidateQueries({queryKey:["farmer-notifications",t.id]})}).subscribe(),o=W.channel("farmer-orders-changes").on("postgres_changes",{event:"*",schema:"public",table:"market_orders",filter:`farmer_id=eq.${t.id}`},()=>{console.log("Market orders updated - refreshing data"),s.invalidateQueries({queryKey:["farmer-orders",t.id]})}).subscribe();return()=>{W.removeChannel(r),W.removeChannel(a),W.removeChannel(n),W.removeChannel(i),W.removeChannel(o)}},[t?.id,s])},Bm={compact:"space-y-4",comfortable:"space-y-6",spacious:"space-y-8"},Zs=({title:t,subtitle:s,actions:r,breadcrumbs:a,density:n="comfortable",className:i,children:o})=>e.jsxs("section",{className:ke(Bm[n],i),children:[a?e.jsx("div",{children:a}):null,e.jsxs("header",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-display font-semibold tracking-tight",children:t}),s?e.jsx("p",{className:"text-sm text-muted-foreground sm:text-base",children:s}):null]}),r?e.jsx("div",{className:"flex items-center gap-2",children:r}):null]}),e.jsx("div",{className:ke(Bm[n]),children:o})]});function $s({title:t,subtitle:s,actions:r,children:a,className:n}){return e.jsx(Zs,{title:t,subtitle:s,actions:r,className:n,children:a})}async function Yt(t,s={}){const{data:r,error:a}=await W.rpc(t,s);if(a)throw a;return r}async function Bs(t,s={}){const{data:r,error:a}=await W.rpc(t,s);if(a)throw a;return r}const su=Object.freeze(Object.defineProperty({__proto__:null,rpcJson:Yt,rpcMutate:Bs},Symbol.toStringTag,{value:"Module"})),pC=()=>{hC();const{t}=Nt(),{data:s}=De({queryKey:["farmer-dashboard"],queryFn:async()=>await Yt("farmer_dashboard_v1")});return e.jsxs(Oe,{title:t("nav.dashboard"),children:[e.jsxs($s,{title:t("dashboard.welcome"),subtitle:t("dashboard.quickActions"),children:[e.jsx(Y_,{}),e.jsx(C_,{}),e.jsx(NN,{dashboardData:s}),e.jsx(b_,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(__,{}),e.jsx(y_,{}),e.jsx(W_,{})]}),e.jsx(k_,{}),e.jsx(u2,{}),e.jsx(t_,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx(o_,{}),e.jsx(l_,{})]}),e.jsx(j_,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx(uC,{}),e.jsx(mC,{})]})]}),e.jsx(V_,{})]})};function nr({icon:t,title:s,description:r,actionLabel:a,onAction:n}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted/50 mb-4",children:e.jsx(t,{className:"h-12 w-12 text-muted-foreground/60"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:s}),r&&e.jsx("p",{className:"text-sm text-muted-foreground max-w-sm mb-6",children:r}),a&&n&&e.jsx(z,{onClick:n,size:"lg",children:a})]})}var fC=Object.defineProperty,Io=Object.getOwnPropertySymbols,Gx=Object.prototype.hasOwnProperty,Qx=Object.prototype.propertyIsEnumerable,$m=(t,s,r)=>s in t?fC(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,Uc=(t,s)=>{for(var r in s||(s={}))Gx.call(s,r)&&$m(t,r,s[r]);if(Io)for(var r of Io(s))Qx.call(s,r)&&$m(t,r,s[r]);return t},Hc=(t,s)=>{var r={};for(var a in t)Gx.call(t,a)&&s.indexOf(a)<0&&(r[a]=t[a]);if(t!=null&&Io)for(var a of Io(t))s.indexOf(a)<0&&Qx.call(t,a)&&(r[a]=t[a]);return r};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var Ka;(t=>{const s=class kt{constructor(l,u,d,p){if(this.version=l,this.errorCorrectionLevel=u,this.modules=[],this.isFunction=[],l<kt.MIN_VERSION||l>kt.MAX_VERSION)throw new RangeError("Version value out of range");if(p<-1||p>7)throw new RangeError("Mask value out of range");this.size=l*4+17;let h=[];for(let y=0;y<this.size;y++)h.push(!1);for(let y=0;y<this.size;y++)this.modules.push(h.slice()),this.isFunction.push(h.slice());this.drawFunctionPatterns();const f=this.addEccAndInterleave(d);if(this.drawCodewords(f),p==-1){let y=1e9;for(let v=0;v<8;v++){this.applyMask(v),this.drawFormatBits(v);const b=this.getPenaltyScore();b<y&&(p=v,y=b),this.applyMask(v)}}n(0<=p&&p<=7),this.mask=p,this.applyMask(p),this.drawFormatBits(p),this.isFunction=[]}static encodeText(l,u){const d=t.QrSegment.makeSegments(l);return kt.encodeSegments(d,u)}static encodeBinary(l,u){const d=t.QrSegment.makeBytes(l);return kt.encodeSegments([d],u)}static encodeSegments(l,u,d=1,p=40,h=-1,f=!0){if(!(kt.MIN_VERSION<=d&&d<=p&&p<=kt.MAX_VERSION)||h<-1||h>7)throw new RangeError("Invalid value");let y,v;for(y=d;;y++){const j=kt.getNumDataCodewords(y,u)*8,C=o.getTotalBits(l,y);if(C<=j){v=C;break}if(y>=p)throw new RangeError("Data too long")}for(const j of[kt.Ecc.MEDIUM,kt.Ecc.QUARTILE,kt.Ecc.HIGH])f&&v<=kt.getNumDataCodewords(y,j)*8&&(u=j);let b=[];for(const j of l){r(j.mode.modeBits,4,b),r(j.numChars,j.mode.numCharCountBits(y),b);for(const C of j.getData())b.push(C)}n(b.length==v);const N=kt.getNumDataCodewords(y,u)*8;n(b.length<=N),r(0,Math.min(4,N-b.length),b),r(0,(8-b.length%8)%8,b),n(b.length%8==0);for(let j=236;b.length<N;j^=253)r(j,8,b);let A=[];for(;A.length*8<b.length;)A.push(0);return b.forEach((j,C)=>A[C>>>3]|=j<<7-(C&7)),new kt(y,u,A,h)}getModule(l,u){return 0<=l&&l<this.size&&0<=u&&u<this.size&&this.modules[u][l]}getModules(){return this.modules}drawFunctionPatterns(){for(let d=0;d<this.size;d++)this.setFunctionModule(6,d,d%2==0),this.setFunctionModule(d,6,d%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const l=this.getAlignmentPatternPositions(),u=l.length;for(let d=0;d<u;d++)for(let p=0;p<u;p++)d==0&&p==0||d==0&&p==u-1||d==u-1&&p==0||this.drawAlignmentPattern(l[d],l[p]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(l){const u=this.errorCorrectionLevel.formatBits<<3|l;let d=u;for(let h=0;h<10;h++)d=d<<1^(d>>>9)*1335;const p=(u<<10|d)^21522;n(p>>>15==0);for(let h=0;h<=5;h++)this.setFunctionModule(8,h,a(p,h));this.setFunctionModule(8,7,a(p,6)),this.setFunctionModule(8,8,a(p,7)),this.setFunctionModule(7,8,a(p,8));for(let h=9;h<15;h++)this.setFunctionModule(14-h,8,a(p,h));for(let h=0;h<8;h++)this.setFunctionModule(this.size-1-h,8,a(p,h));for(let h=8;h<15;h++)this.setFunctionModule(8,this.size-15+h,a(p,h));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let l=this.version;for(let d=0;d<12;d++)l=l<<1^(l>>>11)*7973;const u=this.version<<12|l;n(u>>>18==0);for(let d=0;d<18;d++){const p=a(u,d),h=this.size-11+d%3,f=Math.floor(d/3);this.setFunctionModule(h,f,p),this.setFunctionModule(f,h,p)}}drawFinderPattern(l,u){for(let d=-4;d<=4;d++)for(let p=-4;p<=4;p++){const h=Math.max(Math.abs(p),Math.abs(d)),f=l+p,y=u+d;0<=f&&f<this.size&&0<=y&&y<this.size&&this.setFunctionModule(f,y,h!=2&&h!=4)}}drawAlignmentPattern(l,u){for(let d=-2;d<=2;d++)for(let p=-2;p<=2;p++)this.setFunctionModule(l+p,u+d,Math.max(Math.abs(p),Math.abs(d))!=1)}setFunctionModule(l,u,d){this.modules[u][l]=d,this.isFunction[u][l]=!0}addEccAndInterleave(l){const u=this.version,d=this.errorCorrectionLevel;if(l.length!=kt.getNumDataCodewords(u,d))throw new RangeError("Invalid argument");const p=kt.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][u],h=kt.ECC_CODEWORDS_PER_BLOCK[d.ordinal][u],f=Math.floor(kt.getNumRawDataModules(u)/8),y=p-f%p,v=Math.floor(f/p);let b=[];const N=kt.reedSolomonComputeDivisor(h);for(let j=0,C=0;j<p;j++){let I=l.slice(C,C+v-h+(j<y?0:1));C+=I.length;const k=kt.reedSolomonComputeRemainder(I,N);j<y&&I.push(0),b.push(I.concat(k))}let A=[];for(let j=0;j<b[0].length;j++)b.forEach((C,I)=>{(j!=v-h||I>=y)&&A.push(C[j])});return n(A.length==f),A}drawCodewords(l){if(l.length!=Math.floor(kt.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let u=0;for(let d=this.size-1;d>=1;d-=2){d==6&&(d=5);for(let p=0;p<this.size;p++)for(let h=0;h<2;h++){const f=d-h,v=(d+1&2)==0?this.size-1-p:p;!this.isFunction[v][f]&&u<l.length*8&&(this.modules[v][f]=a(l[u>>>3],7-(u&7)),u++)}}n(u==l.length*8)}applyMask(l){if(l<0||l>7)throw new RangeError("Mask value out of range");for(let u=0;u<this.size;u++)for(let d=0;d<this.size;d++){let p;switch(l){case 0:p=(d+u)%2==0;break;case 1:p=u%2==0;break;case 2:p=d%3==0;break;case 3:p=(d+u)%3==0;break;case 4:p=(Math.floor(d/3)+Math.floor(u/2))%2==0;break;case 5:p=d*u%2+d*u%3==0;break;case 6:p=(d*u%2+d*u%3)%2==0;break;case 7:p=((d+u)%2+d*u%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[u][d]&&p&&(this.modules[u][d]=!this.modules[u][d])}}getPenaltyScore(){let l=0;for(let h=0;h<this.size;h++){let f=!1,y=0,v=[0,0,0,0,0,0,0];for(let b=0;b<this.size;b++)this.modules[h][b]==f?(y++,y==5?l+=kt.PENALTY_N1:y>5&&l++):(this.finderPenaltyAddHistory(y,v),f||(l+=this.finderPenaltyCountPatterns(v)*kt.PENALTY_N3),f=this.modules[h][b],y=1);l+=this.finderPenaltyTerminateAndCount(f,y,v)*kt.PENALTY_N3}for(let h=0;h<this.size;h++){let f=!1,y=0,v=[0,0,0,0,0,0,0];for(let b=0;b<this.size;b++)this.modules[b][h]==f?(y++,y==5?l+=kt.PENALTY_N1:y>5&&l++):(this.finderPenaltyAddHistory(y,v),f||(l+=this.finderPenaltyCountPatterns(v)*kt.PENALTY_N3),f=this.modules[b][h],y=1);l+=this.finderPenaltyTerminateAndCount(f,y,v)*kt.PENALTY_N3}for(let h=0;h<this.size-1;h++)for(let f=0;f<this.size-1;f++){const y=this.modules[h][f];y==this.modules[h][f+1]&&y==this.modules[h+1][f]&&y==this.modules[h+1][f+1]&&(l+=kt.PENALTY_N2)}let u=0;for(const h of this.modules)u=h.reduce((f,y)=>f+(y?1:0),u);const d=this.size*this.size,p=Math.ceil(Math.abs(u*20-d*10)/d)-1;return n(0<=p&&p<=9),l+=p*kt.PENALTY_N4,n(0<=l&&l<=2568888),l}getAlignmentPatternPositions(){if(this.version==1)return[];{const l=Math.floor(this.version/7)+2,u=this.version==32?26:Math.ceil((this.version*4+4)/(l*2-2))*2;let d=[6];for(let p=this.size-7;d.length<l;p-=u)d.splice(1,0,p);return d}}static getNumRawDataModules(l){if(l<kt.MIN_VERSION||l>kt.MAX_VERSION)throw new RangeError("Version number out of range");let u=(16*l+128)*l+64;if(l>=2){const d=Math.floor(l/7)+2;u-=(25*d-10)*d-55,l>=7&&(u-=36)}return n(208<=u&&u<=29648),u}static getNumDataCodewords(l,u){return Math.floor(kt.getNumRawDataModules(l)/8)-kt.ECC_CODEWORDS_PER_BLOCK[u.ordinal][l]*kt.NUM_ERROR_CORRECTION_BLOCKS[u.ordinal][l]}static reedSolomonComputeDivisor(l){if(l<1||l>255)throw new RangeError("Degree out of range");let u=[];for(let p=0;p<l-1;p++)u.push(0);u.push(1);let d=1;for(let p=0;p<l;p++){for(let h=0;h<u.length;h++)u[h]=kt.reedSolomonMultiply(u[h],d),h+1<u.length&&(u[h]^=u[h+1]);d=kt.reedSolomonMultiply(d,2)}return u}static reedSolomonComputeRemainder(l,u){let d=u.map(p=>0);for(const p of l){const h=p^d.shift();d.push(0),u.forEach((f,y)=>d[y]^=kt.reedSolomonMultiply(f,h))}return d}static reedSolomonMultiply(l,u){if(l>>>8||u>>>8)throw new RangeError("Byte out of range");let d=0;for(let p=7;p>=0;p--)d=d<<1^(d>>>7)*285,d^=(u>>>p&1)*l;return n(d>>>8==0),d}finderPenaltyCountPatterns(l){const u=l[1];n(u<=this.size*3);const d=u>0&&l[2]==u&&l[3]==u*3&&l[4]==u&&l[5]==u;return(d&&l[0]>=u*4&&l[6]>=u?1:0)+(d&&l[6]>=u*4&&l[0]>=u?1:0)}finderPenaltyTerminateAndCount(l,u,d){return l&&(this.finderPenaltyAddHistory(u,d),u=0),u+=this.size,this.finderPenaltyAddHistory(u,d),this.finderPenaltyCountPatterns(d)}finderPenaltyAddHistory(l,u){u[0]==0&&(l+=this.size),u.pop(),u.unshift(l)}};s.MIN_VERSION=1,s.MAX_VERSION=40,s.PENALTY_N1=3,s.PENALTY_N2=3,s.PENALTY_N3=40,s.PENALTY_N4=10,s.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],s.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],t.QrCode=s;function r(c,l,u){if(l<0||l>31||c>>>l)throw new RangeError("Value out of range");for(let d=l-1;d>=0;d--)u.push(c>>>d&1)}function a(c,l){return(c>>>l&1)!=0}function n(c){if(!c)throw new Error("Assertion error")}const i=class bs{constructor(l,u,d){if(this.mode=l,this.numChars=u,this.bitData=d,u<0)throw new RangeError("Invalid argument");this.bitData=d.slice()}static makeBytes(l){let u=[];for(const d of l)r(d,8,u);return new bs(bs.Mode.BYTE,l.length,u)}static makeNumeric(l){if(!bs.isNumeric(l))throw new RangeError("String contains non-numeric characters");let u=[];for(let d=0;d<l.length;){const p=Math.min(l.length-d,3);r(parseInt(l.substring(d,d+p),10),p*3+1,u),d+=p}return new bs(bs.Mode.NUMERIC,l.length,u)}static makeAlphanumeric(l){if(!bs.isAlphanumeric(l))throw new RangeError("String contains unencodable characters in alphanumeric mode");let u=[],d;for(d=0;d+2<=l.length;d+=2){let p=bs.ALPHANUMERIC_CHARSET.indexOf(l.charAt(d))*45;p+=bs.ALPHANUMERIC_CHARSET.indexOf(l.charAt(d+1)),r(p,11,u)}return d<l.length&&r(bs.ALPHANUMERIC_CHARSET.indexOf(l.charAt(d)),6,u),new bs(bs.Mode.ALPHANUMERIC,l.length,u)}static makeSegments(l){return l==""?[]:bs.isNumeric(l)?[bs.makeNumeric(l)]:bs.isAlphanumeric(l)?[bs.makeAlphanumeric(l)]:[bs.makeBytes(bs.toUtf8ByteArray(l))]}static makeEci(l){let u=[];if(l<0)throw new RangeError("ECI assignment value out of range");if(l<128)r(l,8,u);else if(l<16384)r(2,2,u),r(l,14,u);else if(l<1e6)r(6,3,u),r(l,21,u);else throw new RangeError("ECI assignment value out of range");return new bs(bs.Mode.ECI,0,u)}static isNumeric(l){return bs.NUMERIC_REGEX.test(l)}static isAlphanumeric(l){return bs.ALPHANUMERIC_REGEX.test(l)}getData(){return this.bitData.slice()}static getTotalBits(l,u){let d=0;for(const p of l){const h=p.mode.numCharCountBits(u);if(p.numChars>=1<<h)return 1/0;d+=4+h+p.bitData.length}return d}static toUtf8ByteArray(l){l=encodeURI(l);let u=[];for(let d=0;d<l.length;d++)l.charAt(d)!="%"?u.push(l.charCodeAt(d)):(u.push(parseInt(l.substring(d+1,d+3),16)),d+=2);return u}};i.NUMERIC_REGEX=/^[0-9]*$/,i.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,i.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let o=i;t.QrSegment=i})(Ka||(Ka={}));(t=>{(s=>{const r=class{constructor(n,i){this.ordinal=n,this.formatBits=i}};r.LOW=new r(0,1),r.MEDIUM=new r(1,0),r.QUARTILE=new r(2,3),r.HIGH=new r(3,2),s.Ecc=r})(t.QrCode||(t.QrCode={}))})(Ka||(Ka={}));(t=>{(s=>{const r=class{constructor(n,i){this.modeBits=n,this.numBitsCharCount=i}numCharCountBits(n){return this.numBitsCharCount[Math.floor((n+7)/17)]}};r.NUMERIC=new r(1,[10,12,14]),r.ALPHANUMERIC=new r(2,[9,11,13]),r.BYTE=new r(4,[8,16,16]),r.KANJI=new r(8,[8,10,12]),r.ECI=new r(7,[0,0,0]),s.Mode=r})(t.QrSegment||(t.QrSegment={}))})(Ka||(Ka={}));var un=Ka;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var xC={L:un.QrCode.Ecc.LOW,M:un.QrCode.Ecc.MEDIUM,Q:un.QrCode.Ecc.QUARTILE,H:un.QrCode.Ecc.HIGH},Xx=128,Jx="L",Zx="#FFFFFF",eg="#000000",tg=!1,sg=1,gC=4,vC=0,yC=.1;function rg(t,s=0){const r=[];return t.forEach(function(a,n){let i=null;a.forEach(function(o,c){if(!o&&i!==null){r.push(`M${i+s} ${n+s}h${c-i}v1H${i+s}z`),i=null;return}if(c===a.length-1){if(!o)return;i===null?r.push(`M${c+s},${n+s} h1v1H${c+s}z`):r.push(`M${i+s},${n+s} h${c+1-i}v1H${i+s}z`);return}o&&i===null&&(i=c)})}),r.join("")}function ag(t,s){return t.slice().map((r,a)=>a<s.y||a>=s.y+s.h?r:r.map((n,i)=>i<s.x||i>=s.x+s.w?n:!1))}function jC(t,s,r,a){if(a==null)return null;const n=t.length+r*2,i=Math.floor(s*yC),o=n/s,c=(a.width||i)*o,l=(a.height||i)*o,u=a.x==null?t.length/2-c/2:a.x*o,d=a.y==null?t.length/2-l/2:a.y*o,p=a.opacity==null?1:a.opacity;let h=null;if(a.excavate){let y=Math.floor(u),v=Math.floor(d),b=Math.ceil(c+u-y),N=Math.ceil(l+d-v);h={x:y,y:v,w:b,h:N}}const f=a.crossOrigin;return{x:u,y:d,h:l,w:c,excavation:h,opacity:p,crossOrigin:f}}function bC(t,s){return s!=null?Math.max(Math.floor(s),0):t?gC:vC}function ng({value:t,level:s,minVersion:r,includeMargin:a,marginSize:n,imageSettings:i,size:o,boostLevel:c}){let l=ue.useMemo(()=>{const y=(Array.isArray(t)?t:[t]).reduce((v,b)=>(v.push(...un.QrSegment.makeSegments(b)),v),[]);return un.QrCode.encodeSegments(y,xC[s],r,void 0,void 0,c)},[t,s,r,c]);const{cells:u,margin:d,numCells:p,calculatedImageSettings:h}=ue.useMemo(()=>{let f=l.getModules();const y=bC(a,n),v=f.length+y*2,b=jC(f,o,y,i);return{cells:f,margin:y,numCells:v,calculatedImageSettings:b}},[l,o,i,a,n]);return{qrcode:l,margin:d,cells:u,numCells:p,calculatedImageSettings:h}}var wC=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),NC=ue.forwardRef(function(s,r){const a=s,{value:n,size:i=Xx,level:o=Jx,bgColor:c=Zx,fgColor:l=eg,includeMargin:u=tg,minVersion:d=sg,boostLevel:p,marginSize:h,imageSettings:f}=a,v=Hc(a,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:b}=v,N=Hc(v,["style"]),A=f?.src,j=ue.useRef(null),C=ue.useRef(null),I=ue.useCallback(q=>{j.current=q,typeof r=="function"?r(q):r&&(r.current=q)},[r]),[k,R]=ue.useState(!1),{margin:S,cells:T,numCells:E,calculatedImageSettings:D}=ng({value:n,level:o,minVersion:d,boostLevel:p,includeMargin:u,marginSize:h,imageSettings:f,size:i});ue.useEffect(()=>{if(j.current!=null){const q=j.current,B=q.getContext("2d");if(!B)return;let L=T;const P=C.current,K=D!=null&&P!==null&&P.complete&&P.naturalHeight!==0&&P.naturalWidth!==0;K&&D.excavation!=null&&(L=ag(T,D.excavation));const $=window.devicePixelRatio||1;q.height=q.width=i*$;const se=i/E*$;B.scale(se,se),B.fillStyle=c,B.fillRect(0,0,E,E),B.fillStyle=l,wC?B.fill(new Path2D(rg(L,S))):T.forEach(function(ne,Y){ne.forEach(function(fe,me){fe&&B.fillRect(me+S,Y+S,1,1)})}),D&&(B.globalAlpha=D.opacity),K&&B.drawImage(P,D.x+S,D.y+S,D.w,D.h)}}),ue.useEffect(()=>{R(!1)},[A]);const F=Uc({height:i,width:i},b);let H=null;return A!=null&&(H=ue.createElement("img",{src:A,key:A,style:{display:"none"},onLoad:()=>{R(!0)},ref:C,crossOrigin:D?.crossOrigin})),ue.createElement(ue.Fragment,null,ue.createElement("canvas",Uc({style:F,height:i,width:i,ref:I,role:"img"},N)),H)});NC.displayName="QRCodeCanvas";var ig=ue.forwardRef(function(s,r){const a=s,{value:n,size:i=Xx,level:o=Jx,bgColor:c=Zx,fgColor:l=eg,includeMargin:u=tg,minVersion:d=sg,boostLevel:p,title:h,marginSize:f,imageSettings:y}=a,v=Hc(a,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:b,cells:N,numCells:A,calculatedImageSettings:j}=ng({value:n,level:o,minVersion:d,boostLevel:p,includeMargin:u,marginSize:f,imageSettings:y,size:i});let C=N,I=null;y!=null&&j!=null&&(j.excavation!=null&&(C=ag(N,j.excavation)),I=ue.createElement("image",{href:y.src,height:j.h,width:j.w,x:j.x+b,y:j.y+b,preserveAspectRatio:"none",opacity:j.opacity,crossOrigin:j.crossOrigin}));const k=rg(C,b);return ue.createElement("svg",Uc({height:i,width:i,viewBox:`0 0 ${A} ${A}`,ref:r,role:"img"},v),!!h&&ue.createElement("title",null,h),ue.createElement("path",{fill:c,d:`M0,0 h${A}v${A}H0z`,shapeRendering:"crispEdges"}),ue.createElement("path",{fill:l,d:k,shapeRendering:"crispEdges"}),I)});ig.displayName="QRCodeSVG";const _C=({listingId:t,traceCode:s,traceStatus:r,productName:a,onTraceCodeGenerated:n,onStatusChange:i})=>{const{toast:o}=hs(),[c,l]=x.useState(!1),[u,d]=x.useState(!1),[p,h]=x.useState(!1),f=x.useRef(null),y=window.location.origin,v=s?`${y}/trace/listing/${s}`:null,b=async()=>{if(v)try{await navigator.clipboard.writeText(v),l(!0),o({title:"Link Copied!",description:"Trace link copied to clipboard"}),setTimeout(()=>l(!1),2e3)}catch{o({title:"Copy Failed",description:"Please copy the link manually",variant:"destructive"})}},N=()=>{if(!f.current||!s)return;const C=f.current.querySelector("svg");if(!C)return;const I=document.createElement("canvas"),k=I.getContext("2d"),R=new XMLSerializer().serializeToString(C),S=new Image;S.onload=()=>{I.width=300,I.height=350,k&&(k.fillStyle="white",k.fillRect(0,0,I.width,I.height),k.drawImage(S,50,20,200,200),k.fillStyle="black",k.font="bold 14px Arial",k.textAlign="center",k.fillText(a.slice(0,30),I.width/2,250),k.font="12px Arial",k.fillStyle="#666",k.fillText(s,I.width/2,275),k.fillText("Scan to verify origin",I.width/2,295),k.font="10px Arial",k.fillStyle="#16a34a",k.fillText("Verified on AgriNext Gen",I.width/2,330));const T=document.createElement("a");T.download=`QR-${s}.png`,T.href=I.toDataURL("image/png"),T.click(),o({title:"QR Downloaded",description:"QR code saved as PNG"})},S.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(R)))},A=async()=>{d(!0);try{const C=new Date().getFullYear(),{data:I}=await W.from("listings").select("trace_code").like("trace_code",`AGN-LST-${C}-%`);let k=0;I&&I.forEach(T=>{if(T.trace_code){const E=T.trace_code.match(/AGN-LST-\d{4}-(\d+)/);if(E){const D=parseInt(E[1],10);D>k&&(k=D)}}});const R=`AGN-LST-${C}-${String(k+1).padStart(6,"0")}`,{error:S}=await W.from("listings").update({trace_code:R}).eq("id",t);if(S)throw S;o({title:"Trace Code Generated!",description:`Code: ${R}`}),n?.(R)}catch(C){console.error("Error generating trace code:",C),o({title:"Generation Failed",description:"Could not generate trace code",variant:"destructive"})}finally{d(!1)}},j=async()=>{h(!0);const C=r==="published"?"draft":"published";try{const{error:I}=await W.from("listings").update({trace_status:C}).eq("id",t);if(I)throw I;o({title:C==="published"?"Trace Published":"Trace Unpublished",description:C==="published"?"Product trace is now publicly visible":"Product trace is now hidden from public"}),i?.(C)}catch(I){console.error("Error updating trace status:",I),o({title:"Update Failed",description:"Could not update trace status",variant:"destructive"})}finally{h(!1)}};return s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{variant:r==="published"?"default":"secondary",className:r==="published"?"bg-green-600":"",children:r==="published"?"Public":"Draft"}),e.jsxs(zt,{children:[e.jsx(Wr,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(hi,{className:"h-4 w-4"}),"QR"]})}),e.jsxs(It,{className:"sm:max-w-md",children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Product Trace QR Code"}),e.jsx(Ks,{children:"Share this QR code for product traceability"})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-4 py-4",children:[e.jsx("div",{ref:f,className:"bg-white p-4 rounded-lg border",children:e.jsx(ig,{value:v,size:180,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-mono text-sm text-muted-foreground",children:s}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Public Link:"}),e.jsx("div",{className:"flex items-center gap-2 p-2 bg-muted rounded text-xs break-all",children:e.jsx("span",{className:"flex-1 font-mono",children:v})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 w-full justify-center",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:b,className:"gap-2",children:[c?e.jsx(Cr,{className:"h-4 w-4"}):e.jsx(Nc,{className:"h-4 w-4"}),c?"Copied!":"Copy Link"]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:N,className:"gap-2",children:[e.jsx(ui,{className:"h-4 w-4"}),"Download QR"]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>window.open(v,"_blank"),className:"gap-2",children:[e.jsx(ya,{className:"h-4 w-4"}),"Preview"]})]}),e.jsx("div",{className:"w-full pt-4 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Public Visibility"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r==="published"?"Anyone with the link can view":"Hidden from public access"})]}),e.jsx(z,{variant:r==="published"?"default":"outline",size:"sm",onClick:j,disabled:p,className:"gap-2",children:r==="published"?e.jsxs(e.Fragment,{children:[e.jsx(sa,{className:"h-4 w-4"})," Published"]}):e.jsxs(e.Fragment,{children:[e.jsx(dd,{className:"h-4 w-4"})," Draft"]})})]})})]})]})]}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:b,title:"Copy trace link",children:c?e.jsx(Cr,{className:"h-4 w-4 text-green-600"}):e.jsx(Nc,{className:"h-4 w-4"})})]}):e.jsxs(z,{variant:"outline",size:"sm",onClick:A,disabled:u,className:"gap-2",children:[e.jsx(hi,{className:"h-4 w-4"}),u?"Generating...":"Generate QR"]})},kC=({crops:t,isLoading:s,selectedCropId:r,onSelectCrop:a,sourceMode:n,onSourceModeChange:i})=>e.jsxs("div",{className:"space-y-3",children:[e.jsx(ie,{className:"text-sm font-medium",children:"Listing Source"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>i("crop"),className:`flex-1 p-3 rounded-lg border-2 text-left transition-colors ${n==="crop"?"border-primary bg-primary/5":"border-border hover:border-muted-foreground/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"From My Crops"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Auto-fill from crop data"})]}),e.jsxs("button",{type:"button",onClick:()=>i("custom"),className:`flex-1 p-3 rounded-lg border-2 text-left transition-colors ${n==="custom"?"border-primary bg-primary/5":"border-border hover:border-muted-foreground/50"}`,children:[e.jsx("span",{className:"text-sm font-medium",children:"Custom Listing"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter details manually"})]})]}),n==="crop"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{className:"text-xs",children:"Select Crop"}),e.jsxs(lt,{value:r,onValueChange:a,disabled:s,children:[e.jsx(it,{children:e.jsx(ct,{placeholder:s?"Loading crops...":"Choose a crop..."})}),e.jsxs(ot,{children:[t.map(o=>e.jsx(ge,{value:o.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[o.crop_name,o.variety?` (${o.variety})`:""]}),e.jsx(he,{variant:"outline",className:"text-xs",children:o.status})]})},o.id)),t.length===0&&!s&&e.jsx(ge,{value:"_none",disabled:!0,children:"No crops available"})]})]})]})]}),CC=({settings:t,onChange:s})=>{const r=(a,n)=>{s({...t,[a]:n})};return e.jsxs("div",{className:"space-y-4 p-4 rounded-lg border border-border bg-muted/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hr,{className:"h-4 w-4 text-primary"}),e.jsx(ie,{className:"text-sm font-medium",children:"Traceability Settings (QR Page)"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Control what buyers see when scanning your QR code"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ie,{className:"text-xs",children:"Origin Detail Level"}),e.jsxs(lt,{value:t.show_origin_level,onValueChange:a=>r("show_origin_level",a),children:[e.jsx(it,{className:"h-9",children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"district",children:"District only"}),e.jsx(ge,{value:"district_village",children:"District + Village"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ie,{className:"text-xs",children:"Show crop details"}),e.jsx(xa,{checked:t.show_crop_details,onCheckedChange:a=>r("show_crop_details",a)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ie,{className:"text-xs",children:"Show crop timeline"}),e.jsx(xa,{checked:t.show_crop_timeline,onCheckedChange:a=>r("show_crop_timeline",a)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ie,{className:"text-xs",children:"Show stage photos on QR"}),e.jsx(xa,{checked:t.show_stage_photos,onCheckedChange:a=>r("show_stage_photos",a)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ie,{className:"text-xs",children:"Show input/fertilizer photos on QR"}),e.jsx(xa,{checked:t.show_input_photos,onCheckedChange:a=>r("show_input_photos",a)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ie,{className:"text-xs",children:"Show soil report on QR"}),e.jsx(xa,{checked:t.show_soil_report,onCheckedChange:a=>r("show_soil_report",a)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ie,{className:"text-xs",children:"Show geo verification badge"}),e.jsx(xa,{checked:t.show_geo_proof??!1,onCheckedChange:a=>r("show_geo_proof",a)})]})]})]})};var hl="Checkbox",[SC]=wr(hl),[AC,ru]=SC(hl);function TC(t){const{__scopeCheckbox:s,checked:r,children:a,defaultChecked:n,disabled:i,form:o,name:c,onCheckedChange:l,required:u,value:d="on",internal_do_not_use_render:p}=t,[h,f]=ra({prop:r,defaultProp:n??!1,onChange:l,caller:hl}),[y,v]=x.useState(null),[b,N]=x.useState(null),A=x.useRef(!1),j=y?!!o||!!y.closest("form"):!0,C={checked:h,disabled:i,setChecked:f,control:y,setControl:v,name:c,form:o,value:d,hasConsumerStoppedPropagationRef:A,required:u,defaultChecked:ja(n)?!1:n,isFormControl:j,bubbleInput:b,setBubbleInput:N};return e.jsx(AC,{scope:s,...C,children:PC(p)?p(C):a})}var og="CheckboxTrigger",lg=x.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:r,...a},n)=>{const{control:i,value:o,disabled:c,checked:l,required:u,setControl:d,setChecked:p,hasConsumerStoppedPropagationRef:h,isFormControl:f,bubbleInput:y}=ru(og,t),v=Ht(n,d),b=x.useRef(l);return x.useEffect(()=>{const N=i?.form;if(N){const A=()=>p(b.current);return N.addEventListener("reset",A),()=>N.removeEventListener("reset",A)}},[i,p]),e.jsx(ht.button,{type:"button",role:"checkbox","aria-checked":ja(l)?"mixed":l,"aria-required":u,"data-state":hg(l),"data-disabled":c?"":void 0,disabled:c,value:o,...a,ref:v,onKeyDown:st(s,N=>{N.key==="Enter"&&N.preventDefault()}),onClick:st(r,N=>{p(A=>ja(A)?!0:!A),y&&f&&(h.current=N.isPropagationStopped(),h.current||N.stopPropagation())})})});lg.displayName=og;var au=x.forwardRef((t,s)=>{const{__scopeCheckbox:r,name:a,checked:n,defaultChecked:i,required:o,disabled:c,value:l,onCheckedChange:u,form:d,...p}=t;return e.jsx(TC,{__scopeCheckbox:r,checked:n,defaultChecked:i,disabled:c,required:o,onCheckedChange:u,name:a,form:d,value:l,internal_do_not_use_render:({isFormControl:h})=>e.jsxs(e.Fragment,{children:[e.jsx(lg,{...p,ref:s,__scopeCheckbox:r}),h&&e.jsx(mg,{__scopeCheckbox:r})]})})});au.displayName=hl;var cg="CheckboxIndicator",dg=x.forwardRef((t,s)=>{const{__scopeCheckbox:r,forceMount:a,...n}=t,i=ru(cg,r);return e.jsx(Lr,{present:a||ja(i.checked)||i.checked===!0,children:e.jsx(ht.span,{"data-state":hg(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:s,style:{pointerEvents:"none",...t.style}})})});dg.displayName=cg;var ug="CheckboxBubbleInput",mg=x.forwardRef(({__scopeCheckbox:t,...s},r)=>{const{control:a,hasConsumerStoppedPropagationRef:n,checked:i,defaultChecked:o,required:c,disabled:l,name:u,value:d,form:p,bubbleInput:h,setBubbleInput:f}=ru(ug,t),y=Ht(r,f),v=rl(i),b=ad(a);x.useEffect(()=>{const A=h;if(!A)return;const j=window.HTMLInputElement.prototype,I=Object.getOwnPropertyDescriptor(j,"checked").set,k=!n.current;if(v!==i&&I){const R=new Event("click",{bubbles:k});A.indeterminate=ja(i),I.call(A,ja(i)?!1:i),A.dispatchEvent(R)}},[h,v,i,n]);const N=x.useRef(ja(i)?!1:i);return e.jsx(ht.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??N.current,required:c,disabled:l,name:u,value:d,form:p,...s,tabIndex:-1,ref:y,style:{...s.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});mg.displayName=ug;function PC(t){return typeof t=="function"}function ja(t){return t==="indeterminate"}function hg(t){return ja(t)?"indeterminate":t?"checked":"unchecked"}const Vc=x.forwardRef(({className:t,...s},r)=>e.jsx(au,{ref:r,className:ke("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(dg,{className:ke("flex items-center justify-center text-current"),children:e.jsx(Cr,{className:"h-4 w-4"})})}));Vc.displayName=au.displayName;function MC(t,s){return s.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(a){if(a!=="default"&&!(a in t)){var n=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return r[a]}})}})}),Object.freeze(t)}function pg(t,s){return new Promise(function(r,a){let n;return RC(t).then(function(i){try{return n=i,r(new Blob([s.slice(0,2),n,s.slice(2)],{type:"image/jpeg"}))}catch(o){return a(o)}},a)})}const RC=t=>new Promise((s,r)=>{const a=new FileReader;a.addEventListener("load",({target:{result:n}})=>{const i=new DataView(n);let o=0;if(i.getUint16(o)!==65496)return r("not a valid JPEG");for(o+=2;;){const c=i.getUint16(o);if(c===65498)break;const l=i.getUint16(o+2);if(c===65505&&i.getUint32(o+4)===1165519206){const u=o+10;let d;switch(i.getUint16(u)){case 18761:d=!0;break;case 19789:d=!1;break;default:return r("TIFF header contains invalid endian")}if(i.getUint16(u+2,d)!==42)return r("TIFF header contains invalid version");const p=i.getUint32(u+4,d),h=u+p+2+12*i.getUint16(u+p,d);for(let f=u+p+2;f<h;f+=12)if(i.getUint16(f,d)==274){if(i.getUint16(f+2,d)!==3)return r("Orientation data type is invalid");if(i.getUint32(f+4,d)!==1)return r("Orientation data count is invalid");i.setUint16(f+8,1,d);break}return s(n.slice(o,o+2+l))}o+=2+l}return s(new Blob)}),a.readAsArrayBuffer(t)});var Oo={},DC={get exports(){return Oo},set exports(t){Oo=t}};(function(t){var s,r,a={};DC.exports=a,a.parse=function(n,i){for(var o=a.bin.readUshort,c=a.bin.readUint,l=0,u={},d=new Uint8Array(n),p=d.length-4;c(d,p)!=101010256;)p--;l=p,l+=4;var h=o(d,l+=4);o(d,l+=2);var f=c(d,l+=2),y=c(d,l+=4);l+=4,l=y;for(var v=0;v<h;v++){c(d,l),l+=4,l+=4,l+=4,c(d,l+=4),f=c(d,l+=4);var b=c(d,l+=4),N=o(d,l+=4),A=o(d,l+2),j=o(d,l+4);l+=6;var C=c(d,l+=8);l+=4,l+=N+A+j,a._readLocal(d,C,u,f,b,i)}return u},a._readLocal=function(n,i,o,c,l,u){var d=a.bin.readUshort,p=a.bin.readUint;p(n,i),d(n,i+=4),d(n,i+=2);var h=d(n,i+=2);p(n,i+=2),p(n,i+=4),i+=4;var f=d(n,i+=8),y=d(n,i+=2);i+=2;var v=a.bin.readUTF8(n,i,f);if(i+=f,i+=y,u)o[v]={size:l,csize:c};else{var b=new Uint8Array(n.buffer,i);if(h==0)o[v]=new Uint8Array(b.buffer.slice(i,i+c));else{if(h!=8)throw"unknown compression method: "+h;var N=new Uint8Array(l);a.inflateRaw(b,N),o[v]=N}}},a.inflateRaw=function(n,i){return a.F.inflate(n,i)},a.inflate=function(n,i){return n[0],n[1],a.inflateRaw(new Uint8Array(n.buffer,n.byteOffset+2,n.length-6),i)},a.deflate=function(n,i){i==null&&(i={level:6});var o=0,c=new Uint8Array(50+Math.floor(1.1*n.length));c[o]=120,c[o+1]=156,o+=2,o=a.F.deflateRaw(n,c,o,i.level);var l=a.adler(n,0,n.length);return c[o+0]=l>>>24&255,c[o+1]=l>>>16&255,c[o+2]=l>>>8&255,c[o+3]=l>>>0&255,new Uint8Array(c.buffer,0,o+4)},a.deflateRaw=function(n,i){i==null&&(i={level:6});var o=new Uint8Array(50+Math.floor(1.1*n.length)),c=a.F.deflateRaw(n,o,c,i.level);return new Uint8Array(o.buffer,0,c)},a.encode=function(n,i){i==null&&(i=!1);var o=0,c=a.bin.writeUint,l=a.bin.writeUshort,u={};for(var d in n){var p=!a._noNeed(d)&&!i,h=n[d],f=a.crc.crc(h,0,h.length);u[d]={cpr:p,usize:h.length,crc:f,file:p?a.deflateRaw(h):h}}for(var d in u)o+=u[d].file.length+30+46+2*a.bin.sizeUTF8(d);o+=22;var y=new Uint8Array(o),v=0,b=[];for(var d in u){var N=u[d];b.push(v),v=a._writeHeader(y,v,d,N,0)}var A=0,j=v;for(var d in u)N=u[d],b.push(v),v=a._writeHeader(y,v,d,N,1,b[A++]);var C=v-j;return c(y,v,101010256),v+=4,l(y,v+=4,A),l(y,v+=2,A),c(y,v+=2,C),c(y,v+=4,j),v+=4,v+=2,y.buffer},a._noNeed=function(n){var i=n.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(i)!=-1},a._writeHeader=function(n,i,o,c,l,u){var d=a.bin.writeUint,p=a.bin.writeUshort,h=c.file;return d(n,i,l==0?67324752:33639248),i+=4,l==1&&(i+=2),p(n,i,20),p(n,i+=2,0),p(n,i+=2,c.cpr?8:0),d(n,i+=2,0),d(n,i+=4,c.crc),d(n,i+=4,h.length),d(n,i+=4,c.usize),p(n,i+=4,a.bin.sizeUTF8(o)),p(n,i+=2,0),i+=2,l==1&&(i+=2,i+=2,d(n,i+=6,u),i+=4),i+=a.bin.writeUTF8(n,i,o),l==0&&(n.set(h,i),i+=h.length),i},a.crc={table:function(){for(var n=new Uint32Array(256),i=0;i<256;i++){for(var o=i,c=0;c<8;c++)1&o?o=3988292384^o>>>1:o>>>=1;n[i]=o}return n}(),update:function(n,i,o,c){for(var l=0;l<c;l++)n=a.crc.table[255&(n^i[o+l])]^n>>>8;return n},crc:function(n,i,o){return 4294967295^a.crc.update(4294967295,n,i,o)}},a.adler=function(n,i,o){for(var c=1,l=0,u=i,d=i+o;u<d;){for(var p=Math.min(u+5552,d);u<p;)l+=c+=n[u++];c%=65521,l%=65521}return l<<16|c},a.bin={readUshort:function(n,i){return n[i]|n[i+1]<<8},writeUshort:function(n,i,o){n[i]=255&o,n[i+1]=o>>8&255},readUint:function(n,i){return 16777216*n[i+3]+(n[i+2]<<16|n[i+1]<<8|n[i])},writeUint:function(n,i,o){n[i]=255&o,n[i+1]=o>>8&255,n[i+2]=o>>16&255,n[i+3]=o>>24&255},readASCII:function(n,i,o){for(var c="",l=0;l<o;l++)c+=String.fromCharCode(n[i+l]);return c},writeASCII:function(n,i,o){for(var c=0;c<o.length;c++)n[i+c]=o.charCodeAt(c)},pad:function(n){return n.length<2?"0"+n:n},readUTF8:function(n,i,o){for(var c,l="",u=0;u<o;u++)l+="%"+a.bin.pad(n[i+u].toString(16));try{c=decodeURIComponent(l)}catch{return a.bin.readASCII(n,i,o)}return c},writeUTF8:function(n,i,o){for(var c=o.length,l=0,u=0;u<c;u++){var d=o.charCodeAt(u);if(!(4294967168&d))n[i+l]=d,l++;else if(!(4294965248&d))n[i+l]=192|d>>6,n[i+l+1]=128|d>>0&63,l+=2;else if(!(4294901760&d))n[i+l]=224|d>>12,n[i+l+1]=128|d>>6&63,n[i+l+2]=128|d>>0&63,l+=3;else{if(4292870144&d)throw"e";n[i+l]=240|d>>18,n[i+l+1]=128|d>>12&63,n[i+l+2]=128|d>>6&63,n[i+l+3]=128|d>>0&63,l+=4}}return l},sizeUTF8:function(n){for(var i=n.length,o=0,c=0;c<i;c++){var l=n.charCodeAt(c);if(!(4294967168&l))o++;else if(!(4294965248&l))o+=2;else if(!(4294901760&l))o+=3;else{if(4292870144&l)throw"e";o+=4}}return o}},a.F={},a.F.deflateRaw=function(n,i,o,c){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],u=a.F.U,d=a.F._goodIndex;a.F._hash;var p=a.F._putsE,h=0,f=o<<3,y=0,v=n.length;if(c==0){for(;h<v;)p(i,f,h+(D=Math.min(65535,v-h))==v?1:0),f=a.F._copyExact(n,h,D,i,f+8),h+=D;return f>>>3}var b=u.lits,N=u.strt,A=u.prev,j=0,C=0,I=0,k=0,R=0,S=0;for(v>2&&(N[S=a.F._hash(n,0)]=0),h=0;h<v;h++){if(R=S,h+1<v-2){S=a.F._hash(n,h+1);var T=h+1&32767;A[T]=N[S],N[S]=T}if(y<=h){(j>14e3||C>26697)&&v-h>100&&(y<h&&(b[j]=h-y,j+=2,y=h),f=a.F._writeBlock(h==v-1||y==v?1:0,b,j,k,n,I,h-I,i,f),j=C=k=0,I=h);var E=0;h<v-2&&(E=a.F._bestMatch(n,h,A,R,Math.min(l[2],v-h),l[3]));var D=E>>>16,F=65535&E;if(E!=0){F=65535&E;var H=d(D=E>>>16,u.of0);u.lhst[257+H]++;var q=d(F,u.df0);u.dhst[q]++,k+=u.exb[H]+u.dxb[q],b[j]=D<<23|h-y,b[j+1]=F<<16|H<<8|q,j+=2,y=h+D}else u.lhst[n[h]]++;C++}}for(I==h&&n.length!=0||(y<h&&(b[j]=h-y,j+=2,y=h),f=a.F._writeBlock(1,b,j,k,n,I,h-I,i,f),j=0,C=0,j=C=k=0,I=h);7&f;)f++;return f>>>3},a.F._bestMatch=function(n,i,o,c,l,u){var d=32767&i,p=o[d],h=d-p+32768&32767;if(p==d||c!=a.F._hash(n,i-h))return 0;for(var f=0,y=0,v=Math.min(32767,i);h<=v&&--u!=0&&p!=d;){if(f==0||n[i+f]==n[i+f-h]){var b=a.F._howLong(n,i,h);if(b>f){if(y=h,(f=b)>=l)break;h+2<b&&(b=h+2);for(var N=0,A=0;A<b-2;A++){var j=i-h+A+32768&32767,C=j-o[j]+32768&32767;C>N&&(N=C,p=j)}}}h+=(d=p)-(p=o[d])+32768&32767}return f<<16|y},a.F._howLong=function(n,i,o){if(n[i]!=n[i-o]||n[i+1]!=n[i+1-o]||n[i+2]!=n[i+2-o])return 0;var c=i,l=Math.min(n.length,i+258);for(i+=3;i<l&&n[i]==n[i-o];)i++;return i-c},a.F._hash=function(n,i){return(n[i]<<8|n[i+1])+(n[i+2]<<4)&65535},a.saved=0,a.F._writeBlock=function(n,i,o,c,l,u,d,p,h){var f,y,v,b,N,A,j,C,I,k=a.F.U,R=a.F._putsF,S=a.F._putsE;k.lhst[256]++,y=(f=a.F.getTrees())[0],v=f[1],b=f[2],N=f[3],A=f[4],j=f[5],C=f[6],I=f[7];var T=32+(h+3&7?8-(h+3&7):0)+(d<<3),E=c+a.F.contSize(k.fltree,k.lhst)+a.F.contSize(k.fdtree,k.dhst),D=c+a.F.contSize(k.ltree,k.lhst)+a.F.contSize(k.dtree,k.dhst);D+=14+3*j+a.F.contSize(k.itree,k.ihst)+(2*k.ihst[16]+3*k.ihst[17]+7*k.ihst[18]);for(var F=0;F<286;F++)k.lhst[F]=0;for(F=0;F<30;F++)k.dhst[F]=0;for(F=0;F<19;F++)k.ihst[F]=0;var H=T<E&&T<D?0:E<D?1:2;if(R(p,h,n),R(p,h+1,H),h+=3,H==0){for(;7&h;)h++;h=a.F._copyExact(l,u,d,p,h)}else{var q,B;if(H==1&&(q=k.fltree,B=k.fdtree),H==2){a.F.makeCodes(k.ltree,y),a.F.revCodes(k.ltree,y),a.F.makeCodes(k.dtree,v),a.F.revCodes(k.dtree,v),a.F.makeCodes(k.itree,b),a.F.revCodes(k.itree,b),q=k.ltree,B=k.dtree,S(p,h,N-257),S(p,h+=5,A-1),S(p,h+=5,j-4),h+=4;for(var L=0;L<j;L++)S(p,h+3*L,k.itree[1+(k.ordr[L]<<1)]);h+=3*j,h=a.F._codeTiny(C,k.itree,p,h),h=a.F._codeTiny(I,k.itree,p,h)}for(var P=u,K=0;K<o;K+=2){for(var $=i[K],se=$>>>23,ne=P+(8388607&$);P<ne;)h=a.F._writeLit(l[P++],q,p,h);if(se!=0){var Y=i[K+1],fe=Y>>16,me=Y>>8&255,xe=255&Y;S(p,h=a.F._writeLit(257+me,q,p,h),se-k.of0[me]),h+=k.exb[me],R(p,h=a.F._writeLit(xe,B,p,h),fe-k.df0[xe]),h+=k.dxb[xe],P+=se}}h=a.F._writeLit(256,q,p,h)}return h},a.F._copyExact=function(n,i,o,c,l){var u=l>>>3;return c[u]=o,c[u+1]=o>>>8,c[u+2]=255-c[u],c[u+3]=255-c[u+1],u+=4,c.set(new Uint8Array(n.buffer,i,o),u),l+(o+4<<3)},a.F.getTrees=function(){for(var n=a.F.U,i=a.F._hufTree(n.lhst,n.ltree,15),o=a.F._hufTree(n.dhst,n.dtree,15),c=[],l=a.F._lenCodes(n.ltree,c),u=[],d=a.F._lenCodes(n.dtree,u),p=0;p<c.length;p+=2)n.ihst[c[p]]++;for(p=0;p<u.length;p+=2)n.ihst[u[p]]++;for(var h=a.F._hufTree(n.ihst,n.itree,7),f=19;f>4&&n.itree[1+(n.ordr[f-1]<<1)]==0;)f--;return[i,o,h,l,d,f,c,u]},a.F.getSecond=function(n){for(var i=[],o=0;o<n.length;o+=2)i.push(n[o+1]);return i},a.F.nonZero=function(n){for(var i="",o=0;o<n.length;o+=2)n[o+1]!=0&&(i+=(o>>1)+",");return i},a.F.contSize=function(n,i){for(var o=0,c=0;c<i.length;c++)o+=i[c]*n[1+(c<<1)];return o},a.F._codeTiny=function(n,i,o,c){for(var l=0;l<n.length;l+=2){var u=n[l],d=n[l+1];c=a.F._writeLit(u,i,o,c);var p=u==16?2:u==17?3:7;u>15&&(a.F._putsE(o,c,d,p),c+=p)}return c},a.F._lenCodes=function(n,i){for(var o=n.length;o!=2&&n[o-1]==0;)o-=2;for(var c=0;c<o;c+=2){var l=n[c+1],u=c+3<o?n[c+3]:-1,d=c+5<o?n[c+5]:-1,p=c==0?-1:n[c-1];if(l==0&&u==l&&d==l){for(var h=c+5;h+2<o&&n[h+2]==l;)h+=2;(f=Math.min(h+1-c>>>1,138))<11?i.push(17,f-3):i.push(18,f-11),c+=2*f-2}else if(l==p&&u==l&&d==l){for(h=c+5;h+2<o&&n[h+2]==l;)h+=2;var f=Math.min(h+1-c>>>1,6);i.push(16,f-3),c+=2*f-2}else i.push(l,0)}return o>>>1},a.F._hufTree=function(n,i,o){var c=[],l=n.length,u=i.length,d=0;for(d=0;d<u;d+=2)i[d]=0,i[d+1]=0;for(d=0;d<l;d++)n[d]!=0&&c.push({lit:d,f:n[d]});var p=c.length,h=c.slice(0);if(p==0)return 0;if(p==1){var f=c[0].lit;return h=f==0?1:0,i[1+(f<<1)]=1,i[1+(h<<1)]=1,1}c.sort(function(C,I){return C.f-I.f});var y=c[0],v=c[1],b=0,N=1,A=2;for(c[0]={lit:-1,f:y.f+v.f,l:y,r:v,d:0};N!=p-1;)y=b!=N&&(A==p||c[b].f<c[A].f)?c[b++]:c[A++],v=b!=N&&(A==p||c[b].f<c[A].f)?c[b++]:c[A++],c[N++]={lit:-1,f:y.f+v.f,l:y,r:v};var j=a.F.setDepth(c[N-1],0);for(j>o&&(a.F.restrictDepth(h,o,j),j=o),d=0;d<p;d++)i[1+(h[d].lit<<1)]=h[d].d;return j},a.F.setDepth=function(n,i){return n.lit!=-1?(n.d=i,i):Math.max(a.F.setDepth(n.l,i+1),a.F.setDepth(n.r,i+1))},a.F.restrictDepth=function(n,i,o){var c=0,l=1<<o-i,u=0;for(n.sort(function(p,h){return h.d==p.d?p.f-h.f:h.d-p.d}),c=0;c<n.length&&n[c].d>i;c++){var d=n[c].d;n[c].d=i,u+=l-(1<<o-d)}for(u>>>=o-i;u>0;)(d=n[c].d)<i?(n[c].d++,u-=1<<i-d-1):c++;for(;c>=0;c--)n[c].d==i&&u<0&&(n[c].d--,u++);u!=0&&console.log("debt left")},a.F._goodIndex=function(n,i){var o=0;return i[16|o]<=n&&(o|=16),i[8|o]<=n&&(o|=8),i[4|o]<=n&&(o|=4),i[2|o]<=n&&(o|=2),i[1|o]<=n&&(o|=1),o},a.F._writeLit=function(n,i,o,c){return a.F._putsF(o,c,i[n<<1]),c+i[1+(n<<1)]},a.F.inflate=function(n,i){var o=Uint8Array;if(n[0]==3&&n[1]==0)return i||new o(0);var c=a.F,l=c._bitsF,u=c._bitsE,d=c._decodeTiny,p=c.makeCodes,h=c.codes2map,f=c._get17,y=c.U,v=i==null;v&&(i=new o(n.length>>>2<<3));for(var b,N,A=0,j=0,C=0,I=0,k=0,R=0,S=0,T=0,E=0;A==0;)if(A=l(n,E,1),j=l(n,E+1,2),E+=3,j!=0){if(v&&(i=a.F._check(i,T+(1<<17))),j==1&&(b=y.flmap,N=y.fdmap,R=511,S=31),j==2){C=u(n,E,5)+257,I=u(n,E+5,5)+1,k=u(n,E+10,4)+4,E+=14;for(var D=0;D<38;D+=2)y.itree[D]=0,y.itree[D+1]=0;var F=1;for(D=0;D<k;D++){var H=u(n,E+3*D,3);y.itree[1+(y.ordr[D]<<1)]=H,H>F&&(F=H)}E+=3*k,p(y.itree,F),h(y.itree,F,y.imap),b=y.lmap,N=y.dmap,E=d(y.imap,(1<<F)-1,C+I,n,E,y.ttree);var q=c._copyOut(y.ttree,0,C,y.ltree);R=(1<<q)-1;var B=c._copyOut(y.ttree,C,I,y.dtree);S=(1<<B)-1,p(y.ltree,q),h(y.ltree,q,b),p(y.dtree,B),h(y.dtree,B,N)}for(;;){var L=b[f(n,E)&R];E+=15&L;var P=L>>>4;if(!(P>>>8))i[T++]=P;else{if(P==256)break;var K=T+P-254;if(P>264){var $=y.ldef[P-257];K=T+($>>>3)+u(n,E,7&$),E+=7&$}var se=N[f(n,E)&S];E+=15&se;var ne=se>>>4,Y=y.ddef[ne],fe=(Y>>>4)+l(n,E,15&Y);for(E+=15&Y,v&&(i=a.F._check(i,T+(1<<17)));T<K;)i[T]=i[T++-fe],i[T]=i[T++-fe],i[T]=i[T++-fe],i[T]=i[T++-fe];T=K}}}else{7&E&&(E+=8-(7&E));var me=4+(E>>>3),xe=n[me-4]|n[me-3]<<8;v&&(i=a.F._check(i,T+xe)),i.set(new o(n.buffer,n.byteOffset+me,xe),T),E=me+xe<<3,T+=xe}return i.length==T?i:i.slice(0,T)},a.F._check=function(n,i){var o=n.length;if(i<=o)return n;var c=new Uint8Array(Math.max(o<<1,i));return c.set(n,0),c},a.F._decodeTiny=function(n,i,o,c,l,u){for(var d=a.F._bitsE,p=a.F._get17,h=0;h<o;){var f=n[p(c,l)&i];l+=15&f;var y=f>>>4;if(y<=15)u[h]=y,h++;else{var v=0,b=0;y==16?(b=3+d(c,l,2),l+=2,v=u[h-1]):y==17?(b=3+d(c,l,3),l+=3):y==18&&(b=11+d(c,l,7),l+=7);for(var N=h+b;h<N;)u[h]=v,h++}}return l},a.F._copyOut=function(n,i,o,c){for(var l=0,u=0,d=c.length>>>1;u<o;){var p=n[u+i];c[u<<1]=0,c[1+(u<<1)]=p,p>l&&(l=p),u++}for(;u<d;)c[u<<1]=0,c[1+(u<<1)]=0,u++;return l},a.F.makeCodes=function(n,i){for(var o,c,l,u,d=a.F.U,p=n.length,h=d.bl_count,f=0;f<=i;f++)h[f]=0;for(f=1;f<p;f+=2)h[n[f]]++;var y=d.next_code;for(o=0,h[0]=0,c=1;c<=i;c++)o=o+h[c-1]<<1,y[c]=o;for(l=0;l<p;l+=2)(u=n[l+1])!=0&&(n[l]=y[u],y[u]++)},a.F.codes2map=function(n,i,o){for(var c=n.length,l=a.F.U.rev15,u=0;u<c;u+=2)if(n[u+1]!=0)for(var d=u>>1,p=n[u+1],h=d<<4|p,f=i-p,y=n[u]<<f,v=y+(1<<f);y!=v;)o[l[y]>>>15-i]=h,y++},a.F.revCodes=function(n,i){for(var o=a.F.U.rev15,c=15-i,l=0;l<n.length;l+=2){var u=n[l]<<i-n[l+1];n[l]=o[u]>>>c}},a.F._putsE=function(n,i,o){o<<=7&i;var c=i>>>3;n[c]|=o,n[c+1]|=o>>>8},a.F._putsF=function(n,i,o){o<<=7&i;var c=i>>>3;n[c]|=o,n[c+1]|=o>>>8,n[c+2]|=o>>>16},a.F._bitsE=function(n,i,o){return(n[i>>>3]|n[1+(i>>>3)]<<8)>>>(7&i)&(1<<o)-1},a.F._bitsF=function(n,i,o){return(n[i>>>3]|n[1+(i>>>3)]<<8|n[2+(i>>>3)]<<16)>>>(7&i)&(1<<o)-1},a.F._get17=function(n,i){return(n[i>>>3]|n[1+(i>>>3)]<<8|n[2+(i>>>3)]<<16)>>>(7&i)},a.F._get25=function(n,i){return(n[i>>>3]|n[1+(i>>>3)]<<8|n[2+(i>>>3)]<<16|n[3+(i>>>3)]<<24)>>>(7&i)},a.F.U=(s=Uint16Array,r=Uint32Array,{next_code:new s(16),bl_count:new s(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new s(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new s(512),fltree:[],fdmap:new s(32),fdtree:[],lmap:new s(32768),ltree:[],ttree:[],dmap:new s(32768),dtree:[],imap:new s(512),itree:[],rev15:new s(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new s(65536),prev:new s(32768)}),function(){for(var n=a.F.U,i=0;i<32768;i++){var o=i;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,n.rev15[i]=(o>>>16|o<<16)>>>17}function c(l,u,d){for(;u--!=0;)l.push(0,d)}for(i=0;i<32;i++)n.ldef[i]=n.of0[i]<<3|n.exb[i],n.ddef[i]=n.df0[i]<<4|n.dxb[i];c(n.fltree,144,8),c(n.fltree,112,9),c(n.fltree,24,7),c(n.fltree,8,8),a.F.makeCodes(n.fltree,9),a.F.codes2map(n.fltree,9,n.flmap),a.F.revCodes(n.fltree,9),c(n.fdtree,32,5),a.F.makeCodes(n.fdtree,5),a.F.codes2map(n.fdtree,5,n.fdmap),a.F.revCodes(n.fdtree,5),c(n.itree,19,0),c(n.ltree,286,0),c(n.dtree,30,0),c(n.ttree,320,0)}()})();var EC=MC({__proto__:null,default:Oo},[Oo]);const Pr=function(){var t={nextZero(d,p){for(;d[p]!=0;)p++;return p},readUshort:(d,p)=>d[p]<<8|d[p+1],writeUshort(d,p,h){d[p]=h>>8&255,d[p+1]=255&h},readUint:(d,p)=>16777216*d[p]+(d[p+1]<<16|d[p+2]<<8|d[p+3]),writeUint(d,p,h){d[p]=h>>24&255,d[p+1]=h>>16&255,d[p+2]=h>>8&255,d[p+3]=255&h},readASCII(d,p,h){let f="";for(let y=0;y<h;y++)f+=String.fromCharCode(d[p+y]);return f},writeASCII(d,p,h){for(let f=0;f<h.length;f++)d[p+f]=h.charCodeAt(f)},readBytes(d,p,h){const f=[];for(let y=0;y<h;y++)f.push(d[p+y]);return f},pad:d=>d.length<2?`0${d}`:d,readUTF8(d,p,h){let f,y="";for(let v=0;v<h;v++)y+=`%${t.pad(d[p+v].toString(16))}`;try{f=decodeURIComponent(y)}catch{return t.readASCII(d,p,h)}return f}};function s(d,p,h,f){const y=p*h,v=i(f),b=Math.ceil(p*v/8),N=new Uint8Array(4*y),A=new Uint32Array(N.buffer),{ctype:j}=f,{depth:C}=f,I=t.readUshort;if(j==6){const $=y<<2;if(C==8)for(var k=0;k<$;k+=4)N[k]=d[k],N[k+1]=d[k+1],N[k+2]=d[k+2],N[k+3]=d[k+3];if(C==16)for(k=0;k<$;k++)N[k]=d[k<<1]}else if(j==2){const $=f.tabs.tRNS;if($==null){if(C==8)for(k=0;k<y;k++){var R=3*k;A[k]=255<<24|d[R+2]<<16|d[R+1]<<8|d[R]}if(C==16)for(k=0;k<y;k++)R=6*k,A[k]=255<<24|d[R+4]<<16|d[R+2]<<8|d[R]}else{var S=$[0];const se=$[1],ne=$[2];if(C==8)for(k=0;k<y;k++){var T=k<<2;R=3*k,A[k]=255<<24|d[R+2]<<16|d[R+1]<<8|d[R],d[R]==S&&d[R+1]==se&&d[R+2]==ne&&(N[T+3]=0)}if(C==16)for(k=0;k<y;k++)T=k<<2,R=6*k,A[k]=255<<24|d[R+4]<<16|d[R+2]<<8|d[R],I(d,R)==S&&I(d,R+2)==se&&I(d,R+4)==ne&&(N[T+3]=0)}}else if(j==3){const $=f.tabs.PLTE,se=f.tabs.tRNS,ne=se?se.length:0;if(C==1)for(var E=0;E<h;E++){var D=E*b,F=E*p;for(k=0;k<p;k++){T=F+k<<2;var H=3*(q=d[D+(k>>3)]>>7-((7&k)<<0)&1);N[T]=$[H],N[T+1]=$[H+1],N[T+2]=$[H+2],N[T+3]=q<ne?se[q]:255}}if(C==2)for(E=0;E<h;E++)for(D=E*b,F=E*p,k=0;k<p;k++)T=F+k<<2,H=3*(q=d[D+(k>>2)]>>6-((3&k)<<1)&3),N[T]=$[H],N[T+1]=$[H+1],N[T+2]=$[H+2],N[T+3]=q<ne?se[q]:255;if(C==4)for(E=0;E<h;E++)for(D=E*b,F=E*p,k=0;k<p;k++)T=F+k<<2,H=3*(q=d[D+(k>>1)]>>4-((1&k)<<2)&15),N[T]=$[H],N[T+1]=$[H+1],N[T+2]=$[H+2],N[T+3]=q<ne?se[q]:255;if(C==8)for(k=0;k<y;k++){var q;T=k<<2,H=3*(q=d[k]),N[T]=$[H],N[T+1]=$[H+1],N[T+2]=$[H+2],N[T+3]=q<ne?se[q]:255}}else if(j==4){if(C==8)for(k=0;k<y;k++){T=k<<2;var B=d[L=k<<1];N[T]=B,N[T+1]=B,N[T+2]=B,N[T+3]=d[L+1]}if(C==16)for(k=0;k<y;k++){var L;T=k<<2,B=d[L=k<<2],N[T]=B,N[T+1]=B,N[T+2]=B,N[T+3]=d[L+2]}}else if(j==0)for(S=f.tabs.tRNS?f.tabs.tRNS:-1,E=0;E<h;E++){const $=E*b,se=E*p;if(C==1)for(var P=0;P<p;P++){var K=(B=255*(d[$+(P>>>3)]>>>7-(7&P)&1))==255*S?0:255;A[se+P]=K<<24|B<<16|B<<8|B}else if(C==2)for(P=0;P<p;P++)K=(B=85*(d[$+(P>>>2)]>>>6-((3&P)<<1)&3))==85*S?0:255,A[se+P]=K<<24|B<<16|B<<8|B;else if(C==4)for(P=0;P<p;P++)K=(B=17*(d[$+(P>>>1)]>>>4-((1&P)<<2)&15))==17*S?0:255,A[se+P]=K<<24|B<<16|B<<8|B;else if(C==8)for(P=0;P<p;P++)K=(B=d[$+P])==S?0:255,A[se+P]=K<<24|B<<16|B<<8|B;else if(C==16)for(P=0;P<p;P++)B=d[$+(P<<1)],K=I(d,$+(P<<1))==S?0:255,A[se+P]=K<<24|B<<16|B<<8|B}return N}function r(d,p,h,f){const y=i(d),v=Math.ceil(h*y/8),b=new Uint8Array((v+1+d.interlace)*f);return p=d.tabs.CgBI?n(p,b):a(p,b),d.interlace==0?p=o(p,d,0,h,f):d.interlace==1&&(p=function(A,j){const C=j.width,I=j.height,k=i(j),R=k>>3,S=Math.ceil(C*k/8),T=new Uint8Array(I*S);let E=0;const D=[0,0,4,0,2,0,1],F=[0,4,0,2,0,1,0],H=[8,8,8,4,4,2,2],q=[8,8,4,4,2,2,1];let B=0;for(;B<7;){const P=H[B],K=q[B];let $=0,se=0,ne=D[B];for(;ne<I;)ne+=P,se++;let Y=F[B];for(;Y<C;)Y+=K,$++;const fe=Math.ceil($*k/8);o(A,j,E,$,se);let me=0,xe=D[B];for(;xe<I;){let He=F[B],Ae=E+me*fe<<3;for(;He<C;){var L;if(k==1&&(L=(L=A[Ae>>3])>>7-(7&Ae)&1,T[xe*S+(He>>3)]|=L<<7-((7&He)<<0)),k==2&&(L=(L=A[Ae>>3])>>6-(7&Ae)&3,T[xe*S+(He>>2)]|=L<<6-((3&He)<<1)),k==4&&(L=(L=A[Ae>>3])>>4-(7&Ae)&15,T[xe*S+(He>>1)]|=L<<4-((1&He)<<2)),k>=8){const Ye=xe*S+He*R;for(let Ze=0;Ze<R;Ze++)T[Ye+Ze]=A[(Ae>>3)+Ze]}Ae+=k,He+=K}me++,xe+=P}$*se!=0&&(E+=se*(1+fe)),B+=1}return T}(p,d)),p}function a(d,p){return n(new Uint8Array(d.buffer,2,d.length-6),p)}var n=function(){const d={H:{}};return d.H.N=function(p,h){const f=Uint8Array;let y,v,b=0,N=0,A=0,j=0,C=0,I=0,k=0,R=0,S=0;if(p[0]==3&&p[1]==0)return h||new f(0);const T=d.H,E=T.b,D=T.e,F=T.R,H=T.n,q=T.A,B=T.Z,L=T.m,P=h==null;for(P&&(h=new f(p.length>>>2<<5));b==0;)if(b=E(p,S,1),N=E(p,S+1,2),S+=3,N!=0){if(P&&(h=d.H.W(h,R+(1<<17))),N==1&&(y=L.J,v=L.h,I=511,k=31),N==2){A=D(p,S,5)+257,j=D(p,S+5,5)+1,C=D(p,S+10,4)+4,S+=14;let $=1;for(var K=0;K<38;K+=2)L.Q[K]=0,L.Q[K+1]=0;for(K=0;K<C;K++){const Y=D(p,S+3*K,3);L.Q[1+(L.X[K]<<1)]=Y,Y>$&&($=Y)}S+=3*C,H(L.Q,$),q(L.Q,$,L.u),y=L.w,v=L.d,S=F(L.u,(1<<$)-1,A+j,p,S,L.v);const se=T.V(L.v,0,A,L.C);I=(1<<se)-1;const ne=T.V(L.v,A,j,L.D);k=(1<<ne)-1,H(L.C,se),q(L.C,se,y),H(L.D,ne),q(L.D,ne,v)}for(;;){const $=y[B(p,S)&I];S+=15&$;const se=$>>>4;if(!(se>>>8))h[R++]=se;else{if(se==256)break;{let ne=R+se-254;if(se>264){const He=L.q[se-257];ne=R+(He>>>3)+D(p,S,7&He),S+=7&He}const Y=v[B(p,S)&k];S+=15&Y;const fe=Y>>>4,me=L.c[fe],xe=(me>>>4)+E(p,S,15&me);for(S+=15&me;R<ne;)h[R]=h[R++-xe],h[R]=h[R++-xe],h[R]=h[R++-xe],h[R]=h[R++-xe];R=ne}}}}else{7&S&&(S+=8-(7&S));const $=4+(S>>>3),se=p[$-4]|p[$-3]<<8;P&&(h=d.H.W(h,R+se)),h.set(new f(p.buffer,p.byteOffset+$,se),R),S=$+se<<3,R+=se}return h.length==R?h:h.slice(0,R)},d.H.W=function(p,h){const f=p.length;if(h<=f)return p;const y=new Uint8Array(f<<1);return y.set(p,0),y},d.H.R=function(p,h,f,y,v,b){const N=d.H.e,A=d.H.Z;let j=0;for(;j<f;){const C=p[A(y,v)&h];v+=15&C;const I=C>>>4;if(I<=15)b[j]=I,j++;else{let k=0,R=0;I==16?(R=3+N(y,v,2),v+=2,k=b[j-1]):I==17?(R=3+N(y,v,3),v+=3):I==18&&(R=11+N(y,v,7),v+=7);const S=j+R;for(;j<S;)b[j]=k,j++}}return v},d.H.V=function(p,h,f,y){let v=0,b=0;const N=y.length>>>1;for(;b<f;){const A=p[b+h];y[b<<1]=0,y[1+(b<<1)]=A,A>v&&(v=A),b++}for(;b<N;)y[b<<1]=0,y[1+(b<<1)]=0,b++;return v},d.H.n=function(p,h){const f=d.H.m,y=p.length;let v,b,N,A;const j=f.j;for(var C=0;C<=h;C++)j[C]=0;for(C=1;C<y;C+=2)j[p[C]]++;const I=f.K;for(v=0,j[0]=0,b=1;b<=h;b++)v=v+j[b-1]<<1,I[b]=v;for(N=0;N<y;N+=2)A=p[N+1],A!=0&&(p[N]=I[A],I[A]++)},d.H.A=function(p,h,f){const y=p.length,v=d.H.m.r;for(let b=0;b<y;b+=2)if(p[b+1]!=0){const N=b>>1,A=p[b+1],j=N<<4|A,C=h-A;let I=p[b]<<C;const k=I+(1<<C);for(;I!=k;)f[v[I]>>>15-h]=j,I++}},d.H.l=function(p,h){const f=d.H.m.r,y=15-h;for(let v=0;v<p.length;v+=2){const b=p[v]<<h-p[v+1];p[v]=f[b]>>>y}},d.H.M=function(p,h,f){f<<=7&h;const y=h>>>3;p[y]|=f,p[y+1]|=f>>>8},d.H.I=function(p,h,f){f<<=7&h;const y=h>>>3;p[y]|=f,p[y+1]|=f>>>8,p[y+2]|=f>>>16},d.H.e=function(p,h,f){return(p[h>>>3]|p[1+(h>>>3)]<<8)>>>(7&h)&(1<<f)-1},d.H.b=function(p,h,f){return(p[h>>>3]|p[1+(h>>>3)]<<8|p[2+(h>>>3)]<<16)>>>(7&h)&(1<<f)-1},d.H.Z=function(p,h){return(p[h>>>3]|p[1+(h>>>3)]<<8|p[2+(h>>>3)]<<16)>>>(7&h)},d.H.i=function(p,h){return(p[h>>>3]|p[1+(h>>>3)]<<8|p[2+(h>>>3)]<<16|p[3+(h>>>3)]<<24)>>>(7&h)},d.H.m=function(){const p=Uint16Array,h=Uint32Array;return{K:new p(16),j:new p(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new p(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new h(32),J:new p(512),_:[],h:new p(32),$:[],w:new p(32768),C:[],v:[],d:new p(32768),D:[],u:new p(512),Q:[],r:new p(32768),s:new h(286),Y:new h(30),a:new h(19),t:new h(15e3),k:new p(65536),g:new p(32768)}}(),function(){const p=d.H.m;for(var h=0;h<32768;h++){let y=h;y=(2863311530&y)>>>1|(1431655765&y)<<1,y=(3435973836&y)>>>2|(858993459&y)<<2,y=(4042322160&y)>>>4|(252645135&y)<<4,y=(4278255360&y)>>>8|(16711935&y)<<8,p.r[h]=(y>>>16|y<<16)>>>17}function f(y,v,b){for(;v--!=0;)y.push(0,b)}for(h=0;h<32;h++)p.q[h]=p.S[h]<<3|p.T[h],p.c[h]=p.p[h]<<4|p.z[h];f(p._,144,8),f(p._,112,9),f(p._,24,7),f(p._,8,8),d.H.n(p._,9),d.H.A(p._,9,p.J),d.H.l(p._,9),f(p.$,32,5),d.H.n(p.$,5),d.H.A(p.$,5,p.h),d.H.l(p.$,5),f(p.Q,19,0),f(p.C,286,0),f(p.D,30,0),f(p.v,320,0)}(),d.H.N}();function i(d){return[1,null,3,1,2,null,4][d.ctype]*d.depth}function o(d,p,h,f,y){let v=i(p);const b=Math.ceil(f*v/8);let N,A;v=Math.ceil(v/8);let j=d[h],C=0;if(j>1&&(d[h]=[0,0,1][j-2]),j==3)for(C=v;C<b;C++)d[C+1]=d[C+1]+(d[C+1-v]>>>1)&255;for(let I=0;I<y;I++)if(N=h+I*b,A=N+I+1,j=d[A-1],C=0,j==0)for(;C<b;C++)d[N+C]=d[A+C];else if(j==1){for(;C<v;C++)d[N+C]=d[A+C];for(;C<b;C++)d[N+C]=d[A+C]+d[N+C-v]}else if(j==2)for(;C<b;C++)d[N+C]=d[A+C]+d[N+C-b];else if(j==3){for(;C<v;C++)d[N+C]=d[A+C]+(d[N+C-b]>>>1);for(;C<b;C++)d[N+C]=d[A+C]+(d[N+C-b]+d[N+C-v]>>>1)}else{for(;C<v;C++)d[N+C]=d[A+C]+c(0,d[N+C-b],0);for(;C<b;C++)d[N+C]=d[A+C]+c(d[N+C-v],d[N+C-b],d[N+C-v-b])}return d}function c(d,p,h){const f=d+p-h,y=f-d,v=f-p,b=f-h;return y*y<=v*v&&y*y<=b*b?d:v*v<=b*b?p:h}function l(d,p,h){h.width=t.readUint(d,p),p+=4,h.height=t.readUint(d,p),p+=4,h.depth=d[p],p++,h.ctype=d[p],p++,h.compress=d[p],p++,h.filter=d[p],p++,h.interlace=d[p],p++}function u(d,p,h,f,y,v,b,N,A){const j=Math.min(p,y),C=Math.min(h,v);let I=0,k=0;for(let B=0;B<C;B++)for(let L=0;L<j;L++)if(b>=0&&N>=0?(I=B*p+L<<2,k=(N+B)*y+b+L<<2):(I=(-N+B)*p-b+L<<2,k=B*y+L<<2),A==0)f[k]=d[I],f[k+1]=d[I+1],f[k+2]=d[I+2],f[k+3]=d[I+3];else if(A==1){var R=d[I+3]*.00392156862745098,S=d[I]*R,T=d[I+1]*R,E=d[I+2]*R,D=f[k+3]*(1/255),F=f[k]*D,H=f[k+1]*D,q=f[k+2]*D;const P=1-R,K=R+D*P,$=K==0?0:1/K;f[k+3]=255*K,f[k+0]=(S+F*P)*$,f[k+1]=(T+H*P)*$,f[k+2]=(E+q*P)*$}else if(A==2)R=d[I+3],S=d[I],T=d[I+1],E=d[I+2],D=f[k+3],F=f[k],H=f[k+1],q=f[k+2],R==D&&S==F&&T==H&&E==q?(f[k]=0,f[k+1]=0,f[k+2]=0,f[k+3]=0):(f[k]=S,f[k+1]=T,f[k+2]=E,f[k+3]=R);else if(A==3){if(R=d[I+3],S=d[I],T=d[I+1],E=d[I+2],D=f[k+3],F=f[k],H=f[k+1],q=f[k+2],R==D&&S==F&&T==H&&E==q)continue;if(R<220&&D>20)return!1}return!0}return{decode:function(p){const h=new Uint8Array(p);let f=8;const y=t,v=y.readUshort,b=y.readUint,N={tabs:{},frames:[]},A=new Uint8Array(h.length);let j,C=0,I=0;const k=[137,80,78,71,13,10,26,10];for(var R=0;R<8;R++)if(h[R]!=k[R])throw"The input is not a PNG file!";for(;f<h.length;){const B=y.readUint(h,f);f+=4;const L=y.readASCII(h,f,4);if(f+=4,L=="IHDR")l(h,f,N);else if(L=="iCCP"){for(var S=f;h[S]!=0;)S++;y.readASCII(h,f,S-f),h[S+1];const P=h.slice(S+2,f+B);let K=null;try{K=a(P)}catch{K=n(P)}N.tabs[L]=K}else if(L=="CgBI")N.tabs[L]=h.slice(f,f+4);else if(L=="IDAT"){for(R=0;R<B;R++)A[C+R]=h[f+R];C+=B}else if(L=="acTL")N.tabs[L]={num_frames:b(h,f),num_plays:b(h,f+4)},j=new Uint8Array(h.length);else if(L=="fcTL"){I!=0&&((q=N.frames[N.frames.length-1]).data=r(N,j.slice(0,I),q.rect.width,q.rect.height),I=0);const P={x:b(h,f+12),y:b(h,f+16),width:b(h,f+4),height:b(h,f+8)};let K=v(h,f+22);K=v(h,f+20)/(K==0?100:K);const $={rect:P,delay:Math.round(1e3*K),dispose:h[f+24],blend:h[f+25]};N.frames.push($)}else if(L=="fdAT"){for(R=0;R<B-4;R++)j[I+R]=h[f+R+4];I+=B-4}else if(L=="pHYs")N.tabs[L]=[y.readUint(h,f),y.readUint(h,f+4),h[f+8]];else if(L=="cHRM")for(N.tabs[L]=[],R=0;R<8;R++)N.tabs[L].push(y.readUint(h,f+4*R));else if(L=="tEXt"||L=="zTXt"){N.tabs[L]==null&&(N.tabs[L]={});var T=y.nextZero(h,f),E=y.readASCII(h,f,T-f),D=f+B-T-1;if(L=="tEXt")H=y.readASCII(h,T+1,D);else{var F=a(h.slice(T+2,T+2+D));H=y.readUTF8(F,0,F.length)}N.tabs[L][E]=H}else if(L=="iTXt"){N.tabs[L]==null&&(N.tabs[L]={}),T=0,S=f,T=y.nextZero(h,S),E=y.readASCII(h,S,T-S);const P=h[S=T+1];var H;h[S+1],S+=2,T=y.nextZero(h,S),y.readASCII(h,S,T-S),S=T+1,T=y.nextZero(h,S),y.readUTF8(h,S,T-S),D=B-((S=T+1)-f),P==0?H=y.readUTF8(h,S,D):(F=a(h.slice(S,S+D)),H=y.readUTF8(F,0,F.length)),N.tabs[L][E]=H}else if(L=="PLTE")N.tabs[L]=y.readBytes(h,f,B);else if(L=="hIST"){const P=N.tabs.PLTE.length/3;for(N.tabs[L]=[],R=0;R<P;R++)N.tabs[L].push(v(h,f+2*R))}else if(L=="tRNS")N.ctype==3?N.tabs[L]=y.readBytes(h,f,B):N.ctype==0?N.tabs[L]=v(h,f):N.ctype==2&&(N.tabs[L]=[v(h,f),v(h,f+2),v(h,f+4)]);else if(L=="gAMA")N.tabs[L]=y.readUint(h,f)/1e5;else if(L=="sRGB")N.tabs[L]=h[f];else if(L=="bKGD")N.ctype==0||N.ctype==4?N.tabs[L]=[v(h,f)]:N.ctype==2||N.ctype==6?N.tabs[L]=[v(h,f),v(h,f+2),v(h,f+4)]:N.ctype==3&&(N.tabs[L]=h[f]);else if(L=="IEND")break;f+=B,y.readUint(h,f),f+=4}var q;return I!=0&&((q=N.frames[N.frames.length-1]).data=r(N,j.slice(0,I),q.rect.width,q.rect.height)),N.data=r(N,A,N.width,N.height),delete N.compress,delete N.interlace,delete N.filter,N},toRGBA8:function(p){const h=p.width,f=p.height;if(p.tabs.acTL==null)return[s(p.data,h,f,p).buffer];const y=[];p.frames[0].data==null&&(p.frames[0].data=p.data);const v=h*f*4,b=new Uint8Array(v),N=new Uint8Array(v),A=new Uint8Array(v);for(let C=0;C<p.frames.length;C++){const I=p.frames[C],k=I.rect.x,R=I.rect.y,S=I.rect.width,T=I.rect.height,E=s(I.data,S,T,p);if(C!=0)for(var j=0;j<v;j++)A[j]=b[j];if(I.blend==0?u(E,S,T,b,h,f,k,R,0):I.blend==1&&u(E,S,T,b,h,f,k,R,1),y.push(b.buffer.slice(0)),I.dispose!=0){if(I.dispose==1)u(N,S,T,b,h,f,k,R,0);else if(I.dispose==2)for(j=0;j<v;j++)b[j]=A[j]}}return y},_paeth:c,_copyTile:u,_bin:t}}();(function(){const{_copyTile:t}=Pr,{_bin:s}=Pr,r=Pr._paeth;var a={table:function(){const S=new Uint32Array(256);for(let T=0;T<256;T++){let E=T;for(let D=0;D<8;D++)1&E?E=3988292384^E>>>1:E>>>=1;S[T]=E}return S}(),update(S,T,E,D){for(let F=0;F<D;F++)S=a.table[255&(S^T[E+F])]^S>>>8;return S},crc:(S,T,E)=>4294967295^a.update(4294967295,S,T,E)};function n(S,T,E,D){T[E]+=S[0]*D>>4,T[E+1]+=S[1]*D>>4,T[E+2]+=S[2]*D>>4,T[E+3]+=S[3]*D>>4}function i(S){return Math.max(0,Math.min(255,S))}function o(S,T){const E=S[0]-T[0],D=S[1]-T[1],F=S[2]-T[2],H=S[3]-T[3];return E*E+D*D+F*F+H*H}function c(S,T,E,D,F,H,q){q==null&&(q=1);const B=D.length,L=[];for(var P=0;P<B;P++){const xe=D[P];L.push([xe>>>0&255,xe>>>8&255,xe>>>16&255,xe>>>24&255])}for(P=0;P<B;P++){let xe=4294967295;for(var K=0,$=0;$<B;$++){var se=o(L[P],L[$]);$!=P&&se<xe&&(xe=se,K=$)}}const ne=new Uint32Array(F.buffer),Y=new Int16Array(T*E*4),fe=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(P=0;P<fe.length;P++)fe[P]=255*((fe[P]+.5)/16-.5);for(let xe=0;xe<E;xe++)for(let He=0;He<T;He++){var me;P=4*(xe*T+He),q!=2?me=[i(S[P]+Y[P]),i(S[P+1]+Y[P+1]),i(S[P+2]+Y[P+2]),i(S[P+3]+Y[P+3])]:(se=fe[4*(3&xe)+(3&He)],me=[i(S[P]+se),i(S[P+1]+se),i(S[P+2]+se),i(S[P+3]+se)]),K=0;let Ae=16777215;for($=0;$<B;$++){const Ne=o(me,L[$]);Ne<Ae&&(Ae=Ne,K=$)}const Ye=L[K],Ze=[me[0]-Ye[0],me[1]-Ye[1],me[2]-Ye[2],me[3]-Ye[3]];q==1&&(He!=T-1&&n(Ze,Y,P+4,7),xe!=E-1&&(He!=0&&n(Ze,Y,P+4*T-4,3),n(Ze,Y,P+4*T,5),He!=T-1&&n(Ze,Y,P+4*T+4,1))),H[P>>2]=K,ne[P>>2]=D[K]}}function l(S,T,E,D,F){F==null&&(F={});const{crc:H}=a,q=s.writeUint,B=s.writeUshort,L=s.writeASCII;let P=8;const K=S.frames.length>1;let $,se=!1,ne=33+(K?20:0);if(F.sRGB!=null&&(ne+=13),F.pHYs!=null&&(ne+=21),F.iCCP!=null&&($=pako.deflate(F.iCCP),ne+=21+$.length+4),S.ctype==3){for(var Y=S.plte.length,fe=0;fe<Y;fe++)S.plte[fe]>>>24!=255&&(se=!0);ne+=8+3*Y+4+(se?8+1*Y+4:0)}for(var me=0;me<S.frames.length;me++)K&&(ne+=38),ne+=(Ye=S.frames[me]).cimg.length+12,me!=0&&(ne+=4);ne+=12;const xe=new Uint8Array(ne),He=[137,80,78,71,13,10,26,10];for(fe=0;fe<8;fe++)xe[fe]=He[fe];if(q(xe,P,13),P+=4,L(xe,P,"IHDR"),P+=4,q(xe,P,T),P+=4,q(xe,P,E),P+=4,xe[P]=S.depth,P++,xe[P]=S.ctype,P++,xe[P]=0,P++,xe[P]=0,P++,xe[P]=0,P++,q(xe,P,H(xe,P-17,17)),P+=4,F.sRGB!=null&&(q(xe,P,1),P+=4,L(xe,P,"sRGB"),P+=4,xe[P]=F.sRGB,P++,q(xe,P,H(xe,P-5,5)),P+=4),F.iCCP!=null){const Ze=13+$.length;q(xe,P,Ze),P+=4,L(xe,P,"iCCP"),P+=4,L(xe,P,"ICC profile"),P+=11,P+=2,xe.set($,P),P+=$.length,q(xe,P,H(xe,P-(Ze+4),Ze+4)),P+=4}if(F.pHYs!=null&&(q(xe,P,9),P+=4,L(xe,P,"pHYs"),P+=4,q(xe,P,F.pHYs[0]),P+=4,q(xe,P,F.pHYs[1]),P+=4,xe[P]=F.pHYs[2],P++,q(xe,P,H(xe,P-13,13)),P+=4),K&&(q(xe,P,8),P+=4,L(xe,P,"acTL"),P+=4,q(xe,P,S.frames.length),P+=4,q(xe,P,F.loop!=null?F.loop:0),P+=4,q(xe,P,H(xe,P-12,12)),P+=4),S.ctype==3){for(q(xe,P,3*(Y=S.plte.length)),P+=4,L(xe,P,"PLTE"),P+=4,fe=0;fe<Y;fe++){const Ze=3*fe,Ne=S.plte[fe],Ge=255&Ne,qe=Ne>>>8&255,Ke=Ne>>>16&255;xe[P+Ze+0]=Ge,xe[P+Ze+1]=qe,xe[P+Ze+2]=Ke}if(P+=3*Y,q(xe,P,H(xe,P-3*Y-4,3*Y+4)),P+=4,se){for(q(xe,P,Y),P+=4,L(xe,P,"tRNS"),P+=4,fe=0;fe<Y;fe++)xe[P+fe]=S.plte[fe]>>>24&255;P+=Y,q(xe,P,H(xe,P-Y-4,Y+4)),P+=4}}let Ae=0;for(me=0;me<S.frames.length;me++){var Ye=S.frames[me];K&&(q(xe,P,26),P+=4,L(xe,P,"fcTL"),P+=4,q(xe,P,Ae++),P+=4,q(xe,P,Ye.rect.width),P+=4,q(xe,P,Ye.rect.height),P+=4,q(xe,P,Ye.rect.x),P+=4,q(xe,P,Ye.rect.y),P+=4,B(xe,P,D[me]),P+=2,B(xe,P,1e3),P+=2,xe[P]=Ye.dispose,P++,xe[P]=Ye.blend,P++,q(xe,P,H(xe,P-30,30)),P+=4);const Ze=Ye.cimg;q(xe,P,(Y=Ze.length)+(me==0?0:4)),P+=4;const Ne=P;L(xe,P,me==0?"IDAT":"fdAT"),P+=4,me!=0&&(q(xe,P,Ae++),P+=4),xe.set(Ze,P),P+=Y,q(xe,P,H(xe,Ne,P-Ne)),P+=4}return q(xe,P,0),P+=4,L(xe,P,"IEND"),P+=4,q(xe,P,H(xe,P-4,4)),P+=4,xe.buffer}function u(S,T,E){for(let D=0;D<S.frames.length;D++){const F=S.frames[D];F.rect.width;const H=F.rect.height,q=new Uint8Array(H*F.bpl+H);F.cimg=f(F.img,H,F.bpp,F.bpl,q,T,E)}}function d(S,T,E,D,F){const H=F[0],q=F[1],B=F[2],L=F[3],P=F[4],K=F[5];let $=6,se=8,ne=255;for(var Y=0;Y<S.length;Y++){const Vt=new Uint8Array(S[Y]);for(var fe=Vt.length,me=0;me<fe;me+=4)ne&=Vt[me+3]}const xe=ne!=255,He=function(Pt,Dt,Gt,ns,jt,is){const Ct=[];for(var Et=0;Et<Pt.length;Et++){const Jt=new Uint8Array(Pt[Et]),ds=new Uint32Array(Jt.buffer);var ps;let Zt=0,As=0,fs=Dt,ws=Gt,Be=ns?1:0;if(Et!=0){const Ar=is||ns||Et==1||Ct[Et-2].dispose!=0?1:2;let Qe=0,bt=1e9;for(let _e=0;_e<Ar;_e++){var _t=new Uint8Array(Pt[Et-1-_e]);const Ot=new Uint32Array(Pt[Et-1-_e]);let ft=Dt,Mt=Gt,Qt=-1,Ue=-1;for(let gt=0;gt<Gt;gt++)for(let At=0;At<Dt;At++)ds[cs=gt*Dt+At]!=Ot[cs]&&(At<ft&&(ft=At),At>Qt&&(Qt=At),gt<Mt&&(Mt=gt),gt>Ue&&(Ue=gt));Qt==-1&&(ft=Mt=Qt=Ue=0),jt&&((1&ft)==1&&ft--,(1&Mt)==1&&Mt--);const pt=(Qt-ft+1)*(Ue-Mt+1);pt<bt&&(bt=pt,Qe=_e,Zt=ft,As=Mt,fs=Qt-ft+1,ws=Ue-Mt+1)}_t=new Uint8Array(Pt[Et-1-Qe]),Qe==1&&(Ct[Et-1].dispose=2),ps=new Uint8Array(fs*ws*4),t(_t,Dt,Gt,ps,fs,ws,-Zt,-As,0),Be=t(Jt,Dt,Gt,ps,fs,ws,-Zt,-As,3)?1:0,Be==1?h(Jt,Dt,Gt,ps,{x:Zt,y:As,width:fs,height:ws}):t(Jt,Dt,Gt,ps,fs,ws,-Zt,-As,0)}else ps=Jt.slice(0);Ct.push({rect:{x:Zt,y:As,width:fs,height:ws},img:ps,blend:Be,dispose:0})}if(ns)for(Et=0;Et<Ct.length;Et++){if((Us=Ct[Et]).blend==1)continue;const Jt=Us.rect,ds=Ct[Et-1].rect,Zt=Math.min(Jt.x,ds.x),As=Math.min(Jt.y,ds.y),fs={x:Zt,y:As,width:Math.max(Jt.x+Jt.width,ds.x+ds.width)-Zt,height:Math.max(Jt.y+Jt.height,ds.y+ds.height)-As};Ct[Et-1].dispose=1,Et-1!=0&&p(Pt,Dt,Gt,Ct,Et-1,fs,jt),p(Pt,Dt,Gt,Ct,Et,fs,jt)}let ls=0;if(Pt.length!=1)for(var cs=0;cs<Ct.length;cs++){var Us;ls+=(Us=Ct[cs]).rect.width*Us.rect.height}return Ct}(S,T,E,H,q,B),Ae={},Ye=[],Ze=[];if(D!=0){const Vt=[];for(me=0;me<He.length;me++)Vt.push(He[me].img.buffer);const Pt=function(jt){let is=0;for(var Ct=0;Ct<jt.length;Ct++)is+=jt[Ct].byteLength;const Et=new Uint8Array(is);let ps=0;for(Ct=0;Ct<jt.length;Ct++){const _t=new Uint8Array(jt[Ct]),ls=_t.length;for(let cs=0;cs<ls;cs+=4){let Us=_t[cs],Jt=_t[cs+1],ds=_t[cs+2];const Zt=_t[cs+3];Zt==0&&(Us=Jt=ds=0),Et[ps+cs]=Us,Et[ps+cs+1]=Jt,Et[ps+cs+2]=ds,Et[ps+cs+3]=Zt}ps+=ls}return Et.buffer}(Vt),Dt=v(Pt,D);for(me=0;me<Dt.plte.length;me++)Ye.push(Dt.plte[me].est.rgba);let Gt=0;for(me=0;me<He.length;me++){const ns=(Ge=He[me]).img.length;var Ne=new Uint8Array(Dt.inds.buffer,Gt>>2,ns>>2);Ze.push(Ne);const jt=new Uint8Array(Dt.abuf,Gt,ns);K&&c(Ge.img,Ge.rect.width,Ge.rect.height,Ye,jt,Ne),Ge.img.set(jt),Gt+=ns}}else for(Y=0;Y<He.length;Y++){var Ge=He[Y];const Vt=new Uint32Array(Ge.img.buffer);var qe=Ge.rect.width;for(fe=Vt.length,Ne=new Uint8Array(fe),Ze.push(Ne),me=0;me<fe;me++){const Pt=Vt[me];if(me!=0&&Pt==Vt[me-1])Ne[me]=Ne[me-1];else if(me>qe&&Pt==Vt[me-qe])Ne[me]=Ne[me-qe];else{let Dt=Ae[Pt];if(Dt==null&&(Ae[Pt]=Dt=Ye.length,Ye.push(Pt),Ye.length>=300))break;Ne[me]=Dt}}}const Ke=Ye.length;for(Ke<=256&&P==0&&(se=Ke<=2?1:Ke<=4?2:Ke<=16?4:8,se=Math.max(se,L)),Y=0;Y<He.length;Y++){(Ge=He[Y]).rect.x,Ge.rect.y,qe=Ge.rect.width;const Vt=Ge.rect.height;let Pt=Ge.img;new Uint32Array(Pt.buffer);let Dt=4*qe,Gt=4;if(Ke<=256&&P==0){Dt=Math.ceil(se*qe/8);var as=new Uint8Array(Dt*Vt);const ns=Ze[Y];for(let jt=0;jt<Vt;jt++){me=jt*Dt;const is=jt*qe;if(se==8)for(var yt=0;yt<qe;yt++)as[me+yt]=ns[is+yt];else if(se==4)for(yt=0;yt<qe;yt++)as[me+(yt>>1)]|=ns[is+yt]<<4-4*(1&yt);else if(se==2)for(yt=0;yt<qe;yt++)as[me+(yt>>2)]|=ns[is+yt]<<6-2*(3&yt);else if(se==1)for(yt=0;yt<qe;yt++)as[me+(yt>>3)]|=ns[is+yt]<<7-1*(7&yt)}Pt=as,$=3,Gt=1}else if(xe==0&&He.length==1){as=new Uint8Array(qe*Vt*3);const ns=qe*Vt;for(me=0;me<ns;me++){const jt=3*me,is=4*me;as[jt]=Pt[is],as[jt+1]=Pt[is+1],as[jt+2]=Pt[is+2]}Pt=as,$=2,Gt=3,Dt=3*qe}Ge.img=Pt,Ge.bpl=Dt,Ge.bpp=Gt}return{ctype:$,depth:se,plte:Ye,frames:He}}function p(S,T,E,D,F,H,q){const B=Uint8Array,L=Uint32Array,P=new B(S[F-1]),K=new L(S[F-1]),$=F+1<S.length?new B(S[F+1]):null,se=new B(S[F]),ne=new L(se.buffer);let Y=T,fe=E,me=-1,xe=-1;for(let Ae=0;Ae<H.height;Ae++)for(let Ye=0;Ye<H.width;Ye++){const Ze=H.x+Ye,Ne=H.y+Ae,Ge=Ne*T+Ze,qe=ne[Ge];qe==0||D[F-1].dispose==0&&K[Ge]==qe&&($==null||$[4*Ge+3]!=0)||(Ze<Y&&(Y=Ze),Ze>me&&(me=Ze),Ne<fe&&(fe=Ne),Ne>xe&&(xe=Ne))}me==-1&&(Y=fe=me=xe=0),q&&((1&Y)==1&&Y--,(1&fe)==1&&fe--),H={x:Y,y:fe,width:me-Y+1,height:xe-fe+1};const He=D[F];He.rect=H,He.blend=1,He.img=new Uint8Array(H.width*H.height*4),D[F-1].dispose==0?(t(P,T,E,He.img,H.width,H.height,-H.x,-H.y,0),h(se,T,E,He.img,H)):t(se,T,E,He.img,H.width,H.height,-H.x,-H.y,0)}function h(S,T,E,D,F){t(S,T,E,D,F.width,F.height,-F.x,-F.y,2)}function f(S,T,E,D,F,H,q){const B=[];let L,P=[0,1,2,3,4];H!=-1?P=[H]:(T*D>5e5||E==1)&&(P=[0]),q&&(L={level:0});const K=EC;for(var $=0;$<P.length;$++){for(let Y=0;Y<T;Y++)y(F,S,Y,D,E,P[$]);B.push(K.deflate(F,L))}let se,ne=1e9;for($=0;$<B.length;$++)B[$].length<ne&&(se=$,ne=B[$].length);return B[se]}function y(S,T,E,D,F,H){const q=E*D;let B=q+E;if(S[B]=H,B++,H==0)if(D<500)for(var L=0;L<D;L++)S[B+L]=T[q+L];else S.set(new Uint8Array(T.buffer,q,D),B);else if(H==1){for(L=0;L<F;L++)S[B+L]=T[q+L];for(L=F;L<D;L++)S[B+L]=T[q+L]-T[q+L-F]+256&255}else if(E==0){for(L=0;L<F;L++)S[B+L]=T[q+L];if(H==2)for(L=F;L<D;L++)S[B+L]=T[q+L];if(H==3)for(L=F;L<D;L++)S[B+L]=T[q+L]-(T[q+L-F]>>1)+256&255;if(H==4)for(L=F;L<D;L++)S[B+L]=T[q+L]-r(T[q+L-F],0,0)+256&255}else{if(H==2)for(L=0;L<D;L++)S[B+L]=T[q+L]+256-T[q+L-D]&255;if(H==3){for(L=0;L<F;L++)S[B+L]=T[q+L]+256-(T[q+L-D]>>1)&255;for(L=F;L<D;L++)S[B+L]=T[q+L]+256-(T[q+L-D]+T[q+L-F]>>1)&255}if(H==4){for(L=0;L<F;L++)S[B+L]=T[q+L]+256-r(0,T[q+L-D],0)&255;for(L=F;L<D;L++)S[B+L]=T[q+L]+256-r(T[q+L-F],T[q+L-D],T[q+L-F-D])&255}}}function v(S,T){const E=new Uint8Array(S),D=E.slice(0),F=new Uint32Array(D.buffer),H=b(D,T),q=H[0],B=H[1],L=E.length,P=new Uint8Array(L>>2);let K;if(E.length<2e7)for(var $=0;$<L;$+=4)K=N(q,se=E[$]*(1/255),ne=E[$+1]*(1/255),Y=E[$+2]*(1/255),fe=E[$+3]*(1/255)),P[$>>2]=K.ind,F[$>>2]=K.est.rgba;else for($=0;$<L;$+=4){var se=E[$]*.00392156862745098,ne=E[$+1]*(1/255),Y=E[$+2]*(1/255),fe=E[$+3]*(1/255);for(K=q;K.left;)K=A(K.est,se,ne,Y,fe)<=0?K.left:K.right;P[$>>2]=K.ind,F[$>>2]=K.est.rgba}return{abuf:D.buffer,inds:P,plte:B}}function b(S,T,E){E==null&&(E=1e-4);const D=new Uint32Array(S.buffer),F={i0:0,i1:S.length,bst:null,est:null,tdst:0,left:null,right:null};F.bst=I(S,F.i0,F.i1),F.est=k(F.bst);const H=[F];for(;H.length<T;){let B=0,L=0;for(var q=0;q<H.length;q++)H[q].est.L>B&&(B=H[q].est.L,L=q);if(B<E)break;const P=H[L],K=j(S,D,P.i0,P.i1,P.est.e,P.est.eMq255);if(P.i0>=K||P.i1<=K){P.est.L=0;continue}const $={i0:P.i0,i1:K,bst:null,est:null,tdst:0,left:null,right:null};$.bst=I(S,$.i0,$.i1),$.est=k($.bst);const se={i0:K,i1:P.i1,bst:null,est:null,tdst:0,left:null,right:null};for(se.bst={R:[],m:[],N:P.bst.N-$.bst.N},q=0;q<16;q++)se.bst.R[q]=P.bst.R[q]-$.bst.R[q];for(q=0;q<4;q++)se.bst.m[q]=P.bst.m[q]-$.bst.m[q];se.est=k(se.bst),P.left=$,P.right=se,H[L]=$,H.push(se)}for(H.sort((B,L)=>L.bst.N-B.bst.N),q=0;q<H.length;q++)H[q].ind=q;return[F,H]}function N(S,T,E,D,F){if(S.left==null)return S.tdst=function($,se,ne,Y,fe){const me=se-$[0],xe=ne-$[1],He=Y-$[2],Ae=fe-$[3];return me*me+xe*xe+He*He+Ae*Ae}(S.est.q,T,E,D,F),S;const H=A(S.est,T,E,D,F);let q=S.left,B=S.right;H>0&&(q=S.right,B=S.left);const L=N(q,T,E,D,F);if(L.tdst<=H*H)return L;const P=N(B,T,E,D,F);return P.tdst<L.tdst?P:L}function A(S,T,E,D,F){const{e:H}=S;return H[0]*T+H[1]*E+H[2]*D+H[3]*F-S.eMq}function j(S,T,E,D,F,H){for(D-=4;E<D;){for(;C(S,E,F)<=H;)E+=4;for(;C(S,D,F)>H;)D-=4;if(E>=D)break;const q=T[E>>2];T[E>>2]=T[D>>2],T[D>>2]=q,E+=4,D-=4}for(;C(S,E,F)>H;)E-=4;return E+4}function C(S,T,E){return S[T]*E[0]+S[T+1]*E[1]+S[T+2]*E[2]+S[T+3]*E[3]}function I(S,T,E){const D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],F=[0,0,0,0],H=E-T>>2;for(let q=T;q<E;q+=4){const B=S[q]*.00392156862745098,L=S[q+1]*(1/255),P=S[q+2]*(1/255),K=S[q+3]*(1/255);F[0]+=B,F[1]+=L,F[2]+=P,F[3]+=K,D[0]+=B*B,D[1]+=B*L,D[2]+=B*P,D[3]+=B*K,D[5]+=L*L,D[6]+=L*P,D[7]+=L*K,D[10]+=P*P,D[11]+=P*K,D[15]+=K*K}return D[4]=D[1],D[8]=D[2],D[9]=D[6],D[12]=D[3],D[13]=D[7],D[14]=D[11],{R:D,m:F,N:H}}function k(S){const{R:T}=S,{m:E}=S,{N:D}=S,F=E[0],H=E[1],q=E[2],B=E[3],L=D==0?0:1/D,P=[T[0]-F*F*L,T[1]-F*H*L,T[2]-F*q*L,T[3]-F*B*L,T[4]-H*F*L,T[5]-H*H*L,T[6]-H*q*L,T[7]-H*B*L,T[8]-q*F*L,T[9]-q*H*L,T[10]-q*q*L,T[11]-q*B*L,T[12]-B*F*L,T[13]-B*H*L,T[14]-B*q*L,T[15]-B*B*L],K=P,$=R;let se=[Math.random(),Math.random(),Math.random(),Math.random()],ne=0,Y=0;if(D!=0)for(let me=0;me<16&&(se=$.multVec(K,se),Y=Math.sqrt($.dot(se,se)),se=$.sml(1/Y,se),!(me!=0&&Math.abs(Y-ne)<1e-9));me++)ne=Y;const fe=[F*L,H*L,q*L,B*L];return{Cov:P,q:fe,e:se,L:ne,eMq255:$.dot($.sml(255,fe),se),eMq:$.dot(se,fe),rgba:(Math.round(255*fe[3])<<24|Math.round(255*fe[2])<<16|Math.round(255*fe[1])<<8|Math.round(255*fe[0])<<0)>>>0}}var R={multVec:(S,T)=>[S[0]*T[0]+S[1]*T[1]+S[2]*T[2]+S[3]*T[3],S[4]*T[0]+S[5]*T[1]+S[6]*T[2]+S[7]*T[3],S[8]*T[0]+S[9]*T[1]+S[10]*T[2]+S[11]*T[3],S[12]*T[0]+S[13]*T[1]+S[14]*T[2]+S[15]*T[3]],dot:(S,T)=>S[0]*T[0]+S[1]*T[1]+S[2]*T[2]+S[3]*T[3],sml:(S,T)=>[S*T[0],S*T[1],S*T[2],S*T[3]]};Pr.encode=function(T,E,D,F,H,q,B){F==null&&(F=0),B==null&&(B=!1);const L=d(T,E,D,F,[!1,!1,!1,0,B,!1]);return u(L,-1),l(L,E,D,H,q)},Pr.encodeLL=function(T,E,D,F,H,q,B,L){const P={ctype:0+(F==1?0:2)+(H==0?0:4),depth:q,frames:[]},K=(F+H)*q,$=K*E;for(let se=0;se<T.length;se++)P.frames.push({rect:{x:0,y:0,width:E,height:D},img:new Uint8Array(T[se]),blend:0,dispose:1,bpp:Math.ceil(K/8),bpl:Math.ceil($/8)});return u(P,0,!0),l(P,E,D,B,L)},Pr.encode.compress=d,Pr.encode.dither=c,Pr.quantize=v,Pr.quantize.getKDtree=b,Pr.quantize.getNearest=N})();const fg={toArrayBuffer(t,s){const r=t.width,a=t.height,n=r<<2,i=t.getContext("2d").getImageData(0,0,r,a),o=new Uint32Array(i.data.buffer),c=(32*r+31)/32<<2,l=c*a,u=122+l,d=new ArrayBuffer(u),p=new DataView(d),h=1<<20;let f,y,v,b,N=h,A=0,j=0,C=0;function I(S){p.setUint16(j,S,!0),j+=2}function k(S){p.setUint32(j,S,!0),j+=4}function R(S){j+=S}I(19778),k(u),R(4),k(122),k(108),k(r),k(-a>>>0),I(1),I(32),k(3),k(l),k(2835),k(2835),R(8),k(16711680),k(65280),k(255),k(4278190080),k(1466527264),function S(){for(;A<a&&N>0;){for(b=122+A*c,f=0;f<n;)N--,y=o[C++],v=y>>>24,p.setUint32(b+f,y<<8|v),f+=4;A++}C<o.length?(N=h,setTimeout(S,fg._dly)):s(d)}()},toBlob(t,s){this.toArrayBuffer(t,r=>{s(new Blob([r],{type:"image/bmp"}))})},_dly:9};var or={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},IC={[or.CHROME]:16384,[or.FIREFOX]:11180,[or.DESKTOP_SAFARI]:16384,[or.IE]:8192,[or.IOS]:4096,[or.ETC]:8192};const nu=typeof window<"u",xg=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Fo=nu&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),OC=(nu||xg)&&(Fo&&Fo.getOriginalSymbol(window,"File")||typeof File<"u"&&File),gg=(nu||xg)&&(Fo&&Fo.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function iu(t,s,r=Date.now()){return new Promise(a=>{const n=t.split(","),i=n[0].match(/:(.*?);/)[1],o=globalThis.atob(n[1]);let c=o.length;const l=new Uint8Array(c);for(;c--;)l[c]=o.charCodeAt(c);const u=new Blob([l],{type:i});u.name=s,u.lastModified=r,a(u)})}function vg(t){return new Promise((s,r)=>{const a=new gg;a.onload=()=>s(a.result),a.onerror=n=>r(n),a.readAsDataURL(t)})}function yg(t){return new Promise((s,r)=>{const a=new Image;a.onload=()=>s(a),a.onerror=n=>r(n),a.src=t})}function qa(){if(qa.cachedResult!==void 0)return qa.cachedResult;let t=or.ETC;const{userAgent:s}=navigator;return/Chrom(e|ium)/i.test(s)?t=or.CHROME:/iP(ad|od|hone)/i.test(s)&&/WebKit/i.test(s)?t=or.IOS:/Safari/i.test(s)?t=or.DESKTOP_SAFARI:/Firefox/i.test(s)?t=or.FIREFOX:(/MSIE/i.test(s)||document.documentMode)&&(t=or.IE),qa.cachedResult=t,qa.cachedResult}function jg(t,s){const r=qa(),a=IC[r];let n=t,i=s,o=n*i;const c=n>i?i/n:n/i;for(;o>a*a;){const l=(a+n)/2,u=(a+i)/2;l<u?(i=u,n=u*c):(i=l*c,n=l),o=n*i}return{width:n,height:i}}function pl(t,s){let r,a;try{if(r=new OffscreenCanvas(t,s),a=r.getContext("2d"),a===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{r=document.createElement("canvas"),a=r.getContext("2d")}return r.width=t,r.height=s,[r,a]}function bg(t,s){const{width:r,height:a}=jg(t.width,t.height),[n,i]=pl(r,a);return s&&/jpe?g/.test(s)&&(i.fillStyle="white",i.fillRect(0,0,n.width,n.height)),i.drawImage(t,0,0,n.width,n.height),n}function jo(){return jo.cachedResult!==void 0||(jo.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),jo.cachedResult}function Lo(t,s={}){return new Promise(function(r,a){let n,i;var o=function(){try{return i=bg(n,s.fileType||t.type),r([n,i])}catch(l){return a(l)}},c=function(l){try{var u=function(d){try{throw d}catch(p){return a(p)}};try{let d;return vg(t).then(function(p){try{return d=p,yg(d).then(function(h){try{return n=h,function(){try{return o()}catch(f){return a(f)}}()}catch(f){return u(f)}},u)}catch(h){return u(h)}},u)}catch(d){u(d)}}catch(d){return a(d)}};try{if(jo()||[or.DESKTOP_SAFARI,or.MOBILE_SAFARI].includes(qa()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then(function(l){try{return n=l,o()}catch{return c()}},c)}catch{c()}})}function qo(t,s,r,a,n=1){return new Promise(function(i,o){let c;if(s==="image/png"){let u,d,p;return u=t.getContext("2d"),{data:d}=u.getImageData(0,0,t.width,t.height),p=Pr.encode([d.buffer],t.width,t.height,4096*n),c=new Blob([p],{type:s}),c.name=r,c.lastModified=a,l.call(this)}{let u=function(){return l.call(this)};if(s==="image/bmp")return new Promise(d=>fg.toBlob(t,d)).then(function(d){try{return c=d,c.name=r,c.lastModified=a,u.call(this)}catch(p){return o(p)}}.bind(this),o);{let d=function(){return u.call(this)};if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:s,quality:n}).then(function(p){try{return c=p,c.name=r,c.lastModified=a,d.call(this)}catch(h){return o(h)}}.bind(this),o);{let p;return p=t.toDataURL(s,n),iu(p,r,a).then(function(h){try{return c=h,d.call(this)}catch(f){return o(f)}}.bind(this),o)}}}function l(){return i(c)}})}function $r(t){t.width=0,t.height=0}function mn(){return new Promise(function(t,s){let r,a,n,i;return mn.cachedResult!==void 0?t(mn.cachedResult):iu("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(o){try{return r=o,Lo(r).then(function(c){try{return a=c[1],qo(a,r.type,r.name,r.lastModified).then(function(l){try{return n=l,$r(a),Lo(n).then(function(u){try{return i=u[0],mn.cachedResult=i.width===1&&i.height===2,t(mn.cachedResult)}catch(d){return s(d)}},s)}catch(u){return s(u)}},s)}catch(l){return s(l)}},s)}catch(c){return s(c)}},s)})}function wg(t){return new Promise((s,r)=>{const a=new gg;a.onload=n=>{const i=new DataView(n.target.result);if(i.getUint16(0,!1)!=65496)return s(-2);const o=i.byteLength;let c=2;for(;c<o;){if(i.getUint16(c+2,!1)<=8)return s(-1);const l=i.getUint16(c,!1);if(c+=2,l==65505){if(i.getUint32(c+=2,!1)!=1165519206)return s(-1);const u=i.getUint16(c+=6,!1)==18761;c+=i.getUint32(c+4,u);const d=i.getUint16(c,u);c+=2;for(let p=0;p<d;p++)if(i.getUint16(c+12*p,u)==274)return s(i.getUint16(c+12*p+8,u))}else{if((65280&l)!=65280)break;c+=i.getUint16(c,!1)}}return s(-1)},a.onerror=n=>r(n),a.readAsArrayBuffer(t)})}function Ng(t,s){const{width:r}=t,{height:a}=t,{maxWidthOrHeight:n}=s;let i,o=t;return isFinite(n)&&(r>n||a>n)&&([o,i]=pl(r,a),r>a?(o.width=n,o.height=a/r*n):(o.width=r/a*n,o.height=n),i.drawImage(t,0,0,o.width,o.height),$r(t)),o}function _g(t,s){const{width:r}=t,{height:a}=t,[n,i]=pl(r,a);switch(s>4&&s<9?(n.width=a,n.height=r):(n.width=r,n.height=a),s){case 2:i.transform(-1,0,0,1,r,0);break;case 3:i.transform(-1,0,0,-1,r,a);break;case 4:i.transform(1,0,0,-1,0,a);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,a,0);break;case 7:i.transform(0,-1,-1,0,a,r);break;case 8:i.transform(0,-1,1,0,0,r)}return i.drawImage(t,0,0,r,a),$r(t),n}function Um(t,s,r=0){return new Promise(function(a,n){let i,o,c,l,u,d,p,h,f,y,v,b,N,A,j,C,I,k,R,S;function T(D=5){if(s.signal&&s.signal.aborted)throw s.signal.reason;i+=D,s.onProgress(Math.min(i,100))}function E(D){if(s.signal&&s.signal.aborted)throw s.signal.reason;i=Math.min(Math.max(D,i),100),s.onProgress(i)}return i=r,o=s.maxIteration||10,c=1024*s.maxSizeMB*1024,T(),Lo(t,s).then(function(D){try{return[,l]=D,T(),u=Ng(l,s),T(),new Promise(function(F,H){var q;if(!(q=s.exifOrientation))return wg(t).then(function(L){try{return q=L,B.call(this)}catch(P){return H(P)}}.bind(this),H);function B(){return F(q)}return B.call(this)}).then(function(F){try{return d=F,T(),mn().then(function(H){try{return p=H?u:_g(u,d),T(),h=s.initialQuality||1,f=s.fileType||t.type,qo(p,f,t.name,t.lastModified,h).then(function(q){try{{let L=function(){if(o--&&(j>c||j>N)){let K,$;return K=S?.95*R.width:R.width,$=S?.95*R.height:R.height,[I,k]=pl(K,$),k.drawImage(R,0,0,K,$),h*=f==="image/png"?.85:.95,qo(I,f,t.name,t.lastModified,h).then(function(se){try{return C=se,$r(R),R=I,j=C.size,E(Math.min(99,Math.floor((A-j)/(A-c)*100))),L}catch(ne){return n(ne)}},n)}return[1]},P=function(){return $r(R),$r(I),$r(u),$r(p),$r(l),E(100),a(C)};if(y=q,T(),v=y.size>c,b=y.size>t.size,!v&&!b)return E(100),a(y);var B;return N=t.size,A=y.size,j=A,R=p,S=!s.alwaysKeepResolution&&v,(B=function(K){for(;K;){if(K.then)return void K.then(B,n);try{if(K.pop){if(K.length)return K.pop()?P.call(this):K;K=L}else K=K.call(this)}catch($){return n($)}}}.bind(this))(L)}}catch(L){return n(L)}}.bind(this),n)}catch(q){return n(q)}}.bind(this),n)}catch(H){return n(H)}}.bind(this),n)}catch(F){return n(F)}}.bind(this),n)})}const FC=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let uc;function LC(t,s){return new Promise((r,a)=>{uc||(uc=function(o){const c=[];return c.push(o),URL.createObjectURL(new Blob(c))}(FC));const n=new Worker(uc);n.addEventListener("message",function(o){if(s.signal&&s.signal.aborted)n.terminate();else if(o.data.progress===void 0){if(o.data.error)return a(new Error(o.data.error)),void n.terminate();r(o.data.file),n.terminate()}else s.onProgress(o.data.progress)}),n.addEventListener("error",a),s.signal&&s.signal.addEventListener("abort",()=>{a(s.signal.reason),n.terminate()}),n.postMessage({file:t,imageCompressionLibUrl:s.libURL,options:{...s,onProgress:void 0,signal:void 0}})})}function Ms(t,s){return new Promise(function(r,a){let n,i,o,c,l,u;if(n={...s},o=0,{onProgress:c}=n,n.maxSizeMB=n.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof n.useWebWorker!="boolean"||n.useWebWorker,delete n.useWebWorker,n.onProgress=f=>{o=f,typeof c=="function"&&c(o)},!(t instanceof Blob||t instanceof OC))return a(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return a(new Error("The file given is not an image"));if(u=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||u)return Um(t,n).then(function(f){try{return i=f,h.call(this)}catch(y){return a(y)}}.bind(this),a);var d=function(){try{return h.call(this)}catch(f){return a(f)}}.bind(this),p=function(f){try{return Um(t,n).then(function(y){try{return i=y,d()}catch(v){return a(v)}},a)}catch(y){return a(y)}};try{return n.libURL=n.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",LC(t,n).then(function(f){try{return i=f,d()}catch{return p()}},p)}catch{p()}function h(){try{i.name=t.name,i.lastModified=t.lastModified}catch{}try{n.preserveExif&&t.type==="image/jpeg"&&(!n.fileType||n.fileType&&n.fileType===t.type)&&(i=pg(t,i))}catch{}return r(i)}})}Ms.getDataUrlFromFile=vg,Ms.getFilefromDataUrl=iu,Ms.loadImage=yg,Ms.drawImageInCanvas=bg,Ms.drawFileInCanvas=Lo,Ms.canvasToFile=qo,Ms.getExifOrientation=wg,Ms.handleMaxWidthOrHeight=Ng,Ms.followExifOrientation=_g,Ms.cleanupCanvasMemory=$r,Ms.isAutoOrientationInBrowser=mn,Ms.approximateBelowMaximumCanvasSizeOfBrowser=jg,Ms.copyExifWithoutOrientation=pg,Ms.getBrowserName=qa,Ms.version="2.0.2";function fl(t){if(!t)return"An unknown error occurred";if(typeof t=="string")return t;if(t instanceof Error){const s=t;return s.code==="PGRST116"?"No matching record found":s.code==="23505"?"This record already exists":s.code==="42501"||s.message?.includes("row-level security")?"You don't have permission to perform this action":s.hint?`${s.message} (${s.hint})`:s.message}if(typeof t=="object"){const s=t;if(typeof s.error=="string")return s.error;if(typeof s.message=="string")return s.message;if(typeof s.msg=="string")return s.msg;if(s.error&&typeof s.error=="object"){const r=s.error;if(typeof r.message=="string")return r.message}}return"An unexpected error occurred"}function ou(t){return{label:"Retry",onClick:t}}const Es={IMAGE_MAX_MB:15,IMAGE_COMPRESS_TARGET_MB:2,PDF_MAX_MB:10};function Tn(t,s){const r=t.size/1048576;return r>s?{valid:!1,message:`File too large. Maximum size is ${s}MB (your file: ${r.toFixed(1)}MB)`}:{valid:!0}}function xl(t){return t.type.startsWith("image/")}function kg(t){return t.type==="application/pdf"}const mc={show_origin_level:"district",show_crop_details:!0,show_crop_timeline:!0,show_stage_photos:!1,show_input_photos:!1,show_soil_report:!1,show_geo_proof:!1};function qC(){const{user:t}=Fe();return De({queryKey:["harvest-ready-crops",t?.id],queryFn:async()=>{if(!t)return[];const{data:s,error:r}=await W.from("crops").select(`
          id, crop_name, variety, estimated_quantity, quantity_unit,
          harvest_estimate, sowing_date, status, land_id,
          farmlands:land_id (district, village, name)
        `).eq("farmer_id",t.id).in("status",["growing","harvested"]).order("created_at",{ascending:!1});if(r)throw r;return(s||[]).map(a=>({...a,farmland:a.farmlands||null}))},enabled:!!t})}function zC(t){const{user:s}=Fe();return De({queryKey:["trace-attachments",t],queryFn:async()=>{if(!t)return[];const{data:r,error:a}=await W.from("trace_attachments").select("*").eq("owner_type","listing").eq("owner_id",t).order("created_at",{ascending:!1});if(a)throw a;return r},enabled:!!t&&!!s})}function BC(){const{user:t}=Fe(),s=Xe();return dt({mutationFn:async({file:r,ownerType:a,ownerId:n,tag:i,visibility:o="private",notes:c})=>{if(!t)throw new Error("Not authenticated");const l=xl(r),u=kg(r);if(!l&&!u)throw new Error("Only images and PDFs are supported");let d=r;if(l){const f=Tn(r,Es.IMAGE_MAX_MB);if(!f.valid)throw new Error(f.message);r.size/(1024*1024)>Es.IMAGE_COMPRESS_TARGET_MB&&(d=await Ms(r,{maxSizeMB:Es.IMAGE_COMPRESS_TARGET_MB,maxWidthOrHeight:1920,useWebWorker:!0}))}else{const f=Tn(r,Es.PDF_MAX_MB);if(!f.valid)throw new Error(f.message)}const p=await bi(d,{bucket:"traceability-media",contentType:d.type||(l?"image/jpeg":"application/pdf"),sizeBytes:d.size,entity:{type:"listing",id:n}}),{error:h}=await W.from("trace_attachments").insert({owner_type:a,owner_id:n,file_url:p,file_type:l?"image":"pdf",tag:i,visibility:o,notes:c||null,uploaded_by:t.id,uploader_id:t.id});if(h)throw h},onSuccess:()=>{s.invalidateQueries({queryKey:["trace-attachments"]}),ce.success("Evidence uploaded successfully")},onError:r=>{ce.error(`Upload failed: ${r.message}`)}})}function $C(){const t=Xe();return dt({mutationFn:async({id:s,visibility:r})=>{const{error:a}=await W.from("trace_attachments").update({visibility:r}).eq("id",s);if(a)throw a},onSuccess:()=>{t.invalidateQueries({queryKey:["trace-attachments"]})}})}const UC={stage_photo:"Crop Stage Photo",input_proof:"Input/Fertilizer Proof",soil_report:"Soil Report"},Hm=({listingId:t,cropId:s})=>{const{user:r}=Fe(),a=Xe(),{data:n=[],isLoading:i}=zC(t),o=BC(),c=$C(),[l,u]=x.useState(null),[d,p]=x.useState(!1),[h,f]=x.useState(!1),[y,v]=x.useState(new Set),[b,N]=x.useState(new Set),[A,j]=x.useState(!1),[C,I]=x.useState(!1),{data:k=[]}=De({queryKey:["crop-diary-photos",s],queryFn:async()=>{if(!s)return[];const{data:P,error:K}=await W.from("crop_media").select("id, file_path, mime_type, caption, captured_at, tags").eq("crop_id",s).order("captured_at",{ascending:!1}).limit(30);if(K)throw K;return P||[]},enabled:!!s}),{data:R=[]}=De({queryKey:["soil-reports-for-listing",s],queryFn:async()=>{if(!s)return[];const{data:P}=await W.from("crops").select("land_id").eq("id",s).single();if(!P?.land_id)return[];const{data:K,error:$}=await W.from("soil_test_reports").select("id, report_file_path, report_file_type, lab_name, report_date, ph, nitrogen, phosphorus, potassium").eq("farmland_id",P.land_id).order("report_date",{ascending:!1}).limit(10);if($)throw $;return K||[]},enabled:!!s}),S=new Set(n.filter(P=>P.owner_type==="crop"||P.tag==="stage_photo").map(P=>P.file_url)),T=new Set(n.filter(P=>P.tag==="soil_report").map(P=>P.file_url)),E=async(P,K)=>{const $=document.createElement("input");$.type="file",$.accept=K,$.onchange=async se=>{const ne=se.target.files?.[0];if(ne){u(P);try{await o.mutateAsync({file:ne,ownerType:"listing",ownerId:t,tag:P,visibility:"private"})}finally{u(null)}}},$.click()},D=P=>{const K=P.visibility==="public_on_qr"?"private":"public_on_qr";c.mutate({id:P.id,visibility:K})},F=async()=>{if(!(!r||y.size===0)){j(!0);try{const P=k.filter(se=>y.has(se.id)),K=P.map(se=>({owner_type:"listing",owner_id:t,file_url:se.file_path,file_type:se.mime_type?.startsWith("image")?"image":"pdf",tag:"stage_photo",visibility:"public_on_qr",notes:se.caption||null,uploaded_by:r.id,captured_at:se.captured_at||new Date().toISOString()})),{error:$}=await W.from("trace_attachments").insert(K);if($)throw $;a.invalidateQueries({queryKey:["trace-attachments"]}),ce.success(`${P.length} photo(s) linked to listing`),v(new Set),p(!1)}catch(P){ce.error(`Failed to link photos: ${P.message}`)}finally{j(!1)}}},H=async()=>{if(!(!r||b.size===0)){I(!0);try{const P=R.filter(se=>b.has(se.id)),K=P.map(se=>({owner_type:"listing",owner_id:t,file_url:se.report_file_path,file_type:se.report_file_type==="pdf"?"pdf":"image",tag:"soil_report",visibility:"public_on_qr",notes:se.lab_name?`Lab: ${se.lab_name}`:null,uploaded_by:r.id,captured_at:se.report_date||new Date().toISOString()})),{error:$}=await W.from("trace_attachments").insert(K);if($)throw $;a.invalidateQueries({queryKey:["trace-attachments"]}),ce.success(`${P.length} report(s) linked to listing`),N(new Set),f(!1)}catch(P){ce.error(`Failed to link reports: ${P.message}`)}finally{I(!1)}}},q=P=>{v(K=>{const $=new Set(K);return $.has(P)?$.delete(P):$.add(P),$})},B=P=>{N(K=>{const $=new Set(K);return $.has(P)?$.delete(P):$.add(P),$})};function L({path:P,alt:K}){const[$,se]=x.useState("");return useEffect(()=>{let ne=!0;if(/^[0-9a-fA-F-]{36}$/.test(P))(async()=>{try{const{data:fe}=await W.functions.invoke("storage-sign-read-v1",{body:{file_id:P}});ne&&fe?.signed_read_url&&se(fe.signed_read_url)}catch(fe){console.warn("storage-sign-read-v1 failed:",fe)}})();else{const{data:fe}=W.storage.from("crop-media").getPublicUrl(P);fe?.publicUrl&&se(fe.publicUrl)}return()=>{ne=!1}},[P]),e.jsx("img",{src:$,alt:K||"Crop photo",className:"w-full h-20 object-cover"})}return e.jsxs("div",{className:"space-y-4 p-4 rounded-lg border border-border bg-muted/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dr,{className:"h-4 w-4 text-primary"}),e.jsx(ie,{className:"text-sm font-medium",children:"Evidence Attachments (Optional)"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add photos/reports and control which appear on the public QR page"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(z,{type:"button",variant:"outline",size:"sm",className:"gap-2",disabled:l==="stage_photo",onClick:()=>E("stage_photo","image/*"),children:[l==="stage_photo"?e.jsx(et,{className:"h-4 w-4 animate-spin"}):e.jsx(dr,{className:"h-4 w-4"}),"Upload Photo"]}),e.jsxs(z,{type:"button",variant:"outline",size:"sm",className:"gap-2",disabled:l==="input_proof",onClick:()=>E("input_proof","image/*"),children:[l==="input_proof"?e.jsx(et,{className:"h-4 w-4 animate-spin"}):e.jsx(pi,{className:"h-4 w-4"}),"Input Proof"]}),e.jsxs(z,{type:"button",variant:"outline",size:"sm",className:"gap-2",disabled:l==="soil_report",onClick:()=>E("soil_report","application/pdf,image/*"),children:[l==="soil_report"?e.jsx(et,{className:"h-4 w-4 animate-spin"}):e.jsx(sr,{className:"h-4 w-4"}),"Upload Report"]})]}),s&&k.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{type:"button",variant:"secondary",size:"sm",className:"gap-2 w-full",onClick:()=>p(!d),children:[e.jsx(Rj,{className:"h-4 w-4"}),"Pick from Crop Diary (",k.length," photos)"]}),d&&e.jsxs("div",{className:"space-y-2 p-3 border border-border rounded-lg bg-background",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:k.map(P=>{const K=S.has(P.file_path),$=y.has(P.id);return e.jsxs("div",{className:`relative rounded-md overflow-hidden border-2 cursor-pointer transition-colors ${K?"border-muted opacity-50 cursor-not-allowed":$?"border-primary":"border-border hover:border-primary/50"}`,onClick:()=>!K&&q(P.id),children:[e.jsx(L,{path:P.file_path,alt:P.caption||"Crop photo"}),K&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/60",children:e.jsx(he,{variant:"secondary",className:"text-[10px]",children:"Linked"})}),$&&e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(Vc,{checked:!0,className:"h-4 w-4"})}),P.captured_at&&e.jsx("p",{className:"text-[9px] text-muted-foreground p-0.5 truncate",children:new Date(P.captured_at).toLocaleDateString()})]},P.id)})}),y.size>0&&e.jsxs(z,{type:"button",size:"sm",className:"w-full gap-2",disabled:A,onClick:F,children:[A?e.jsx(et,{className:"h-4 w-4 animate-spin"}):e.jsx(sa,{className:"h-4 w-4"}),"Link ",y.size," Photo(s) to QR Page"]})]})]}),s&&R.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{type:"button",variant:"secondary",size:"sm",className:"gap-2 w-full",onClick:()=>f(!h),children:[e.jsx(Lj,{className:"h-4 w-4"}),"Pick Soil Reports (",R.length," available)"]}),h&&e.jsxs("div",{className:"space-y-2 p-3 border border-border rounded-lg bg-background",children:[R.map(P=>{const K=T.has(P.report_file_path),$=b.has(P.id);return e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-md border-2 cursor-pointer transition-colors ${K?"border-muted opacity-50 cursor-not-allowed":$?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onClick:()=>!K&&B(P.id),children:[e.jsx(sr,{className:"h-5 w-5 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs font-medium",children:[P.lab_name||"Soil Report","  ",new Date(P.report_date).toLocaleDateString()]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:[P.ph&&`pH: ${P.ph}`,P.nitrogen&&`N: ${P.nitrogen}`,P.phosphorus&&`P: ${P.phosphorus}`,P.potassium&&`K: ${P.potassium}`].filter(Boolean).join(" | ")||"No details"})]}),K?e.jsx(he,{variant:"secondary",className:"text-[10px] shrink-0",children:"Linked"}):e.jsx(Vc,{checked:$,className:"shrink-0"})]},P.id)}),b.size>0&&e.jsxs(z,{type:"button",size:"sm",className:"w-full gap-2",disabled:C,onClick:H,children:[C?e.jsx(et,{className:"h-4 w-4 animate-spin"}):e.jsx(sa,{className:"h-4 w-4"}),"Link ",b.size," Report(s) to QR Page"]})]})]}),i?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Loading attachments..."}):n.length===0?e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"No evidence uploaded yet"}):e.jsx("div",{className:"space-y-2",children:n.map(P=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md bg-background border border-border",children:[P.file_type==="image"?e.jsx(dr,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(sr,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium truncate",children:UC[P.tag]||P.tag}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(P.created_at).toLocaleDateString()})]}),e.jsx(he,{variant:P.visibility==="public_on_qr"?"default":"secondary",className:"text-xs cursor-pointer shrink-0",onClick:()=>D(P),children:P.visibility==="public_on_qr"?e.jsxs(e.Fragment,{children:[e.jsx(sa,{className:"h-3 w-3 mr-1"}),"On QR"]}):e.jsxs(e.Fragment,{children:[e.jsx(dd,{className:"h-3 w-3 mr-1"}),"Private"]})})]},P.id))})]})};function HC(t=""){return De({queryKey:["geo-search","state",t],queryFn:async()=>await Yt("geo_search_v1",{p_q:t,p_type:"state",p_limit:50})??[],staleTime:1e3*60*60})}function VC(t,s=""){return De({queryKey:["geo-search","district",t,s],queryFn:async()=>await Yt("geo_search_v1",{p_q:s,p_type:"district",p_state_id:t||null,p_limit:50})??[],staleTime:1e3*60*30})}function KC(t,s=""){return De({queryKey:["geo-search","market",t,s],queryFn:async()=>await Yt("geo_search_v1",{p_q:s,p_type:"market",p_district_id:t||null,p_limit:50})??[],enabled:!!t,staleTime:1e3*60*30})}function Kr({stateId:t,value:s,onValueChange:r,placeholder:a="Select district",disabled:n,className:i}){const{data:o,isLoading:c}=VC(t);return e.jsxs(lt,{value:s||"",onValueChange:r,disabled:n||c,children:[e.jsx(it,{className:i,children:e.jsx(ct,{placeholder:c?"Loading...":a})}),e.jsx(ot,{children:(o??[]).map(l=>e.jsxs(ge,{value:l.id,children:[l.name_en,l.state_name?` (${l.state_name})`:""]},l.id))})]})}const WC=["Vegetables","Fruits","Grains","Pulses","Dairy","Spices","Other"],YC=()=>{const{user:t}=Fe(),{toast:s}=hs(),{t:r}=Nt(),[a,n]=x.useState([]),[i,o]=x.useState(!0),[c,l]=x.useState(""),[u,d]=x.useState(!1),[p,h]=x.useState(!1),[f,y]=x.useState(null),[v,b]=x.useState("crop"),[N,A]=x.useState(""),[j,C]=x.useState(mc),[I,k]=x.useState({title:"",description:"",category:"",price:"",quantity:"",unit:"kg",location:"",geo_district_id:""}),[R,S]=x.useState(null),{data:T=[],isLoading:E}=qC();x.useEffect(()=>{t&&D()},[t]);const D=async()=>{try{const{data:ne,error:Y}=await W.from("listings").select("*").eq("seller_id",t?.id).order("created_at",{ascending:!1});if(Y)throw Y;n(ne||[])}catch(ne){console.error("Error fetching listings:",ne),s({title:r("common.error"),description:r("farmer.listings.fetchError"),variant:"destructive"})}finally{o(!1)}},F=ne=>{A(ne);const Y=T.find(xe=>xe.id===ne);if(!Y)return;const fe=Y.variety?`${Y.crop_name} (${Y.variety})`:Y.crop_name,me=Y.farmland?[Y.farmland.village,Y.farmland.district].filter(Boolean).join(", "):"";k({...I,title:fe,quantity:Y.estimated_quantity?.toString()||"",unit:Y.quantity_unit||"kg",location:me})},H=async ne=>{ne.preventDefault(),h(!0);try{const Y={title:I.title,description:I.description||null,category:I.category,price:parseFloat(I.price),quantity:parseFloat(I.quantity),unit:I.unit,location:I.location||null,seller_id:t?.id,trace_settings:j,geo_district_id:I.geo_district_id||null};if(v==="crop"&&N&&(Y.crop_id=N),f){const{error:fe}=await W.from("listings").update(Y).eq("id",f.id);if(fe)throw fe;s({title:r("common.success"),description:r("farmer.listings.updateSuccess")})}else{const{data:fe,error:me}=await W.from("listings").insert([Y]).select().single();if(me)throw me;s({title:r("common.success"),description:r("farmer.listings.createSuccess")}),fe&&S(fe.id)}d(!1),L(),D()}catch(Y){console.error("Error saving listing:",Y),s({title:r("common.error"),description:r("farmer.listings.saveError"),variant:"destructive"})}finally{h(!1)}},q=async ne=>{try{const{error:Y}=await W.from("listings").delete().eq("id",ne);if(Y)throw Y;s({title:r("common.success"),description:r("farmer.listings.deleteSuccess")}),D()}catch(Y){console.error("Error deleting listing:",Y),s({title:r("common.error"),description:r("farmer.listings.deleteError"),variant:"destructive"})}},B=ne=>{y(ne),b(ne.crop_id?"crop":"custom"),A(ne.crop_id||""),C(ne.trace_settings||mc),k({title:ne.title,description:ne.description||"",category:ne.category,price:ne.price.toString(),quantity:ne.quantity.toString(),unit:ne.unit,location:ne.location||""}),d(!0)},L=()=>{k({title:"",description:"",category:"",price:"",quantity:"",unit:"kg",location:"",geo_district_id:""}),y(null),b("crop"),A(""),C(mc)},P=async(ne,Y)=>{try{const{error:fe}=await W.from("listings").update({is_active:!Y}).eq("id",ne);if(fe)throw fe;s({title:r("common.success"),description:r(Y?"farmer.listings.deactivated":"farmer.listings.activated")}),D()}catch(fe){console.error("Error updating listing status:",fe),s({title:r("common.error"),description:r("farmer.listings.statusError"),variant:"destructive"})}},K=(ne,Y)=>{n(fe=>fe.map(me=>me.id===ne?{...me,trace_code:Y}:me))},$=(ne,Y)=>{n(fe=>fe.map(me=>me.id===ne?{...me,trace_status:Y}:me))},se=a.filter(ne=>ne.title.toLowerCase().includes(c.toLowerCase())||ne.category.toLowerCase().includes(c.toLowerCase()));return e.jsx(Oe,{title:r("farmer.listings.title"),children:e.jsx($s,{title:r("farmer.listings.title"),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:r("farmer.listings.searchPlaceholder"),value:c,onChange:ne=>l(ne.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",className:"gap-2",children:[e.jsx(ud,{className:"h-4 w-4"}),r("common.filter")]}),e.jsxs(zt,{open:u,onOpenChange:ne=>{d(ne),ne||L()},children:[e.jsx(Wr,{asChild:!0,children:e.jsxs(z,{variant:"default",className:"gap-2",children:[e.jsx(Ss,{className:"h-4 w-4"}),r("farmer.listings.addListing")]})}),e.jsxs(It,{className:"sm:max-w-[560px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Bt,{children:[e.jsx($t,{children:r(f?"farmer.listings.editListing":"farmer.listings.addNewListing")}),e.jsx(Ks,{children:r(f?"farmer.listings.editDescription":"farmer.listings.addDescription")})]}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[!f&&e.jsx(kC,{crops:T,isLoading:E,selectedCropId:N,onSelectCrop:F,sourceMode:v,onSourceModeChange:b}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"title",children:r("farmer.listings.productName")}),e.jsx(Ce,{id:"title",value:I.title,onChange:ne=>k({...I,title:ne.target.value}),placeholder:r("farmer.listings.productNamePlaceholder"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"description",children:r("farmer.listings.description")}),e.jsx(zs,{id:"description",value:I.description,onChange:ne=>k({...I,description:ne.target.value}),placeholder:r("farmer.listings.descriptionPlaceholder"),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"category",children:r("farmer.listings.category")}),e.jsxs(lt,{value:I.category,onValueChange:ne=>k({...I,category:ne}),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:r("farmer.listings.selectCategory")})}),e.jsx(ot,{children:WC.map(ne=>e.jsx(ge,{value:ne,children:r(`enum.categories.${ne.toLowerCase()}`)},ne))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"location",children:r("farmer.listings.location")}),e.jsx(Ce,{id:"location",value:I.location,onChange:ne=>k({...I,location:ne.target.value}),placeholder:r("farmer.listings.locationPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:"District"}),e.jsx(Kr,{value:I.geo_district_id,onValueChange:ne=>k({...I,geo_district_id:ne}),placeholder:"Select listing district"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"price",children:r("farmer.listings.price")}),e.jsx(Ce,{id:"price",type:"number",value:I.price,onChange:ne=>k({...I,price:ne.target.value}),placeholder:"50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"quantity",children:r("farmer.listings.quantity")}),e.jsx(Ce,{id:"quantity",type:"number",value:I.quantity,onChange:ne=>k({...I,quantity:ne.target.value}),placeholder:"100",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"unit",children:r("common.unit")}),e.jsxs(lt,{value:I.unit,onValueChange:ne=>k({...I,unit:ne}),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"kg",children:r("enum.units.kg")}),e.jsx(ge,{value:"quintal",children:r("enum.units.quintals")}),e.jsx(ge,{value:"ton",children:r("enum.units.tonnes")}),e.jsx(ge,{value:"piece",children:r("enum.units.piece")}),e.jsx(ge,{value:"dozen",children:r("enum.units.dozen")})]})]})]})]}),e.jsx(CC,{settings:j,onChange:C}),f&&e.jsx(Hm,{listingId:f.id,cropId:f.crop_id}),e.jsxs(br,{children:[e.jsx(z,{type:"button",variant:"outline",onClick:()=>d(!1),children:r("common.cancel")}),e.jsx(z,{type:"submit",variant:"default",disabled:p,children:r(p?"common.saving":f?"farmer.listings.updateListing":"farmer.listings.createListing")})]})]})]})]})]})]}),R&&e.jsx(zt,{open:!!R,onOpenChange:()=>S(null),children:e.jsxs(It,{className:"sm:max-w-[500px]",children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Add Evidence (Optional)"}),e.jsx(Ks,{children:"Upload photos or reports to strengthen your listing's traceability"})]}),e.jsx(Hm,{listingId:R,cropId:a.find(ne=>ne.id===R)?.crop_id}),e.jsx(br,{children:e.jsx(z,{variant:"outline",onClick:()=>S(null),children:"Done"})})]})}),i?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3].map(ne=>e.jsxs("div",{className:"bg-card rounded-xl border border-border p-6 animate-pulse",children:[e.jsx("div",{className:"h-32 bg-muted rounded-lg mb-4"}),e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2"})]},ne))}):se.length===0?e.jsx(nr,{icon:qt,title:r("farmer.listings.noListingsYet"),description:r("farmer.listings.startSelling"),actionLabel:r("farmer.listings.addFirstListing"),onAction:()=>d(!0)}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:se.map(ne=>e.jsxs("div",{className:"bg-card rounded-xl border border-border overflow-hidden shadow-soft hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"h-32 bg-gradient-earth flex items-center justify-center relative",children:[e.jsx("span",{className:"text-4xl",children:""}),ne.crop_id&&e.jsx(he,{className:"absolute top-2 left-2 bg-primary/80 text-xs",children:"Crop-linked"})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:ne.title}),e.jsx(he,{variant:"outline",className:"mt-1 bg-primary/10 text-primary border-primary/20",children:ne.category})]}),e.jsxs(Co,{children:[e.jsx(So,{asChild:!0,children:e.jsx(z,{"aria-label":"Listing menu",variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Aj,{className:"h-4 w-4"})})}),e.jsxs(gi,{align:"end",children:[e.jsxs(Rr,{onClick:()=>B(ne),children:[e.jsx(ji,{className:"h-4 w-4 mr-2"}),r("common.edit")]}),e.jsxs(Rr,{onClick:()=>S(ne.id),children:[e.jsx(dr,{className:"h-4 w-4 mr-2"}),"Add Evidence"]}),e.jsxs(Rr,{onClick:()=>P(ne.id,ne.is_active),children:[e.jsx(sa,{className:"h-4 w-4 mr-2"}),ne.is_active?r("farmer.listings.deactivate"):r("farmer.listings.activate")]}),e.jsxs(Rr,{onClick:()=>q(ne.id),className:"text-destructive focus:text-destructive",children:[e.jsx(Na,{className:"h-4 w-4 mr-2"}),r("common.delete")]})]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 line-clamp-2",children:ne.description||r("farmer.listings.noDescription")}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-border",children:[e.jsx(hi,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground flex-1",children:ne.trace_code||"No trace code"}),e.jsx(_C,{listingId:ne.id,traceCode:ne.trace_code,traceStatus:ne.trace_status||"published",productName:ne.title,onTraceCodeGenerated:Y=>K(ne.id,Y),onStatusChange:Y=>$(ne.id,Y)})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-border",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-semibold text-foreground",children:["",ne.price,"/",ne.unit]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[ne.quantity," ",ne.unit," ",r("farmer.listings.available")]})]}),e.jsx(he,{variant:ne.is_active?"default":"secondary",children:ne.is_active?r("farmer.listings.active"):r("farmer.listings.inactive")})]})]})]},ne.id))})]})})})},zn=My,Ja=x.forwardRef(({className:t,...s},r)=>e.jsx(jh,{ref:r,className:ke("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));Ja.displayName=jh.displayName;const Vs=x.forwardRef(({className:t,...s},r)=>e.jsx(bh,{ref:r,className:ke("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...s}));Vs.displayName=bh.displayName;const ga=x.forwardRef(({className:t,...s},r)=>e.jsx(wh,{ref:r,className:ke("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));ga.displayName=wh.displayName;const lo={pending:{label:"Pending",icon:vs,color:"bg-accent/20 text-accent-foreground border-accent/30"},confirmed:{label:"Confirmed",icon:ys,color:"bg-primary/20 text-primary border-primary/30"},shipped:{label:"Shipped",icon:rt,color:"bg-blue-500/20 text-blue-700 border-blue-500/30"},delivered:{label:"Delivered",icon:qt,color:"bg-primary/20 text-primary border-primary/30"},cancelled:{label:"Cancelled",icon:Ur,color:"bg-destructive/20 text-destructive border-destructive/30"},rejected:{label:"Rejected",icon:Ur,color:"bg-destructive/20 text-destructive border-destructive/30"}},GC=()=>{const{t}=Nt(),[s,r]=x.useState(""),[a,n]=x.useState("all"),[i,o]=x.useState(null),[c,l]=x.useState(!1),{data:u,isLoading:d}=jw(),p=bw(),h=(u||[]).filter(j=>{const C=j.id.toLowerCase().includes(s.toLowerCase())||j.buyer?.name?.toLowerCase().includes(s.toLowerCase())||j.crop?.crop_name?.toLowerCase().includes(s.toLowerCase()),I=a==="all"||j.status===a;return C&&I}),f={all:u?.length||0,pending:u?.filter(j=>j.status==="pending").length||0,confirmed:u?.filter(j=>j.status==="confirmed").length||0,shipped:u?.filter(j=>j.status==="shipped").length||0,delivered:u?.filter(j=>j.status==="delivered").length||0,cancelled:u?.filter(j=>j.status==="cancelled"||j.status==="rejected").length||0},y=j=>{o(j),l(!0)},[v,b]=x.useState([]),N=async j=>{if(j)try{const{supabase:C}=await Ya(async()=>{const{supabase:S}=await Promise.resolve().then(()=>Mp);return{supabase:S}},void 0),{data:{session:I}}=await C.auth.getSession();if(!I)throw new Error("Not authenticated");const k=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/storage-sign-read-v1",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${I.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({file_id:j})}),R=await k.json();if(!k.ok||!R?.signed_url)throw new Error(R?.error||"Failed to sign read url");window.open(R.signed_url,"_blank")}catch(C){console.error("viewProof error",C),toast.error("Unable to open proof file")}},A=j=>{i&&p.mutate({orderId:i.id,newStatus:j},{onSuccess:()=>l(!1)})};return d?e.jsx(Oe,{title:t("orders.title"),children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{className:"h-10 w-full max-w-md"}),e.jsx(Re,{className:"h-12 w-full"}),e.jsx("div",{className:"space-y-4",children:Array(5).fill(0).map((j,C)=>e.jsx(Re,{className:"h-20 w-full"},C))})]})}):e.jsx(Oe,{title:t("orders.title"),children:e.jsxs($s,{title:t("orders.title"),subtitle:t("orders.subtitle")||"View and manage incoming buyer orders",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:t("common.search"),value:s,onChange:j=>r(j.target.value),className:"pl-9"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(lt,{value:a,onValueChange:n,children:[e.jsxs(it,{className:"w-[140px]",children:[e.jsx(ud,{className:"h-4 w-4 mr-2"}),e.jsx(ct,{placeholder:"Status"})]}),e.jsxs(ot,{children:[e.jsx(ge,{value:"all",children:"All Status"}),e.jsx(ge,{value:"pending",children:"Pending"}),e.jsx(ge,{value:"confirmed",children:"Confirmed"}),e.jsx(ge,{value:"shipped",children:"Shipped"}),e.jsx(ge,{value:"delivered",children:"Delivered"}),e.jsx(ge,{value:"cancelled",children:"Cancelled"})]})]})})]}),e.jsx(zn,{value:a,onValueChange:n,className:"w-full",children:e.jsxs(Ja,{className:"w-full justify-start bg-muted/50 p-1 h-auto flex-wrap",children:[e.jsxs(Vs,{value:"all",className:"data-[state=active]:bg-background",children:["All ",e.jsx(he,{variant:"secondary",className:"ml-2",children:f.all})]}),e.jsxs(Vs,{value:"pending",className:"data-[state=active]:bg-background",children:["Pending ",e.jsx(he,{variant:"secondary",className:"ml-2",children:f.pending})]}),e.jsxs(Vs,{value:"confirmed",className:"data-[state=active]:bg-background",children:["Confirmed ",e.jsx(he,{variant:"secondary",className:"ml-2",children:f.confirmed})]}),e.jsxs(Vs,{value:"shipped",className:"data-[state=active]:bg-background",children:["Shipped ",e.jsx(he,{variant:"secondary",className:"ml-2",children:f.shipped})]}),e.jsxs(Vs,{value:"delivered",className:"data-[state=active]:bg-background",children:["Delivered ",e.jsx(he,{variant:"secondary",className:"ml-2",children:f.delivered})]})]})}),e.jsxs("div",{className:"bg-card rounded-xl border border-border shadow-soft overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/30",children:[e.jsx("th",{className:"text-left text-xs font-medium text-muted-foreground uppercase tracking-wider px-6 py-4",children:"Order ID"}),e.jsx("th",{className:"text-left text-xs font-medium text-muted-foreground uppercase tracking-wider px-6 py-4",children:"Buyer"}),e.jsx("th",{className:"text-left text-xs font-medium text-muted-foreground uppercase tracking-wider px-6 py-4",children:"Product"}),e.jsx("th",{className:"text-left text-xs font-medium text-muted-foreground uppercase tracking-wider px-6 py-4",children:"Quantity"}),e.jsx("th",{className:"text-left text-xs font-medium text-muted-foreground uppercase tracking-wider px-6 py-4",children:"Total"}),e.jsx("th",{className:"text-left text-xs font-medium text-muted-foreground uppercase tracking-wider px-6 py-4",children:"Status"}),e.jsx("th",{className:"text-left text-xs font-medium text-muted-foreground uppercase tracking-wider px-6 py-4",children:"Date"}),e.jsx("th",{className:"text-left text-xs font-medium text-muted-foreground uppercase tracking-wider px-6 py-4",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:h.map(j=>{const C=j.status,I=lo[C]||lo.pending,k=I.icon;return e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-foreground",children:j.id.slice(0,8).toUpperCase()}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:j.buyer?.name||"Unknown Buyer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j.buyer?.district||"-"})]})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-foreground",children:[j.crop?.crop_name||"N/A",j.crop?.variety&&e.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",j.crop.variety,")"]})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:[j.quantity," ",j.quantity_unit||"quintals"]}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-foreground",children:j.price_offered?`${j.price_offered.toLocaleString()}`:"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{variant:"outline",className:ke("gap-1",I.color),children:[e.jsx(k,{className:"h-3 w-3"}),I.label]}),j.payout_hold&&e.jsx(he,{className:"bg-yellow-100 text-yellow-800",children:"Payout hold"})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:tt(new Date(j.created_at),"dd MMM yyyy")}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs(z,{variant:"ghost",size:"sm",className:"gap-2",onClick:()=>y(j),children:[e.jsx(sa,{className:"h-4 w-4"}),"View"]})})]},j.id)})})]})}),h.length===0&&e.jsx(nr,{icon:qt,title:u?.length===0?t("orders.noOrdersYet"):t("common.noResultsFound"),description:u?.length===0?t("orders.noOrdersYet"):t("common.tryAgain")})]}),e.jsx(zt,{open:c,onOpenChange:l,children:e.jsxs(It,{className:"sm:max-w-[500px]",children:[e.jsxs(Bt,{children:[e.jsxs($t,{children:["Order Details - ",i?.id.slice(0,8).toUpperCase()]}),e.jsx(Ks,{children:"View and manage order information"})]}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Buyer"}),e.jsx("p",{className:"text-sm font-medium",children:i.buyer?.name||"Unknown"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-sm font-medium",children:i.buyer?.phone||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Company"}),e.jsx("p",{className:"text-sm font-medium",children:i.buyer?.company_name||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Order Date"}),e.jsx("p",{className:"text-sm font-medium",children:tt(new Date(i.created_at),"dd MMM yyyy")})]})]}),e.jsxs("div",{className:"border-t border-border pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"text-sm",children:i.crop?.crop_name||"Product"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.quantity," ",i.quantity_unit||"quintals"]})]}),i.delivery_address&&e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Delivery Address"}),e.jsx("p",{className:"text-sm",children:i.delivery_address})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-border",children:[e.jsx("p",{className:"font-medium",children:"Total Amount"}),e.jsx("p",{className:"font-semibold text-lg",children:i.price_offered?`${i.price_offered.toLocaleString()}`:"-"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current Status"}),e.jsx(he,{variant:"outline",className:ke("mt-1",lo[i.status]?.color||""),children:lo[i.status]?.label||i.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Payment"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{variant:i.payment_status==="paid"?"default":"secondary",className:"mt-1",children:i.payment_status||"pending"}),i.payout_hold&&e.jsx(he,{className:"bg-yellow-100 text-yellow-800 mt-1",children:"Payout hold"})]})]})]}),i.notes&&e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm",children:i.notes})]})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:"Timeline"}),v.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No events yet"}):e.jsx("ol",{className:"relative border-l border-muted/50 ml-2",children:v.map(j=>e.jsxs("li",{className:"mb-6 ml-6",children:[e.jsx("span",{className:"absolute -left-3 flex h-6 w-6 items-center justify-center rounded-full bg-white ring-2 ring-primary",children:e.jsx("svg",{className:"h-3 w-3 text-primary",fill:"currentColor",viewBox:"0 0 8 8",children:e.jsx("circle",{cx:"4",cy:"4",r:"3"})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("div",{children:new Date(j.created_at).toLocaleString()}),e.jsx("div",{className:"ml-2",children:j.event_type})]}),e.jsxs("div",{className:"mt-1 text-sm",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:JSON.stringify(j.payload)}),(j.payload&&(j.payload.proof_file_id||j.payload.proof||j.payload.file_id)||j.payload&&j.payload.file_id)&&e.jsx("div",{className:"mt-2",children:e.jsx(z,{size:"sm",variant:"outline",onClick:()=>N(j.payload.proof_file_id||j.payload.file_id||j.payload.proof),children:"View proof"})})]})]},j.event_id))})]}),e.jsxs(br,{className:"flex-col sm:flex-row gap-2",children:[i?.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>A("rejected"),disabled:p.isPending,children:[e.jsx(Ur,{className:"h-4 w-4 mr-2"}),"Reject"]}),e.jsxs(z,{className:"gap-2",onClick:()=>A("confirmed"),disabled:p.isPending,children:[e.jsx(ys,{className:"h-4 w-4"}),"Confirm Order"]})]}),i?.status==="confirmed"&&e.jsxs(z,{className:"gap-2",onClick:()=>A("shipped"),disabled:p.isPending,children:[e.jsx(rt,{className:"h-4 w-4"}),"Mark as Shipped"]}),i?.status==="shipped"&&e.jsxs(z,{className:"gap-2",onClick:()=>A("delivered"),disabled:p.isPending,children:[e.jsx(qt,{className:"h-4 w-4"}),"Mark as Delivered"]})]})]})})]})})},ln=({title:t,value:s,change:r,changeType:a="neutral",icon:n,iconColor:i="bg-primary/10 text-primary"})=>e.jsx("div",{className:"bg-card rounded-xl border border-border p-6 shadow-soft hover:shadow-medium transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:t}),e.jsx("p",{className:"mt-2 text-3xl font-display font-bold text-foreground",children:s}),r&&e.jsxs("p",{className:ke("mt-2 text-sm font-medium flex items-center gap-1",a==="positive"&&"text-primary",a==="negative"&&"text-destructive",a==="neutral"&&"text-muted-foreground"),children:[a==="positive"&&"",a==="negative"&&"",r]})]}),e.jsx("div",{className:ke("p-3 rounded-lg",i),children:e.jsx(n,{className:"h-6 w-6"})})]})}),QC=({icon:t,title:s,description:r,actionLabel:a,onAction:n})=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted/50 mb-4",children:e.jsx(t,{className:"h-12 w-12 text-muted-foreground/60"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-sm mb-6",children:r}),a&&n&&e.jsx(z,{onClick:n,size:"lg",children:a})]}),XC=()=>{const{user:t}=Fe();return De({queryKey:["farmer-earnings",t?.id],queryFn:async()=>{if(!t?.id)return{totalSales:0,pendingPayments:0,completedOrders:0,pendingOrders:0};const{data:s,error:r}=await W.from("market_orders").select("status, price_offered").eq("farmer_id",t.id);if(r)throw r;const a=["delivered","completed"],n=["pending","confirmed","shipped"];let i=0,o=0,c=0,l=0;for(const u of s||[]){const d=u.price_offered||0;a.includes(u.status)?(i+=d,c++):n.includes(u.status)&&(o+=d,l++)}return{totalSales:i,pendingPayments:o,completedOrders:c,pendingOrders:l}},enabled:!!t?.id})},JC=(t=20)=>{const{user:s}=Fe();return De({queryKey:["farmer-transactions",s?.id,t],queryFn:async()=>{if(!s?.id)return[];const{data:r,error:a}=await W.from("market_orders").select(`
          id,
          status,
          price_offered,
          created_at,
          crop_id
        `).eq("farmer_id",s.id).order("created_at",{ascending:!1}).limit(t);if(a)throw a;return await Promise.all((r||[]).map(async i=>{let o=null,c=null;if(i.crop_id){const{data:u}=await W.from("crops").select("crop_name").eq("id",i.crop_id).maybeSingle();o=u?.crop_name||null}const l=["delivered","completed"];return{id:i.id,type:"credit",description:o?`Order for ${o}`:`Order #${i.id.slice(0,8).toUpperCase()}`,amount:i.price_offered||0,date:i.created_at,status:l.includes(i.status)?"completed":"pending",cropName:o,buyerName:c}}))},enabled:!!s?.id})},ZC=()=>{const t=Ut(),{data:s,isLoading:r}=XC(),{data:a,isLoading:n}=JC(10),i=r||n,o=!i&&s?.completedOrders===0&&s?.pendingOrders===0;return i?e.jsx(Oe,{title:"Earnings",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[1,2,3].map(c=>e.jsx(Re,{className:"h-32 rounded-xl"},c))}),e.jsx(Re,{className:"h-64 rounded-xl"})]})}):o?e.jsx(Oe,{title:"Earnings",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(ln,{title:"Total Sales",value:"0",change:"From completed orders",changeType:"neutral",icon:Zr,iconColor:"bg-primary/10 text-primary"}),e.jsx(ln,{title:"Pending Payments",value:"0",change:"From active orders",changeType:"neutral",icon:vs,iconColor:"bg-amber-500/10 text-amber-600"}),e.jsx(ln,{title:"Completed Orders",value:"0",change:"Total fulfilled orders",changeType:"neutral",icon:ys,iconColor:"bg-emerald-500/10 text-emerald-600"})]}),e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:e.jsx(QC,{icon:No,title:"No earnings yet",description:"Start selling your produce to see your earnings here. Create a listing or complete an order to get started.",actionLabel:"Create a Listing",onAction:()=>t("/farmer/listings")})})}),e.jsx(G,{className:"bg-gradient-to-r from-primary/5 to-accent/5 border-primary/20",children:e.jsx(Q,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/10",children:e.jsx(pr,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:"How earnings work"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"When buyers purchase your produce through the marketplace, the payment will be tracked here. You'll see your total sales from completed orders and pending payments from active orders."}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsxs(z,{size:"sm",onClick:()=>t("/farmer/listings"),children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Create Listing"]}),e.jsx(z,{size:"sm",variant:"outline",onClick:()=>t("/farmer/crops"),children:"Manage Crops"})]})]})]})})})]})}):e.jsx(Oe,{title:"Earnings",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-bold text-foreground",children:"Financial Overview"}),e.jsx("p",{className:"text-muted-foreground",children:"Track your earnings from marketplace sales"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(ln,{title:"Total Sales",value:`${(s?.totalSales||0).toLocaleString("en-IN")}`,change:`${s?.completedOrders||0} completed orders`,changeType:s?.totalSales&&s.totalSales>0?"positive":"neutral",icon:Zr,iconColor:"bg-primary/10 text-primary"}),e.jsx(ln,{title:"Pending Payments",value:`${(s?.pendingPayments||0).toLocaleString("en-IN")}`,change:`${s?.pendingOrders||0} pending orders`,changeType:"neutral",icon:vs,iconColor:"bg-amber-500/10 text-amber-600"}),e.jsx(ln,{title:"Completed Orders",value:(s?.completedOrders||0).toString(),change:"Total fulfilled orders",changeType:s?.completedOrders&&s.completedOrders>0?"positive":"neutral",icon:ys,iconColor:"bg-emerald-500/10 text-emerald-600"})]}),e.jsxs(G,{children:[e.jsxs(je,{className:"flex flex-row items-center justify-between pb-4",children:[e.jsx(we,{className:"text-lg",children:"Recent Transactions"}),e.jsx(z,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80",onClick:()=>t("/farmer/orders"),children:"View All Orders"})]}),e.jsx(Q,{children:!a||a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(qt,{className:"h-10 w-10 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No transactions yet"})]}):e.jsx("div",{className:"divide-y divide-border",children:a.map(c=>e.jsxs("div",{className:"flex items-center justify-between py-4 first:pt-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 rounded-full bg-primary/10 text-primary",children:e.jsx(Yh,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:c.description}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Er(new Date(c.date),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold text-primary",children:["+",c.amount.toLocaleString("en-IN")]}),e.jsx(he,{variant:c.status==="completed"?"default":"secondary",className:"text-xs",children:c.status})]})]},c.id))})})]}),s&&(s.totalSales>0||s.pendingPayments>0)&&e.jsx(G,{className:"bg-muted/30 border-dashed",children:e.jsx(Q,{className:"p-4",children:e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:" More detailed analytics, withdrawal options, and payment history are coming soon!"})})})]})})},xr=({loading:t=!1,empty:s=!1,error:r,loadingLabel:a=void 0,emptyTitle:n=void 0,emptyMessage:i,retry:o,children:c})=>{const{t:l}=Nt(),u=a??l("common.loading"),d=n??l("common.noData");return t?e.jsxs("div",{className:"rounded-xl border border-border/70 bg-card p-6 text-center text-muted-foreground",children:[e.jsx(et,{className:"mx-auto mb-3 h-5 w-5 animate-spin"}),e.jsx("p",{className:"text-sm",children:u})]}):r?e.jsxs("div",{className:"rounded-xl border border-destructive/30 bg-destructive/5 p-6 text-center",children:[e.jsx(ks,{className:"mx-auto mb-3 h-5 w-5 text-destructive"}),e.jsx("p",{className:"mb-3 text-sm text-destructive",children:r}),o?e.jsx(z,{variant:"outline",size:"sm",onClick:o,children:l("common.retry")}):null]}):s?e.jsxs("div",{className:"rounded-xl border border-border/70 bg-card p-6 text-center",children:[e.jsx(rp,{className:"mx-auto mb-3 h-5 w-5 text-muted-foreground"}),e.jsx("p",{className:"font-medium text-foreground",children:d}),i?e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:i}):null]}):e.jsx(e.Fragment,{children:c})};var Cg="AlertDialog",[eS]=wr(Cg,[Nh]),na=Nh(),Sg=t=>{const{__scopeAlertDialog:s,...r}=t,a=na(s);return e.jsx(sd,{...a,...r,modal:!0})};Sg.displayName=Cg;var tS="AlertDialogTrigger",sS=x.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=na(r);return e.jsx(ph,{...n,...a,ref:s})});sS.displayName=tS;var rS="AlertDialogPortal",Ag=t=>{const{__scopeAlertDialog:s,...r}=t,a=na(s);return e.jsx(ed,{...a,...r})};Ag.displayName=rS;var aS="AlertDialogOverlay",Tg=x.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=na(r);return e.jsx(Uo,{...n,...a,ref:s})});Tg.displayName=aS;var xn="AlertDialogContent",[nS,iS]=eS(xn),oS=ah("AlertDialogContent"),Pg=x.forwardRef((t,s)=>{const{__scopeAlertDialog:r,children:a,...n}=t,i=na(r),o=x.useRef(null),c=Ht(s,o),l=x.useRef(null);return e.jsx(Ry,{contentName:xn,titleName:Mg,docsSlug:"alert-dialog",children:e.jsx(nS,{scope:r,cancelRef:l,children:e.jsxs(Ho,{role:"alertdialog",...i,...n,ref:c,onOpenAutoFocus:st(n.onOpenAutoFocus,u=>{u.preventDefault(),l.current?.focus({preventScroll:!0})}),onPointerDownOutside:u=>u.preventDefault(),onInteractOutside:u=>u.preventDefault(),children:[e.jsx(oS,{children:a}),e.jsx(cS,{contentRef:o})]})})})});Pg.displayName=xn;var Mg="AlertDialogTitle",Rg=x.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=na(r);return e.jsx(Vo,{...n,...a,ref:s})});Rg.displayName=Mg;var Dg="AlertDialogDescription",Eg=x.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=na(r);return e.jsx(Ko,{...n,...a,ref:s})});Eg.displayName=Dg;var lS="AlertDialogAction",Ig=x.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,n=na(r);return e.jsx(td,{...n,...a,ref:s})});Ig.displayName=lS;var Og="AlertDialogCancel",Fg=x.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,{cancelRef:n}=iS(Og,r),i=na(r),o=Ht(s,n);return e.jsx(td,{...i,...a,ref:o})});Fg.displayName=Og;var cS=({contentRef:t})=>{const s=`\`${xn}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${xn}\` by passing a \`${Dg}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${xn}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return x.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},dS=Sg,uS=Ag,Lg=Tg,qg=Pg,zg=Ig,Bg=Fg,$g=Rg,Ug=Eg;const mS=dS,hS=uS,Hg=x.forwardRef(({className:t,...s},r)=>e.jsx(Lg,{className:ke("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:r}));Hg.displayName=Lg.displayName;const Vg=x.forwardRef(({className:t,...s},r)=>e.jsxs(hS,{children:[e.jsx(Hg,{}),e.jsx(qg,{ref:r,className:ke("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s})]}));Vg.displayName=qg.displayName;const Kg=({className:t,...s})=>e.jsx("div",{className:ke("flex flex-col space-y-2 text-center sm:text-left",t),...s});Kg.displayName="AlertDialogHeader";const Wg=({className:t,...s})=>e.jsx("div",{className:ke("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});Wg.displayName="AlertDialogFooter";const Yg=x.forwardRef(({className:t,...s},r)=>e.jsx($g,{ref:r,className:ke("text-lg font-semibold",t),...s}));Yg.displayName=$g.displayName;const Gg=x.forwardRef(({className:t,...s},r)=>e.jsx(Ug,{ref:r,className:ke("text-sm text-muted-foreground",t),...s}));Gg.displayName=Ug.displayName;const Qg=x.forwardRef(({className:t,...s},r)=>e.jsx(zg,{ref:r,className:ke(xi(),t),...s}));Qg.displayName=zg.displayName;const Xg=x.forwardRef(({className:t,...s},r)=>e.jsx(Bg,{ref:r,className:ke(xi({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));Xg.displayName=Bg.displayName;const Ci=({open:t,onOpenChange:s,title:r,description:a,confirmText:n="Confirm",cancelText:i="Cancel",variant:o="default",onConfirm:c,loading:l=!1})=>e.jsx(mS,{open:t,onOpenChange:s,children:e.jsxs(Vg,{children:[e.jsxs(Kg,{children:[e.jsx(Yg,{children:r}),e.jsx(Gg,{children:a})]}),e.jsxs(Wg,{children:[e.jsx(Xg,{disabled:l,children:i}),e.jsx(Qg,{onClick:u=>{u.preventDefault(),c()},disabled:l,className:o==="destructive"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"",children:l?"Please wait...":n})]})]})}),vr=({content:t})=>e.jsxs(Sb,{children:[e.jsx(Ab,{asChild:!0,children:e.jsxs("button",{type:"button",className:"inline-flex ml-1 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(cd,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Help"})]})}),e.jsx(Pp,{side:"top",className:"max-w-xs text-sm",children:t})]}),pS=()=>{const{data:t,isLoading:s}=ka(),{data:r}=_a(),{user:a}=Fe(),{toast:n}=hs(),{t:i}=Nt(),o=Xe(),c=Ut(),[l,u]=x.useState(!1),[d,p]=x.useState(!1),[h,f]=x.useState(""),[y,v]=x.useState("all"),[b,N]=x.useState(null),[A,j]=x.useState(!1),[C,I]=x.useState(null),[k,R]=x.useState(!1),[S,T]=x.useState(!1),[E,D]=x.useState(null),[F,H]=x.useState(!1),[q,B]=x.useState({crop_name:"",variety:"",land_id:"",sowing_date:"",harvest_estimate:"",status:"growing",estimated_quantity:"",quantity_unit:"quintals"}),L={growing:{label:i("enum.crop_status.growing"),color:"bg-muted text-muted-foreground",dotColor:"bg-gray-400"},one_week:{label:i("enum.crop_status.one_week"),color:"bg-amber-100 text-amber-800",dotColor:"bg-amber-500"},ready:{label:i("enum.crop_status.ready"),color:"bg-emerald-100 text-emerald-800",dotColor:"bg-emerald-500"},harvested:{label:i("enum.crop_status.harvested"),color:"bg-primary/10 text-primary",dotColor:"bg-primary"}},P=t?.filter(Y=>{const fe=Y.crop_name.toLowerCase().includes(h.toLowerCase())||Y.variety?.toLowerCase().includes(h.toLowerCase()),me=y==="all"||Y.status===y;return fe&&me}),K={total:t?.length||0,growing:t?.filter(Y=>Y.status==="growing").length||0,oneWeek:t?.filter(Y=>Y.status==="one_week").length||0,ready:t?.filter(Y=>Y.status==="ready").length||0,harvested:t?.filter(Y=>Y.status==="harvested").length||0},$=async Y=>{if(Y.preventDefault(),!!a?.id){p(!0);try{const{error:fe}=await W.from("crops").insert({farmer_id:a.id,crop_name:q.crop_name,variety:q.variety||null,land_id:q.land_id||null,sowing_date:q.sowing_date||null,harvest_estimate:q.harvest_estimate||null,status:q.status,estimated_quantity:q.estimated_quantity?parseFloat(q.estimated_quantity):null,quantity_unit:q.quantity_unit});if(fe)throw fe;n({title:i("common.success"),description:i("farmer.crops.addSuccess")}),u(!1),B({crop_name:"",variety:"",land_id:"",sowing_date:"",harvest_estimate:"",status:"growing",estimated_quantity:"",quantity_unit:"quintals"}),o.invalidateQueries({queryKey:["crops",a.id]})}catch(fe){const me=fe instanceof Error?fe.message:i("common.error");n({title:i("common.error"),description:me,variant:"destructive"})}finally{p(!1)}}},se=(Y,fe)=>{D({id:Y,name:fe}),T(!0)},ne=async()=>{if(E){H(!0);try{const{error:Y}=await W.from("crops").delete().eq("id",E.id);if(Y)throw Y;n({title:i("farmer.crops.deleted"),description:i("farmer.crops.deleteSuccess")}),o.invalidateQueries({queryKey:["crops",a?.id]}),T(!1),D(null)}catch(Y){const fe=Y instanceof Error?Y.message:i("common.error");n({title:i("common.error"),description:fe,variant:"destructive"})}finally{H(!1)}}};return e.jsxs(Oe,{title:i("farmer.crops.title"),children:[e.jsxs($s,{title:i("farmer.crops.title"),children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(G,{className:`cursor-pointer hover:shadow-md transition-all ${y==="all"?"ring-2 ring-primary shadow-md":""}`,onClick:()=>v("all"),children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:e.jsx(ts,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:K.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i("farmer.crops.totalCrops")})]})]})})}),e.jsx(G,{className:`cursor-pointer hover:shadow-md transition-all ${y==="growing"?"ring-2 ring-primary shadow-md":""}`,onClick:()=>v("growing"),children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-muted",children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:K.growing}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i("enum.crop_status.growing")})]})]})})}),e.jsx(G,{className:`cursor-pointer hover:shadow-md transition-all ${y==="one_week"?"ring-2 ring-primary shadow-md":""}`,onClick:()=>v("one_week"),children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100",children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:K.oneWeek}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i("enum.crop_status.one_week")})]})]})})}),e.jsx(G,{className:`cursor-pointer hover:shadow-md transition-all ${y==="ready"?"ring-2 ring-primary shadow-md":""}`,onClick:()=>v("ready"),children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-100",children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-emerald-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:K.ready}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i("enum.crop_status.ready")})]})]})})}),e.jsx(G,{className:`cursor-pointer hover:shadow-md transition-all ${y==="harvested"?"ring-2 ring-primary shadow-md":""}`,onClick:()=>v("harvested"),children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx("div",{className:"w-5 h-5 rounded-full bg-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:K.harvested}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i("enum.crop_status.harvested")})]})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:i("farmer.crops.searchPlaceholder"),className:"pl-10",value:h,onChange:Y=>f(Y.target.value)})]}),e.jsxs(zt,{open:l,onOpenChange:u,children:[e.jsx(Wr,{asChild:!0,children:e.jsxs(z,{size:"lg",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),i("farmer.crops.addCrop")]})}),e.jsxs(It,{className:"max-w-md",children:[e.jsxs(Bt,{children:[e.jsx($t,{children:i("farmer.crops.addNewCrop")}),e.jsx(Ks,{children:i("farmer.crops.addCropDescription")})]}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[i("farmer.crops.cropName")," *",e.jsx(vr,{content:i("farmer.crops.cropNameHelp")})]}),e.jsx(Ce,{value:q.crop_name,onChange:Y=>B({...q,crop_name:Y.target.value}),placeholder:i("farmer.crops.cropNamePlaceholder"),required:!0})]}),e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[i("farmer.crops.variety"),e.jsx(vr,{content:i("farmer.crops.varietyHelp")})]}),e.jsx(Ce,{value:q.variety,onChange:Y=>B({...q,variety:Y.target.value}),placeholder:i("farmer.crops.varietyPlaceholder")})]}),e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[i("farmer.farmlands.title"),e.jsx(vr,{content:i("farmer.crops.farmlandHelp")})]}),e.jsxs(lt,{value:q.land_id,onValueChange:Y=>B({...q,land_id:Y}),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:i("farmer.crops.selectFarmland")})}),e.jsx(ot,{children:r?.map(Y=>e.jsxs(ge,{value:Y.id,children:[Y.name," (",Y.area," ",Y.area_unit,")"]},Y.id))})]}),(!r||r.length===0)&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[i("farmer.crops.noFarmlands")," ",e.jsx("button",{type:"button",className:"text-primary underline",onClick:()=>c("/farmer/farmlands"),children:i("farmer.crops.addFarmlandFirst")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[i("farmer.crops.sowingDate"),e.jsx(vr,{content:i("farmer.crops.sowingDateHelp")})]}),e.jsx(Ce,{type:"date",value:q.sowing_date,onChange:Y=>B({...q,sowing_date:Y.target.value})})]}),e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[i("farmer.crops.harvestDate"),e.jsx(vr,{content:i("farmer.crops.harvestDateHelp")})]}),e.jsx(Ce,{type:"date",value:q.harvest_estimate,onChange:Y=>B({...q,harvest_estimate:Y.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[i("farmer.crops.expectedQuantity"),e.jsx(vr,{content:i("farmer.crops.quantityHelp")})]}),e.jsx(Ce,{type:"number",value:q.estimated_quantity,onChange:Y=>B({...q,estimated_quantity:Y.target.value}),placeholder:"50"})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("common.unit")}),e.jsxs(lt,{value:q.quantity_unit,onValueChange:Y=>B({...q,quantity_unit:Y}),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"quintals",children:i("enum.units.quintals")}),e.jsx(ge,{value:"kg",children:i("enum.units.kg")}),e.jsx(ge,{value:"tonnes",children:i("enum.units.tonnes")})]})]})]})]}),e.jsx(z,{type:"submit",className:"w-full",size:"lg",disabled:d,children:i(d?"common.saving":"farmer.crops.addCrop")})]})]})]})]}),s?e.jsx(xr,{loading:!0,children:e.jsx(e.Fragment,{})}):P?.length===0?e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:e.jsx(nr,{icon:ts,title:i(h||y!=="all"?"farmer.crops.noCropsFound":"farmer.crops.noCropsYet"),description:i(h||y!=="all"?"farmer.crops.adjustSearch":"farmer.crops.startAddingCrops"),actionLabel:i(h||y!=="all"?"common.clearFilters":"farmer.crops.addFirstCrop"),onAction:()=>{h||y!=="all"?(f(""),v("all")):u(!0)}})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:P?.map(Y=>{const fe=L[Y.status];return e.jsx(G,{className:"hover:shadow-medium transition-all group",children:e.jsxs(Q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:Y.crop_name}),Y.variety&&e.jsx("p",{className:"text-sm text-muted-foreground",children:Y.variety})]}),e.jsxs(he,{className:fe.color,children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-1.5 ${fe.dotColor}`}),fe.label]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground mb-4",children:[Y.farmland&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"truncate",children:Y.farmland.name})]}),Y.harvest_estimate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4 shrink-0"}),e.jsxs("span",{children:[i("farmer.crops.harvest"),": ",tt(new Date(Y.harvest_estimate),"MMM d, yyyy")]})]}),Y.estimated_quantity&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cp,{className:"h-4 w-4 shrink-0"}),e.jsxs("span",{children:[Y.estimated_quantity," ",Y.quantity_unit]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(z,{variant:"default",size:"sm",className:"flex-1",onClick:()=>c(`/farmer/crops/${Y.id}`),children:[e.jsx(jj,{className:"h-4 w-4 mr-1"}),i("farmer.crops.diary")]}),e.jsx(z,{"aria-label":`Edit ${Y.crop_name}`,variant:"outline",size:"sm",onClick:()=>{N(Y),j(!0)},children:e.jsx(ji,{className:"h-4 w-4"})}),e.jsx(z,{"aria-label":`Request transport for ${Y.crop_name}`,variant:"outline",size:"sm",onClick:()=>{I(Y),R(!0)},children:e.jsx(rt,{className:"h-4 w-4"})}),e.jsx(z,{"aria-label":`Delete ${Y.crop_name}`,variant:"outline",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>se(Y.id,Y.crop_name),children:e.jsx(Na,{className:"h-4 w-4"})})]})]})},Y.id)})})]}),e.jsx(Xf,{crop:b,open:A,onOpenChange:j}),e.jsx(Jf,{crop:C,open:k,onOpenChange:R}),e.jsx(Ci,{open:S,onOpenChange:T,title:i("farmer.crops.deleteCrop"),description:i("farmer.crops.deleteConfirm"),confirmText:i("common.delete"),variant:"destructive",onConfirm:ne,loading:F})]})};function lu(){const[t,s]=x.useState(null),[r,a]=x.useState(!1),[n,i]=x.useState(null),o=x.useCallback(async()=>navigator.geolocation?(a(!0),i(null),new Promise(l=>{navigator.geolocation.getCurrentPosition(u=>{const d={latitude:u.coords.latitude,longitude:u.coords.longitude,accuracy:u.coords.accuracy};s(d),a(!1),l(d)},u=>{let d="Unable to capture location";u.code===1?d="Location permission denied":u.code===2?d="Location unavailable":u.code===3&&(d="Location request timed out"),i(d),a(!1),l(null)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})})):(i("GPS not supported on this device"),null),[]),c=x.useCallback(()=>{s(null),i(null)},[]);return{position:t,capturing:r,error:n,capture:o,clear:c}}const fS=({cropId:t,open:s,onOpenChange:r})=>{const[a,n]=x.useState(null),[i,o]=x.useState(null),[c,l]=x.useState(""),[u,d]=x.useState(""),[p,h]=x.useState(!1),f=lu(),y=n2(),v=async j=>{const C=j.target.files?.[0];if(!C)return;if(!xl(C)){ce.error("Please select an image file (JPG, PNG, WebP)");return}const I=Tn(C,Es.IMAGE_MAX_MB);if(!I.valid){ce.error(I.message);return}let k=C;if(C.size/(1024*1024)>Es.IMAGE_COMPRESS_TARGET_MB){h(!0);try{k=await Ms(C,{maxSizeMB:Es.IMAGE_COMPRESS_TARGET_MB,maxWidthOrHeight:1920,useWebWorker:!0})}catch(T){console.error("Compression failed:",T),ce.error("Failed to compress image. Please try a smaller file."),h(!1);return}h(!1)}n(k);const S=new FileReader;S.onloadend=()=>o(S.result),S.readAsDataURL(k),f.position||f.capture()},b=()=>{n(null),o(null)},N=async j=>{if(j.preventDefault(),!a)return;const C=[];u&&C.push(u);try{await y.mutateAsync({cropId:t,file:a,caption:c||void 0,tags:C.length>0?C:void 0,latitude:f.position?.latitude,longitude:f.position?.longitude}),n(null),o(null),l(""),d(""),f.clear(),r(!1)}catch(I){const k=fl(I);ce.error(`Upload failed: ${k}`,{action:ou(()=>N(j))})}},A=y.isPending||p;return e.jsx(zt,{open:s,onOpenChange:r,children:e.jsxs(It,{className:"max-w-md",children:[e.jsxs(Bt,{children:[e.jsxs($t,{className:"flex items-center gap-2",children:[e.jsx(dr,{className:"h-5 w-5"}),"Upload Crop Photo"]}),e.jsx(Ks,{children:"Capture or upload a photo of your crop to track its progress."})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[i?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:i,alt:"Preview",className:"w-full h-48 object-cover rounded-lg"}),e.jsx(z,{type:"button",variant:"secondary",size:"icon",className:"absolute top-2 right-2",onClick:b,disabled:A,children:e.jsx(ar,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:[e.jsx("input",{type:"file",id:"photo-upload",accept:"image/*",capture:"environment",onChange:v,className:"hidden",disabled:A}),e.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer flex flex-col items-center gap-3",children:[e.jsx("div",{className:"p-4 rounded-full bg-primary/10",children:p?e.jsx(et,{className:"h-8 w-8 text-primary animate-spin"}):e.jsx(dr,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:p?"Compressing...":"Take Photo or Upload"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:p?"Optimizing image for upload":"Tap to open camera or select from gallery"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Max ",Es.IMAGE_MAX_MB,"MB  Auto-compressed to ",Es.IMAGE_COMPRESS_TARGET_MB,"MB"]})]})]})]}),a&&e.jsx("div",{className:"flex items-center gap-2 text-xs px-1",children:f.capturing?e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(et,{className:"h-3 w-3 animate-spin"})," Capturing location..."]}):f.position?e.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[e.jsx(qs,{className:"h-3 w-3"}),"  Geo-tagged"]}):e.jsxs("button",{type:"button",onClick:()=>f.capture(),className:"text-muted-foreground hover:text-foreground flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"})," Add location (optional)"]})}),e.jsxs("div",{children:[e.jsx(ie,{children:"Caption (Optional)"}),e.jsx(Ce,{value:c,onChange:j=>l(j.target.value),placeholder:"Describe what's happening...",disabled:A})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Month Tag (Optional)"}),e.jsxs(lt,{value:u,onValueChange:d,disabled:A,children:[e.jsx(it,{children:e.jsx(ct,{placeholder:"Select month..."})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"month_1",children:"Month 1"}),e.jsx(ge,{value:"month_2",children:"Month 2"}),e.jsx(ge,{value:"month_3",children:"Month 3"}),e.jsx(ge,{value:"month_4",children:"Month 4"}),e.jsx(ge,{value:"month_5",children:"Month 5"}),e.jsx(ge,{value:"month_6",children:"Month 6"})]})]})]}),e.jsx(z,{type:"submit",className:"w-full",disabled:!a||A,children:A?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),p?"Compressing...":"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pi,{className:"h-4 w-4 mr-2"}),"Upload Photo"]})})]})]})})},xS=[{value:"fertilizer",label:"Fertilizer",icon:e.jsx(Ys,{className:"h-4 w-4"})},{value:"spray",label:"Spray/Pesticide",icon:e.jsx(Gh,{className:"h-4 w-4"})},{value:"irrigation",label:"Irrigation",icon:e.jsx(Go,{className:"h-4 w-4"})},{value:"weeding",label:"Weeding",icon:e.jsx(dp,{className:"h-4 w-4"})},{value:"note",label:"General Note",icon:e.jsx(us,{className:"h-4 w-4"})},{value:"other",label:"Other",icon:e.jsx(Js,{className:"h-4 w-4"})}],gS=({cropId:t,open:s,onOpenChange:r})=>{const[a,n]=x.useState("note"),[i,o]=x.useState(""),[c,l]=x.useState(""),[u,d]=x.useState(""),[p,h]=x.useState(""),f=i2(),y=["fertilizer","spray"].includes(a),v=async b=>{b.preventDefault();const N={};c&&(N.product_name=c),u&&(N.dosage=u),p&&(N.cost=parseFloat(p)),await f.mutateAsync({cropId:t,activityType:a,notes:i||void 0,meta:Object.keys(N).length>0?N:void 0}),o(""),l(""),d(""),h(""),r(!1)};return e.jsx(zt,{open:s,onOpenChange:r,children:e.jsxs(It,{className:"max-w-md",children:[e.jsxs(Bt,{children:[e.jsxs($t,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5"}),"Log Activity"]}),e.jsx(Ks,{children:"Record an activity like fertilizer application, irrigation, or spraying."})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:"Activity Type"}),e.jsxs(lt,{value:a,onValueChange:b=>n(b),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsx(ot,{children:xS.map(b=>e.jsx(ge,{value:b.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[b.icon,b.label]})},b.value))})]})]}),y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(ie,{children:"Product Name"}),e.jsx(Ce,{value:c,onChange:b=>l(b.target.value),placeholder:"e.g., Urea, NPK 20-20-20"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:"Dosage"}),e.jsx(Ce,{value:u,onChange:b=>d(b.target.value),placeholder:"e.g., 50kg/acre"})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Cost ()"}),e.jsx(Ce,{type:"number",value:p,onChange:b=>h(b.target.value),placeholder:"e.g., 1500"})]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Notes"}),e.jsx(zs,{value:i,onChange:b=>o(b.target.value),placeholder:"Add any details...",rows:3})]}),e.jsx(z,{type:"submit",className:"w-full",disabled:f.isPending,children:f.isPending?"Saving...":"Save Activity"})]})]})})};var cu="Radio",[vS,Jg]=wr(cu),[yS,jS]=vS(cu),Zg=x.forwardRef((t,s)=>{const{__scopeRadio:r,name:a,checked:n=!1,required:i,disabled:o,value:c="on",onCheck:l,form:u,...d}=t,[p,h]=x.useState(null),f=Ht(s,b=>h(b)),y=x.useRef(!1),v=p?u||!!p.closest("form"):!0;return e.jsxs(yS,{scope:r,checked:n,disabled:o,children:[e.jsx(ht.button,{type:"button",role:"radio","aria-checked":n,"data-state":rv(n),"data-disabled":o?"":void 0,disabled:o,value:c,...d,ref:f,onClick:st(t.onClick,b=>{n||l?.(),v&&(y.current=b.isPropagationStopped(),y.current||b.stopPropagation())})}),v&&e.jsx(sv,{control:p,bubbles:!y.current,name:a,value:c,checked:n,required:i,disabled:o,form:u,style:{transform:"translateX(-100%)"}})]})});Zg.displayName=cu;var ev="RadioIndicator",tv=x.forwardRef((t,s)=>{const{__scopeRadio:r,forceMount:a,...n}=t,i=jS(ev,r);return e.jsx(Lr,{present:a||i.checked,children:e.jsx(ht.span,{"data-state":rv(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:s})})});tv.displayName=ev;var bS="RadioBubbleInput",sv=x.forwardRef(({__scopeRadio:t,control:s,checked:r,bubbles:a=!0,...n},i)=>{const o=x.useRef(null),c=Ht(o,i),l=rl(r),u=ad(s);return x.useEffect(()=>{const d=o.current;if(!d)return;const p=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(p,"checked").set;if(l!==r&&f){const y=new Event("click",{bubbles:a});f.call(d,r),d.dispatchEvent(y)}},[l,r,a]),e.jsx(ht.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:c,style:{...n.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});sv.displayName=bS;function rv(t){return t?"checked":"unchecked"}var wS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],gl="RadioGroup",[NS]=wr(gl,[_h,Jg]),av=_h(),nv=Jg(),[_S,kS]=NS(gl),iv=x.forwardRef((t,s)=>{const{__scopeRadioGroup:r,name:a,defaultValue:n,value:i,required:o=!1,disabled:c=!1,orientation:l,dir:u,loop:d=!0,onValueChange:p,...h}=t,f=av(r),y=rd(u),[v,b]=ra({prop:i,defaultProp:n??null,onChange:p,caller:gl});return e.jsx(_S,{scope:r,name:a,required:o,disabled:c,value:v,onValueChange:b,children:e.jsx(Dy,{asChild:!0,...f,orientation:l,dir:y,loop:d,children:e.jsx(ht.div,{role:"radiogroup","aria-required":o,"aria-orientation":l,"data-disabled":c?"":void 0,dir:y,...h,ref:s})})})});iv.displayName=gl;var ov="RadioGroupItem",lv=x.forwardRef((t,s)=>{const{__scopeRadioGroup:r,disabled:a,...n}=t,i=kS(ov,r),o=i.disabled||a,c=av(r),l=nv(r),u=x.useRef(null),d=Ht(s,u),p=i.value===n.value,h=x.useRef(!1);return x.useEffect(()=>{const f=v=>{wS.includes(v.key)&&(h.current=!0)},y=()=>h.current=!1;return document.addEventListener("keydown",f),document.addEventListener("keyup",y),()=>{document.removeEventListener("keydown",f),document.removeEventListener("keyup",y)}},[]),e.jsx(Ey,{asChild:!0,...c,focusable:!o,active:p,children:e.jsx(Zg,{disabled:o,required:i.required,checked:p,...l,...n,name:i.name,ref:d,onCheck:()=>i.onValueChange(n.value),onKeyDown:st(f=>{f.key==="Enter"&&f.preventDefault()}),onFocus:st(n.onFocus,()=>{h.current&&u.current?.click()})})})});lv.displayName=ov;var CS="RadioGroupIndicator",cv=x.forwardRef((t,s)=>{const{__scopeRadioGroup:r,...a}=t,n=nv(r);return e.jsx(tv,{...n,...a,ref:s})});cv.displayName=CS;var dv=iv,uv=lv,SS=cv;const du=x.forwardRef(({className:t,...s},r)=>e.jsx(dv,{className:ke("grid gap-2",t),...s,ref:r}));du.displayName=dv.displayName;const ci=x.forwardRef(({className:t,...s},r)=>e.jsx(uv,{ref:r,className:ke("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(SS,{className:"flex items-center justify-center",children:e.jsx(Zh,{className:"h-2.5 w-2.5 fill-current text-current"})})}));ci.displayName=uv.displayName;const AS=({cropId:t,open:s,onOpenChange:r})=>{const[a,n]=x.useState(""),[i,o]=x.useState("medium"),[c,l]=x.useState(null),[u,d]=x.useState(null),p=l2(),h=v=>{const b=v.target.files?.[0];if(b){l(b);const N=new FileReader;N.onloadend=()=>d(N.result),N.readAsDataURL(b)}},f=()=>{l(null),d(null)},y=async v=>{v.preventDefault(),a.trim()&&(await p.mutateAsync({cropId:t,notes:a,severity:i,file:c||void 0}),n(""),o("medium"),l(null),d(null),r(!1))};return e.jsx(zt,{open:s,onOpenChange:r,children:e.jsxs(It,{className:"max-w-md",children:[e.jsxs(Bt,{children:[e.jsxs($t,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ks,{className:"h-5 w-5"}),"Report Disease"]}),e.jsx(Ks,{children:"Describe the symptoms you're observing. Optionally add a photo for reference."})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:"Symptoms / Issue Description *"}),e.jsx(zs,{value:a,onChange:v=>n(v.target.value),placeholder:"Describe what you're seeing... (e.g., yellow leaves, spots, wilting)",rows:4,required:!0})]}),e.jsxs("div",{children:[e.jsx(ie,{className:"mb-3 block",children:"Severity"}),e.jsxs(du,{value:i,onValueChange:v=>o(v),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ci,{value:"low",id:"low"}),e.jsx(ie,{htmlFor:"low",className:"font-normal cursor-pointer",children:e.jsx("span",{className:"px-2 py-1 rounded bg-yellow-100 text-yellow-800 text-sm",children:"Low"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ci,{value:"medium",id:"medium"}),e.jsx(ie,{htmlFor:"medium",className:"font-normal cursor-pointer",children:e.jsx("span",{className:"px-2 py-1 rounded bg-orange-100 text-orange-800 text-sm",children:"Medium"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ci,{value:"high",id:"high"}),e.jsx(ie,{htmlFor:"high",className:"font-normal cursor-pointer",children:e.jsx("span",{className:"px-2 py-1 rounded bg-red-100 text-red-800 text-sm",children:"High"})})]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{className:"mb-2 block",children:"Photo (Optional)"}),u?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:u,alt:"Disease photo",className:"w-full h-32 object-cover rounded-lg"}),e.jsx(z,{type:"button",variant:"secondary",size:"icon",className:"absolute top-2 right-2 h-6 w-6",onClick:f,children:e.jsx(ar,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 text-center",children:[e.jsx("input",{type:"file",id:"disease-photo",accept:"image/*",capture:"environment",onChange:h,className:"hidden"}),e.jsxs("label",{htmlFor:"disease-photo",className:"cursor-pointer flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(dr,{className:"h-5 w-5"}),e.jsx("span",{children:"Add photo of issue"})]})]})]}),e.jsx(z,{type:"submit",variant:"destructive",className:"w-full",disabled:!a.trim()||p.isPending,children:p.isPending?"Submitting...":"Submit Disease Report"})]})]})})},TS=({cropId:t})=>{const{data:s,isLoading:r}=r2(t),a=kx(),n=c2(),[i,o]=x.useState({}),[c,l]=x.useState(!1),[u,d]=x.useState(0),[p,h]=x.useState(null),[f,y]=x.useState(!1),[v,b]=x.useState(null);x.useEffect(()=>{(async()=>{if(!s)return;const R={};for(const S of s)if(!i[S.id])try{const T=await a.mutateAsync(S.file_path);R[S.id]=T}catch(T){console.error("Failed to load thumbnail:",T)}Object.keys(R).length>0&&o(S=>({...S,...R}))})()},[s]);const N=async k=>{d(k);const R=s?.[k];if(R){const S=await a.mutateAsync(R.file_path);h(S),l(!0)}},A=async k=>{if(!s)return;const R=k==="next"?(u+1)%s.length:(u-1+s.length)%s.length;d(R);const S=await a.mutateAsync(s[R].file_path);h(S)},j=async k=>{const R=await a.mutateAsync(k.file_path),S=document.createElement("a");S.href=R,S.download=`crop-photo-${tt(new Date(k.captured_at),"yyyy-MM-dd")}.jpg`,S.click()},C=k=>{b(k),y(!0)},I=async()=>{v&&(await n.mutateAsync({mediaId:v.id,filePath:v.file_path,cropId:t}),y(!1),b(null))};return r?e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(to,{className:"h-5 w-5"}),"Photo Gallery"]})}),e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3].map(k=>e.jsx(Re,{className:"aspect-square rounded-lg"},k))})})]}):!s||s.length===0?e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(to,{className:"h-5 w-5"}),"Photo Gallery"]})}),e.jsx(Q,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(to,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No photos yet"}),e.jsx("p",{className:"text-sm",children:"Upload your first crop photo to start the timeline"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(to,{className:"h-5 w-5"}),"Photo Gallery (",s.length,")"]})}),e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2",children:s.map((k,R)=>e.jsxs("div",{className:"relative aspect-square group cursor-pointer rounded-lg overflow-hidden bg-muted",onClick:()=>N(R),children:[i[k.id]?e.jsx("img",{src:i[k.id],alt:k.caption||"Crop photo",className:"w-full h-full object-cover"}):e.jsx(Re,{className:"w-full h-full"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors flex items-center justify-center",children:e.jsx(Sc,{className:"h-6 w-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"})}),k.tags&&k.tags.length>0&&e.jsx("div",{className:"absolute bottom-1 left-1",children:e.jsx(he,{variant:"secondary",className:"text-[10px] px-1 py-0",children:k.tags[0].replace("_"," ")})})]},k.id))})})]}),e.jsx(zt,{open:c,onOpenChange:l,children:e.jsx(It,{className:"max-w-4xl p-0 bg-black/95 border-none",children:e.jsxs("div",{className:"relative min-h-[60vh] flex items-center justify-center",children:[e.jsx(z,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 text-white hover:bg-white/20 z-10",onClick:()=>l(!1),children:e.jsx(ar,{className:"h-5 w-5"})}),s&&s.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"ghost",size:"icon",className:"absolute left-2 text-white hover:bg-white/20",onClick:()=>A("prev"),children:e.jsx(Jh,{className:"h-8 w-8"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"absolute right-2 text-white hover:bg-white/20",onClick:()=>A("next"),children:e.jsx(Wa,{className:"h-8 w-8"})})]}),p&&e.jsx("img",{src:p,alt:"Full view",className:"max-w-full max-h-[80vh] object-contain"}),s&&s[u]&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:tt(new Date(s[u].captured_at),"PPP")}),s[u].caption&&e.jsx("p",{children:s[u].caption})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",onClick:()=>j(s[u]),children:[e.jsx(ui,{className:"h-4 w-4 mr-1"}),"Download"]}),e.jsxs(z,{variant:"ghost",size:"sm",className:"text-red-400 hover:bg-red-500/20",onClick:()=>C(s[u]),children:[e.jsx(Na,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})})]})})}),e.jsx(Ci,{open:f,onOpenChange:y,title:"Delete Photo",description:"Are you sure you want to delete this photo? This action cannot be undone.",confirmText:"Delete",variant:"destructive",onConfirm:I,loading:n.isPending})]})},PS={photo:e.jsx(dr,{className:"h-4 w-4"}),fertilizer:e.jsx(Ys,{className:"h-4 w-4"}),spray:e.jsx(Gh,{className:"h-4 w-4"}),irrigation:e.jsx(Go,{className:"h-4 w-4"}),weeding:e.jsx(dp,{className:"h-4 w-4"}),disease:e.jsx(ks,{className:"h-4 w-4"}),growth_update:e.jsx(pr,{className:"h-4 w-4"}),harvest_update:e.jsx(Ij,{className:"h-4 w-4"}),note:e.jsx(us,{className:"h-4 w-4"}),other:e.jsx(Js,{className:"h-4 w-4"})},MS={photo:"Photo Added",fertilizer:"Fertilizer Applied",spray:"Spray/Pesticide",irrigation:"Irrigation",weeding:"Weeding",disease:"Disease Reported",growth_update:"Growth Update",harvest_update:"Harvest Update",note:"Note",other:"Activity"},RS={photo:"bg-blue-100 text-blue-700",fertilizer:"bg-green-100 text-green-700",spray:"bg-purple-100 text-purple-700",irrigation:"bg-cyan-100 text-cyan-700",weeding:"bg-lime-100 text-lime-700",disease:"bg-red-100 text-red-700",growth_update:"bg-amber-100 text-amber-700",harvest_update:"bg-emerald-100 text-emerald-700",note:"bg-gray-100 text-gray-700",other:"bg-slate-100 text-slate-700"},DS=({cropId:t})=>{const{data:s,isLoading:r}=a2(t),a=kx(),[n,i]=x.useState({});return x.useEffect(()=>{(async()=>{if(!s)return;const c=s.filter(u=>u.media),l={};for(const u of c)if(u.media&&!n[u.media.id])try{const d=await a.mutateAsync(u.media.file_path);l[u.media.id]=d}catch(d){console.error("Failed to load thumbnail:",d)}Object.keys(l).length>0&&i(u=>({...u,...l}))})()},[s]),r?e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5"}),"Activity Timeline"]})}),e.jsx(Q,{className:"space-y-4",children:[1,2,3].map(o=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx(Re,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Re,{className:"h-4 w-1/3"}),e.jsx(Re,{className:"h-3 w-1/2"})]})]},o))})]}):!s||s.length===0?e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5"}),"Activity Timeline"]})}),e.jsx(Q,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(us,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No activities yet"}),e.jsx("p",{className:"text-sm",children:"Start logging your crop activities"})]})})]}):e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5"}),"Activity Timeline (",s.length,")"]})}),e.jsx(Q,{children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-5 top-0 bottom-0 w-px bg-border"}),e.jsx("div",{className:"space-y-4",children:s.map(o=>e.jsxs("div",{className:"relative flex gap-4 pl-2",children:[e.jsx("div",{className:`relative z-10 flex items-center justify-center w-8 h-8 rounded-full ${RS[o.activity_type]}`,children:PS[o.activity_type]}),e.jsxs("div",{className:"flex-1 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:MS[o.activity_type]}),o.severity&&e.jsx(he,{variant:"outline",className:o.severity==="high"?"border-red-500 text-red-600":o.severity==="medium"?"border-orange-500 text-orange-600":"border-yellow-500 text-yellow-600",children:o.severity}),o.creator_role==="agent"&&e.jsx(he,{variant:"secondary",className:"text-xs",children:"By Agent"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:tt(new Date(o.activity_at),"PPp")}),o.notes&&e.jsx("p",{className:"text-sm mt-2",children:o.notes}),o.meta&&Object.keys(o.meta).length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[o.meta.product_name&&e.jsx(he,{variant:"outline",className:"text-xs",children:o.meta.product_name}),o.meta.dosage&&e.jsx(he,{variant:"outline",className:"text-xs",children:o.meta.dosage}),o.meta.cost&&e.jsxs(he,{variant:"outline",className:"text-xs",children:["",o.meta.cost]})]}),o.media&&n[o.media.id]&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:n[o.media.id],alt:"Activity photo",className:"h-20 w-20 object-cover rounded-lg"})})]})]},o.id))})]})})]})},ES=[{value:"seedling",label:"Seedling",emoji:""},{value:"vegetative",label:"Vegetative",emoji:""},{value:"flowering",label:"Flowering",emoji:""},{value:"fruiting",label:"Fruiting",emoji:""},{value:"harvesting",label:"Harvesting",emoji:""}],IS={normal:{label:"Healthy",color:"bg-emerald-100 text-emerald-800",icon:sp},watch:{label:"Watch",color:"bg-amber-100 text-amber-800",icon:rr},diseased:{label:"Diseased",color:"bg-red-100 text-red-800",icon:ks}},OS=()=>{const{cropId:t}=Dn(),{t:s}=Nt(),r=Ut(),{data:a,isLoading:n}=s2(t),i=o2(),[o,c]=x.useState(!1),[l,u]=x.useState(!1),[d,p]=x.useState(!1);if(n)return e.jsx(Oe,{title:"Crop Diary",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{className:"h-10 w-32"}),e.jsx(Re,{className:"h-48 w-full"}),e.jsx(Re,{className:"h-64 w-full"})]})});if(!a)return e.jsx(Oe,{title:s("cropDiary.title"),children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ts,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Crop not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"This crop doesn't exist or you don't have access to it."}),e.jsxs(z,{onClick:()=>r("/farmer/crops"),children:[e.jsx(ba,{className:"h-4 w-4 mr-2"}),"Back to Crops"]})]})});const h=IS[a.health_status],f=h.icon;return e.jsx(Oe,{title:s("cropDiary.title"),children:e.jsx($s,{title:s("cropDiary.title"),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(z,{variant:"ghost",onClick:()=>r("/farmer/crops"),className:"gap-2",children:[e.jsx(ba,{className:"h-4 w-4"}),"Back to Crops"]}),e.jsx(G,{children:e.jsxs(Q,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-full bg-primary/10",children:e.jsx(ts,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.crop_name}),a.variety&&e.jsx("p",{className:"text-muted-foreground",children:a.variety})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-muted-foreground",children:[a.farmland&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-4 w-4"}),a.farmland.name]}),a.sowing_date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"h-4 w-4"}),"Sown: ",tt(new Date(a.sowing_date),"MMM d, yyyy")]}),a.estimated_quantity&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(cp,{className:"h-4 w-4"}),a.estimated_quantity," ",a.quantity_unit]})]}),e.jsxs(he,{className:`${h.color} gap-1`,children:[e.jsx(f,{className:"h-3 w-3"}),h.label]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground mb-1 block",children:"Growth Stage"}),e.jsxs(lt,{value:a.growth_stage,onValueChange:y=>i.mutate({cropId:a.id,growthStage:y}),disabled:i.isPending,children:[e.jsx(it,{className:"w-48",children:e.jsx(ct,{})}),e.jsx(ot,{children:ES.map(y=>e.jsx(ge,{value:y.value,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:y.emoji}),y.label]})},y.value))})]})]}),a.last_photo_at&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last photo: ",tt(new Date(a.last_photo_at),"MMM d, yyyy")]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-6 pt-4 border-t",children:[e.jsxs(z,{onClick:()=>c(!0),children:[e.jsx(dr,{className:"h-4 w-4 mr-2"}),"Upload Photo"]}),e.jsxs(z,{variant:"outline",onClick:()=>u(!0),children:[e.jsx(us,{className:"h-4 w-4 mr-2"}),"Log Activity"]}),e.jsxs(z,{variant:"outline",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>p(!0),children:[e.jsx(ks,{className:"h-4 w-4 mr-2"}),"Report Disease"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(TS,{cropId:a.id}),e.jsx(DS,{cropId:a.id})]}),e.jsx(fS,{cropId:a.id,open:o,onOpenChange:c}),e.jsx(gS,{cropId:a.id,open:l,onOpenChange:u}),e.jsx(AS,{cropId:a.id,open:d,onOpenChange:p})]})})})},FS=({farmland:t,open:s,onOpenChange:r})=>{const{user:a}=Fe(),{toast:n}=hs(),{t:i}=Nt(),o=Xe(),[c,l]=x.useState(!1),u=lu(),[d,p]=x.useState({name:"",area:"",area_unit:"acres",soil_type:"",village:"",district:""}),[h,f]=x.useState({lat:null,lng:null,verified:!1});x.useEffect(()=>{t&&(p({name:t.name,area:t.area.toString(),area_unit:t.area_unit,soil_type:t.soil_type||"",village:t.village||"",district:t.district||""}),f({lat:t.location_lat||null,lng:t.location_long||null,verified:t.geo_verified||!1}))},[t]);const y=async()=>{const b=await u.capture();b?(f({lat:b.latitude,lng:b.longitude,verified:!0}),n({title:"Location captured",description:`Accuracy: ~${Math.round(b.accuracy)}m`})):u.error&&n({title:"Location error",description:u.error,variant:"destructive"})},v=async b=>{if(b.preventDefault(),!(!a?.id||!t)){l(!0);try{const{error:N}=await W.from("farmlands").update({name:d.name,area:parseFloat(d.area),area_unit:d.area_unit,soil_type:d.soil_type||null,village:d.village||null,district:d.district||null,location_lat:h.lat,location_long:h.lng,geo_verified:h.verified}).eq("id",t.id);if(N)throw N;n({title:i("farmer.farmlands.updateSuccess")}),r(!1),o.invalidateQueries({queryKey:["farmlands",a.id]})}catch(N){n({title:i("common.error"),description:N.message,variant:"destructive"})}finally{l(!1)}}};return e.jsx(zt,{open:s,onOpenChange:r,children:e.jsxs(It,{children:[e.jsx(Bt,{children:e.jsx($t,{children:i("farmer.farmlands.editFarmland")})}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{children:[i("farmer.farmlands.plotName")," *"]}),e.jsx(Ce,{value:d.name,onChange:b=>p({...d,name:b.target.value}),placeholder:i("farmer.farmlands.plotNamePlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{children:[i("farmer.farmlands.area")," *"]}),e.jsx(Ce,{type:"number",step:"0.1",value:d.area,onChange:b=>p({...d,area:b.target.value}),placeholder:"5",required:!0})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("common.unit")}),e.jsxs(lt,{value:d.area_unit,onValueChange:b=>p({...d,area_unit:b}),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"acres",children:i("enum.area_units.acres")}),e.jsx(ge,{value:"hectares",children:i("enum.area_units.hectares")}),e.jsx(ge,{value:"bigha",children:i("enum.area_units.bigha")}),e.jsx(ge,{value:"guntha",children:i("enum.area_units.guntha")})]})]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.farmlands.soilType")}),e.jsxs(lt,{value:d.soil_type,onValueChange:b=>p({...d,soil_type:b}),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:i("farmer.farmlands.selectSoilType")})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"alluvial",children:i("enum.soil_types.alluvial")}),e.jsx(ge,{value:"black",children:i("enum.soil_types.black")}),e.jsx(ge,{value:"red",children:i("enum.soil_types.red")}),e.jsx(ge,{value:"laterite",children:i("enum.soil_types.laterite")}),e.jsx(ge,{value:"sandy",children:i("enum.soil_types.sandy")}),e.jsx(ge,{value:"clay",children:i("enum.soil_types.clay")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.farmlands.village")}),e.jsx(Ce,{value:d.village,onChange:b=>p({...d,village:b.target.value}),placeholder:i("farmer.farmlands.villagePlaceholder")})]}),e.jsxs("div",{children:[e.jsx(ie,{children:i("farmer.farmlands.district")}),e.jsx(Ce,{value:d.district,onChange:b=>p({...d,district:b.target.value}),placeholder:i("farmer.farmlands.districtPlaceholder")})]})]}),e.jsxs("div",{className:"rounded-lg border border-border p-3 space-y-2",children:[e.jsxs(ie,{className:"text-sm font-medium flex items-center gap-1.5",children:[e.jsx(We,{className:"h-4 w-4"}),"Farm Location (GPS)"]}),h.verified?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-green-600 flex items-center gap-1",children:[e.jsx(qs,{className:"h-4 w-4"})," Location Captured"]}),e.jsxs(z,{type:"button",variant:"outline",size:"sm",onClick:y,disabled:u.capturing,children:[u.capturing?e.jsx(et,{className:"h-3 w-3 animate-spin mr-1"}):null,"Recapture"]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Location not added"}),e.jsx(z,{type:"button",variant:"outline",size:"sm",onClick:y,disabled:u.capturing,children:u.capturing?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-3 w-3 animate-spin mr-1"})," Capturing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"h-3 w-3 mr-1"})," Capture Location"]})})]})]}),e.jsx(z,{type:"submit",className:"w-full",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),i("common.saving")]}):i("common.saveChanges")})]})]})})};function LS(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",s.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const mv=ue.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),Si=()=>{const t=ue.useContext(mv);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};LS(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,100%,0)}}@keyframes slideFromTop{from{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,-100%,0)}}@keyframes slideFromLeft{from{transform:translate3d(-100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(-100%,0,0)}}@keyframes slideFromRight{from{transform:translate3d(100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(100%,0,0)}}`);const qS=24,zS=typeof window<"u"?x.useLayoutEffect:x.useEffect;function Vm(...t){return(...s)=>{for(let r of t)typeof r=="function"&&r(...s)}}function BS(){return uu(/^Mac/)}function $S(){return uu(/^iPhone/)}function Km(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function US(){return uu(/^iPad/)||BS()&&navigator.maxTouchPoints>1}function hv(){return $S()||US()}function uu(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const hc=typeof document<"u"&&window.visualViewport;function Wm(t){let s=window.getComputedStyle(t);return/(auto|scroll)/.test(s.overflow+s.overflowX+s.overflowY)}function pv(t){for(Wm(t)&&(t=t.parentElement);t&&!Wm(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const HS=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let co=0,pc;function VS(t={}){let{isDisabled:s}=t;zS(()=>{if(!s)return co++,co===1&&hv()&&(pc=KS()),()=>{co--,co===0&&pc?.()}},[s])}function KS(){let t,s=0,r=p=>{t=pv(p.target),!(t===document.documentElement&&t===document.body)&&(s=p.changedTouches[0].pageY)},a=p=>{if(!t||t===document.documentElement||t===document.body){p.preventDefault();return}let h=p.changedTouches[0].pageY,f=t.scrollTop,y=t.scrollHeight-t.clientHeight;y!==0&&((f<=0&&h>s||f>=y&&h<s)&&p.preventDefault(),s=h)},n=p=>{let h=p.target;Kc(h)&&h!==document.activeElement&&(p.preventDefault(),h.style.transform="translateY(-2000px)",h.focus(),requestAnimationFrame(()=>{h.style.transform=""}))},i=p=>{let h=p.target;Kc(h)&&(h.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{h.style.transform="",hc&&(hc.height<window.innerHeight?requestAnimationFrame(()=>{Ym(h)}):hc.addEventListener("resize",()=>Ym(h),{once:!0}))}))},o=()=>{window.scrollTo(0,0)},c=window.pageXOffset,l=window.pageYOffset,u=Vm(WS(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let d=Vm(ri(document,"touchstart",r,{passive:!1,capture:!0}),ri(document,"touchmove",a,{passive:!1,capture:!0}),ri(document,"touchend",n,{passive:!1,capture:!0}),ri(document,"focus",i,!0),ri(window,"scroll",o));return()=>{u(),d(),window.scrollTo(c,l)}}function WS(t,s,r){let a=t.style[s];return t.style[s]=r,()=>{t.style[s]=a}}function ri(t,s,r,a){return t.addEventListener(s,r,a),()=>{t.removeEventListener(s,r,a)}}function Ym(t){let s=document.scrollingElement||document.documentElement;for(;t&&t!==s;){let r=pv(t);if(r!==document.documentElement&&r!==document.body&&r!==t){let a=r.getBoundingClientRect().top,n=t.getBoundingClientRect().top,i=t.getBoundingClientRect().bottom;const o=r.getBoundingClientRect().bottom+qS;i>o&&(r.scrollTop+=n-a)}t=r.parentElement}}function Kc(t){return t instanceof HTMLInputElement&&!HS.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function YS(t,s){typeof t=="function"?t(s):t!=null&&(t.current=s)}function GS(...t){return s=>t.forEach(r=>YS(r,s))}function fv(...t){return x.useCallback(GS(...t),t)}const xv=new WeakMap;function Rs(t,s,r=!1){if(!t||!(t instanceof HTMLElement))return;let a={};Object.entries(s).forEach(([n,i])=>{if(n.startsWith("--")){t.style.setProperty(n,i);return}a[n]=t.style[n],t.style[n]=i}),!r&&xv.set(t,a)}function QS(t,s){if(!t||!(t instanceof HTMLElement))return;let r=xv.get(t);r&&(t.style[s]=r[s])}const Ds=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function uo(t,s){if(!t)return null;const r=window.getComputedStyle(t),a=r.transform||r.webkitTransform||r.mozTransform;let n=a.match(/^matrix3d\((.+)\)$/);return n?parseFloat(n[1].split(", ")[Ds(s)?13:12]):(n=a.match(/^matrix\((.+)\)$/),n?parseFloat(n[1].split(", ")[Ds(s)?5:4]):null)}function XS(t){return 8*(Math.log(t+1)-2)}function fc(t,s){if(!t)return()=>{};const r=t.style.cssText;return Object.assign(t.style,s),()=>{t.style.cssText=r}}function JS(...t){return(...s)=>{for(const r of t)typeof r=="function"&&r(...s)}}const gs={DURATION:.5,EASE:[.32,.72,0,1]},gv=.4,ZS=.25,e4=100,vv=8,Ia=16,Wc=26,xc="vaul-dragging";function yv(t){const s=ue.useRef(t);return ue.useEffect(()=>{s.current=t}),ue.useMemo(()=>(...r)=>s.current==null?void 0:s.current.call(s,...r),[])}function t4({defaultProp:t,onChange:s}){const r=ue.useState(t),[a]=r,n=ue.useRef(a),i=yv(s);return ue.useEffect(()=>{n.current!==a&&(i(a),n.current=a)},[a,n,i]),r}function jv({prop:t,defaultProp:s,onChange:r=()=>{}}){const[a,n]=t4({defaultProp:s,onChange:r}),i=t!==void 0,o=i?t:a,c=yv(r),l=ue.useCallback(u=>{if(i){const p=typeof u=="function"?u(t):u;p!==t&&c(p)}else n(u)},[i,t,n,c]);return[o,l]}function s4({activeSnapPointProp:t,setActiveSnapPointProp:s,snapPoints:r,drawerRef:a,overlayRef:n,fadeFromIndex:i,onSnapPointChange:o,direction:c="bottom",container:l,snapToSequentialPoint:u}){const[d,p]=jv({prop:t,defaultProp:r?.[0],onChange:s}),[h,f]=ue.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);ue.useEffect(()=>{function R(){f({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",R),()=>window.removeEventListener("resize",R)},[]);const y=ue.useMemo(()=>d===r?.[r.length-1]||null,[r,d]),v=ue.useMemo(()=>r?.findIndex(R=>R===d),[r,d]),b=r&&r.length>0&&(i||i===0)&&!Number.isNaN(i)&&r[i]===d||!r,N=ue.useMemo(()=>{const R=l?{width:l.getBoundingClientRect().width,height:l.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var S;return(S=r?.map(T=>{const E=typeof T=="string";let D=0;if(E&&(D=parseInt(T,10)),Ds(c)){const H=E?D:h?T*R.height:0;return h?c==="bottom"?R.height-H:-R.height+H:H}const F=E?D:h?T*R.width:0;return h?c==="right"?R.width-F:-R.width+F:F}))!=null?S:[]},[r,h,l]),A=ue.useMemo(()=>v!==null?N?.[v]:null,[N,v]),j=ue.useCallback(R=>{var S;const T=(S=N?.findIndex(E=>E===R))!=null?S:null;o(T),Rs(a.current,{transition:`transform ${gs.DURATION}s cubic-bezier(${gs.EASE.join(",")})`,transform:Ds(c)?`translate3d(0, ${R}px, 0)`:`translate3d(${R}px, 0, 0)`}),N&&T!==N.length-1&&T!==i&&T<i?Rs(n.current,{transition:`opacity ${gs.DURATION}s cubic-bezier(${gs.EASE.join(",")})`,opacity:"0"}):Rs(n.current,{transition:`opacity ${gs.DURATION}s cubic-bezier(${gs.EASE.join(",")})`,opacity:"1"}),p(r?.[Math.max(T,0)])},[a.current,r,N,i,n,p]);ue.useEffect(()=>{if(d||t){var R;const S=(R=r?.findIndex(T=>T===t||T===d))!=null?R:-1;N&&S!==-1&&typeof N[S]=="number"&&j(N[S])}},[d,t,r,N,j]);function C({draggedDistance:R,closeDrawer:S,velocity:T,dismissible:E}){if(i===void 0)return;const D=c==="bottom"||c==="right"?(A??0)-R:(A??0)+R,F=v===i-1,H=v===0,q=R>0;if(F&&Rs(n.current,{transition:`opacity ${gs.DURATION}s cubic-bezier(${gs.EASE.join(",")})`}),!u&&T>2&&!q){E?S():j(N[0]);return}if(!u&&T>2&&q&&N&&r){j(N[r.length-1]);return}const B=N?.reduce((P,K)=>typeof P!="number"||typeof K!="number"?P:Math.abs(K-D)<Math.abs(P-D)?K:P),L=Ds(c)?window.innerHeight:window.innerWidth;if(T>gv&&Math.abs(R)<L*.4){const P=q?1:-1;if(P>0&&y){j(N[r.length-1]);return}if(H&&P<0&&E&&S(),v===null)return;j(N[v+P]);return}j(B)}function I({draggedDistance:R}){if(A===null)return;const S=c==="bottom"||c==="right"?A-R:A+R;(c==="bottom"||c==="right")&&S<N[N.length-1]||(c==="top"||c==="left")&&S>N[N.length-1]||Rs(a.current,{transform:Ds(c)?`translate3d(0, ${S}px, 0)`:`translate3d(${S}px, 0, 0)`})}function k(R,S){if(!r||typeof v!="number"||!N||i===void 0)return null;const T=v===i-1;if(v>=i&&S)return 0;if(T&&!S)return 1;if(!b&&!T)return null;const D=T?v+1:v-1,F=T?N[D]-N[D-1]:N[D+1]-N[D],H=R/Math.abs(F);return T?1-H:H}return{isLastSnapPoint:y,activeSnapPoint:d,shouldFade:b,getPercentageDragged:k,setActiveSnapPoint:p,activeSnapPointIndex:v,onRelease:C,onDrag:I,snapPointsOffset:N}}const r4=()=>()=>{};function a4(){const{direction:t,isOpen:s,shouldScaleBackground:r,setBackgroundColorOnScale:a,noBodyStyles:n}=Si(),i=ue.useRef(null),o=x.useMemo(()=>document.body.style.backgroundColor,[]);function c(){return(window.innerWidth-Wc)/window.innerWidth}ue.useEffect(()=>{if(s&&r){i.current&&clearTimeout(i.current);const l=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!l)return;JS(a&&!n?fc(document.body,{background:"black"}):r4,fc(l,{transformOrigin:Ds(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${gs.DURATION}s`,transitionTimingFunction:`cubic-bezier(${gs.EASE.join(",")})`}));const u=fc(l,{borderRadius:`${vv}px`,overflow:"hidden",...Ds(t)?{transform:`scale(${c()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${c()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{u(),i.current=window.setTimeout(()=>{o?document.body.style.background=o:document.body.style.removeProperty("background")},gs.DURATION*1e3)}}},[s,r,o])}let ai=null;function n4({isOpen:t,modal:s,nested:r,hasBeenOpened:a,preventScrollRestoration:n,noBodyStyles:i}){const[o,c]=ue.useState(()=>typeof window<"u"?window.location.href:""),l=ue.useRef(0),u=ue.useCallback(()=>{if(Km()&&ai===null&&t&&!i){ai={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:p,innerHeight:h}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-l.current}px`,left:`${-p}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const f=h-window.innerHeight;f&&l.current>=h&&(document.body.style.top=`${-(l.current+f)}px`)}),300)}},[t]),d=ue.useCallback(()=>{if(Km()&&ai!==null&&!i){const p=-parseInt(document.body.style.top,10),h=-parseInt(document.body.style.left,10);Object.assign(document.body.style,ai),window.requestAnimationFrame(()=>{if(n&&o!==window.location.href){c(window.location.href);return}window.scrollTo(h,p)}),ai=null}},[o]);return ue.useEffect(()=>{function p(){l.current=window.scrollY}return p(),window.addEventListener("scroll",p),()=>{window.removeEventListener("scroll",p)}},[]),ue.useEffect(()=>{r||!a||(t?(!window.matchMedia("(display-mode: standalone)").matches&&u(),s||window.setTimeout(()=>{d()},500)):d())},[t,a,o,s,r,u,d]),{restorePositionSetting:d}}function i4({open:t,onOpenChange:s,children:r,onDrag:a,onRelease:n,snapPoints:i,shouldScaleBackground:o=!1,setBackgroundColorOnScale:c=!0,closeThreshold:l=ZS,scrollLockTimeout:u=e4,dismissible:d=!0,handleOnly:p=!1,fadeFromIndex:h=i&&i.length-1,activeSnapPoint:f,setActiveSnapPoint:y,fixed:v,modal:b=!0,onClose:N,nested:A,noBodyStyles:j,direction:C="bottom",defaultOpen:I=!1,disablePreventScroll:k=!0,snapToSequentialPoint:R=!1,preventScrollRestoration:S=!1,repositionInputs:T=!0,onAnimationEnd:E,container:D,autoFocus:F=!1}){var H,q;const[B=!1,L]=jv({defaultProp:I,prop:t,onChange:Qe=>{s?.(Qe),!Qe&&!A&&_t(),setTimeout(()=>{E?.(Qe)},gs.DURATION*1e3),Qe&&!b&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),Qe||(document.body.style.pointerEvents="auto")}}),[P,K]=ue.useState(!1),[$,se]=ue.useState(!1),[ne,Y]=ue.useState(!1),fe=ue.useRef(null),me=ue.useRef(null),xe=ue.useRef(null),He=ue.useRef(null),Ae=ue.useRef(null),Ye=ue.useRef(!1),Ze=ue.useRef(null),Ne=ue.useRef(0),Ge=ue.useRef(!1),qe=ue.useRef(0),Ke=ue.useRef(null),as=ue.useRef(((H=Ke.current)==null?void 0:H.getBoundingClientRect().height)||0),yt=ue.useRef(((q=Ke.current)==null?void 0:q.getBoundingClientRect().width)||0),Vt=ue.useRef(0),Pt=ue.useCallback(Qe=>{i&&Qe===is.length-1&&(me.current=new Date)},[]),{activeSnapPoint:Dt,activeSnapPointIndex:Gt,setActiveSnapPoint:ns,onRelease:jt,snapPointsOffset:is,onDrag:Ct,shouldFade:Et,getPercentageDragged:ps}=s4({snapPoints:i,activeSnapPointProp:f,setActiveSnapPointProp:y,drawerRef:Ke,fadeFromIndex:h,overlayRef:fe,onSnapPointChange:Pt,direction:C,container:D,snapToSequentialPoint:R});VS({isDisabled:!B||$||!b||ne||!P||!T||!k});const{restorePositionSetting:_t}=n4({isOpen:B,modal:b,nested:A,hasBeenOpened:P,preventScrollRestoration:S,noBodyStyles:j});function ls(){return(window.innerWidth-Wc)/window.innerWidth}function cs(Qe){var bt,_e;!d&&!i||Ke.current&&!Ke.current.contains(Qe.target)||(as.current=((bt=Ke.current)==null?void 0:bt.getBoundingClientRect().height)||0,yt.current=((_e=Ke.current)==null?void 0:_e.getBoundingClientRect().width)||0,se(!0),xe.current=new Date,hv()&&window.addEventListener("touchend",()=>Ye.current=!1,{once:!0}),Qe.target.setPointerCapture(Qe.pointerId),Ne.current=Ds(C)?Qe.pageY:Qe.pageX)}function Us(Qe,bt){var _e,Ot;let ft=Qe;const Mt=(_e=window.getSelection())==null?void 0:_e.toString(),Qt=Ke.current?uo(Ke.current,C):null,Ue=new Date;if(ft.hasAttribute("data-vaul-no-drag")||ft.closest("[data-vaul-no-drag]"))return!1;if(C==="right"||C==="left")return!0;if(me.current&&Ue.getTime()-me.current.getTime()<500)return!1;if(Qt!==null&&(C==="bottom"?Qt>0:Qt<0))return!0;if(Mt&&Mt.length>0)return!1;if(Ue.getTime()-((Ot=Ae.current)==null?void 0:Ot.getTime())<u&&Qt===0||bt)return Ae.current=Ue,!1;for(;ft;){if(ft.scrollHeight>ft.clientHeight){if(ft.scrollTop!==0)return Ae.current=new Date,!1;if(ft.getAttribute("role")==="dialog")return!0}ft=ft.parentNode}return!0}function Jt(Qe){if(Ke.current&&$){const bt=C==="bottom"||C==="right"?1:-1,_e=(Ne.current-(Ds(C)?Qe.pageY:Qe.pageX))*bt,Ot=_e>0,ft=i&&!d&&!Ot;if(ft&&Gt===0)return;const Mt=Math.abs(_e),Qt=document.querySelector("[data-vaul-drawer-wrapper]"),Ue=C==="bottom"||C==="top"?as.current:yt.current;let pt=Mt/Ue;const gt=ps(Mt,Ot);if(gt!==null&&(pt=gt),ft&&pt>=1||!Ye.current&&!Us(Qe.target,Ot))return;if(Ke.current.classList.add(xc),Ye.current=!0,Rs(Ke.current,{transition:"none"}),Rs(fe.current,{transition:"none"}),i&&Ct({draggedDistance:_e}),Ot&&!i){const Kt=XS(_e),Ws=Math.min(Kt*-1,0)*bt;Rs(Ke.current,{transform:Ds(C)?`translate3d(0, ${Ws}px, 0)`:`translate3d(${Ws}px, 0, 0)`});return}const At=1-pt;if((Et||h&&Gt===h-1)&&(a?.(Qe,pt),Rs(fe.current,{opacity:`${At}`,transition:"none"},!0)),Qt&&fe.current&&o){const Kt=Math.min(ls()+pt*(1-ls()),1),Ws=8-pt*8,er=Math.max(0,14-pt*14);Rs(Qt,{borderRadius:`${Ws}px`,transform:Ds(C)?`scale(${Kt}) translate3d(0, ${er}px, 0)`:`scale(${Kt}) translate3d(${er}px, 0, 0)`,transition:"none"},!0)}if(!i){const Kt=Mt*bt;Rs(Ke.current,{transform:Ds(C)?`translate3d(0, ${Kt}px, 0)`:`translate3d(${Kt}px, 0, 0)`})}}}ue.useEffect(()=>{var Qe;function bt(){if(!Ke.current||!T)return;const _e=document.activeElement;if(Kc(_e)||Ge.current){var Ot;const ft=((Ot=window.visualViewport)==null?void 0:Ot.height)||0,Mt=window.innerHeight;let Qt=Mt-ft;const Ue=Ke.current.getBoundingClientRect().height||0,pt=Ue>Mt*.8;Vt.current||(Vt.current=Ue);const gt=Ke.current.getBoundingClientRect().top;if(Math.abs(qe.current-Qt)>60&&(Ge.current=!Ge.current),i&&i.length>0&&is&&Gt){const At=is[Gt]||0;Qt+=At}if(qe.current=Qt,Ue>ft||Ge.current){const At=Ke.current.getBoundingClientRect().height;let Kt=At;At>ft&&(Kt=ft-(pt?gt:Wc)),v?Ke.current.style.height=`${At-Math.max(Qt,0)}px`:Ke.current.style.height=`${Math.max(Kt,ft-gt)}px`}else Ke.current.style.height=`${Vt.current}px`;i&&i.length>0&&!Ge.current?Ke.current.style.bottom="0px":Ke.current.style.bottom=`${Math.max(Qt,0)}px`}}return(Qe=window.visualViewport)==null||Qe.addEventListener("resize",bt),()=>{var _e;return(_e=window.visualViewport)==null?void 0:_e.removeEventListener("resize",bt)}},[Gt,i,is]);function ds(Qe){As(),N?.(),Qe||L(!1),setTimeout(()=>{i&&ns(i[0])},gs.DURATION*1e3)}function Zt(){if(!Ke.current)return;const Qe=document.querySelector("[data-vaul-drawer-wrapper]"),bt=uo(Ke.current,C);Rs(Ke.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${gs.DURATION}s cubic-bezier(${gs.EASE.join(",")})`}),Rs(fe.current,{transition:`opacity ${gs.DURATION}s cubic-bezier(${gs.EASE.join(",")})`,opacity:"1"}),o&&bt&&bt>0&&B&&Rs(Qe,{borderRadius:`${vv}px`,overflow:"hidden",...Ds(C)?{transform:`scale(${ls()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${ls()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${gs.DURATION}s`,transitionTimingFunction:`cubic-bezier(${gs.EASE.join(",")})`},!0)}function As(){!$||!Ke.current||(Ke.current.classList.remove(xc),Ye.current=!1,se(!1),He.current=new Date)}function fs(Qe){if(!$||!Ke.current)return;Ke.current.classList.remove(xc),Ye.current=!1,se(!1),He.current=new Date;const bt=uo(Ke.current,C);if(!Us(Qe.target,!1)||!bt||Number.isNaN(bt)||xe.current===null)return;const _e=He.current.getTime()-xe.current.getTime(),Ot=Ne.current-(Ds(C)?Qe.pageY:Qe.pageX),ft=Math.abs(Ot)/_e;if(ft>.05&&(Y(!0),setTimeout(()=>{Y(!1)},200)),i){jt({draggedDistance:Ot*(C==="bottom"||C==="right"?1:-1),closeDrawer:ds,velocity:ft,dismissible:d}),n?.(Qe,!0);return}if(C==="bottom"||C==="right"?Ot>0:Ot<0){Zt(),n?.(Qe,!0);return}if(ft>gv){ds(),n?.(Qe,!1);return}var Mt;const Qt=Math.min((Mt=Ke.current.getBoundingClientRect().height)!=null?Mt:0,window.innerHeight);var Ue;const pt=Math.min((Ue=Ke.current.getBoundingClientRect().width)!=null?Ue:0,window.innerWidth),gt=C==="left"||C==="right";if(Math.abs(bt)>=(gt?pt:Qt)*l){ds(),n?.(Qe,!1);return}n?.(Qe,!0),Zt()}ue.useEffect(()=>(B&&(Rs(document.documentElement,{scrollBehavior:"auto"}),me.current=new Date),()=>{QS(document.documentElement,"scrollBehavior")}),[B]);function ws(Qe){const bt=Qe?(window.innerWidth-Ia)/window.innerWidth:1,_e=Qe?-Ia:0;Ze.current&&window.clearTimeout(Ze.current),Rs(Ke.current,{transition:`transform ${gs.DURATION}s cubic-bezier(${gs.EASE.join(",")})`,transform:`scale(${bt}) translate3d(0, ${_e}px, 0)`}),!Qe&&Ke.current&&(Ze.current=setTimeout(()=>{const Ot=uo(Ke.current,C);Rs(Ke.current,{transition:"none",transform:Ds(C)?`translate3d(0, ${Ot}px, 0)`:`translate3d(${Ot}px, 0, 0)`})},500))}function Be(Qe,bt){if(bt<0)return;const _e=(window.innerWidth-Ia)/window.innerWidth,Ot=_e+bt*(1-_e),ft=-Ia+bt*Ia;Rs(Ke.current,{transform:Ds(C)?`scale(${Ot}) translate3d(0, ${ft}px, 0)`:`scale(${Ot}) translate3d(${ft}px, 0, 0)`,transition:"none"})}function Ar(Qe,bt){const _e=Ds(C)?window.innerHeight:window.innerWidth,Ot=bt?(_e-Ia)/_e:1,ft=bt?-Ia:0;bt&&Rs(Ke.current,{transition:`transform ${gs.DURATION}s cubic-bezier(${gs.EASE.join(",")})`,transform:Ds(C)?`scale(${Ot}) translate3d(0, ${ft}px, 0)`:`scale(${Ot}) translate3d(${ft}px, 0, 0)`})}return ue.createElement(sd,{defaultOpen:I,onOpenChange:Qe=>{!d&&!Qe||(Qe?K(!0):ds(!0),L(Qe))},open:B},ue.createElement(mv.Provider,{value:{activeSnapPoint:Dt,snapPoints:i,setActiveSnapPoint:ns,drawerRef:Ke,overlayRef:fe,onOpenChange:s,onPress:cs,onRelease:fs,onDrag:Jt,dismissible:d,handleOnly:p,isOpen:B,isDragging:$,shouldFade:Et,closeDrawer:ds,onNestedDrag:Be,onNestedOpenChange:ws,onNestedRelease:Ar,keyboardIsOpen:Ge,modal:b,snapPointsOffset:is,direction:C,shouldScaleBackground:o,setBackgroundColorOnScale:c,noBodyStyles:j,container:D,autoFocus:F}},r))}const bv=ue.forwardRef(function({...t},s){const{overlayRef:r,snapPoints:a,onRelease:n,shouldFade:i,isOpen:o,modal:c}=Si(),l=fv(s,r),u=a&&a.length>0;return c?ue.createElement(Uo,{onMouseUp:n,ref:l,"data-vaul-overlay":"","data-vaul-snap-points":o&&u?"true":"false","data-vaul-snap-points-overlay":o&&i?"true":"false",...t}):(typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),null)});bv.displayName="Drawer.Overlay";const wv=ue.forwardRef(function({onPointerDownOutside:t,style:s,onOpenAutoFocus:r,...a},n){const{drawerRef:i,onPress:o,onRelease:c,onDrag:l,keyboardIsOpen:u,snapPointsOffset:d,modal:p,isOpen:h,direction:f,snapPoints:y,container:v,handleOnly:b,autoFocus:N}=Si(),[A,j]=ue.useState(!1),C=fv(n,i),I=ue.useRef(null),k=ue.useRef(null),R=ue.useRef(!1),S=y&&y.length>0;a4();const T=(D,F,H=0)=>{if(R.current)return!0;const q=Math.abs(D.y),B=Math.abs(D.x),L=B>q,P=["bottom","right"].includes(F)?1:-1;if(F==="left"||F==="right"){if(!(D.x*P<0)&&B>=0&&B<=H)return L}else if(!(D.y*P<0)&&q>=0&&q<=H)return!L;return R.current=!0,!0};ue.useEffect(()=>{S&&window.requestAnimationFrame(()=>{j(!0)})},[]);function E(D){I.current=null,R.current=!1,c(D)}return ue.createElement(Ho,{"data-vaul-drawer-direction":f,"data-vaul-drawer":"","data-vaul-delayed-snap-points":A?"true":"false","data-vaul-snap-points":h&&S?"true":"false","data-vaul-custom-container":v?"true":"false",...a,ref:C,style:d&&d.length>0?{"--snap-point-height":`${d[0]}px`,...s}:s,onPointerDown:D=>{b||(a.onPointerDown==null||a.onPointerDown.call(a,D),I.current={x:D.pageX,y:D.pageY},o(D))},onOpenAutoFocus:D=>{r?.(D),N||D.preventDefault()},onPointerDownOutside:D=>{if(t?.(D),!p||D.defaultPrevented){D.preventDefault();return}u.current&&(u.current=!1)},onFocusOutside:D=>{if(!p){D.preventDefault();return}},onPointerMove:D=>{if(k.current=D,b||(a.onPointerMove==null||a.onPointerMove.call(a,D),!I.current))return;const F=D.pageY-I.current.y,H=D.pageX-I.current.x,q=D.pointerType==="touch"?10:2;T({x:H,y:F},f,q)?l(D):(Math.abs(H)>q||Math.abs(F)>q)&&(I.current=null)},onPointerUp:D=>{a.onPointerUp==null||a.onPointerUp.call(a,D),I.current=null,R.current=!1,c(D)},onPointerOut:D=>{a.onPointerOut==null||a.onPointerOut.call(a,D),E(k.current)},onContextMenu:D=>{a.onContextMenu==null||a.onContextMenu.call(a,D),E(k.current)}})});wv.displayName="Drawer.Content";const o4=250,l4=120,c4=ue.forwardRef(function({preventCycle:t=!1,children:s,...r},a){const{closeDrawer:n,isDragging:i,snapPoints:o,activeSnapPoint:c,setActiveSnapPoint:l,dismissible:u,handleOnly:d,isOpen:p,onPress:h,onDrag:f}=Si(),y=ue.useRef(null),v=ue.useRef(!1);function b(){if(v.current){j();return}window.setTimeout(()=>{N()},l4)}function N(){if(i||t||v.current){j();return}if(j(),(!o||o.length===0)&&u){n();return}if(c===o[o.length-1]&&u){n();return}const I=o.findIndex(R=>R===c);if(I===-1)return;const k=o[I+1];l(k)}function A(){y.current=window.setTimeout(()=>{v.current=!0},o4)}function j(){window.clearTimeout(y.current),v.current=!1}return ue.createElement("div",{onClick:b,onPointerCancel:j,onPointerDown:C=>{d&&h(C),A()},onPointerMove:C=>{d&&f(C)},ref:a,"data-vaul-drawer-visible":p?"true":"false","data-vaul-handle":"","aria-hidden":"true",...r},ue.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},s))});c4.displayName="Drawer.Handle";function d4(t){const s=Si(),{container:r=s.container,...a}=t;return ue.createElement(ed,{container:r,...a})}const ia={Root:i4,Content:wv,Overlay:bv,Portal:d4,Title:Vo,Description:Ko},Nv=({shouldScaleBackground:t=!0,...s})=>e.jsx(ia.Root,{shouldScaleBackground:t,...s});Nv.displayName="Drawer";const u4=ia.Portal,_v=x.forwardRef(({className:t,...s},r)=>e.jsx(ia.Overlay,{ref:r,className:ke("fixed inset-0 z-50 bg-black/80",t),...s}));_v.displayName=ia.Overlay.displayName;const kv=x.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(u4,{children:[e.jsx(_v,{}),e.jsxs(ia.Content,{ref:a,className:ke("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...r,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),s]})]}));kv.displayName="DrawerContent";const Cv=({className:t,...s})=>e.jsx("div",{className:ke("grid gap-1.5 p-4 text-center sm:text-left",t),...s});Cv.displayName="DrawerHeader";const Sv=x.forwardRef(({className:t,...s},r)=>e.jsx(ia.Title,{ref:r,className:ke("text-lg font-semibold leading-none tracking-tight",t),...s}));Sv.displayName=ia.Title.displayName;const Av=x.forwardRef(({className:t,...s},r)=>e.jsx(ia.Description,{ref:r,className:ke("text-sm text-muted-foreground",t),...s}));Av.displayName=ia.Description.displayName;const m4=t=>{const{user:s}=Fe();return De({queryKey:["soil-reports",t],queryFn:async()=>{if(!t)return[];const{data:r,error:a}=await W.from("soil_test_reports").select("*").eq("farmland_id",t).order("report_date",{ascending:!1});if(a)throw a;return r},enabled:!!t&&!!s?.id})},h4=t=>{const{user:s}=Fe();return De({queryKey:["soil-reports-latest",t],queryFn:async()=>{if(!t)return null;const{data:r,error:a}=await W.from("soil_test_reports").select("*").eq("farmland_id",t).order("report_date",{ascending:!1}).limit(1).maybeSingle();if(a)throw a;return r},enabled:!!t&&!!s?.id})},p4=()=>{const{user:t}=Fe(),{toast:s}=hs(),r=Xe();return dt({mutationFn:async({farmlandId:a,file:n,formData:i})=>{if(!t?.id)throw new Error("Not authenticated");const o=n.type.startsWith("image/"),c=n.type==="application/pdf";if(!o&&!c)throw new Error("Only images and PDF files are allowed");const l=await bi(n,{bucket:"soil-reports",contentType:n.type,sizeBytes:n.size,entity:{type:"soil_report",id:a}}),{data:u,error:d}=await W.from("soil_test_reports").insert({farmland_id:a,farmer_id:t.id,uploaded_by:t.id,source_role:"farmer",report_date:i.report_date,lab_name:i.lab_name||null,report_file_path:l,report_file_type:o?"image":"pdf",report_mime_type:n.type,notes:i.notes||null,ph:i.ph??null,ec:i.ec??null,organic_carbon:i.organic_carbon??null,nitrogen:i.nitrogen??null,phosphorus:i.phosphorus??null,potassium:i.potassium??null}).select().single();if(d)throw await W.storage.from("soil-reports").remove([l]),new Error(`Failed to save report: ${d.message}`);return u},onSuccess:(a,{farmlandId:n})=>{s({title:"Success",description:"Soil report uploaded successfully!"}),r.invalidateQueries({queryKey:["soil-reports",n]}),r.invalidateQueries({queryKey:["soil-reports-latest",n]})},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}})},f4=()=>{const{toast:t}=hs(),s=Xe();return dt({mutationFn:async({report:r})=>{try{const{error:n}=await W.functions.invoke("storage-delete-v1",{body:{bucket:"soil-reports",path:r.report_file_path}});n&&console.warn("storage-delete-v1 warning:",n)}catch(n){console.warn("storage-delete-v1 failed:",n)}const{error:a}=await W.from("soil_test_reports").delete().eq("id",r.id);if(a)throw new Error(`Failed to delete report: ${a.message}`);return r},onSuccess:r=>{t({title:"Deleted",description:"Soil report deleted successfully."}),s.invalidateQueries({queryKey:["soil-reports",r.farmland_id]}),s.invalidateQueries({queryKey:["soil-reports-latest",r.farmland_id]})},onError:r=>{t({title:"Error",description:r.message,variant:"destructive"})}})},Tv=t=>De({queryKey:["signed-url",t],queryFn:async()=>{if(!t)return null;if(/^[0-9a-fA-F-]{36}$/.test(t)){const{data:n,error:i}=await W.functions.invoke("storage-sign-read-v1",{body:{file_id:t}});if(i)throw i;if(n?.error)throw new Error(n.error);return n.signed_read_url}const{data:r,error:a}=await W.storage.from("soil-reports").createSignedUrl(t,600);if(a)throw a;return r.signedUrl},enabled:!!t,staleTime:5*60*1e3,gcTime:9*60*1e3});function x4({open:t,onOpenChange:s,farmlandId:r,farmlandName:a}){const n=p4(),[i,o]=x.useState(null),[c,l]=x.useState(!1),[u,d]=x.useState(!1),[p,h]=x.useState({report_date:new Date().toISOString().split("T")[0],lab_name:"",notes:"",ph:null,ec:null,organic_carbon:null,nitrogen:null,phosphorus:null,potassium:null}),f=async N=>{const A=N.target.files?.[0];if(!A)return;const j=xl(A),C=kg(A);if(!j&&!C){ce.error("Please select an image or PDF file");return}if(C){const I=Tn(A,Es.PDF_MAX_MB);if(!I.valid){ce.error(I.message);return}o(A)}else if(j){const I=Tn(A,Es.IMAGE_MAX_MB);if(!I.valid){ce.error(I.message);return}let k=A;const R=A.size/(1024*1024);if(R>Es.IMAGE_COMPRESS_TARGET_MB){d(!0);try{k=await Ms(A,{maxSizeMB:Es.IMAGE_COMPRESS_TARGET_MB,maxWidthOrHeight:1920,useWebWorker:!0});const S=k.size/(1024*1024);console.log(`Image compressed: ${R.toFixed(2)}MB  ${S.toFixed(2)}MB`)}catch(S){console.error("Compression failed:",S),ce.error("Failed to compress image. Please try a smaller file."),d(!1);return}d(!1)}o(k)}},y=async N=>{if(N.preventDefault(),!i){ce.error("Please select a file to upload");return}try{await n.mutateAsync({farmlandId:r,file:i,formData:p}),o(null),h({report_date:new Date().toISOString().split("T")[0],lab_name:"",notes:"",ph:null,ec:null,organic_carbon:null,nitrogen:null,phosphorus:null,potassium:null}),l(!1),s(!1)}catch(A){const j=fl(A);ce.error(`Upload failed: ${j}`,{action:ou(()=>y(N))})}},v=(N,A)=>{const j=A===""?null:parseFloat(A);h({...p,[N]:j})},b=n.isPending||u;return e.jsx(zt,{open:t,onOpenChange:s,children:e.jsxs(It,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Upload Soil Report"}),e.jsxs(Ks,{children:["Add a soil test report for ",a]})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"report_date",children:"Report Date *"}),e.jsx(Ce,{id:"report_date",type:"date",value:p.report_date,onChange:N=>h({...p,report_date:N.target.value}),required:!0,disabled:b})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Report File (Image/PDF) *"}),e.jsx("div",{className:"mt-1",children:i?e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/30",children:[i.type.startsWith("image/")?e.jsx(tp,{className:"h-5 w-5 text-primary"}):e.jsx(sr,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"flex-1 truncate text-sm",children:i.name}),e.jsx(z,{type:"button",variant:"ghost",size:"sm",onClick:()=>o(null),disabled:b,children:"Change"})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed rounded-lg cursor-pointer hover:bg-muted/30 transition-colors",children:[u?e.jsx(et,{className:"h-8 w-8 text-muted-foreground mb-2 animate-spin"}):e.jsx(pi,{className:"h-8 w-8 text-muted-foreground mb-2"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:u?"Compressing image...":"Click to upload or drag & drop"}),e.jsxs("span",{className:"text-xs text-muted-foreground mt-1",children:["Images: max ",Es.IMAGE_MAX_MB,"MB  PDF: max ",Es.PDF_MAX_MB,"MB"]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/jpeg,image/jpg,image/png,image/webp,application/pdf",onChange:f,disabled:b})]})})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"lab_name",children:"Lab Name (optional)"}),e.jsx(Ce,{id:"lab_name",value:p.lab_name,onChange:N=>h({...p,lab_name:N.target.value}),placeholder:"e.g., Krishi Vigyan Kendra",disabled:b})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"notes",children:"Notes (optional)"}),e.jsx(zs,{id:"notes",value:p.notes,onChange:N=>h({...p,notes:N.target.value}),placeholder:"Any additional notes about this report...",rows:2,disabled:b})]}),e.jsxs(Ga,{open:c,onOpenChange:l,children:[e.jsx(Qa,{asChild:!0,children:e.jsxs(z,{type:"button",variant:"ghost",size:"sm",className:"w-full justify-between",disabled:b,children:[e.jsx("span",{children:"Add Soil Values (optional)"}),e.jsx(qr,{className:`h-4 w-4 transition-transform ${c?"rotate-180":""}`})]})}),e.jsxs(Xa,{className:"space-y-3 pt-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter values from your report for trend tracking"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"ph",className:"text-xs",children:"pH"}),e.jsx(Ce,{id:"ph",type:"number",step:"0.1",min:"0",max:"14",value:p.ph??"",onChange:N=>v("ph",N.target.value),placeholder:"e.g., 6.5",disabled:b})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"ec",className:"text-xs",children:"EC (dS/m)"}),e.jsx(Ce,{id:"ec",type:"number",step:"0.01",min:"0",value:p.ec??"",onChange:N=>v("ec",N.target.value),placeholder:"e.g., 0.5",disabled:b})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"nitrogen",className:"text-xs",children:"Nitrogen (kg/ha)"}),e.jsx(Ce,{id:"nitrogen",type:"number",step:"0.1",min:"0",value:p.nitrogen??"",onChange:N=>v("nitrogen",N.target.value),placeholder:"e.g., 280",disabled:b})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"phosphorus",className:"text-xs",children:"Phosphorus (kg/ha)"}),e.jsx(Ce,{id:"phosphorus",type:"number",step:"0.1",min:"0",value:p.phosphorus??"",onChange:N=>v("phosphorus",N.target.value),placeholder:"e.g., 45",disabled:b})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"potassium",className:"text-xs",children:"Potassium (kg/ha)"}),e.jsx(Ce,{id:"potassium",type:"number",step:"0.1",min:"0",value:p.potassium??"",onChange:N=>v("potassium",N.target.value),placeholder:"e.g., 320",disabled:b})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"organic_carbon",className:"text-xs",children:"Organic Carbon (%)"}),e.jsx(Ce,{id:"organic_carbon",type:"number",step:"0.01",min:"0",value:p.organic_carbon??"",onChange:N=>v("organic_carbon",N.target.value),placeholder:"e.g., 0.75",disabled:b})]})]})]})]}),e.jsx(z,{type:"submit",className:"w-full",disabled:b||!i,children:b?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),u?"Compressing...":"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pi,{className:"h-4 w-4 mr-2"}),"Upload Report"]})})]})]})})}function g4({report:t,open:s,onOpenChange:r}){const{data:a,isLoading:n}=Tv(t?.report_file_path||null),[i,o]=x.useState(1),[c,l]=x.useState(!1);if(!t)return null;const u=t.report_file_type==="image",d=t.report_file_type==="pdf",p=()=>{a&&window.open(a,"_blank")},h=[t.ph!=null&&{label:"pH",value:t.ph},t.nitrogen!=null&&{label:"N",value:t.nitrogen},t.phosphorus!=null&&{label:"P",value:t.phosphorus},t.potassium!=null&&{label:"K",value:t.potassium},t.organic_carbon!=null&&{label:"OC",value:`${t.organic_carbon}%`},t.ec!=null&&{label:"EC",value:t.ec}].filter(Boolean);return c&&u&&a?e.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex items-center justify-center",children:[e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 z-10",children:[e.jsx(z,{variant:"secondary",size:"icon",onClick:()=>o(f=>Math.min(f+.5,3)),children:e.jsx(Sc,{className:"h-4 w-4"})}),e.jsx(z,{variant:"secondary",size:"icon",onClick:()=>o(f=>Math.max(f-.5,.5)),children:e.jsx(Kj,{className:"h-4 w-4"})}),e.jsx(z,{variant:"secondary",size:"icon",onClick:p,children:e.jsx(ui,{className:"h-4 w-4"})}),e.jsx(z,{variant:"secondary",size:"icon",onClick:()=>l(!1),children:e.jsx(ar,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"overflow-auto max-w-full max-h-full p-4",children:e.jsx("img",{src:a,alt:"Soil Report",style:{transform:`scale(${i})`,transformOrigin:"center"},className:"transition-transform duration-200"})})]}):e.jsx(zt,{open:s,onOpenChange:r,children:e.jsxs(It,{className:"max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(Bt,{children:e.jsxs($t,{className:"flex items-center gap-2",children:[e.jsx(sr,{className:"h-5 w-5"}),"Soil Test Report"]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-muted-foreground border-b pb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ms,{className:"h-4 w-4"}),tt(new Date(t.report_date),"dd MMM yyyy")]}),t.lab_name&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Qh,{className:"h-4 w-4"}),t.lab_name]}),e.jsx(he,{variant:"outline",className:"capitalize",children:t.report_file_type})]}),h.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 py-2",children:h.map(f=>e.jsxs(he,{variant:"secondary",children:[f.label,": ",f.value]},f.label))}),t.notes&&e.jsx("p",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded-lg",children:t.notes}),e.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:n?e.jsx(Re,{className:"w-full h-64 rounded-lg"}):a?u?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a,alt:"Soil Report",className:"w-full rounded-lg cursor-pointer",onClick:()=>l(!0)}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsxs(z,{size:"sm",variant:"secondary",onClick:()=>l(!0),children:[e.jsx(Sc,{className:"h-4 w-4 mr-1"}),"Full Screen"]})})]}):d?e.jsxs("div",{className:"flex flex-col items-center gap-4 p-8 border rounded-lg bg-muted/30",children:[e.jsx(sr,{className:"h-16 w-16 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"PDF Document"}),e.jsxs(z,{onClick:p,children:[e.jsx(ya,{className:"h-4 w-4 mr-2"}),"Open PDF in New Tab"]})]}):null:e.jsx("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:"Unable to load file"})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-3 border-t",children:[e.jsxs(z,{variant:"outline",onClick:p,disabled:!a,children:[e.jsx(ui,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsx(z,{variant:"outline",onClick:()=>r(!1),children:"Close"})]})]})})}const mo={ph:{label:"pH",color:"hsl(var(--primary))",unit:""},nitrogen:{label:"Nitrogen",color:"#22c55e",unit:" kg/ha"},phosphorus:{label:"Phosphorus",color:"#3b82f6",unit:" kg/ha"},potassium:{label:"Potassium",color:"#f97316",unit:" kg/ha"},organic_carbon:{label:"Organic Carbon",color:"#8b5cf6",unit:"%"},ec:{label:"EC",color:"#ec4899",unit:" dS/m"}};function v4({reports:t}){const[s,r]=x.useState("ph"),a=t.filter(o=>o[s]!=null).sort((o,c)=>new Date(o.report_date).getTime()-new Date(c.report_date).getTime()).map(o=>({date:tt(new Date(o.report_date),"MMM yyyy"),value:o[s],fullDate:o.report_date})),n=Object.keys(mo).filter(o=>t.filter(l=>l[o]!=null).length>=2);if(n.length===0)return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Add soil values in at least 2 reports to see trends"})});n.includes(s)||r(n[0]);const i=mo[s];return e.jsxs("div",{className:"space-y-4",children:[e.jsx(zn,{value:s,onValueChange:o=>r(o),children:e.jsx(Ja,{className:"flex-wrap h-auto",children:Object.keys(mo).map(o=>{const c=n.includes(o);return e.jsx(Vs,{value:o,disabled:!c,className:"text-xs",children:mo[o].label},o)})})}),e.jsx("div",{className:"h-48",children:e.jsx(Iy,{width:"100%",height:"100%",children:e.jsxs(Oy,{data:a,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(Fy,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(Ly,{dataKey:"date",tick:{fontSize:11},className:"text-muted-foreground"}),e.jsx(qy,{tick:{fontSize:11},className:"text-muted-foreground",domain:["auto","auto"]}),e.jsx(zy,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:o=>[`${o}${i.unit}`,i.label],labelFormatter:o=>`Date: ${o}`}),e.jsx(By,{type:"monotone",dataKey:"value",stroke:i.color,strokeWidth:2,dot:{fill:i.color,strokeWidth:0},activeDot:{r:6}})]})})})]})}function y4(t){if(!t)return{variant:"destructive",label:"No test yet",icon:rr};const s=Sd(new Date,new Date(t));return s<=6?{variant:"default",label:"Recent",icon:qs}:s<=12?{variant:"secondary",label:`${s}mo ago`,icon:vs}:{variant:"destructive",label:`${s}mo ago`,icon:rr}}function j4({report:t,onView:s,onDelete:r}){const{data:a}=Tv(t.report_file_path),n=t.report_file_type==="image",i=[t.ph!=null&&{label:"pH",value:t.ph},t.nitrogen!=null&&{label:"N",value:t.nitrogen},t.phosphorus!=null&&{label:"P",value:t.phosphorus},t.potassium!=null&&{label:"K",value:t.potassium}].filter(Boolean);return e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg hover:bg-muted/30 transition-colors",children:[e.jsx("div",{className:"p-2 rounded-lg bg-muted",children:n?e.jsx(tp,{className:"h-5 w-5 text-primary"}):e.jsx(sr,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:tt(new Date(t.report_date),"dd MMM yyyy")}),t.lab_name&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(Qh,{className:"h-3 w-3"}),t.lab_name]})]}),i.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:i.map(o=>e.jsxs(he,{variant:"outline",className:"text-xs py-0",children:[o.label,": ",o.value]},o.label))})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:s,children:e.jsx(sa,{className:"h-4 w-4"})}),a&&e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>window.open(a,"_blank"),children:e.jsx(ui,{className:"h-4 w-4"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:r,children:e.jsx(Na,{className:"h-4 w-4"})})]})]})}function b4({farmland:t,open:s,onOpenChange:r}){const{data:a,isLoading:n}=m4(t?.id||""),{data:i}=h4(t?.id||""),o=f4(),[c,l]=x.useState(!1),[u,d]=x.useState(null),[p,h]=x.useState(!1),[f,y]=x.useState(null);if(!t)return null;const v=y4(i?.report_date||null),b=v.icon,N=i?Sd(new Date,new Date(i.report_date)):null,A=C=>{y(C),h(!0)},j=async()=>{f&&(await o.mutateAsync({report:f}),h(!1),y(null))};return e.jsxs(e.Fragment,{children:[e.jsx(Nv,{open:s,onOpenChange:r,children:e.jsxs(kv,{className:"max-h-[90vh]",children:[e.jsxs(Cv,{className:"border-b",children:[e.jsxs(Sv,{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-5 w-5"}),"Soil Reports - ",t.name]}),e.jsxs(Av,{children:[t.area," ",t.area_unit,"  ",t.village||"Unknown location"]})]}),e.jsx(Cn,{className:"flex-1 p-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(G,{children:e.jsxs(Q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(he,{variant:v.variant,className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-3.5 w-3.5"}),v.label]}),i&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Last tested: ",tt(new Date(i.report_date),"dd MMM yyyy")]})]}),e.jsxs(z,{onClick:()=>l(!0),children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Upload Report"]})]}),N!==null&&N>12&&e.jsxs("div",{className:"mt-4 p-3 bg-destructive/10 rounded-lg flex items-start gap-2",children:[e.jsx(rr,{className:"h-5 w-5 text-destructive shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-destructive",children:"Soil test overdue"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["It's been ",N," months since your last soil test. Consider getting a new test for better crop planning."]})]})]}),!i&&e.jsxs("div",{className:"mt-4 p-3 bg-muted rounded-lg flex items-start gap-2",children:[e.jsx(rr,{className:"h-5 w-5 text-muted-foreground shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"No soil reports yet"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload your first soil test report to track soil health over time."})]})]})]})}),a&&a.length>=2&&e.jsxs(G,{children:[e.jsx(je,{className:"pb-2",children:e.jsxs(we,{className:"text-sm flex items-center gap-2",children:[e.jsx(pr,{className:"h-4 w-4"}),"Soil Health Trends"]})}),e.jsx(Q,{children:e.jsx(v4,{reports:a})})]}),e.jsxs(G,{children:[e.jsx(je,{className:"pb-2",children:e.jsx(we,{className:"text-sm",children:"Report History"})}),e.jsx(Q,{children:n?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(C=>e.jsx(Re,{className:"h-16 rounded-lg"},C))}):a?.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(sr,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No reports uploaded yet"}),e.jsxs(z,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>l(!0),children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Upload First Report"]})]}):e.jsx("div",{className:"space-y-2",children:a?.map(C=>e.jsx(j4,{report:C,onView:()=>d(C),onDelete:()=>A(C)},C.id))})})]})]})})]})}),e.jsx(x4,{open:c,onOpenChange:l,farmlandId:t.id,farmlandName:t.name}),e.jsx(g4,{report:u,open:!!u,onOpenChange:C=>!C&&d(null)}),e.jsx(Ci,{open:p,onOpenChange:h,title:"Delete Soil Report",description:`Are you sure you want to delete this soil report from ${f?tt(new Date(f.report_date),"dd MMM yyyy"):""}? This action cannot be undone.`,confirmText:"Delete",variant:"destructive",onConfirm:j,loading:o.isPending})]})}const w4=()=>{const{data:t,isLoading:s}=_a(),{user:r}=Fe(),{toast:a}=hs(),{t:n}=Nt(),i=Xe(),[o,c]=x.useState(!1),[l,u]=x.useState(!1),[d,p]=x.useState(""),[h,f]=x.useState(null),[y,v]=x.useState(!1),[b,N]=x.useState(!1),[A,j]=x.useState(null),[C,I]=x.useState(!1),[k,R]=x.useState(null),[S,T]=x.useState(!1),E=lu(),[D,F]=x.useState({name:"",area:"",area_unit:"acres",soil_type:"",village:"",district:""}),H=t?.filter($=>$.name.toLowerCase().includes(d.toLowerCase())||$.village?.toLowerCase().includes(d.toLowerCase())),q=async $=>{if($.preventDefault(),!!r?.id){u(!0);try{const{error:se}=await W.from("farmlands").insert({farmer_id:r.id,name:D.name,area:parseFloat(D.area),area_unit:D.area_unit,soil_type:D.soil_type||null,village:D.village||null,district:D.district||null,location_lat:E.position?.latitude??null,location_long:E.position?.longitude??null,geo_verified:!!E.position});if(se)throw se;a({title:n("common.success"),description:n("farmer.farmlands.addSuccess")}),c(!1),F({name:"",area:"",area_unit:"acres",soil_type:"",village:"",district:""}),E.clear(),i.invalidateQueries({queryKey:["farmlands",r.id]})}catch(se){const ne=se instanceof Error?se.message:n("common.error");a({title:n("common.error"),description:ne,variant:"destructive"})}finally{u(!1)}}},B=($,se)=>{j({id:$,name:se}),N(!0)},L=async()=>{if(A){I(!0);try{const{error:$}=await W.from("farmlands").delete().eq("id",A.id);if($)throw $;a({title:n("farmer.farmlands.deleted"),description:n("farmer.farmlands.deleteSuccess")}),i.invalidateQueries({queryKey:["farmlands",r?.id]}),N(!1),j(null)}catch($){const se=$ instanceof Error?$.message:n("common.error");a({title:n("common.error"),description:se,variant:"destructive"})}finally{I(!1)}}},P=t?.reduce(($,se)=>$+se.area,0)||0,K=t?.reduce(($,se)=>{const ne=se.soil_type||"unknown";return $[ne]=($[ne]||0)+se.area,$},{});return e.jsxs(Oe,{title:n("farmer.farmlands.title"),children:[e.jsxs($s,{title:n("farmer.farmlands.title"),children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:e.jsx(lr,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:t?.length||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("farmer.farmlands.totalPlots")})]})]})})}),e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-100 text-emerald-600",children:e.jsx(sm,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:P.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("farmer.farmlands.totalAcres")})]})]})})}),e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 text-amber-600",children:e.jsx(Uj,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:Object.keys(K||{}).filter($=>$!=="unknown").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("farmer.farmlands.soilTypes")})]})]})})}),e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 text-blue-600",children:e.jsx(We,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:new Set(t?.map($=>$.village).filter(Boolean)).size}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("farmer.farmlands.villages")})]})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:n("farmer.farmlands.searchPlaceholder"),className:"pl-10",value:d,onChange:$=>p($.target.value)})]}),e.jsxs(zt,{open:o,onOpenChange:c,children:[e.jsx(Wr,{asChild:!0,children:e.jsxs(z,{size:"lg",variant:"default",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),n("farmer.farmlands.addFarmland")]})}),e.jsxs(It,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:n("farmer.farmlands.addNewFarmland")}),e.jsx(Ks,{children:n("farmer.farmlands.addFarmlandDescription")})]}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[n("farmer.farmlands.plotName")," *",e.jsx(vr,{content:n("farmer.farmlands.plotNameHelp")})]}),e.jsx(Ce,{value:D.name,onChange:$=>F({...D,name:$.target.value}),placeholder:n("farmer.farmlands.plotNamePlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[n("farmer.farmlands.area")," *",e.jsx(vr,{content:n("farmer.farmlands.areaHelp")})]}),e.jsx(Ce,{type:"number",step:"0.1",value:D.area,onChange:$=>F({...D,area:$.target.value}),placeholder:"5",required:!0})]}),e.jsxs("div",{children:[e.jsx(ie,{children:n("common.unit")}),e.jsxs(lt,{value:D.area_unit,onValueChange:$=>F({...D,area_unit:$}),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"acres",children:n("enum.area_units.acres")}),e.jsx(ge,{value:"hectares",children:n("enum.area_units.hectares")}),e.jsx(ge,{value:"bigha",children:n("enum.area_units.bigha")}),e.jsx(ge,{value:"guntha",children:n("enum.area_units.guntha")})]})]})]})]}),e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[n("farmer.farmlands.soilType"),e.jsx(vr,{content:n("farmer.farmlands.soilTypeHelp")})]}),e.jsxs(lt,{value:D.soil_type,onValueChange:$=>F({...D,soil_type:$}),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:n("farmer.farmlands.selectSoilType")})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"alluvial",children:n("enum.soil_types.alluvial")}),e.jsx(ge,{value:"black",children:n("enum.soil_types.black")}),e.jsx(ge,{value:"red",children:n("enum.soil_types.red")}),e.jsx(ge,{value:"laterite",children:n("enum.soil_types.laterite")}),e.jsx(ge,{value:"sandy",children:n("enum.soil_types.sandy")}),e.jsx(ge,{value:"clay",children:n("enum.soil_types.clay")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:n("farmer.farmlands.village")}),e.jsx(Ce,{value:D.village,onChange:$=>F({...D,village:$.target.value}),placeholder:n("farmer.farmlands.villagePlaceholder")})]}),e.jsxs("div",{children:[e.jsx(ie,{children:n("farmer.farmlands.district")}),e.jsx(Ce,{value:D.district,onChange:$=>F({...D,district:$.target.value}),placeholder:n("farmer.farmlands.districtPlaceholder")})]})]}),e.jsxs("div",{className:"rounded-lg border border-border p-3 space-y-2",children:[e.jsxs(ie,{className:"text-sm font-medium flex items-center gap-1.5",children:[e.jsx(We,{className:"h-4 w-4"}),"Farm Location (GPS) - Optional"]}),E.position?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm flex items-center gap-1 text-green-600",children:[e.jsx(qs,{className:"h-4 w-4"}),"Location captured"]}),e.jsxs(z,{type:"button",variant:"outline",size:"sm",onClick:()=>E.capture(),disabled:E.capturing,children:[E.capturing?e.jsx(et,{className:"h-3 w-3 animate-spin mr-1"}):null,"Recapture"]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Location not added"}),e.jsx(z,{type:"button",variant:"outline",size:"sm",onClick:()=>E.capture(),disabled:E.capturing,children:E.capturing?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-3 w-3 animate-spin mr-1"})," Capturing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"h-3 w-3 mr-1"})," Capture Location"]})})]})]}),e.jsx(z,{type:"submit",variant:"default",className:"w-full",size:"lg",disabled:l,children:n(l?"common.saving":"farmer.farmlands.addFarmland")})]})]})]})]}),s?e.jsx(xr,{loading:!0,children:e.jsx(e.Fragment,{})}):H?.length===0?e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:e.jsx(nr,{icon:lr,title:n(d?"farmer.farmlands.noFarmlandsFound":"farmer.farmlands.noFarmlandsYet"),description:n(d?"farmer.farmlands.adjustSearch":"farmer.farmlands.startAddingFarmlands"),actionLabel:n(d?"common.clearSearch":"farmer.farmlands.addFirstFarmland"),onAction:()=>{d?p(""):c(!0)}})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:H?.map($=>e.jsx(G,{className:"hover:shadow-medium transition-all group",children:e.jsxs(Q,{className:"p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 text-amber-600",children:e.jsx(lr,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:$.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[$.area," ",$.area_unit]})]})]})}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground mb-4",children:[$.village&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 shrink-0"}),e.jsxs("span",{className:"truncate",children:[$.village,$.district?`, ${$.district}`:""]})]}),$.soil_type&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(sm,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"capitalize",children:n(`enum.soil_types.${$.soil_type}`)})]}),$.geo_verified?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(qs,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{children:"Location captured"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 shrink-0 opacity-40"}),e.jsx("span",{children:"Location not added"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{R($),T(!0)},children:[e.jsx(zj,{className:"h-4 w-4 mr-1"}),n("farmer.farmlands.soilReports")]}),e.jsx(z,{"aria-label":`Edit ${$.name}`,variant:"outline",size:"sm",onClick:()=>{f($),v(!0)},children:e.jsx(ji,{className:"h-4 w-4"})}),e.jsx(z,{"aria-label":`Delete ${$.name}`,variant:"outline",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>B($.id,$.name),children:e.jsx(Na,{className:"h-4 w-4"})})]})]})},$.id))})]}),e.jsx(FS,{farmland:h,open:y,onOpenChange:v}),e.jsx(b4,{farmland:k,open:S,onOpenChange:T}),e.jsx(Ci,{open:b,onOpenChange:N,title:n("farmer.farmlands.deleteFarmland"),description:n("farmer.farmlands.deleteConfirm"),confirmText:n("common.delete"),variant:"destructive",onConfirm:L,loading:C})]})},N4=()=>{const{data:t,isLoading:s}=yd(),{data:r}=ka(),{data:a}=_a(),{user:n}=Fe(),{toast:i}=hs(),{t:o}=Nt(),c=Xe(),[l,u]=x.useState(!1),[d,p]=x.useState("all"),[h,f]=x.useState(!1),[y,v]=x.useState(null),[b,N]=x.useState(!1),[A,j]=x.useState(!1),[C,I]=x.useState({crop_id:"",quantity:"",quantity_unit:"quintals",pickup_location:"",pickup_village:"",preferred_date:"",preferred_time:"",notes:"",origin_district_id:"",dest_district_id:""}),k={requested:{label:o("enum.transport_status.requested"),color:"bg-blue-100 text-blue-800",icon:vs},assigned:{label:o("enum.transport_status.assigned"),color:"bg-purple-100 text-purple-800",icon:rt},en_route:{label:o("enum.transport_status.en_route"),color:"bg-amber-100 text-amber-800",icon:rt},picked_up:{label:o("enum.transport_status.picked_up"),color:"bg-emerald-100 text-emerald-800",icon:qt},delivered:{label:o("enum.transport_status.delivered"),color:"bg-primary/10 text-primary",icon:qs},cancelled:{label:o("enum.transport_status.cancelled"),color:"bg-destructive/10 text-destructive",icon:Ur}},R=t?.filter(B=>d==="all"||B.status===d),S=t?.filter(B=>!["delivered","cancelled"].includes(B.status)).length||0,T=t?.filter(B=>B.status==="delivered").length||0,E=B=>{I({...C,crop_id:B});const L=r?.find(P=>P.id===B);if(L?.farmland){const P=[L.farmland.name,L.farmland.village,L.farmland.district].filter(Boolean).join(", ");I(K=>({...K,crop_id:B,pickup_location:P,pickup_village:L.farmland?.village||""}))}},D=async B=>{if(B.preventDefault(),!!n?.id){j(!0);try{const{error:L}=await W.from("transport_requests").insert({farmer_id:n.id,crop_id:C.crop_id||null,quantity:parseFloat(C.quantity),quantity_unit:C.quantity_unit,pickup_location:C.pickup_location,pickup_village:C.pickup_village||null,preferred_date:C.preferred_date||null,preferred_time:C.preferred_time||null,notes:C.notes||null,origin_district_id:C.origin_district_id||null,dest_district_id:C.dest_district_id||null});if(L)throw L;i({title:o("common.success"),description:o("farmer.transport.requestSuccess")}),u(!1),I({crop_id:"",quantity:"",quantity_unit:"quintals",pickup_location:"",pickup_village:"",preferred_date:"",preferred_time:"",notes:"",origin_district_id:"",dest_district_id:""}),c.invalidateQueries({queryKey:["transport-requests",n.id]})}catch(L){const P=L instanceof Error?L.message:o("common.error");i({title:o("common.error"),description:P,variant:"destructive"})}finally{j(!1)}}},F=(B,L)=>{v({id:B,cropName:L}),f(!0)},H=async()=>{if(y){N(!0);try{const{error:B}=await W.from("transport_requests").update({status:"cancelled"}).eq("id",y.id);if(B)throw B;i({title:o("farmer.transport.cancelled"),description:o("farmer.transport.cancelSuccess")}),c.invalidateQueries({queryKey:["transport-requests",n?.id]}),f(!1),v(null)}catch(B){const L=B instanceof Error?B.message:o("common.error");i({title:o("common.error"),description:L,variant:"destructive"})}finally{N(!1)}}},q=[{value:"all",label:o("common.all"),count:t?.length},{value:"requested",label:o("farmer.transport.pending"),count:t?.filter(B=>B.status==="requested").length},{value:"assigned",label:o("enum.transport_status.assigned"),count:t?.filter(B=>B.status==="assigned").length},{value:"en_route",label:o("enum.transport_status.en_route"),count:t?.filter(B=>B.status==="en_route").length},{value:"delivered",label:o("enum.transport_status.delivered"),count:T}];return e.jsxs(Oe,{title:o("farmer.transport.title"),children:[e.jsxs($s,{title:o("farmer.transport.title"),children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 text-blue-600",children:e.jsx(vs,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:S}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o("farmer.transport.activeRequests")})]})]})})}),e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-100 text-emerald-600",children:e.jsx(qs,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:T}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o("farmer.transport.completed")})]})]})})}),e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 text-amber-600",children:e.jsx(rt,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:t?.filter(B=>B.status==="en_route").length||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o("farmer.transport.inTransit")})]})]})})}),e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:e.jsx(qt,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:t?.length||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o("farmer.transport.totalRequests")})]})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:q.map(B=>e.jsxs(z,{variant:d===B.value?"default":"outline",size:"sm",onClick:()=>p(B.value),children:[B.label,B.count!==void 0&&B.count>0&&e.jsx("span",{className:"ml-1.5 px-1.5 py-0.5 rounded-full text-xs bg-background/20",children:B.count})]},B.value))}),e.jsxs(zt,{open:l,onOpenChange:u,children:[e.jsx(Wr,{asChild:!0,children:e.jsxs(z,{size:"lg",variant:"default",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),o("farmer.transport.newRequest")]})}),e.jsxs(It,{className:"max-w-md",children:[e.jsxs(Bt,{children:[e.jsx($t,{children:o("farmer.transport.requestTransport")}),e.jsx(Ks,{children:o("farmer.transport.requestDescription")})]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[o("farmer.transport.crop"),e.jsx(vr,{content:o("farmer.transport.cropHelp")})]}),e.jsxs(lt,{value:C.crop_id,onValueChange:E,children:[e.jsx(it,{children:e.jsx(ct,{placeholder:o("farmer.transport.selectCrop")})}),e.jsx(ot,{children:r?.filter(B=>B.status!=="harvested").map(B=>e.jsxs(ge,{value:B.id,children:[B.crop_name," ",B.variety&&`(${B.variety})`]},B.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[o("farmer.transport.quantity")," *",e.jsx(vr,{content:o("farmer.transport.quantityHelp")})]}),e.jsx(Ce,{type:"number",value:C.quantity,onChange:B=>I({...C,quantity:B.target.value}),placeholder:"50",required:!0})]}),e.jsxs("div",{children:[e.jsx(ie,{children:o("common.unit")}),e.jsxs(lt,{value:C.quantity_unit,onValueChange:B=>I({...C,quantity_unit:B}),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"quintals",children:o("enum.units.quintals")}),e.jsx(ge,{value:"kg",children:o("enum.units.kg")}),e.jsx(ge,{value:"tonnes",children:o("enum.units.tonnes")})]})]})]})]}),e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[o("farmer.transport.pickupLocation")," *",e.jsx(vr,{content:o("farmer.transport.pickupHelp")})]}),e.jsx(Ce,{value:C.pickup_location,onChange:B=>I({...C,pickup_location:B.target.value}),placeholder:o("farmer.transport.pickupPlaceholder"),required:!0})]}),e.jsxs("div",{children:[e.jsx(ie,{children:o("farmer.farmlands.village")}),e.jsx(Ce,{value:C.pickup_village,onChange:B=>I({...C,pickup_village:B.target.value}),placeholder:o("farmer.farmlands.villagePlaceholder")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(ie,{children:[o("farmer.transport.pickupLocation")," District"]}),e.jsx(Kr,{value:C.origin_district_id,onValueChange:B=>I({...C,origin_district_id:B}),placeholder:"Origin district"})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Destination District"}),e.jsx(Kr,{value:C.dest_district_id,onValueChange:B=>I({...C,dest_district_id:B}),placeholder:"Dest district"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:o("farmer.transport.preferredDate")}),e.jsx(Ce,{type:"date",value:C.preferred_date,onChange:B=>I({...C,preferred_date:B.target.value}),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsxs(ie,{className:"flex items-center",children:[o("farmer.transport.preferredTime"),e.jsx(vr,{content:o("farmer.transport.timeHelp")})]}),e.jsxs(lt,{value:C.preferred_time,onValueChange:B=>I({...C,preferred_time:B}),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:o("farmer.transport.selectTime")})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"Early Morning (5-8 AM)",children:o("farmer.transport.earlyMorning")}),e.jsx(ge,{value:"Morning (8-11 AM)",children:o("farmer.transport.morning")}),e.jsx(ge,{value:"Afternoon (12-3 PM)",children:o("farmer.transport.afternoon")}),e.jsx(ge,{value:"Evening (4-6 PM)",children:o("farmer.transport.evening")})]})]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:o("farmer.transport.notes")}),e.jsx(zs,{value:C.notes,onChange:B=>I({...C,notes:B.target.value}),placeholder:o("farmer.transport.notesPlaceholder"),rows:2})]}),e.jsx(z,{type:"submit",variant:"default",className:"w-full",size:"lg",disabled:A,children:o(A?"common.saving":"farmer.transport.submitRequest")})]})]})]})]}),s?e.jsx(xr,{loading:!0,children:e.jsx(e.Fragment,{})}):R?.length===0?e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:e.jsx(nr,{icon:rt,title:o(d!=="all"?"farmer.transport.noRequestsFound":"farmer.transport.noRequestsYet"),description:o(d!=="all"?"farmer.transport.tryDifferentFilter":"farmer.transport.startRequestingTransport"),actionLabel:o(d!=="all"?"common.showAll":"farmer.transport.createFirstRequest"),onAction:()=>{d!=="all"?p("all"):u(!0)}})})}):e.jsx("div",{className:"space-y-4",children:R?.map(B=>{const L=k[B.status],P=L.icon;return e.jsx(G,{className:"hover:shadow-medium transition-all",children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${L.color}`,children:e.jsx(P,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-semibold text-lg",children:B.crop?.crop_name||o("farmer.transport.generalProduce")}),e.jsxs("span",{className:"text-muted-foreground",children:["- ",B.quantity," ",B.quantity_unit]}),e.jsx(he,{className:L.color,children:L.label})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"truncate max-w-[200px]",children:B.pickup_village||B.pickup_location})]}),B.preferred_date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"h-4 w-4"}),e.jsx("span",{children:tt(new Date(B.preferred_date),"MMM d, yyyy")})]}),B.preferred_time&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{children:B.preferred_time})]})]})]}),B.status==="requested"&&e.jsx(z,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>F(B.id,B.crop?.crop_name||o("farmer.transport.generalProduce")),children:o("farmer.transport.cancelRequest")})]})})},B.id)})})]}),e.jsx(Ci,{open:h,onOpenChange:f,title:o("farmer.transport.cancelTransportRequest"),description:o("farmer.transport.cancelConfirm"),confirmText:o("farmer.transport.yesCancel"),variant:"destructive",onConfirm:H,loading:b})]})},Gm={price:{icon:pr,color:"bg-emerald-100 text-emerald-600",label:"Price Alert"},weather:{icon:La,color:"bg-blue-100 text-blue-600",label:"Weather"},crop:{icon:ts,color:"bg-amber-100 text-amber-600",label:"Crop"},scheme:{icon:Tj,color:"bg-purple-100 text-purple-600",label:"Scheme"},pickup:{icon:rt,color:"bg-primary/10 text-primary",label:"Pickup"},info:{icon:rr,color:"bg-muted text-muted-foreground",label:"Info"}},_4=()=>{const{data:t,isLoading:s}=tl(),{user:r}=Fe(),{toast:a}=hs(),n=Xe(),[i,o]=x.useState("all"),c=t?.filter(h=>!h.is_read).length||0,l=t?.filter(h=>i==="all"?!0:i==="unread"?!h.is_read:(h.type||"info")===i),u=async h=>{try{const{error:f}=await W.from("notifications").update({is_read:!0}).eq("id",h);if(f)throw f;n.invalidateQueries({queryKey:["farmer-notifications",r?.id]})}catch(f){const y=f instanceof Error?f.message:"Failed to update notification";a({title:"Error",description:y,variant:"destructive"})}},d=async()=>{try{const{error:h}=await W.from("notifications").update({is_read:!0}).eq("user_id",r?.id).eq("is_read",!1);if(h)throw h;a({title:"All notifications marked as read"}),n.invalidateQueries({queryKey:["farmer-notifications",r?.id]})}catch(h){const f=h instanceof Error?h.message:"Failed to update notifications";a({title:"Error",description:f,variant:"destructive"})}},p=[{value:"all",label:"All"},{value:"unread",label:"Unread"},{value:"price",label:"Price"},{value:"weather",label:"Weather"},{value:"crop",label:"Crop"},{value:"pickup",label:"Pickup"}];return e.jsx(Oe,{title:"Notifications",children:e.jsxs(Zs,{title:"Notifications",subtitle:c>0?`${c} unread notifications`:"All caught up!",actions:c>0?e.jsxs(z,{variant:"outline",onClick:d,children:[e.jsx(wj,{className:"h-4 w-4 mr-2"}),"Mark all as read"]}):void 0,children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/10",children:e.jsx(_r,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c>0?`${c} unread notifications`:"All caught up!"})]})]})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:p.map(h=>e.jsxs(z,{variant:i===h.value?"default":"outline",size:"sm",onClick:()=>o(h.value),children:[h.label,h.value==="unread"&&c>0&&e.jsx(he,{className:"ml-2 bg-destructive text-destructive-foreground",children:c})]},h.value))}),e.jsx(xr,{loading:s,empty:!s&&(!l||l.length===0),emptyTitle:"No notifications found",children:e.jsx("div",{className:"space-y-3",children:l?.map(h=>{const f=Gm[h.type]||Gm.info,y=f.icon;return e.jsx(G,{className:`hover:shadow-medium transition-all ${h.is_read?"":"border-l-4 border-l-primary bg-primary/5"}`,children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2.5 rounded-xl ${f.color} shrink-0`,children:e.jsx(y,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("h3",{className:`font-medium ${h.is_read?"text-muted-foreground":"text-foreground"}`,children:h.title}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(he,{variant:"outline",className:"text-xs",children:f.label}),!h.is_read&&e.jsx(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>u(h.id),children:e.jsx(Cr,{className:"h-4 w-4"})})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:h.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Er(new Date(h.created_at),{addSuffix:!0})})]})]})})},h.id)})})})]})})};var k4="Separator",Qm="horizontal",C4=["horizontal","vertical"],Pv=x.forwardRef((t,s)=>{const{decorative:r,orientation:a=Qm,...n}=t,i=S4(a)?a:Qm,c=r?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return e.jsx(ht.div,{"data-orientation":i,...c,...n,ref:s})});Pv.displayName=k4;function S4(t){return C4.includes(t)}var Mv=Pv;const wa=x.forwardRef(({className:t,orientation:s="horizontal",decorative:r=!0,...a},n)=>e.jsx(Mv,{ref:n,decorative:r,orientation:s,className:ke("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...a}));wa.displayName=Mv.displayName;function mu(t){const{user:s}=Fe();return De({queryKey:["service-areas",s?.id,t],queryFn:async()=>{if(!s?.id)return[];const{data:r,error:a}=await W.from("geo_service_areas").select("*").eq("user_id",s.id).eq("role_scope",t).order("created_at",{ascending:!1});if(a)throw a;const n=r??[],i=n.map(o=>o.district_id).filter(Boolean);if(i.length>0){const{data:o}=await W.from("geo_districts").select("id, name_en, state_id").in("id",i),c=new Map((o??[]).map(l=>[l.id,l]));for(const l of n){const u=c.get(l.district_id);u&&(l.district_name=u.name_en)}}return n},enabled:!!s?.id})}function Rv(){const t=Xe();return dt({mutationFn:async s=>Bs("upsert_service_area_v1",{p_role_scope:s.role_scope,p_state_id:s.state_id||null,p_district_id:s.district_id||null,p_market_id:s.market_id||null,p_radius_km:s.radius_km??null,p_is_active:s.is_active??!0}),onSuccess:()=>{t.invalidateQueries({queryKey:["service-areas"]})}})}function Dv(){const t=Xe();return dt({mutationFn:async s=>Bs("delete_service_area_v1",{p_id:s}),onSuccess:()=>{t.invalidateQueries({queryKey:["service-areas"]})}})}function Ev(){const t=Xe();return dt({mutationFn:async s=>Bs("set_profile_geo_v1",{p_state_id:s.state_id||null,p_district_id:s.district_id||null,p_market_id:s.market_id||null}),onSuccess:()=>{t.invalidateQueries({queryKey:["farmer-profile"]}),t.invalidateQueries({queryKey:["agent-profile"]}),t.invalidateQueries({queryKey:["transporter-profile"]}),t.invalidateQueries({queryKey:["buyer-profile"]})}})}function Ai({value:t,onValueChange:s,placeholder:r="Select state",disabled:a,className:n}){const{data:i,isLoading:o}=HC();return e.jsxs(lt,{value:t||"",onValueChange:s,disabled:a||o,children:[e.jsx(it,{className:n,children:e.jsx(ct,{placeholder:o?"Loading...":r})}),e.jsx(ot,{children:(i??[]).map(c=>e.jsxs(ge,{value:c.id,children:[c.name_en,c.name_local?` (${c.name_local})`:""]},c.id))})]})}function A4({districtId:t,value:s,onValueChange:r,placeholder:a="Select market",disabled:n,className:i}){const{data:o,isLoading:c}=KC(t);return t?e.jsxs(lt,{value:s||"",onValueChange:r,disabled:n||c,children:[e.jsx(it,{className:i,children:e.jsx(ct,{placeholder:c?"Loading...":a})}),e.jsx(ot,{children:(o??[]).map(l=>e.jsxs(ge,{value:l.id,children:[l.name_en," (",l.market_type,")"]},l.id))})]}):null}const T4=()=>{const{data:t,isLoading:s}=Fn(),{user:r}=Fe(),{toast:a}=hs(),n=Xe(),{language:i,setLanguage:o,isLoading:c,t:l}=Nt(),[u,d]=x.useState(!1),p=Ev(),[h,f]=x.useState({full_name:"",phone:"",village:"",district:""}),[y,v]=x.useState(""),[b,N]=x.useState(""),[A,j]=x.useState("");x.useEffect(()=>{t&&(f({full_name:t.full_name||"",phone:t.phone||"",village:t.village||"",district:t.district||""}),v(t.geo_state_id||""),N(t.geo_district_id||""),j(t.home_market_id||""))},[t]);const C=async k=>{if(k.preventDefault(),!!r?.id){d(!0);try{const{error:R}=await W.from("profiles").update({full_name:h.full_name,phone:h.phone,village:h.village||null,district:h.district||null}).eq("id",r.id);if(R)throw R;(y||b||A)&&await p.mutateAsync({state_id:y||void 0,district_id:b||void 0,market_id:A||void 0}),a({title:l("toast.profile_updated")}),n.invalidateQueries({queryKey:["farmer-profile",r.id]})}catch(R){const S=R instanceof Error?R.message:l("common.error");a({title:l("common.error"),description:S,variant:"destructive"})}finally{d(!1)}}},I=k=>k?k.split(" ").map(R=>R[0]).join("").toUpperCase().slice(0,2):"FM";return s?e.jsx(Oe,{title:l("nav.settings"),children:e.jsx(xr,{loading:!0,children:e.jsx(e.Fragment,{})})}):e.jsx(Oe,{title:l("nav.settings"),children:e.jsxs(Zs,{title:l("nav.settings"),className:"max-w-3xl",children:[e.jsxs(G,{children:[e.jsxs(je,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5 text-primary"}),l("settings.profile_information")]}),e.jsx(kr,{children:l("settings.update_info")})]}),e.jsx(Q,{children:e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(bd,{className:"h-20 w-20",children:[e.jsx(wd,{src:void 0}),e.jsx(Nd,{className:"bg-primary/10 text-primary text-xl font-semibold",children:I(h.full_name)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:h.full_name||l("roles.farmer")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r?.email})]})]}),e.jsx(wa,{}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"full_name",children:l("settings.full_name")}),e.jsx(Ce,{id:"full_name",value:h.full_name,onChange:k=>f({...h,full_name:k.target.value}),placeholder:l("settings.full_name_placeholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"phone",children:l("settings.phone")}),e.jsx(Ce,{id:"phone",value:h.phone,onChange:k=>f({...h,phone:k.target.value}),placeholder:"+91 XXXXX XXXXX"})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"village",children:l("settings.village")}),e.jsx(Ce,{id:"village",value:h.village,onChange:k=>f({...h,village:k.target.value}),placeholder:l("settings.village_placeholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ie,{htmlFor:"district",children:[l("settings.district")," (text)"]}),e.jsx(Ce,{id:"district",value:h.district,onChange:k=>f({...h,district:k.target.value}),placeholder:l("settings.district_placeholder")})]})]}),e.jsx(wa,{}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:i==="kn"?" ":"Geographic Location"}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:i==="kn"?"":"State"}),e.jsx(Ai,{value:y,onValueChange:k=>{v(k),N(""),j("")}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:i==="kn"?"":"District"}),e.jsx(Kr,{stateId:y||null,value:b,onValueChange:k=>{N(k),j("")}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:i==="kn"?"":"Home Market"}),e.jsx(A4,{districtId:b||null,value:A,onValueChange:j})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(z,{type:"submit",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),l("common.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(gn,{className:"h-4 w-4 mr-2"}),l("common.save_changes")]})})})]})})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(_r,{className:"h-5 w-5 text-primary"}),l("settings.preferences")]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_r,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l("settings.push_notifications")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l("settings.push_notifications_desc")})]})]}),e.jsx(z,{variant:"outline",size:"sm",children:l("settings.configure")})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(mi,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l("settings.language")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l(i==="en"?"common.english":"common.kannada")})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:i==="en"?"default":"outline",size:"sm",onClick:()=>o("en"),disabled:c,children:[i==="en"&&e.jsx(Cr,{className:"h-3 w-3 mr-1"}),l("common.english")]}),e.jsxs(z,{variant:i==="kn"?"default":"outline",size:"sm",onClick:()=>o("kn"),disabled:c,children:[i==="kn"&&e.jsx(Cr,{className:"h-3 w-3 mr-1"}),l("common.kannada")]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Hr,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l("settings.account_security")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l("settings.account_security_desc")})]})]}),e.jsx(z,{variant:"outline",size:"sm",children:l("settings.manage")})]})]})]})]})})},P4=async t=>{if(!t||t.length===0)return[];const s=Array.from(new Set(t.map(c=>c.farmer_id).filter(Boolean))),r=Array.from(new Set(t.map(c=>c.crop_id).filter(Boolean))),[a,n]=await Promise.all([s.length>0?W.from("profiles").select("id, full_name, village, district, phone").in("id",s):Promise.resolve({data:[],error:null}),r.length>0?W.from("crops").select("id, crop_name, status, harvest_estimate, estimated_quantity").in("id",r):Promise.resolve({data:[],error:null})]);if(a.error)throw a.error;if(n.error)throw n.error;const i=new Map((a.data||[]).map(c=>[c.id,c])),o=new Map((n.data||[]).map(c=>[c.id,c]));return t.map(c=>({...c,farmer:i.get(c.farmer_id)?{full_name:i.get(c.farmer_id).full_name,village:i.get(c.farmer_id).village,district:i.get(c.farmer_id).district,phone:i.get(c.farmer_id).phone}:null,crop:c.crop_id&&o.get(c.crop_id)||null}))},Iv=()=>{const{user:t}=Fe(),s=new Date().toISOString().split("T")[0];return De({queryKey:["today-tasks",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:r,error:a}=await W.from("agent_tasks").select("*").eq("agent_id",t.id).eq("due_date",s).order("priority",{ascending:!1});if(a)throw a;return P4(r||[])},enabled:!!t?.id})},hu=()=>{const{user:t}=Fe();return De({queryKey:["all-farmers",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("profiles").select("district").eq("id",t.id).single();if(r)throw r;if(!s?.district)return[];const{data:a,error:n}=await W.from("profiles").select("*, user_roles!inner(role)").eq("user_roles.role","farmer").eq("district",s.district);if(n)throw n;const i=(a||[]).map(l=>l.id);if(i.length===0)return[];const{data:o}=await W.from("agent_farmer_assignments").select("farmer_id, agent_id, active").in("farmer_id",i).eq("active",!0),c={};return(o||[]).forEach(l=>{c[l.farmer_id]=l.agent_id}),(a||[]).map(l=>({...l,assigned_agent_id:c[l.id]||null,is_assigned_to_me:c[l.id]===t.id,is_assigned_to_other:!!c[l.id]&&c[l.id]!==t.id}))},enabled:!!t?.id})},Ti=()=>De({queryKey:["all-crops-agent"],queryFn:async()=>{const{data:t,error:s}=await W.from("crops").select(`
          *,
          farmer:profiles!crops_farmer_id_fkey(full_name, village, district),
          farmland:farmlands(name, village)
        `).order("harvest_estimate",{ascending:!0});if(s)throw s;return t}}),pu=()=>De({queryKey:["all-transport-requests"],queryFn:async()=>{const{data:t,error:s}=await W.from("transport_requests").select(`
          *,
          crop:crops(crop_name, farmer_id),
          farmer:profiles!transport_requests_farmer_id_fkey(full_name, village)
        `).order("preferred_date",{ascending:!0});if(s)throw s;return t}}),Pi=()=>{const t=Xe();return dt({mutationFn:async({taskId:s,status:r,notes:a})=>{const{data:n,error:i}=await W.functions.invoke("agent-update-task-status",{body:{task_id:s,status:r,notes:a||null}});if(i)throw i;if(n?.error)throw new Error(n.error)},onSuccess:()=>{t.invalidateQueries({queryKey:["agent-tasks"]}),t.invalidateQueries({queryKey:["today-tasks"]}),ce.success("Task updated successfully")},onError:s=>{ce.error("Failed to update task"),console.error(s)}})},Ov=()=>{const t=Xe();return dt({mutationFn:async s=>{const{data:r,error:a}=await W.functions.invoke("agent-create-task",{body:{farmer_id:s.farmer_id,crop_id:s.crop_id||null,task_type:s.task_type,due_date:s.due_date,notes:s.notes||null}});if(a)throw a;if(r?.error)throw new Error(r.error)},onSuccess:()=>{t.invalidateQueries({queryKey:["agent-tasks"]}),t.invalidateQueries({queryKey:["today-tasks"]}),ce.success("Task created successfully")},onError:s=>{ce.error("Failed to create task"),console.error(s)}})},M4=()=>{const{user:t}=Fe();return dt({mutationFn:async s=>{const{data:{session:r}}=await W.auth.getSession();if(!r)throw new Error("Not authenticated");const a=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/ai-gateway/agent-ai",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({type:"visit_prioritization",context:{tasks:s.map(i=>({id:i.id,farmer:i.farmer?.full_name||"Unknown",village:i.farmer?.village||"Unknown",taskType:i.task_type,cropName:i.crop?.crop_name||"N/A",cropStatus:i.crop?.status||"N/A",harvestEstimate:i.crop?.harvest_estimate||"N/A",estimatedQuantity:i.crop?.estimated_quantity||0}))}})}),n=await a.json();if(!a.ok)throw new Error(n?.error?.message||"Function error");return await W.from("ai_agent_logs").insert({agent_id:t?.id,log_type:"visit_prioritization",input_context:{taskCount:s.length},output_text:n.result}),n.result}})},R4=()=>{const{user:t}=Fe();return dt({mutationFn:async s=>{const{data:{session:r}}=await W.auth.getSession();if(!r)throw new Error("Not authenticated");const a=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/ai-gateway/agent-ai",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({type:"cluster_summary",context:{clusterData:s}})}),n=await a.json();if(!a.ok)throw new Error(n?.error?.message||"Function error");return await W.from("ai_agent_logs").insert({agent_id:t?.id,log_type:"cluster_summary",input_context:s,output_text:n.result}),n.result}})},D4=()=>{const{user:t}=Fe();return De({queryKey:["ai-logs",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("ai_agent_logs").select("*").eq("agent_id",t.id).order("created_at",{ascending:!1}).limit(10);if(r)throw r;return s},enabled:!!t?.id})},E4=()=>De({queryKey:["agent-dashboard-stats"],queryFn:async()=>{const t=await Yt("agent_dashboard_v1");return{farmersAssigned:Number(t?.assigned_farmers_count||0),activeCrops:Number(t?.active_crops||0),tasksToday:Number(t?.pending_tasks_count||0),tasksCompleted:0,cropsReadyToHarvest:Number((t?.tasks_top10||[]).length||0),pendingTransportRequests:Number(t?.pending_tasks_count||0)}}}),I4=()=>{const t=E4(),s=[{title:"Farmers Assigned",value:t.farmersAssigned,icon:Cs,color:"text-blue-600",bgColor:"bg-blue-50"},{title:"Active Crops",value:t.activeCrops,icon:ts,color:"text-green-600",bgColor:"bg-green-50"},{title:"Tasks Today",value:`${t.tasksCompleted}/${t.tasksToday}`,icon:us,color:"text-purple-600",bgColor:"bg-purple-50"},{title:"Ready to Harvest",value:t.cropsReadyToHarvest,icon:ks,color:"text-amber-600",bgColor:"bg-amber-50"},{title:"Pending Transport",value:t.pendingTransportRequests,icon:rt,color:"text-red-600",bgColor:"bg-red-50"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:s.map(r=>e.jsx(G,{className:"hover:shadow-md transition-shadow",children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground font-medium",children:r.title}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:r.value})]}),e.jsx("div",{className:`h-10 w-10 rounded-full ${r.bgColor} flex items-center justify-center`,children:e.jsx(r.icon,{className:`h-5 w-5 ${r.color}`})})]})})},r.title))})},O4={visit:"Farm Visit",verify_crop:"Verify Crop",harvest_check:"Harvest Check",transport_assist:"Transport Assist"},F4={pending:"bg-amber-100 text-amber-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"},L4=()=>{const{data:t,isLoading:s}=Iv(),r=Pi(),a=Ut(),n=i=>{let o;if(i.task_status==="pending")o="in_progress";else if(i.task_status==="in_progress")o="completed";else return;r.mutate({taskId:i.id,status:o})};return s?e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5"}),"Today's Tasks"]})}),e.jsx(Q,{className:"space-y-3",children:[1,2,3].map(i=>e.jsx(Re,{className:"h-20 w-full"},i))})]}):e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(us,{className:"h-5 w-5 text-primary"}),"Today's Tasks"]}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>a("/agent/tasks"),children:["View All ",e.jsx(Wa,{className:"h-4 w-4 ml-1"})]})]})}),e.jsx(Q,{children:!t||t.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(us,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No tasks scheduled for today"})]}):e.jsx("div",{className:"space-y-3",children:t.slice(0,5).map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium truncate",children:i.farmer?.full_name||"Unknown Farmer"}),e.jsx(he,{variant:"outline",className:"text-xs",children:O4[i.task_type]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),i.farmer?.village||"Unknown"]}),i.crop&&e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded",children:i.crop.crop_name})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{className:F4[i.task_status],children:[i.task_status==="pending"&&e.jsx(vs,{className:"h-3 w-3 mr-1"}),i.task_status==="in_progress"&&e.jsx(aa,{className:"h-3 w-3 mr-1"}),i.task_status==="completed"&&e.jsx(ys,{className:"h-3 w-3 mr-1"}),i.task_status.replace("_"," ")]}),i.task_status!=="completed"&&e.jsx(z,{size:"sm",variant:"outline",onClick:()=>n(i),disabled:r.isPending,children:i.task_status==="pending"?"Start":"Complete"})]})]},i.id))})})]})},q4=()=>{const{data:t,isLoading:s}=Ti(),r=new Date,a=t?.filter(n=>{if(!n.harvest_estimate||n.status==="harvested")return!1;const i=ss(n.harvest_estimate),o=wm(i,r);return o>=0&&o<=14}).map(n=>({...n,daysToHarvest:wm(ss(n.harvest_estimate),r)})).sort((n,i)=>n.daysToHarvest-i.daysToHarvest).slice(0,5);return s?e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(za,{className:"h-5 w-5"}),"Crops Near Harvest"]})}),e.jsx(Q,{className:"space-y-3",children:[1,2,3].map(n=>e.jsx(Re,{className:"h-16 w-full"},n))})]}):e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(za,{className:"h-5 w-5 text-amber-600"}),"Crops Near Harvest"]})}),e.jsx(Q,{children:!a||a.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(za,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No crops near harvest"})]}):e.jsx("div",{className:"space-y-3",children:a.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",children:n.crop_name}),e.jsx(he,{variant:"outline",className:n.status==="ready"?"bg-green-100 text-green-800 border-green-300":n.status==="one_week"?"bg-amber-100 text-amber-800 border-amber-300":"bg-gray-100 text-gray-800",children:n.status==="ready"?"Ready":n.status==="one_week"?"1 Week":"Growing"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx("span",{children:n.farmer?.full_name||"Unknown"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),n.farmer?.village||"Unknown"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold ${n.daysToHarvest<=3?"text-red-600":n.daysToHarvest<=7?"text-amber-600":"text-green-600"}`,children:n.daysToHarvest===0?"Today":`${n.daysToHarvest}d`}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(ms,{className:"h-3 w-3"}),"to harvest"]})]})]},n.id))})})]})},z4={requested:"bg-amber-100 text-amber-800",assigned:"bg-blue-100 text-blue-800",en_route:"bg-purple-100 text-purple-800",picked_up:"bg-indigo-100 text-indigo-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"},B4=()=>{const{data:t,isLoading:s}=pu(),r=Ut(),a=t?.filter(n=>n.status==="requested"||n.status==="assigned").slice(0,4);return s?e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-5 w-5"}),"Pending Transport"]})}),e.jsx(Q,{className:"space-y-3",children:[1,2,3].map(n=>e.jsx(Re,{className:"h-16 w-full"},n))})]}):e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(rt,{className:"h-5 w-5 text-red-600"}),"Pending Transport"]}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>r("/agent/transport"),children:["View All ",e.jsx(Wa,{className:"h-4 w-4 ml-1"})]})]})}),e.jsx(Q,{children:!a||a.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(rt,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No pending transport requests"})]}):e.jsx("div",{className:"space-y-3",children:a.map(n=>e.jsxs("div",{className:"p-3 rounded-lg border hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:n.farmer?.full_name||"Unknown Farmer"}),e.jsx(he,{className:z4[n.status],children:n.status})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qt,{className:"h-3 w-3"}),n.crop?.crop_name||"N/A"," - ",n.quantity," ",n.quantity_unit]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),n.pickup_village||n.pickup_location]}),n.preferred_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"h-3 w-3"}),tt(ss(n.preferred_date),"MMM d")]})]})]},n.id))})})]})},$4=()=>{const[t,s]=x.useState(null),[r,a]=x.useState(null),[n,i]=x.useState(!1),{data:o}=Iv(),{data:c}=Ti(),{data:l}=pu(),{data:u}=D4(),d=M4(),p=R4(),h=async()=>{if(!o||o.length===0){ce.error("No tasks to prioritize");return}try{const y=await d.mutateAsync(o);s(y),ce.success("AI prioritization complete")}catch{ce.error("Failed to get AI suggestions")}},f=async()=>{const y={totalFarmers:new Set(c?.map(v=>v.farmer_id)||[]).size,totalCrops:c?.length||0,cropsByStatus:{growing:c?.filter(v=>v.status==="growing").length||0,one_week:c?.filter(v=>v.status==="one_week").length||0,ready:c?.filter(v=>v.status==="ready").length||0,harvested:c?.filter(v=>v.status==="harvested").length||0},pendingTransports:l?.filter(v=>v.status==="requested").length||0,assignedTransports:l?.filter(v=>v.status==="assigned").length||0,topCrops:c?.reduce((v,b)=>(v[b.crop_name]=(v[b.crop_name]||0)+1,v),{})||{}};try{const v=await p.mutateAsync(y);a(v),ce.success("AI analysis complete")}catch{ce.error("Failed to generate summary")}};return e.jsxs(G,{className:"lg:col-span-2",children:[e.jsx(je,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Js,{className:"h-5 w-5 text-purple-600"}),"AI Insights"]}),e.jsx(he,{variant:"secondary",className:"bg-purple-100 text-purple-800",children:"Powered by AI"})]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(z,{onClick:h,disabled:d.isPending,className:"bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700",children:[d.isPending?e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(am,{className:"h-4 w-4 mr-2"}),"Prioritize Today's Visits"]}),e.jsxs(z,{onClick:f,disabled:p.isPending,variant:"outline",className:"border-purple-300 text-purple-700 hover:bg-purple-50",children:[p.isPending?e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(wo,{className:"h-4 w-4 mr-2"}),"Generate Cluster Summary"]})]}),t&&e.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200",children:[e.jsxs("h4",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[e.jsx(am,{className:"h-4 w-4"}),"AI Suggested Visit Order"]}),e.jsx(Cn,{className:"h-48",children:e.jsx("div",{className:"text-sm whitespace-pre-wrap text-gray-700",children:t})})]}),r&&e.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200",children:[e.jsxs("h4",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx(wo,{className:"h-4 w-4"}),"Cluster Analysis"]}),e.jsx(Cn,{className:"h-48",children:e.jsx("div",{className:"text-sm whitespace-pre-wrap text-gray-700",children:r})})]}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>i(!n),className:"w-full text-muted-foreground",children:[e.jsx(Mj,{className:"h-4 w-4 mr-2"}),"Recent AI Insights",n?e.jsx(ld,{className:"h-4 w-4 ml-2"}):e.jsx(qr,{className:"h-4 w-4 ml-2"})]}),n&&u&&u.length>0&&e.jsx("div",{className:"space-y-2",children:u.slice(0,5).map(y=>e.jsxs("div",{className:"p-3 rounded-lg border text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(he,{variant:"outline",className:"text-xs",children:y.log_type.replace("_"," ")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Er(ss(y.created_at),{addSuffix:!0})})]}),e.jsxs("p",{className:"text-muted-foreground line-clamp-2",children:[y.output_text?.substring(0,100),"..."]})]},y.id))})]})]})},U4=()=>{const{t}=Nt();return e.jsx(Oe,{title:t("agent.dashboard"),children:e.jsxs($s,{title:t("agent.dashboard"),subtitle:t("agent.assignedFarmers"),children:[e.jsx(I4,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx(L4,{}),e.jsx(q4,{})]}),e.jsx($4,{}),e.jsx(B4,{})]})})},Os=x.forwardRef(({className:t,...s},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:ke("w-full caption-bottom text-sm",t),...s})}));Os.displayName="Table";const Fs=x.forwardRef(({className:t,...s},r)=>e.jsx("thead",{ref:r,className:ke("[&_tr]:border-b",t),...s}));Fs.displayName="TableHeader";const Ls=x.forwardRef(({className:t,...s},r)=>e.jsx("tbody",{ref:r,className:ke("[&_tr:last-child]:border-0",t),...s}));Ls.displayName="TableBody";const H4=x.forwardRef(({className:t,...s},r)=>e.jsx("tfoot",{ref:r,className:ke("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s}));H4.displayName="TableFooter";const mt=x.forwardRef(({className:t,...s},r)=>e.jsx("tr",{ref:r,className:ke("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",t),...s}));mt.displayName="TableRow";const Se=x.forwardRef(({className:t,...s},r)=>e.jsx("th",{ref:r,className:ke("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s}));Se.displayName="TableHead";const be=x.forwardRef(({className:t,...s},r)=>e.jsx("td",{ref:r,className:ke("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s}));be.displayName="TableCell";const V4=x.forwardRef(({className:t,...s},r)=>e.jsx("caption",{ref:r,className:ke("mt-4 text-sm text-muted-foreground",t),...s}));V4.displayName="TableCaption";const Xm=3e4,K4=({farmerId:t,taskId:s,cropId:r,triggerButton:a,onNoteSaved:n})=>{const[i,o]=x.useState(!1),[c,l]=x.useState(""),[u,d]=x.useState("en-IN"),[p,h]=x.useState(!1),[f,y]=x.useState(!1),[v,b]=x.useState(null),[N,A]=x.useState(0),j=x.useRef(null),C=x.useRef([]),I=x.useRef(null),k=x.useRef(null),R=x.useCallback(async()=>{try{const F=await navigator.mediaDevices.getUserMedia({audio:!0}),H=new MediaRecorder(F,{mimeType:"audio/webm"});j.current=H,C.current=[],H.ondataavailable=q=>{q.data.size>0&&C.current.push(q.data)},H.onstop=()=>{const q=new Blob(C.current,{type:"audio/webm"});b(q),F.getTracks().forEach(B=>B.stop())},H.start(1e3),h(!0),A(0),k.current=setInterval(()=>{A(q=>q+1)},1e3),I.current=setTimeout(()=>{S()},Xm)}catch(F){console.error("Recording error:",F),ce.error("Could not start recording. Please check microphone permissions.")}},[]),S=x.useCallback(()=>{I.current&&clearTimeout(I.current),k.current&&clearInterval(k.current),j.current&&p&&j.current.stop(),h(!1)},[p]),T=async()=>{if(!c.trim()&&!v){ce.error("Please add a note or recording");return}y(!0);try{const{data:{session:F}}=await W.auth.getSession();if(!F)throw new Error("Not authenticated");let H=null;if(v){const L=await v.arrayBuffer(),P=new Uint8Array(L);let K="";for(let $=0;$<P.byteLength;$++)K+=String.fromCharCode(P[$]);H=btoa(K)}const B=await(await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/save-agent-voice-note",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${F.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({farmer_id:t||null,task_id:s||null,crop_id:r||null,language_code:u,note_text:c.trim()||null,audio_base64:H})})).json();if(!B.success)throw new Error(B.error||"Failed to save note");ce.success("Voice note saved!"),o(!1),l(""),b(null),A(0),n?.()}catch(F){console.error("Save error:",F),ce.error(F.message||"Failed to save note")}finally{y(!1)}},E=()=>{p&&S(),o(!1),l(""),b(null),A(0)},D=F=>{const H=Math.floor(F/60),q=F%60;return`${H}:${q.toString().padStart(2,"0")}`};return e.jsxs(zt,{open:i,onOpenChange:F=>F?o(!0):E(),children:[e.jsx(Wr,{asChild:!0,children:a||e.jsxs(z,{variant:"outline",size:"sm",children:[e.jsx(pn,{className:"h-4 w-4 mr-2"}),"Voice Note"]})}),e.jsxs(It,{className:"sm:max-w-md",children:[e.jsxs(Bt,{children:[e.jsxs($t,{className:"flex items-center gap-2",children:[e.jsx(pn,{className:"h-5 w-5"}),"Add Voice Note"]}),e.jsx(Ks,{children:"Record a voice note or type your observations"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(ie,{className:"flex items-center gap-2",children:[e.jsx(ap,{className:"h-4 w-4"}),"Language"]}),e.jsxs(lt,{value:u,onValueChange:F=>d(F),disabled:p,children:[e.jsx(it,{className:"w-32",children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"en-IN",children:"English"}),e.jsx(ge,{value:"hi-IN",children:"Hindi"}),e.jsx(ge,{value:"kn-IN",children:"Kannada"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 py-4",children:[e.jsx(z,{variant:p?"destructive":"default",size:"lg",className:"h-16 w-16 rounded-full",onClick:p?S:R,disabled:f,children:p?e.jsx(ip,{className:"h-6 w-6"}):e.jsx(Xo,{className:"h-6 w-6"})}),p&&e.jsxs(he,{variant:"destructive",className:"animate-pulse",children:["Recording ",D(N)]}),v&&!p&&e.jsxs(he,{variant:"secondary",children:["Recording saved (",D(N),")"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p?`Max ${Xm/1e3} seconds`:"Tap to start recording"})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"note-text",children:"Note Text"}),e.jsx(zs,{id:"note-text",value:c,onChange:F=>l(F.target.value),placeholder:"Type or speak your observations...",className:"mt-1.5 min-h-[100px]",disabled:p||f})]}),(t||s||r)&&e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t&&e.jsx(he,{variant:"outline",children:"Farmer linked"}),s&&e.jsx(he,{variant:"outline",children:"Task linked"}),r&&e.jsx(he,{variant:"outline",children:"Crop linked"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(z,{variant:"outline",onClick:E,disabled:f,children:"Cancel"}),e.jsx(z,{onClick:T,disabled:f||!c.trim()&&!v,children:f?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Note"})]})]})]})]})};function W4(t){return new Promise(s=>setTimeout(s,t))}const Fv=8,ho=[60*1e3,5*60*1e3,15*60*1e3,60*60*1e3,6*60*60*1e3,24*60*60*1e3],di=new EventTarget;async function Y4(t){try{if(await Ts.actions.update(t.id,{status:"running",updatedAt:Date.now()}),t.type==="rpc"){const s={...t.payload||{},idempotency_key:t.idempotencyKey};await Bs(t.name,s)}else await Bs(t.name,t.payload||{});await Ts.actions.delete(t.id),di.dispatchEvent(new CustomEvent("synced",{detail:t}))}catch(s){const r=(t.retryCount||0)+1,a=t.maxRetries||Fv;let n=null;if(r>a){await Ts.actions.update(t.id,{status:"dead",retryCount:r,lastError:String(s?.message||s),updatedAt:Date.now()}),di.dispatchEvent(new CustomEvent("dead",{detail:t}));return}else{const i=ho[Math.min(r-1,ho.length-1)]||ho[ho.length-1],o=Math.floor(Math.random()*400)+200;n=Date.now()+i+o,await Ts.actions.update(t.id,{status:"failed",retryCount:r,lastError:String(s?.message||s),nextRunAt:n,updatedAt:Date.now()}),di.dispatchEvent(new CustomEvent("retry",{detail:{action:t,nextRun:n}}))}}}let gc=!1;async function fu(){if(Ua()&&!gc){gc=!0;try{const t=Date.now(),s=await Ts.actions.orderBy("createdAt").filter(r=>!r.nextRunAt||r.nextRunAt<=t).toArray();for(const r of s){await Y4(r);const a=Math.floor(Math.random()*400)+200;if(await W4(1e3+a),!Ua())break}}finally{gc=!1}}}async function G4(t){const s=t.id||crypto.randomUUID(),r=Date.now(),a={id:s,type:t.type,name:t.name,payload:t.payload,idempotencyKey:t.idempotencyKey,createdAt:r,updatedAt:r,status:"queued",retryCount:0,maxRetries:t.maxRetries||Fv,nextRunAt:t.nextRunAt||null,lastError:null,scope:t.scope||null,entityType:t.entityType||null,entityId:t.entityId||null};return await Ts.actions.put(a),di.dispatchEvent(new CustomEvent("enqueue",{detail:a})),Ua()&&fu().catch(()=>{}),s}Md(t=>{t&&fu().catch(()=>{})});const Jm={enqueueAction:G4,processQueueOnce:fu,actionEvents:di},Q4={visit:"Farm Visit",verify_crop:"Verify Crop",harvest_check:"Harvest Check",transport_assist:"Transport Assist"},X4={pending:"bg-amber-100 text-amber-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"},J4=()=>{const{data:t,isLoading:s,fetchNextPage:r,hasNextPage:a,isFetchingNextPage:n}=useAgentTasksInfinite(),{t:i}=Nt(),o=t?t.pages.flatMap(T=>T.items||[]):[],c=s,{data:l}=hu(),{data:u}=Ti(),d=Pi(),p=Ov(),[h,f]=x.useState("all"),[y,v]=x.useState(""),[b,N]=x.useState(!1),[A,j]=x.useState(null),[C,I]=x.useState({farmer_id:"",crop_id:"",task_type:"visit",due_date:new Date().toISOString().split("T")[0],notes:""}),k=o?.filter(T=>{const E=h==="all"||T.task_status===h,D=T.farmer?.full_name?.toLowerCase().includes(y.toLowerCase())||T.farmer?.village?.toLowerCase().includes(y.toLowerCase())||T.crop?.crop_name?.toLowerCase().includes(y.toLowerCase());return E&&(y===""||D)}),R=()=>{if(!C.farmer_id){ce.error("Please select a farmer");return}p.mutate({farmer_id:C.farmer_id,crop_id:C.crop_id||null,task_type:C.task_type,due_date:C.due_date,notes:C.notes},{onSuccess:()=>{N(!1),I({farmer_id:"",crop_id:"",task_type:"visit",due_date:new Date().toISOString().split("T")[0],notes:""})}})},S=(T,E)=>{if(!Ao.isOnline()){const D=crypto.randomUUID();Jm.enqueueAction({id:crypto.randomUUID(),type:"rpc",name:"agent.update_task_status_v1",payload:{task_id:T.id,status:E},idempotencyKey:D,createdAt:Date.now(),updatedAt:Date.now(),status:"queued",retryCount:0,maxRetries:8,nextRunAt:null,scope:"agent",entityType:"agent_task",entityId:T.id}),ce.success("Saved locally  will sync when online");return}d.mutate({taskId:T.id,status:E},{onError:D=>{if(String(D?.message||"").toLowerCase().includes("network")||String(D?.message||"").toLowerCase().includes("failed to fetch")){const F=crypto.randomUUID();Jm.enqueueAction({id:crypto.randomUUID(),type:"rpc",name:"agent.update_task_status_v1",payload:{task_id:T.id,status:E},idempotencyKey:F,createdAt:Date.now(),updatedAt:Date.now(),status:"queued",retryCount:0,maxRetries:8,nextRunAt:null,scope:"agent",entityType:"agent_task",entityId:T.id}),ce.success("Saved locally  will sync when online")}}})};return e.jsx(Oe,{title:"Tasks",children:e.jsxs($s,{title:"My Tasks",subtitle:"Manage your field visit tasks",actions:e.jsxs(zt,{open:b,onOpenChange:N,children:[e.jsx(Wr,{asChild:!0,children:e.jsxs(z,{variant:"default",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"New Task"]})}),e.jsxs(It,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Create New Task"}),e.jsx(Ks,{children:"Schedule a new field visit or task"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:"Farmer *"}),e.jsxs(lt,{value:C.farmer_id,onValueChange:T=>I({...C,farmer_id:T}),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:"Select farmer"})}),e.jsx(ot,{children:l?.map(T=>e.jsxs(ge,{value:T.id,children:[T.full_name||"Unknown"," - ",T.village||"N/A"]},T.id))})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Crop (Optional)"}),e.jsxs(lt,{value:C.crop_id,onValueChange:T=>I({...C,crop_id:T==="__none__"?"":T}),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:"Select crop"})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"__none__",children:"None"}),u?.filter(T=>T.farmer_id===C.farmer_id).map(T=>e.jsxs(ge,{value:T.id,children:[T.crop_name," - ",T.status]},T.id))]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Task Type"}),e.jsxs(lt,{value:C.task_type,onValueChange:T=>I({...C,task_type:T}),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"visit",children:"Farm Visit"}),e.jsx(ge,{value:"verify_crop",children:"Verify Crop"}),e.jsx(ge,{value:"harvest_check",children:"Harvest Check"}),e.jsx(ge,{value:"transport_assist",children:"Transport Assist"})]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Due Date"}),e.jsx(Ce,{type:"date",value:C.due_date,onChange:T=>I({...C,due_date:T.target.value})})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Notes"}),e.jsx(zs,{value:C.notes,onChange:T=>I({...C,notes:T.target.value}),placeholder:"Add any notes..."})]}),e.jsx(z,{onClick:R,disabled:p.isPending,className:"w-full",variant:"default",children:p.isPending?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Create Task"})]})]})]}),children:[e.jsx(G,{children:e.jsx(Q,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search by farmer, village, or crop...",value:y,onChange:T=>v(T.target.value),className:"pl-9"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","in_progress","completed"].map(T=>e.jsx(z,{variant:h===T?"default":"outline",size:"sm",onClick:()=>f(T),children:T==="all"?"All":T.replace("_"," ")},T))})]})})}),e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:e.jsxs(xr,{loading:c,empty:!c&&(!k||k.length===0),emptyTitle:"No tasks found",children:[e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Farmer"}),e.jsx(Se,{children:"Village"}),e.jsx(Se,{children:"Crop"}),e.jsx(Se,{children:"Task Type"}),e.jsx(Se,{children:"Due Date"}),e.jsx(Se,{children:"Status"}),e.jsx(Se,{children:"Actions"})]})}),e.jsx(Ls,{children:k?.length===0?e.jsx(mt,{children:e.jsxs(be,{colSpan:7,className:"text-center py-12",children:[e.jsx(us,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No tasks found"})]})}):k?.map(T=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:T.farmer?.full_name||"Unknown"}),e.jsx(be,{children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),T.farmer?.village||"N/A"]})}),e.jsx(be,{children:T.crop?e.jsx(he,{variant:"outline",className:"bg-green-50",children:T.crop.crop_name}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(be,{children:Q4[T.task_type]}),e.jsx(be,{children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"h-3 w-3"}),tt(ss(T.due_date),"MMM d, yyyy")]})}),e.jsx(be,{children:e.jsxs(he,{className:X4[T.task_status],children:[T.task_status==="pending"&&e.jsx(vs,{className:"h-3 w-3 mr-1"}),T.task_status==="in_progress"&&e.jsx(aa,{className:"h-3 w-3 mr-1"}),T.task_status==="completed"&&e.jsx(ys,{className:"h-3 w-3 mr-1"}),T.task_status.replace("_"," ")]})}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[T.task_status==="pending"&&e.jsx(z,{size:"sm",variant:"outline",onClick:()=>S(T,"in_progress"),children:"Start"}),T.task_status==="in_progress"&&e.jsx(z,{size:"sm",variant:"default",onClick:()=>S(T,"completed"),children:"Complete"}),T.task_status==="completed"&&e.jsx("span",{className:"text-sm text-green-600",children:"Done"}),e.jsx(K4,{farmerId:T.farmer_id,taskId:T.id,cropId:T.crop_id,triggerButton:e.jsx(z,{"aria-label":"Add voice note",variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(pn,{className:"h-4 w-4"})})})]})})]},T.id))})]}),e.jsx("div",{className:"p-4 text-center",children:a?e.jsx(z,{variant:"outline",onClick:()=>r(),disabled:n,children:i(n?"common.loading":"common.loadMore")}):e.jsx("div",{className:"text-sm text-muted-foreground",children:i("common.noMoreItems")})})]})})})]})})},Z4=()=>{const{user:t}=Fe(),{language:s}=Nt(),{data:r,isLoading:a}=hu(),{data:n}=Ti(),i=cC(),[o,c]=x.useState(""),[l,u]=x.useState("unassigned"),[d,p]=x.useState("all"),h=x.useMemo(()=>{const j=new Set;return r?.forEach(C=>{C.village&&j.add(C.village)}),Array.from(j).sort()},[r]),f=x.useMemo(()=>{let j=r||[];if(l==="unassigned"?j=j.filter(C=>!C.assigned_agent_id):l==="mine"&&(j=j.filter(C=>C.is_assigned_to_me)),o){const C=o.toLowerCase();j=j.filter(I=>I.full_name?.toLowerCase().includes(C)||I.village?.toLowerCase().includes(C)||I.phone?.includes(C))}return d!=="all"&&(j=j.filter(C=>C.village===d)),j},[r,l,o,d]),y=j=>n?.filter(C=>C.farmer_id===j).length||0,v=j=>{t?.id&&i.mutate({farmerId:j,agentId:t.id},{onSuccess:()=>{ce.success(s==="kn"?"  ":"Farmer assigned to you successfully")}})},b=j=>j.is_assigned_to_me?e.jsxs(he,{className:"bg-green-100 text-green-800 flex items-center gap-1",children:[e.jsx(om,{className:"h-3 w-3"}),s==="kn"?"":"Yours"]}):j.is_assigned_to_other?e.jsx(he,{variant:"secondary",className:"opacity-60",children:s==="kn"?"":"Other Agent"}):e.jsx(he,{variant:"outline",className:"text-muted-foreground",children:s==="kn"?"":"Unassigned"}),N=r?.filter(j=>!j.assigned_agent_id).length||0,A=r?.filter(j=>j.is_assigned_to_me).length||0;return e.jsx(Oe,{title:s==="kn"?" ":"Farmer Directory",children:e.jsx($s,{title:s==="kn"?" ":"Farmer Directory",subtitle:s==="kn"?"     ":"Find and assign farmers in your district",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:s==="kn"?", ,  ...":"Search by name, village, phone...",value:o,onChange:j=>c(j.target.value),className:"pl-9"})]}),e.jsxs(lt,{value:d,onValueChange:p,children:[e.jsx(it,{className:"w-[180px]",children:e.jsx(ct,{placeholder:s==="kn"?" ":"All Villages"})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"all",children:s==="kn"?" ":"All Villages"}),h.map(j=>e.jsx(ge,{value:j,children:j},j))]})]})]}),e.jsxs(zn,{value:l,onValueChange:u,children:[e.jsxs(Ja,{children:[e.jsxs(Vs,{value:"unassigned",className:"flex items-center gap-2",children:[e.jsx(Cc,{className:"h-4 w-4"}),s==="kn"?"":"Unassigned"," (",N,")"]}),e.jsxs(Vs,{value:"mine",className:"flex items-center gap-2",children:[e.jsx(om,{className:"h-4 w-4"}),s==="kn"?"":"Assigned to Me"," (",A,")"]}),e.jsxs(Vs,{value:"all",className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-4 w-4"}),s==="kn"?"":"All"," (",r?.length||0,")"]})]}),e.jsx(ga,{value:l,className:"mt-4",children:e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:a?e.jsx("div",{className:"p-6 space-y-4",children:[1,2,3,4,5].map(j=>e.jsx(Re,{className:"h-16 w-full"},j))}):e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:s==="kn"?"":"Name"}),e.jsx(Se,{children:s==="kn"?"":"Village"}),e.jsx(Se,{className:"hidden sm:table-cell",children:s==="kn"?"":"Phone"}),e.jsx(Se,{className:"hidden md:table-cell",children:s==="kn"?"":"Crops"}),e.jsx(Se,{children:s==="kn"?"":"Status"}),e.jsx(Se,{children:s==="kn"?"":"Action"})]})}),e.jsx(Ls,{children:f.length===0?e.jsx(mt,{children:e.jsx(be,{colSpan:6,className:"p-0",children:e.jsx(nr,{icon:Cs,title:s==="kn"?"  ":"No farmers found",description:s==="kn"?"  ":"No farmers found for your filters."})})}):f.map(j=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:j.full_name||(s==="kn"?"":"Unknown")}),e.jsx(be,{children:e.jsxs("span",{className:"flex items-center gap-1 text-sm",children:[e.jsx(We,{className:"h-3 w-3"}),j.village||"N/A"]})}),e.jsx(be,{className:"hidden sm:table-cell",children:j.phone?e.jsxs("a",{href:`tel:${j.phone}`,className:"flex items-center gap-1 text-sm text-primary hover:underline",children:[e.jsx(hr,{className:"h-3 w-3"}),j.phone]}):"-"}),e.jsx(be,{className:"hidden md:table-cell",children:e.jsxs(he,{variant:"secondary",className:"flex items-center gap-1 w-fit",children:[e.jsx(ts,{className:"h-3 w-3"}),y(j.id)]})}),e.jsx(be,{children:b(j)}),e.jsx(be,{children:j.assigned_agent_id?j.is_assigned_to_me?e.jsxs(he,{className:"bg-green-100 text-green-800",children:[e.jsx(ys,{className:"h-3 w-3 mr-1"}),s==="kn"?"":"Assigned"]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:""}):e.jsx(z,{size:"sm",onClick:()=>v(j.id),disabled:i.isPending,children:i.isPending?e.jsx(et,{className:"h-3 w-3 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Cc,{className:"h-3 w-3 mr-1"}),s==="kn"?"":"Assign"]})})})]},j.id))})]})})})})]})]})})})};function e3(){const{language:t}=Nt(),s=Ut(),{data:r,isLoading:a}=nC(),n=eu(),{data:i}=tu(),[o,c]=x.useState(""),l=r?.filter(d=>d.full_name?.toLowerCase().includes(o.toLowerCase())||d.village?.toLowerCase().includes(o.toLowerCase())||d.district?.toLowerCase().includes(o.toLowerCase())),u=d=>{if(i){ce.error(t==="kn"?"    ":"Please end your current visit first");return}n.mutate({farmerId:d})};return e.jsx(Oe,{title:t==="kn"?" ":"My Farmers",children:e.jsx($s,{title:t==="kn"?" ":"My Farmers",subtitle:t==="kn"?"  ":"Farmers assigned to you",children:e.jsxs("div",{className:"space-y-6",children:[i&&e.jsx(G,{className:"border-primary bg-primary/5",children:e.jsxs(Q,{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"font-medium",children:t==="kn"?" ":"Active Visit"})]}),e.jsx(z,{size:"sm",variant:"outline",onClick:()=>s(`/agent/visit/${i.id}`),children:t==="kn"?"":"View"})]})}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:t==="kn"?", ,  ...":"Search by name, village, district...",value:o,onChange:d=>c(d.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(G,{children:e.jsxs(Q,{className:"pt-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:r?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t==="kn"?" ":"Total Farmers"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r?.reduce((d,p)=>d+(p.ready_crops_count||0),0)||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t==="kn"?" ":"Ready to Harvest"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r?.reduce((d,p)=>d+(p.crops_count||0),0)||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t==="kn"?" ":"Active Crops"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-4",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:r?.reduce((d,p)=>d+(p.pending_transport_count||0),0)||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t==="kn"?" ":"Pending Transport"})]})})]}),e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:a?e.jsx("div",{className:"p-6 space-y-4",children:[1,2,3,4,5].map(d=>e.jsx(Re,{className:"h-16 w-full"},d))}):e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:t==="kn"?"":"Name"}),e.jsx(Se,{children:t==="kn"?"":"Location"}),e.jsx(Se,{children:t==="kn"?"":"Phone"}),e.jsx(Se,{children:t==="kn"?"":"Crops"}),e.jsx(Se,{children:t==="kn"?"":"Transport"}),e.jsx(Se,{children:t==="kn"?"":"Actions"})]})}),e.jsx(Ls,{children:l?.length===0?e.jsx(mt,{children:e.jsx(be,{colSpan:6,className:"p-0",children:e.jsx(nr,{icon:Cs,title:t==="kn"?"  ":"No farmers found",description:t==="kn"?"   .":"No farmers assigned to you yet."})})}):l?.map(d=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:d.full_name||(t==="kn"?"":"Unknown")}),e.jsx(be,{children:e.jsxs("span",{className:"flex items-center gap-1 text-sm",children:[e.jsx(We,{className:"h-3 w-3"}),[d.village,d.district].filter(Boolean).join(", ")||"N/A"]})}),e.jsx(be,{children:d.phone?e.jsxs("a",{href:`tel:${d.phone}`,className:"flex items-center gap-1 text-sm text-primary hover:underline",children:[e.jsx(hr,{className:"h-3 w-3"}),d.phone]}):"-"}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(ts,{className:"h-3 w-3"}),d.crops_count||0]}),(d.ready_crops_count||0)>0&&e.jsxs(he,{className:"bg-green-100 text-green-800",children:[d.ready_crops_count," ",t==="kn"?"":"ready"]})]})}),e.jsx(be,{children:(d.pending_transport_count||0)>0?e.jsxs(he,{className:"bg-amber-100 text-amber-800 flex items-center gap-1 w-fit",children:[e.jsx(rt,{className:"h-3 w-3"}),d.pending_transport_count]}):"-"}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>s(`/agent/farmer/${d.id}`),children:[e.jsx(sa,{className:"h-3 w-3 mr-1"}),t==="kn"?"":"View"]}),e.jsxs(z,{size:"sm",onClick:()=>u(d.id),disabled:n.isPending||!!i,children:[e.jsx(aa,{className:"h-3 w-3 mr-1"}),t==="kn"?"":"Visit"]})]})})]},d.id))})]})})})]})})})}const t3=["phone","village","taluk","preferred_language","avatar_url"],s3=()=>{const{user:t}=Fe(),s=Xe();return dt({mutationFn:async({farmerId:r,updates:a})=>{if(!t?.id)throw new Error("Not authenticated");const n={};for(const[o,c]of Object.entries(a))t3.includes(o)&&(n[o]=c);if(Object.keys(n).length===0)throw new Error("No valid fields to update");const{error:i}=await W.from("profiles").update({...n,updated_at:new Date().toISOString()}).eq("id",r);if(i)throw i;return await W.from("agent_activity_logs").insert({actor_id:t.id,actor_role:"agent",farmer_id:r,action_type:"QUICK_UPDATE_SAFE_FIELDS",details:{fields_updated:Object.keys(n),new_values:n}}),n},onSuccess:(r,a)=>{s.invalidateQueries({queryKey:["agent-farmer-detail",a.farmerId]}),s.invalidateQueries({queryKey:["assigned-farmers"]}),s.invalidateQueries({queryKey:["all-farmers"]}),ce.success("Farmer profile updated")},onError:r=>{console.error("Quick update error:",r),ce.error("Failed to update farmer profile")}})},r3=()=>{const t=Xe();return dt({mutationFn:async({farmerId:s,proposedChanges:r,notes:a})=>{const{data:n,error:i}=await W.functions.invoke("agent-create-task",{body:{farmer_id:s,task_type:"update_profile",due_date:new Date().toISOString().split("T")[0],notes:a||"Profile update requiring approval",payload:r}});if(i)throw i;if(n?.error)throw new Error(n.error);return n.task},onSuccess:()=>{t.invalidateQueries({queryKey:["agent-tasks"]}),ce.success("Update request submitted for admin approval")},onError:s=>{console.error("Sensitive update error:",s),ce.error("Failed to create update request")}})};function a3({farmer:t}){const{language:s}=Nt(),r=s3(),a=r3(),[n,i]=x.useState(t.phone||""),[o,c]=x.useState(t.village||""),[l,u]=x.useState(t.taluk||""),[d,p]=x.useState(t.preferred_language||"en"),[h,f]=x.useState(String(t.total_land_area||""));x.useEffect(()=>{i(t.phone||""),c(t.village||""),u(t.taluk||""),p(t.preferred_language||"en"),f(String(t.total_land_area||""))},[t]);const y=()=>{const A={};n!==(t.phone||"")&&(A.phone=n||null),o!==(t.village||"")&&(A.village=o||null),l!==(t.taluk||"")&&(A.taluk=l||null),d!==(t.preferred_language||"en")&&(A.preferred_language=d),Object.keys(A).length!==0&&r.mutate({farmerId:t.id,updates:A})},v=()=>{const A={};h!==String(t.total_land_area||"")&&(A.total_land_area=parseFloat(h)||0),Object.keys(A).length!==0&&a.mutate({farmerId:t.id,proposedChanges:A,notes:`Land area change: ${t.total_land_area||0}  ${h}`})},b=n!==(t.phone||"")||o!==(t.village||"")||l!==(t.taluk||"")||d!==(t.preferred_language||"en"),N=h!==String(t.total_land_area||"");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(je,{className:"pb-3",children:[e.jsxs(we,{className:"text-base flex items-center gap-2",children:[e.jsx(gn,{className:"h-4 w-4 text-primary"}),s==="kn"?" ":"Quick Update"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s==="kn"?"   ":"These changes apply immediately"})]}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:s==="kn"?"":"Phone"}),e.jsx(Ce,{value:n,onChange:A=>i(A.target.value),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(ie,{children:s==="kn"?"":"Village"}),e.jsx(Ce,{value:o,onChange:A=>c(A.target.value),placeholder:"Village name"})]}),e.jsxs("div",{children:[e.jsx(ie,{children:s==="kn"?"":"Taluk"}),e.jsx(Ce,{value:l,onChange:A=>u(A.target.value),placeholder:"Taluk"})]}),e.jsxs("div",{children:[e.jsx(ie,{children:s==="kn"?"":"Language"}),e.jsxs(lt,{value:d,onValueChange:p,children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"en",children:"English"}),e.jsx(ge,{value:"kn",children:""})]})]})]})]}),e.jsxs(z,{onClick:y,disabled:!b||r.isPending,className:"w-full sm:w-auto",children:[r.isPending?e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(gn,{className:"h-4 w-4 mr-2"}),s==="kn"?"":"Save Changes"]})]})]}),e.jsxs(G,{className:"border-amber-200 dark:border-amber-800",children:[e.jsxs(je,{className:"pb-3",children:[e.jsxs(we,{className:"text-base flex items-center gap-2",children:[e.jsx(Hr,{className:"h-4 w-4 text-amber-600"}),s==="kn"?" ":"Requires Approval"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s==="kn"?"    ":"These changes need admin approval before applying"})]}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:s==="kn"?"  ()":"Total Land Area (acres)"}),e.jsx(Ce,{type:"number",value:h,onChange:A=>f(A.target.value),placeholder:"Acres"})]}),e.jsxs("div",{children:[e.jsx(ie,{children:s==="kn"?"":"District"}),e.jsx(Ce,{value:t.district||"",disabled:!0,className:"opacity-60"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s==="kn"?"   ":"District can only be changed by admin"})]})]}),e.jsxs(z,{variant:"outline",onClick:v,disabled:!N||a.isPending,className:"w-full sm:w-auto border-amber-300 text-amber-700 hover:bg-amber-50",children:[a.isPending?e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Hr,{className:"h-4 w-4 mr-2"}),s==="kn"?" ":"Submit for Approval"]})]})]})]})}const Zm=[{value:"visit",label:"Farm Visit",labelKn:""},{value:"verify_crop",label:"Crop Verification",labelKn:" "},{value:"harvest_check",label:"Harvest Check",labelKn:" "},{value:"transport_assist",label:"Transport Help",labelKn:" "},{value:"onboard_farmer",label:"Onboard Farmer",labelKn:" "},{value:"soil_report_upload",label:"Soil Report",labelKn:" "},{value:"field_visit",label:"Field Visit",labelKn:" "}],n3={pending:"bg-amber-100 text-amber-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",approved:"bg-emerald-100 text-emerald-800",rejected:"bg-red-100 text-red-800"};function i3({farmerId:t}){const{user:s}=Fe(),{language:r}=Nt(),a=Ov(),n=Pi(),[i,o]=x.useState(!1),[c,l]=x.useState({task_type:"visit",due_date:new Date().toISOString().split("T")[0],notes:""}),{data:u,isLoading:d}=De({queryKey:["farmer-tasks",t],queryFn:async()=>{if(!s?.id)return[];const{data:h,error:f}=await W.from("agent_tasks").select("*").eq("agent_id",s.id).eq("farmer_id",t).order("created_at",{ascending:!1});if(f)throw f;return h||[]},enabled:!!s?.id&&!!t}),p=()=>{a.mutate({farmer_id:t,task_type:c.task_type,due_date:c.due_date,notes:c.notes},{onSuccess:()=>{o(!1),l({task_type:"visit",due_date:new Date().toISOString().split("T")[0],notes:""})}})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(us,{className:"h-4 w-4"}),r==="kn"?"":"Tasks"]}),e.jsxs(zt,{open:i,onOpenChange:o,children:[e.jsx(Wr,{asChild:!0,children:e.jsxs(z,{size:"sm",children:[e.jsx(Ss,{className:"h-3 w-3 mr-1"}),r==="kn"?" ":"New Task"]})}),e.jsxs(It,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:r==="kn"?" ":"New Task"}),e.jsx(Ks,{children:r==="kn"?"   ":"Create a task for this farmer"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:r==="kn"?" ":"Task Type"}),e.jsxs(lt,{value:c.task_type,onValueChange:h=>l({...c,task_type:h}),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsx(ot,{children:Zm.map(h=>e.jsx(ge,{value:h.value,children:r==="kn"?h.labelKn:h.label},h.value))})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:r==="kn"?" ":"Due Date"}),e.jsx(Ce,{type:"date",value:c.due_date,onChange:h=>l({...c,due_date:h.target.value})})]}),e.jsxs("div",{children:[e.jsx(ie,{children:r==="kn"?"":"Notes"}),e.jsx(zs,{value:c.notes,onChange:h=>l({...c,notes:h.target.value}),placeholder:r==="kn"?" ...":"Add notes...",rows:3})]}),e.jsxs(z,{onClick:p,disabled:a.isPending,className:"w-full",children:[a.isPending?e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ss,{className:"h-4 w-4 mr-2"}),r==="kn"?"":"Create Task"]})]})]})]})]}),d?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(h=>e.jsx("div",{className:"h-20 bg-muted rounded-lg animate-pulse"},h))}):u?.length?e.jsx("div",{className:"space-y-3",children:u.map(h=>{const f=Zm.find(y=>y.value===h.task_type);return e.jsx(G,{children:e.jsx(Q,{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-sm",children:r==="kn"?f?.labelKn:f?.label||h.task_type}),e.jsx(he,{className:n3[h.task_status]||"bg-gray-100 text-gray-800",children:h.task_status.replace("_"," ")}),h.payload&&e.jsx(he,{variant:"outline",className:"text-amber-600 border-amber-300",children:r==="kn"?" ":"Needs Approval"})]}),h.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-1",children:h.notes}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 flex items-center gap-1",children:[e.jsx(ms,{className:"h-3 w-3"}),"Due: ",tt(ss(h.due_date),"MMM d, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[h.task_status==="pending"&&e.jsx(z,{size:"sm",variant:"outline",onClick:()=>n.mutate({taskId:h.id,status:"in_progress"}),children:e.jsx(aa,{className:"h-3 w-3"})}),h.task_status==="in_progress"&&e.jsx(z,{size:"sm",onClick:()=>n.mutate({taskId:h.id,status:"completed"}),children:e.jsx(ys,{className:"h-3 w-3"})})]})]})})},h.id)})}):e.jsx(G,{children:e.jsxs(Q,{className:"py-8 text-center",children:[e.jsx(us,{className:"h-10 w-10 mx-auto text-muted-foreground/50 mb-2"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:r==="kn"?" ":"No tasks yet"})]})})]})}function o3(){const{farmerId:t}=Dn(),s=Ut(),{language:r}=Nt(),a=eu(),{data:n}=tu(),[i,o]=x.useState("overview"),{data:c,isLoading:l}=De({queryKey:["agent-farmer-detail",t],queryFn:async()=>{if(!t)return null;const{data:j,error:C}=await W.from("profiles").select("*").eq("id",t).single();if(C)throw C;return j},enabled:!!t}),{data:u,isLoading:d}=De({queryKey:["agent-farmer-crops",t],queryFn:async()=>{if(!t)return[];const{data:j,error:C}=await W.from("crops").select("*").eq("farmer_id",t).neq("status","harvested").order("created_at",{ascending:!1});if(C)throw C;return j||[]},enabled:!!t}),{data:p,isLoading:h}=De({queryKey:["agent-farmer-transport",t],queryFn:async()=>{if(!t)return[];const{data:j,error:C}=await W.from("transport_requests").select("*").eq("farmer_id",t).order("created_at",{ascending:!1}).limit(10);if(C)throw C;return j||[]},enabled:!!t}),{data:f,isLoading:y}=De({queryKey:["agent-farmer-farmlands",t],queryFn:async()=>{if(!t)return[];const{data:j,error:C}=await W.from("farmlands").select("*").eq("farmer_id",t).order("created_at",{ascending:!1});if(C)throw C;return j||[]},enabled:!!t}),v=()=>{if(t){if(n){ce.error(r==="kn"?"    ":"Please end your current visit first");return}a.mutate({farmerId:t})}},b=()=>{c?.phone&&(window.location.href=`tel:${c.phone}`)},N=()=>{if(c?.phone){const j=c.phone.replace(/[^0-9]/g,""),C=encodeURIComponent("Hello");window.open(`https://wa.me/91${j}?text=${C}`,"_blank")}},A=j=>{const I={growing:{label:"Growing",className:"bg-blue-100 text-blue-800"},one_week:{label:"1 Week",className:"bg-amber-100 text-amber-800"},ready:{label:"Ready",className:"bg-green-100 text-green-800"},harvested:{label:"Harvested",className:"bg-gray-100 text-gray-800"},requested:{label:"Requested",className:"bg-amber-100 text-amber-800"},assigned:{label:"Assigned",className:"bg-blue-100 text-blue-800"},en_route:{label:"En Route",className:"bg-purple-100 text-purple-800"},picked_up:{label:"Picked Up",className:"bg-cyan-100 text-cyan-800"},delivered:{label:"Delivered",className:"bg-green-100 text-green-800"},cancelled:{label:"Cancelled",className:"bg-red-100 text-red-800"}}[j]||{label:j,className:"bg-gray-100 text-gray-800"};return e.jsx(he,{className:I.className,children:I.label})};return l?e.jsx(Oe,{title:r==="kn"?" ":"Farmer Details",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{className:"h-10 w-48"}),e.jsx(Re,{className:"h-40 w-full"})]})}):c?e.jsx(Oe,{title:c.full_name||(r==="kn"?"":"Farmer"),children:e.jsx($s,{title:c.full_name||(r==="kn"?"":"Farmer"),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(z,{variant:"ghost",onClick:()=>s("/agent/my-farmers"),"aria-label":"Back to farmers",children:[e.jsx(ba,{className:"h-4 w-4 mr-2"}),r==="kn"?"":"Back"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{"aria-label":"Call farmer",variant:"outline",size:"sm",onClick:b,disabled:!c.phone,children:[e.jsx(hr,{className:"h-4 w-4 mr-1"}),r==="kn"?"":"Call"]}),e.jsxs(z,{"aria-label":"WhatsApp farmer",variant:"outline",size:"sm",onClick:N,disabled:!c.phone,className:"text-green-600",children:[e.jsx(pd,{className:"h-4 w-4 mr-1"}),"WhatsApp"]}),e.jsxs(z,{"aria-label":"Start visit",size:"sm",onClick:v,disabled:a.isPending||!!n,children:[e.jsx(aa,{className:"h-4 w-4 mr-1"}),r==="kn"?" ":"Start Visit"]})]})]}),e.jsx(G,{children:e.jsx(Q,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Ps,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold",children:c.full_name||(r==="kn"?"":"Unknown")}),c.phone&&e.jsxs("p",{className:"text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(hr,{className:"h-4 w-4"}),c.phone]}),e.jsxs("p",{className:"text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(We,{className:"h-4 w-4"}),[c.village,c.taluk,c.district].filter(Boolean).join(", ")||"N/A"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:u?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r==="kn"?" ":"Active Crops"})]})]})})}),e.jsxs(zn,{value:i,onValueChange:o,children:[e.jsxs(Ja,{className:"grid w-full grid-cols-3 sm:grid-cols-6",children:[e.jsxs(Vs,{value:"overview",className:"flex items-center gap-1",children:[e.jsx(Ps,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:r==="kn"?"":"Overview"})]}),e.jsxs(Vs,{value:"update",className:"flex items-center gap-1",children:[e.jsx(ji,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:r==="kn"?"":"Update"})]}),e.jsxs(Vs,{value:"tasks",className:"flex items-center gap-1",children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:r==="kn"?"":"Tasks"})]}),e.jsxs(Vs,{value:"crops",className:"flex items-center gap-1",children:[e.jsx(ts,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:r==="kn"?"":"Crops"})]}),e.jsxs(Vs,{value:"transport",className:"flex items-center gap-1",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:r==="kn"?"":"Transport"})]}),e.jsxs(Vs,{value:"farmlands",className:"flex items-center gap-1",children:[e.jsx(sr,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:r==="kn"?"":"Farmlands"})]})]}),e.jsx(ga,{value:"overview",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(G,{children:[e.jsx(je,{className:"pb-2",children:e.jsx(we,{className:"text-sm font-medium text-muted-foreground",children:r==="kn"?" ":"Total Land"})}),e.jsx(Q,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[c.total_land_area||0," ",e.jsx("span",{className:"text-sm font-normal",children:"acres"})]})})]}),e.jsxs(G,{children:[e.jsx(je,{className:"pb-2",children:e.jsx(we,{className:"text-sm font-medium text-muted-foreground",children:r==="kn"?"":"Farmlands"})}),e.jsx(Q,{children:e.jsx("div",{className:"text-2xl font-bold",children:f?.length||0})})]}),e.jsxs(G,{children:[e.jsx(je,{className:"pb-2",children:e.jsx(we,{className:"text-sm font-medium text-muted-foreground",children:r==="kn"?" ":"Pending Transport"})}),e.jsx(Q,{children:e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:p?.filter(j=>j.status==="requested").length||0})})]})]})}),e.jsx(ga,{value:"update",className:"mt-6",children:e.jsx(a3,{farmer:c})}),e.jsx(ga,{value:"tasks",className:"mt-6",children:t&&e.jsx(i3,{farmerId:t})}),e.jsx(ga,{value:"crops",className:"mt-6",children:e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:d?e.jsx("div",{className:"p-6 space-y-4",children:[1,2,3].map(j=>e.jsx(Re,{className:"h-12 w-full"},j))}):u?.length?e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:r==="kn"?"":"Crop"}),e.jsx(Se,{children:r==="kn"?"":"Quantity"}),e.jsx(Se,{children:r==="kn"?"":"Status"}),e.jsx(Se,{children:r==="kn"?"":"Harvest"})]})}),e.jsx(Ls,{children:u.map(j=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:j.crop_name}),e.jsxs(be,{children:[j.estimated_quantity||"-"," ",j.quantity_unit||""]}),e.jsx(be,{children:A(j.status)}),e.jsx(be,{children:j.harvest_estimate?tt(ss(j.harvest_estimate),"MMM d, yyyy"):"-"})]},j.id))})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ts,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:r==="kn"?" ":"No crops found"})]})})})}),e.jsx(ga,{value:"transport",className:"mt-6",children:e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:h?e.jsx("div",{className:"p-6 space-y-4",children:[1,2,3].map(j=>e.jsx(Re,{className:"h-12 w-full"},j))}):p?.length?e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:r==="kn"?"":"Location"}),e.jsx(Se,{children:r==="kn"?"":"Quantity"}),e.jsx(Se,{children:r==="kn"?"":"Status"}),e.jsx(Se,{children:r==="kn"?"":"Date"})]})}),e.jsx(Ls,{children:p.map(j=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:j.pickup_location||j.pickup_village||"-"}),e.jsxs(be,{children:[j.quantity||"-"," ",j.quantity_unit||"kg"]}),e.jsx(be,{children:A(j.status)}),e.jsx(be,{children:j.preferred_date?tt(ss(j.preferred_date),"MMM d, yyyy"):tt(ss(j.created_at),"MMM d, yyyy")})]},j.id))})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(rt,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:r==="kn"?"  ":"No transport requests"})]})})})}),e.jsx(ga,{value:"farmlands",className:"mt-6",children:e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:y?e.jsx("div",{className:"p-6 space-y-4",children:[1,2,3].map(j=>e.jsx(Re,{className:"h-12 w-full"},j))}):f?.length?e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:r==="kn"?"":"Name"}),e.jsx(Se,{children:r==="kn"?"":"Area"}),e.jsx(Se,{children:r==="kn"?" ":"Soil Type"}),e.jsx(Se,{children:r==="kn"?"":"Location"})]})}),e.jsx(Ls,{children:f.map(j=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:j.name}),e.jsxs(be,{children:[j.area," ",j.area_unit]}),e.jsx(be,{children:j.soil_type||"-"}),e.jsx(be,{children:[j.village,j.district].filter(Boolean).join(", ")||"-"})]},j.id))})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(sr,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:r==="kn"?" ":"No farmlands found"})]})})})})]})]})})}):e.jsx(Oe,{title:r==="kn"?" ":"Farmer Details",children:e.jsx("div",{className:"text-center py-12",children:e.jsx(nr,{icon:Ps,title:r==="kn"?" ":"Farmer not found",description:r==="kn"?"    ":"This farmer doesn't exist or you don't have access to it.",actionLabel:r==="kn"?"":"Go Back",onAction:()=>s("/agent/my-farmers")})})})}const l3={requested:"bg-amber-100 text-amber-800",assigned:"bg-blue-100 text-blue-800",en_route:"bg-purple-100 text-purple-800",picked_up:"bg-indigo-100 text-indigo-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"},c3=()=>{const{data:t,isLoading:s}=pu(),{data:r}=hu(),{data:a}=Ti(),n=Xe(),[i,o]=x.useState("all"),[c,l]=x.useState(""),[u,d]=x.useState(!1),[p,h]=x.useState(!1),[f,y]=x.useState({farmer_id:"",crop_id:"",quantity:"",pickup_village:"",preferred_date:new Date().toISOString().split("T")[0]}),v=t?.filter(j=>{const C=i==="all"||j.status===i,I=j.farmer?.full_name?.toLowerCase().includes(c.toLowerCase())||j.pickup_village?.toLowerCase().includes(c.toLowerCase())||j.crop?.crop_name?.toLowerCase().includes(c.toLowerCase());return C&&(c===""||I)}),b=async()=>{if(!f.farmer_id||!f.quantity){ce.error("Please fill in all required fields");return}try{h(!0);const{error:j}=await W.from("transport_requests").insert({farmer_id:f.farmer_id,crop_id:f.crop_id||null,quantity:parseFloat(f.quantity),pickup_village:f.pickup_village,pickup_location:f.pickup_village,preferred_date:f.preferred_date,status:"requested"});if(j)throw j;n.invalidateQueries({queryKey:["all-transport-requests"]}),ce.success("Transport request created"),d(!1),y({farmer_id:"",crop_id:"",quantity:"",pickup_village:"",preferred_date:new Date().toISOString().split("T")[0]})}catch(j){ce.error("Failed to create request"),console.error(j)}finally{h(!1)}},N=async(j,C)=>{try{const{error:I}=await W.from("transport_requests").update({status:C}).eq("id",j);if(I)throw I;n.invalidateQueries({queryKey:["all-transport-requests"]}),ce.success("Status updated")}catch(I){ce.error("Failed to update status"),console.error(I)}},A=a?.filter(j=>j.farmer_id===f.farmer_id)||[];return e.jsx(Oe,{title:"Transport",children:e.jsx($s,{title:"Transport Requests",subtitle:"Manage transport and pickup requests",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(zt,{open:u,onOpenChange:d,children:[e.jsx(Wr,{asChild:!0,children:e.jsxs(z,{variant:"default",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"New Request"]})}),e.jsxs(It,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Create Transport Request"}),e.jsx(Ks,{children:"Request transport for a farmer's crops"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:"Farmer *"}),e.jsxs(lt,{value:f.farmer_id,onValueChange:j=>y({...f,farmer_id:j,crop_id:""}),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:"Select farmer"})}),e.jsx(ot,{children:r?.map(j=>e.jsxs(ge,{value:j.id,children:[j.full_name||"Unknown"," - ",j.village||"N/A"]},j.id))})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Crop"}),e.jsxs(lt,{value:f.crop_id,onValueChange:j=>y({...f,crop_id:j}),disabled:!f.farmer_id,children:[e.jsx(it,{children:e.jsx(ct,{placeholder:"Select crop"})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"",children:"None"}),A.map(j=>e.jsxs(ge,{value:j.id,children:[j.crop_name," - ",j.estimated_quantity||"?"," ",j.quantity_unit]},j.id))]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Quantity (quintals) *"}),e.jsx(Ce,{type:"number",value:f.quantity,onChange:j=>y({...f,quantity:j.target.value}),placeholder:"Enter quantity"})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Pickup Village"}),e.jsx(Ce,{value:f.pickup_village,onChange:j=>y({...f,pickup_village:j.target.value}),placeholder:"Enter village name"})]}),e.jsxs("div",{children:[e.jsx(ie,{children:"Preferred Date"}),e.jsx(Ce,{type:"date",value:f.preferred_date,onChange:j=>y({...f,preferred_date:j.target.value})})]}),e.jsx(z,{variant:"default",onClick:b,className:"w-full",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Create Request"})]})]})]}),e.jsx(G,{children:e.jsx(Q,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search by farmer, village, or crop...",value:c,onChange:j=>l(j.target.value),className:"pl-9"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","requested","assigned","en_route","delivered"].map(j=>e.jsx(z,{variant:i===j?"default":"outline",size:"sm",onClick:()=>o(j),children:j==="all"?"All":j.replace("_"," ")},j))})]})})}),e.jsx(G,{children:e.jsx(Q,{className:"p-0",children:s?e.jsx("div",{className:"p-6 space-y-4",children:[1,2,3,4,5].map(j=>e.jsx(Re,{className:"h-16 w-full"},j))}):e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Farmer"}),e.jsx(Se,{children:"Crop"}),e.jsx(Se,{children:"Quantity"}),e.jsx(Se,{children:"Village"}),e.jsx(Se,{children:"Preferred Date"}),e.jsx(Se,{children:"Status"}),e.jsx(Se,{children:"Actions"})]})}),e.jsx(Ls,{children:v?.length===0?e.jsx(mt,{children:e.jsx(be,{colSpan:7,className:"p-0",children:e.jsx(nr,{icon:rt,title:"No transport requests found",description:"Create a transport request to get started.",actionLabel:"New Request",onAction:()=>d(!0)})})}):v?.map(j=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:j.farmer?.full_name||"Unknown"}),e.jsx(be,{children:j.crop?e.jsx(he,{variant:"outline",className:"bg-green-50",children:j.crop.crop_name}):"-"}),e.jsx(be,{children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qt,{className:"h-3 w-3"}),j.quantity," ",j.quantity_unit]})}),e.jsx(be,{children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),j.pickup_village||j.pickup_location]})}),e.jsx(be,{children:j.preferred_date?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"h-3 w-3"}),tt(ss(j.preferred_date),"MMM d")]}):"-"}),e.jsx(be,{children:e.jsx(he,{className:l3[j.status],children:j.status.replace("_"," ")})}),e.jsxs(be,{children:[j.status==="requested"&&e.jsx(z,{size:"sm",variant:"outline",onClick:()=>N(j.id,"assigned"),children:"Assign"}),j.status==="assigned"&&e.jsx(z,{size:"sm",onClick:()=>N(j.id,"en_route"),children:"Start"})]})]},j.id))})]})})})]})})})};function d3(){const{user:t}=Fe(),{language:s}=Nt(),r=Xe(),a=Ev(),{data:n,isLoading:i}=De({queryKey:["agent-profile",t?.id],queryFn:async()=>{if(!t?.id)return null;const{data:S,error:T}=await W.from("profiles").select("*").eq("id",t.id).single();if(T)throw T;return S},enabled:!!t?.id}),[o,c]=x.useState(""),[l,u]=x.useState(""),[d,p]=x.useState(""),[h,f]=x.useState(""),[y,v]=x.useState(""),[b,N]=x.useState("en"),[A,j]=x.useState(""),[C,I]=x.useState("");x.useEffect(()=>{n&&(c(n.full_name||""),u(n.phone||""),p(n.district||""),f(n.village||""),v(n.taluk||""),N(n.preferred_language||"en"),j(n.geo_state_id||""),I(n.geo_district_id||""))},[n]);const k=dt({mutationFn:async()=>{if(!t?.id)throw new Error("Not authenticated");if(!o.trim()||!l.trim())throw new Error("Name and phone are required");const{error:S}=await W.from("profiles").update({full_name:o.trim(),phone:l.trim(),district:d,village:h.trim()||null,taluk:y.trim()||null,preferred_language:b}).eq("id",t.id);if(S)throw S;(A||C)&&await a.mutateAsync({state_id:A||void 0,district_id:C||void 0})},onSuccess:()=>{r.invalidateQueries({queryKey:["agent-profile"]}),ce.success(s==="kn"?" ":"Profile updated successfully")},onError:S=>{ce.error(S.message||"Failed to update profile")}}),R=o.trim()&&l.trim();return i?e.jsx(Oe,{title:s==="kn"?" ":"My Profile",children:e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(et,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsx(Oe,{title:s==="kn"?" ":"My Profile",children:e.jsx($s,{title:s==="kn"?" ":"My Profile",subtitle:s==="kn"?"   ":"Update your profile information",children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-6",children:e.jsxs(G,{children:[e.jsx(je,{children:e.jsx(we,{className:"text-lg",children:s==="kn"?" ":"Basic Information"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ie,{children:[s==="kn"?" ":"Full Name"," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Ce,{value:o,onChange:S=>c(S.target.value),placeholder:s==="kn"?" ":"Your full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ie,{children:[s==="kn"?" ":"Phone Number"," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Ce,{value:l,onChange:S=>u(S.target.value),placeholder:"9876543210",type:"tel"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:s==="kn"?"":"State (Geo)"}),e.jsx(Ai,{value:A,onValueChange:S=>{j(S),I("")},placeholder:s==="kn"?" ":"Select state"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:s==="kn"?"":"District (Geo)"}),e.jsx(Kr,{stateId:A||null,value:C,onValueChange:I,placeholder:s==="kn"?" ":"Select district"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:s==="kn"?"":"Taluk"}),e.jsx(Ce,{value:y,onChange:S=>v(S.target.value),placeholder:s==="kn"?"":"Taluk"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:s==="kn"?"":"Village"}),e.jsx(Ce,{value:h,onChange:S=>f(S.target.value),placeholder:s==="kn"?"":"Village"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:s==="kn"?" ":"Preferred Language"}),e.jsxs(lt,{value:b,onValueChange:N,children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"en",children:"English"}),e.jsx(ge,{value:"kn",children:""})]})]})]}),e.jsx(xt,{to:"/agent/service-area",className:"block",children:e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg border hover:bg-muted/50 transition-colors cursor-pointer",children:[e.jsx(We,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s==="kn"?" ":"Service Areas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s==="kn"?"   ":"Manage the districts you serve"})]})]})}),e.jsx(z,{onClick:()=>k.mutate(),disabled:!R||k.isPending,className:"w-full",children:k.isPending?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),s==="kn"?"...":"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gn,{className:"h-4 w-4 mr-2"}),s==="kn"?" ":"Save Profile"]})})]})]})})})})}function u3(){const{language:t}=Nt(),{data:s,isLoading:r}=mu("agent"),a=Rv(),n=Dv(),[i,o]=x.useState(!1),[c,l]=x.useState(""),[u,d]=x.useState(""),p=()=>{if(!u&&!c){ce.error("Select at least a state or district");return}a.mutate({role_scope:"agent",state_id:c||void 0,district_id:u||void 0},{onSuccess:()=>{ce.success(t==="kn"?"  ":"Service area added"),o(!1),l(""),d("")},onError:f=>ce.error(f.message)})},h=f=>{n.mutate(f,{onSuccess:()=>ce.success("Service area removed"),onError:y=>ce.error(y.message)})};return e.jsx(Oe,{title:t==="kn"?" ":"Service Area",children:e.jsx($s,{title:t==="kn"?"  ":"My Service Areas",subtitle:t==="kn"?"    ":"Manage the districts you serve. Farmers in these areas can be assigned to you.",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs(G,{children:[e.jsxs(je,{className:"flex flex-row items-center justify-between",children:[e.jsx(we,{className:"text-lg",children:t==="kn"?" ":"Active Areas"}),!i&&e.jsxs(z,{size:"sm",onClick:()=>o(!0),children:[e.jsx(Ss,{className:"h-4 w-4 mr-1"})," ",t==="kn"?"":"Add"]})]}),e.jsxs(Q,{className:"space-y-3",children:[r&&e.jsx(et,{className:"h-6 w-6 animate-spin mx-auto"}),!r&&(!s||s.length===0)&&e.jsx(nr,{icon:We,title:t==="kn"?"   ":"No service areas configured",description:t==="kn"?"   ":"Add your districts to get farmer assignments.",actionLabel:t==="kn"?"":"Add Area",onAction:()=>o(!0)}),(s??[]).map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium",children:f.district_name||"State-level coverage"}),e.jsx(he,{variant:f.is_active?"default":"secondary",className:"text-xs",children:f.is_active?"Active":"Inactive"})]}),e.jsx(z,{size:"sm",variant:"ghost",className:"text-destructive hover:text-destructive",onClick:()=>h(f.id),disabled:n.isPending,children:e.jsx(Na,{className:"h-4 w-4"})})]},f.id))]})]}),i&&e.jsxs(G,{children:[e.jsx(je,{children:e.jsx(we,{className:"text-lg",children:t==="kn"?"  ":"Add Service Area"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:t==="kn"?"":"State"}),e.jsx(Ai,{value:c,onValueChange:f=>{l(f),d("")}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:t==="kn"?"":"District"}),e.jsx(Kr,{stateId:c||null,value:u,onValueChange:d})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{onClick:p,disabled:a.isPending,children:[a.isPending?e.jsx(et,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(Ss,{className:"h-4 w-4 mr-1"}),t==="kn"?"":"Add Area"]}),e.jsx(z,{variant:"outline",onClick:()=>{o(!1),l(""),d("")},children:t==="kn"?"":"Cancel"})]})]})]})]})})})}const Bn=()=>{const{user:t}=Fe();return De({queryKey:["transporter-profile",t?.id],queryFn:async()=>{if(!t?.id)return null;const{data:s,error:r}=await W.from("transporters").select("*").eq("user_id",t.id).maybeSingle();if(r)throw r;return s},enabled:!!t?.id})},m3=()=>{const t=Xe(),{user:s}=Fe();return dt({mutationFn:async r=>{if(!s?.id)throw new Error("Not authenticated");const{data:a,error:n}=await W.from("transporters").insert({user_id:s.id,name:r.name||"Transporter",phone:r.phone,vehicle_type:r.vehicle_type,vehicle_capacity:r.vehicle_capacity,registration_number:r.registration_number,operating_village:r.operating_village,operating_district:r.operating_district}).select().single();if(n)throw n;return a},onSuccess:()=>{t.invalidateQueries({queryKey:["transporter-profile"]}),ce.success("Profile created successfully")},onError:r=>{ce.error("Failed to create profile: "+r.message)}})},Lv=()=>De({queryKey:["available-loads"],queryFn:async()=>{const{data:t,error:s}=await W.from("transport_requests").select("*").eq("status","requested").order("created_at",{ascending:!1});if(s)throw s;return await Promise.all((t||[]).map(async a=>{const[n,i]=await Promise.all([W.from("profiles").select("full_name, village, district, phone").eq("id",a.farmer_id).maybeSingle(),a.crop_id?W.from("crops").select("crop_name, variety").eq("id",a.crop_id).maybeSingle():Promise.resolve({data:null})]);return{...a,farmer:n.data,crop:i.data}}))}}),h3=()=>{const{data:t}=Bn();return De({queryKey:["active-trips",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("transport_requests").select("*").eq("transporter_id",t.user_id).in("status",["assigned","en_route","picked_up"]).order("preferred_date",{ascending:!0});if(r)throw r;return await Promise.all((s||[]).map(async n=>{const[i,o]=await Promise.all([W.from("profiles").select("full_name, village, district, phone").eq("id",n.farmer_id).maybeSingle(),n.crop_id?W.from("crops").select("crop_name, variety").eq("id",n.crop_id).maybeSingle():Promise.resolve({data:null})]);return{...n,farmer:i.data,crop:o.data}}))},enabled:!!t?.id})},p3=()=>{const{data:t}=Bn();return De({queryKey:["completed-trips",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("transport_requests").select("*").eq("transporter_id",t.user_id).eq("status","delivered").order("completed_at",{ascending:!1});if(r)throw r;return await Promise.all((s||[]).map(async n=>{const[i,o]=await Promise.all([W.from("profiles").select("full_name, village, district, phone").eq("id",n.farmer_id).maybeSingle(),n.crop_id?W.from("crops").select("crop_name, variety").eq("id",n.crop_id).maybeSingle():Promise.resolve({data:null})]);return{...n,farmer:i.data,crop:o.data}}))},enabled:!!t?.id})},qv=()=>{const{data:t}=Bn();return De({queryKey:["vehicles",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s,error:r}=await W.from("vehicles").select("*").eq("transporter_id",t.id).order("created_at",{ascending:!1});if(r)throw r;return s},enabled:!!t?.id})},f3=()=>De({queryKey:["logistics-dashboard"],queryFn:async()=>{const s=await Yt("logistics_dashboard_v1");return{stats:{availableLoads:Number(s?.available_loads_count||0),acceptedTrips:0,tripsInProgress:Number(s?.trips_by_status&&s.trips_by_status.en_route||0),completedTrips:Number(s?.trips_by_status&&s.trips_by_status.delivered||0)},transporter:null,raw:s}}}).data||{stats:{availableLoads:0,acceptedTrips:0,tripsInProgress:0,completedTrips:0},transporter:null},x3={primary:"text-primary",success:"text-success",warning:"text-warning",info:"text-info",neutral:"text-muted-foreground"},Xs=({label:t,value:s,trend:r,icon:a,priority:n="neutral",onClick:i})=>{const o=typeof i=="function",c=r===void 0?ko:r>0?pr:r<0?kc:ko,l=r===void 0?"text-muted-foreground":r>0?"text-success":r<0?"text-destructive":"text-muted-foreground";return e.jsx(G,{className:ke("transition-all duration-standard",o?"cursor-pointer hover:-translate-y-[2px] hover:shadow-elev-2":"hover:shadow-elev-1"),onClick:i,children:e.jsx(Q,{className:"p-4 sm:p-5",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-muted-foreground",children:t}),e.jsx("p",{className:"mt-2 text-2xl font-display font-semibold leading-none",children:s}),r!==void 0?e.jsxs("p",{className:ke("mt-2 inline-flex items-center gap-1 text-xs font-medium",l),children:[e.jsx(c,{className:"h-3.5 w-3.5"}),Math.abs(r),"%"]}):null]}),a?e.jsx("div",{className:ke("rounded-lg bg-muted p-2.5",x3[n]),children:e.jsx(a,{className:"h-5 w-5"})}):null]})})})},xu=({title:t,context:s,primaryAction:r,secondaryAction:a,children:n})=>e.jsxs(G,{children:[e.jsx(je,{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(we,{className:"text-base",children:t}),s?e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:s}):null]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a,r]})]})}),n?e.jsx(Q,{children:n}):null]}),g3={requested:"bg-amber-100 text-amber-800",assigned:"bg-blue-100 text-blue-800",en_route:"bg-purple-100 text-purple-800",picked_up:"bg-indigo-100 text-indigo-800",delivered:"bg-green-100 text-green-800"},v3=()=>{const t=Ut(),{user:s}=Fe(),{t:r}=Nt(),{stats:a}=f3(),{data:n,isLoading:i}=h3(),{data:o,isLoading:c}=Lv(),{data:l,isLoading:u}=Bn(),d=m3(),[p,h]=x.useState(!1),[f,y]=x.useState(null),[v,b]=x.useState(!1),[N,A]=x.useState(null),j=()=>{d.mutate({name:s?.email?.split("@")[0]||"Transporter"})},C=async()=>{if(!o||o.length===0){ce.error("No available loads to optimize");return}h(!0);try{const k=o.map(E=>({farmer_name:E.farmer?.full_name,village:E.pickup_village||E.pickup_location,crop_name:E.crop?.crop_name,quantity:E.quantity,quantity_unit:E.quantity_unit,preferred_date:E.preferred_date})),{data:{session:R}}=await W.auth.getSession();if(!R)throw new Error("Not authenticated");const S=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/ai-gateway/transport-ai",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({type:"route_optimization",loads:k,currentLocation:l?.operating_village||"Base"})}),T=await S.json();if(!S.ok)throw new Error(T?.error?.message||"Function error");y(T.result),ce.success("Route optimization complete!")}catch(k){console.error("AI error:",k),ce.error("Failed to get AI suggestions")}finally{h(!1)}},I=async()=>{b(!0);try{const{data:{session:k}}=await W.auth.getSession();if(!k)throw new Error("Not authenticated");const R=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/ai-gateway/transport-ai",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({type:"reverse_logistics",currentLocation:"Market/Mandi",homeBase:l?.operating_village||"Base village",loads:[]})}),S=await R.json();if(!R.ok)throw new Error(S?.error?.message||"Function error");A(S.result),ce.success("Reverse load suggestions ready!")}catch(k){console.error("AI error:",k),ce.error("Failed to get reverse load suggestions")}finally{b(!1)}};return u?e.jsx(Oe,{title:r("nav.dashboard"),children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{className:"h-32 w-full"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[1,2,3,4].map(k=>e.jsx(Re,{className:"h-24"},k))})]})}):l?e.jsx(Oe,{title:r("nav.dashboard"),children:e.jsxs($s,{title:r("logistics.transporterDashboard"),subtitle:`Welcome back, ${l.name} - ${l.operating_village||r("logistics.setYourLocation")}`,actions:e.jsxs(z,{"aria-label":"Open profile",variant:"outline",onClick:()=>t("/logistics/profile"),children:[e.jsx(Ps,{className:"mr-2 h-4 w-4"}),r("nav.profile")]}),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[e.jsx(Xs,{label:r("logistics.availableLoads"),value:a.availableLoads,icon:qt,priority:"warning",onClick:()=>t("/logistics/loads")}),e.jsx(Xs,{label:r("logistics.acceptedTrips"),value:a.acceptedTrips,icon:vs,priority:"info",onClick:()=>t("/logistics/trips")}),e.jsx(Xs,{label:r("logistics.inProgress"),value:a.tripsInProgress,icon:rt,priority:"primary",onClick:()=>t("/logistics/trips")}),e.jsx(Xs,{label:r("logistics.completedTrips"),value:a.completedTrips,icon:qs,priority:"success",onClick:()=>t("/logistics/completed")})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(rt,{className:"h-5 w-5 text-primary"}),r("logistics.todaysActiveTrips")]}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>t("/logistics/trips"),children:[r("common.viewAll")," ",e.jsx(Ir,{className:"ml-1 h-4 w-4"})]})]})}),e.jsx(Q,{children:i?e.jsx("div",{className:"space-y-3",children:[1,2].map(k=>e.jsx(Re,{className:"h-20"},k))}):!n||n.length===0?e.jsx("div",{className:"p-4",children:e.jsx(nr,{icon:rt,title:r("logistics.noActiveTrips"),description:""})}):e.jsx("div",{className:"space-y-3",children:n.slice(0,3).map(k=>e.jsxs("div",{className:"cursor-pointer rounded-lg border p-3 transition-colors hover:bg-accent/50",onClick:()=>t(`/logistics/trip/${k.id}`),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:k.crop?.crop_name||"Unknown Crop"}),e.jsx(he,{className:g3[k.status],children:k.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(We,{className:"h-3 w-3"}),e.jsx("span",{children:k.pickup_village||k.pickup_location}),e.jsx("span",{children:"-"}),e.jsxs("span",{children:[k.quantity," ",k.quantity_unit]})]})]},k.id))})})]}),e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(qt,{className:"h-5 w-5 text-amber-600"}),r("logistics.newLoadRequests")]}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>t("/logistics/loads"),children:[r("common.viewAll")," ",e.jsx(Ir,{className:"ml-1 h-4 w-4"})]})]})}),e.jsx(Q,{children:c?e.jsx("div",{className:"space-y-3",children:[1,2].map(k=>e.jsx(Re,{className:"h-20"},k))}):!o||o.length===0?e.jsx("div",{className:"p-4",children:e.jsx(nr,{icon:qt,title:r("logistics.noLoadsFound"),description:""})}):e.jsx("div",{className:"space-y-3",children:o.slice(0,3).map(k=>e.jsxs("div",{className:"rounded-lg border p-3 transition-colors hover:bg-accent/50",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:k.farmer?.full_name||"Unknown Farmer"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:k.preferred_date?tt(ss(k.preferred_date),"MMM d"):r("common.flexible")})]}),e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:k.crop?.crop_name||"Crop"}),e.jsx("span",{children:"-"}),e.jsxs("span",{children:[k.quantity," ",k.quantity_unit]}),e.jsx("span",{children:"-"}),e.jsx(We,{className:"h-3 w-3"}),e.jsx("span",{children:k.pickup_village||k.pickup_location})]})]},k.id))})})]})]}),e.jsx(xu,{title:r("logistics.aiSuggestions"),context:r("logistics.aiSuggestionsContext"),primaryAction:e.jsx(z,{size:"sm",onClick:C,disabled:p||!o?.length,children:r(p?"logistics.analyzing":"logistics.suggestBestRoute")}),secondaryAction:e.jsxs(z,{size:"sm",variant:"outline",onClick:I,disabled:v,children:[e.jsx(rm,{className:"mr-2 h-4 w-4"}),r(v?"logistics.finding":"logistics.findReturnLoads")]}),children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border bg-background p-4",children:[e.jsxs("h4",{className:"mb-2 flex items-center gap-2 font-medium",children:[e.jsx(Js,{className:"h-4 w-4 text-primary"}),r("logistics.routeOptimization")]}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:f||r("logistics.routeOptimizationHint")})]}),e.jsxs("div",{className:"rounded-lg border bg-background p-4",children:[e.jsxs("h4",{className:"mb-2 flex items-center gap-2 font-medium",children:[e.jsx(rm,{className:"h-4 w-4"}),r("logistics.reverseLogistics")]}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:N||r("logistics.reverseLogisticsHint")})]})]})})]})}):e.jsx(Oe,{title:r("nav.dashboard"),children:e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center",children:e.jsxs(G,{className:"w-full max-w-md",children:[e.jsxs(je,{className:"text-center",children:[e.jsx(rt,{className:"mx-auto mb-4 h-16 w-16 text-primary"}),e.jsx(we,{children:r("logistics.welcomeTransporter")})]}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("p",{className:"text-center text-muted-foreground",children:r("logistics.setupTransporterProfile")}),e.jsx(z,{className:"w-full",onClick:j,disabled:d.isPending,children:d.isPending?r("logistics.creatingProfile"):r("logistics.createProfile")})]})]})})})},y3=t=>Mn({queryKey:["transport-requests-infinite",t],queryFn:async({pageParam:s=null})=>{const r=await Yt("list_transport_requests_compact_v1",{p_filter:{},p_limit:24,p_cursor:s});return{items:r?.items||[],next_cursor:r?.next_cursor||null}},getNextPageParam:s=>s.next_cursor||void 0}),j3=t=>{const{user:s}=Fe();return De({queryKey:["trips",s?.id,t],queryFn:async()=>{if(!s?.id)return[];const r=t==null?null:Array.isArray(t)?t:[t],{data:a,error:n}=await W.rpc("get_trips_with_context",{p_transporter_id:s.id,p_status_filter:r});if(n)throw n;return a||[]},enabled:!!s?.id})},b3=t=>{const{user:s}=Fe();return De({queryKey:["trip-detail",t],queryFn:async()=>{if(!t)return null;const{data:r,error:a}=await W.rpc("get_trip_detail_with_context",{p_trip_id:t});if(a)throw a;return r},enabled:!!t&&!!s?.id})},w3=t=>De({queryKey:["trip-status-events",t],queryFn:async()=>{if(!t)return[];const{data:s,error:r}=await W.from("transport_status_events").select("*").eq("trip_id",t).order("created_at",{ascending:!0});if(r)throw r;return s},enabled:!!t}),N3=()=>{const t=Xe();return dt({mutationFn:async({transportRequestId:s,vehicleId:r})=>{const{data:a,error:n}=await W.functions.invoke("accept-load",{body:{transport_request_id:s,vehicle_id:r}});if(n)throw n;if(a.error)throw new Error(a.error);return a},onSuccess:s=>{t.invalidateQueries({queryKey:["available-loads"]}),t.invalidateQueries({queryKey:["trips"]}),t.invalidateQueries({queryKey:["active-trips"]}),ce.success("Load accepted successfully!")},onError:s=>{s.message.includes("ALREADY_ASSIGNED")||s.message.includes("already")?ce.error("This load has already been accepted by another transporter"):s.message.includes("fetch")||s.message.includes("network")||s.message.includes("Failed to fetch")?ce.error("Network error. Please check your connection and try again."):ce.error("Failed to accept load: "+s.message)}})},gu=()=>{const t=Xe();return dt({mutationFn:async({tripId:s,newStatus:r,note:a,proofPaths:n,issueCode:i,issueNotes:o,actualWeightKg:c})=>{const{data:l,error:u}=await W.functions.invoke("update-trip-status",{body:{trip_id:s,new_status:r,note:a,proof_paths:n,issue_code:i,issue_notes:o,actual_weight_kg:c}});if(u)throw u;if(l.error)throw new Error(l.error);return l},onSuccess:s=>{t.invalidateQueries({queryKey:["trips"]}),t.invalidateQueries({queryKey:["trip-detail"]}),t.invalidateQueries({queryKey:["trip-status-events"]}),t.invalidateQueries({queryKey:["active-trips"]}),t.invalidateQueries({queryKey:["completed-trips"]}),ce.success(`Status updated to ${s.new_status}`)},onError:s=>{s.message.includes("fetch")||s.message.includes("network")||s.message.includes("Failed to fetch")?ce.error("Network error. Please check your connection and try again."):ce.error("Failed to update status: "+s.message)}})},_3=()=>{const{user:t}=Fe();return dt({mutationFn:async({tripId:s,file:r,type:a})=>{if(!t?.id)throw new Error("Not authenticated");return await bi(r,{bucket:"trip-proofs",contentType:r.type,sizeBytes:r.size,entity:{type:"trip",id:s}})},onError:s=>{ce.error("Failed to upload photo: "+s.message)}})},k3=()=>{const{data:t,isLoading:s}=Lv(),{t:r}=Nt(),{data:a}=qv(),n=N3(),{data:i,isLoading:o,fetchNextPage:c,hasNextPage:l,isFetchingNextPage:u}=y3(),d=i?i.pages.flatMap(k=>k.items||[]):t||[],[p,h]=x.useState(""),[f,y]=x.useState(null),[v,b]=x.useState(""),[N,A]=x.useState(!1),j=d?.filter(k=>{const R=p.toLowerCase();return k.farmer?.full_name?.toLowerCase().includes(R)||k.crop?.crop_name?.toLowerCase().includes(R)||k.pickup_village?.toLowerCase().includes(R)||k.pickup_location?.toLowerCase().includes(R)}),C=k=>{y(k),A(!0)},I=()=>{f&&n.mutate({transportRequestId:f,vehicleId:v||void 0},{onSuccess:()=>{A(!1),y(null),b("")},onError:k=>{const R=fl(k);R.toLowerCase().includes("already")||R.includes("ALREADY_ASSIGNED")?ce.error("This load has already been accepted by another transporter"):ce.error(`Failed to accept load: ${R}`)}})};return s?e.jsx(Oe,{title:"Available Loads",children:e.jsx(xr,{loading:!0,children:e.jsx(e.Fragment,{})})}):e.jsx(Oe,{title:"Available Loads",children:e.jsxs(Zs,{title:"Available Loads",subtitle:`${j?.length||0} loads waiting for pickup`,children:[e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search by farmer, crop, or village...",value:p,onChange:k=>h(k.target.value),className:"pl-10"})]})})}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-5 w-5 text-amber-600"}),"Load Requests"]})}),e.jsx(Q,{children:e.jsxs(xr,{empty:!j||j.length===0,emptyTitle:"No available loads found",emptyMessage:"Check back later for new transport requests.",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Farmer"}),e.jsx(Se,{children:"Crop"}),e.jsx(Se,{children:"Quantity"}),e.jsx(Se,{children:"Pickup Location"}),e.jsx(Se,{children:"Preferred Date"}),e.jsx(Se,{className:"text-right",children:"Action"})]})}),e.jsx(Ls,{children:j.map(k=>e.jsxs(mt,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:k.farmer?.full_name||"Unknown"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:k.farmer?.phone})]})]})}),e.jsx(be,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:k.crop?.crop_name||"N/A"}),k.crop?.variety&&e.jsx("p",{className:"text-xs text-muted-foreground",children:k.crop.variety})]})}),e.jsx(be,{children:e.jsxs(he,{variant:"outline",children:[k.quantity," ",k.quantity_unit||"quintals"]})}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{children:k.pickup_village||k.pickup_location})]})}),e.jsx(be,{children:k.preferred_date?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{children:tt(ss(k.preferred_date),"MMM d, yyyy")}),k.preferred_time&&e.jsxs("span",{className:"text-muted-foreground",children:["@ ",k.preferred_time]})]}):e.jsx("span",{className:"text-muted-foreground",children:"Flexible"})}),e.jsx(be,{className:"text-right",children:e.jsxs(z,{size:"sm",onClick:()=>C(k.id),disabled:n.isPending,children:[n.isPending&&f===k.id?e.jsx(et,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(Cr,{className:"h-4 w-4 mr-1"}),"Accept"]})})]},k.id))})]})}),e.jsx("div",{className:"mt-4 text-center",children:l?e.jsx(z,{variant:"outline",onClick:()=>c(),disabled:u,children:r(u?"common.loading":"common.loadMore")}):e.jsx("div",{className:"text-sm text-muted-foreground",children:r("common.noMoreItems")})})]})})]}),e.jsx(zt,{open:N,onOpenChange:A,children:e.jsxs(It,{children:[e.jsx(Bt,{children:e.jsx($t,{children:"Accept Load"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"You are about to accept this load. Once accepted, it will appear in your Active Trips."}),a&&a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Assign Vehicle (Optional)"}),e.jsxs(lt,{value:v,onValueChange:b,children:[e.jsx(it,{children:e.jsx(ct,{placeholder:"Select a vehicle"})}),e.jsx(ot,{children:a.map(k=>e.jsxs(ge,{value:k.id,children:[k.number_plate," - ",k.vehicle_type," (",k.capacity," tons)"]},k.id))})]})]})]}),e.jsxs(br,{children:[e.jsxs(z,{variant:"outline",onClick:()=>A(!1),disabled:n.isPending,children:[e.jsx(ar,{className:"h-4 w-4 mr-1"}),"Cancel"]}),e.jsx(z,{onClick:I,disabled:n.isPending,children:n.isPending?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-1 animate-spin"}),"Accepting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Cr,{className:"h-4 w-4 mr-1"}),"Confirm Accept"]})})]})]})})]})})},C3={assigned:"bg-blue-100 text-blue-800",en_route:"bg-purple-100 text-purple-800",picked_up:"bg-indigo-100 text-indigo-800"},S3=()=>{const t=Ut(),{data:s,isLoading:r}=j3(["assigned","en_route","arrived","picked_up","in_transit"]),a=n=>{window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(n)}`,"_blank")};return r?e.jsx(Oe,{title:"Active Trips",children:e.jsx(xr,{loading:!0,children:e.jsx(e.Fragment,{})})}):e.jsx(Oe,{title:"Active Trips",children:e.jsxs(Zs,{title:"Active Trips",subtitle:`${s?.length||0} trips in progress`,children:[e.jsx(xr,{empty:!s||s.length===0,emptyTitle:"No active trips",emptyMessage:"Accept some loads to start transporting.",children:e.jsx("div",{className:"space-y-4",children:s.map(n=>{const i=n.transport_request;return e.jsx(G,{className:"hover:shadow-md transition-shadow",children:e.jsx(Q,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[n.crop?.crop_name||"Unknown Crop",n.crop?.variety&&e.jsxs("span",{className:"text-muted-foreground font-normal ml-2",children:["(",n.crop.variety,")"]})]}),e.jsx(he,{className:C3[n.status]||"bg-gray-100 text-gray-800",children:n.status.replace("_"," ")})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Farmer"}),e.jsx("p",{className:"font-medium",children:n.farmer?.full_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Quantity"}),e.jsxs("p",{className:"font-medium",children:[i?.quantity," ",i?.quantity_unit||"quintals"]})]}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Pickup Location"}),e.jsx("p",{className:"font-medium",children:i?.pickup_village||i?.pickup_location})]})]}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(ms,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Preferred Date"}),e.jsxs("p",{className:"font-medium",children:[i?.preferred_date?tt(ss(i.preferred_date),"MMM d, yyyy"):"Flexible",i?.preferred_time&&` @ ${i.preferred_time}`]})]})]})]}),i?.notes&&e.jsx("div",{className:"p-2 bg-muted/50 rounded text-sm",children:e.jsxs("p",{className:"text-muted-foreground",children:["Notes: ",i.notes]})})]}),e.jsxs("div",{className:"flex flex-col gap-2 min-w-[180px]",children:[e.jsxs(z,{onClick:()=>t(`/logistics/trip/${n.id}`),className:"w-full",children:[e.jsx(qt,{className:"h-4 w-4 mr-2"}),"Open Trip"]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>a(i?.pickup_village||i?.pickup_location||""),className:"w-full",children:[e.jsx(ya,{className:"h-4 w-4 mr-2"}),"Open in Maps"]}),n.farmer?.phone&&e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>window.open(`tel:${n.farmer?.phone}`),className:"w-full",children:[e.jsx(hr,{className:"h-4 w-4 mr-2"}),"Call Farmer"]})]})]})})},n.id)})})}),!s||s.length===0?e.jsx("div",{className:"pt-2",children:e.jsx(z,{onClick:()=>t("/logistics/loads"),children:"Browse Available Loads"})}):null]})})},A3=()=>{const{data:t,isLoading:s}=p3();return s?e.jsx(Oe,{title:"Completed Trips",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{className:"h-10 w-48"}),e.jsx(Re,{className:"h-96 w-full"})]})}):e.jsx(Oe,{title:"Completed Trips",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Completed Trips"}),e.jsxs("p",{className:"text-muted-foreground",children:[t?.length||0," trips completed successfully"]})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(qs,{className:"h-5 w-5 text-green-600"}),"Delivery History"]})}),e.jsx(Q,{children:!t||t.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(qt,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg",children:"No completed trips yet"}),e.jsx("p",{className:"text-sm",children:"Your delivery history will appear here"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Farmer"}),e.jsx(Se,{children:"Crop"}),e.jsx(Se,{children:"Quantity"}),e.jsx(Se,{children:"Pickup Location"}),e.jsx(Se,{children:"Completed"}),e.jsx(Se,{children:"Distance"})]})}),e.jsx(Ls,{children:t.map(r=>e.jsxs(mt,{children:[e.jsxs(be,{children:[e.jsx("p",{className:"font-medium",children:r.farmer?.full_name||"Unknown"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.farmer?.village,", ",r.farmer?.district]})]}),e.jsxs(be,{children:[e.jsx("p",{className:"font-medium",children:r.crop?.crop_name||"N/A"}),r.crop?.variety&&e.jsx("p",{className:"text-xs text-muted-foreground",children:r.crop.variety})]}),e.jsx(be,{children:e.jsxs(he,{variant:"outline",children:[r.quantity," ",r.quantity_unit||"quintals"]})}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{children:r.pickup_village||r.pickup_location})]})}),e.jsx(be,{children:r.completed_at?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{children:tt(ss(r.completed_at),"MMM d, yyyy")})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(be,{children:r.distance_km?e.jsxs("span",{children:[r.distance_km," km"]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})]},r.id))})]})})})]}),t&&t.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(G,{children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Deliveries"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:t.reduce((r,a)=>r+(a.quantity||0),0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Quintals"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t.reduce((r,a)=>r+(a.distance_km||0),0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Distance (km)"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:new Set(t.map(r=>r.farmer_id)).size}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Farmers Served"})]})})]})]})})},T3=[{value:"truck",label:"Truck"},{value:"pickup",label:"Pickup"},{value:"mini_truck",label:"Mini Truck"},{value:"tempo",label:"Tempo"},{value:"tractor",label:"Tractor Trolley"}],P3=()=>{const{data:t,isLoading:s}=qv(),{data:r}=Bn(),a=Xe(),[n,i]=x.useState(!1),[o,c]=x.useState(!1),[l,u]=x.useState({vehicle_type:"truck",capacity:"",number_plate:""}),d=async()=>{if(!r?.id){ce.error("Transporter profile not found");return}if(!l.number_plate||!l.capacity){ce.error("Please fill in all required fields");return}c(!0);try{const{error:h}=await W.from("vehicles").insert({transporter_id:r.id,vehicle_type:l.vehicle_type,capacity:parseFloat(l.capacity),number_plate:l.number_plate.toUpperCase()});if(h)throw h;ce.success("Vehicle added successfully!"),a.invalidateQueries({queryKey:["vehicles"]}),i(!1),u({vehicle_type:"truck",capacity:"",number_plate:""})}catch(h){ce.error("Failed to add vehicle: "+h.message)}finally{c(!1)}},p=async h=>{if(confirm("Are you sure you want to delete this vehicle?"))try{const{error:f}=await W.from("vehicles").delete().eq("id",h);if(f)throw f;ce.success("Vehicle deleted"),a.invalidateQueries({queryKey:["vehicles"]})}catch(f){ce.error("Failed to delete vehicle: "+f.message)}};return s?e.jsx(Oe,{title:"My Vehicles",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{className:"h-10 w-48"}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(h=>e.jsx(Re,{className:"h-40"},h))})]})}):e.jsx(Oe,{title:"My Vehicles",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"My Vehicles"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your fleet of vehicles"})]}),e.jsxs(z,{onClick:()=>i(!0),children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Add Vehicle"]})]}),!t||t.length===0?e.jsx(G,{children:e.jsx(Q,{className:"py-12",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(rt,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg",children:"No vehicles added yet"}),e.jsx("p",{className:"text-sm mb-4",children:"Add your first vehicle to start accepting loads"}),e.jsxs(z,{onClick:()=>i(!0),children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Add Vehicle"]})]})})}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(h=>e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(we,{className:"text-lg flex items-center gap-2",children:[e.jsx(rt,{className:"h-5 w-5 text-primary"}),h.number_plate]}),e.jsx(he,{variant:h.is_active?"default":"secondary",children:h.is_active?"Active":"Inactive"})]})}),e.jsxs(Q,{children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:h.vehicle_type.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Capacity:"}),e.jsxs("span",{className:"font-medium",children:[h.capacity," tons"]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(z,{variant:"outline",size:"sm",className:"flex-1",children:[e.jsx(ji,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsx(z,{variant:"outline",size:"sm",className:"text-destructive",onClick:()=>p(h.id),children:e.jsx(Na,{className:"h-4 w-4"})})]})]})]},h.id))}),e.jsx(zt,{open:n,onOpenChange:i,children:e.jsxs(It,{children:[e.jsx(Bt,{children:e.jsx($t,{children:"Add New Vehicle"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"number_plate",children:"Number Plate *"}),e.jsx(Ce,{id:"number_plate",placeholder:"e.g., KA-01-AB-1234",value:l.number_plate,onChange:h=>u(f=>({...f,number_plate:h.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"vehicle_type",children:"Vehicle Type"}),e.jsxs(lt,{value:l.vehicle_type,onValueChange:h=>u(f=>({...f,vehicle_type:h})),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsx(ot,{children:T3.map(h=>e.jsx(ge,{value:h.value,children:h.label},h.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"capacity",children:"Capacity (tons) *"}),e.jsx(Ce,{id:"capacity",type:"number",placeholder:"e.g., 10",value:l.capacity,onChange:h=>u(f=>({...f,capacity:h.target.value}))})]})]}),e.jsxs(br,{children:[e.jsx(z,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(z,{onClick:d,disabled:o,children:o?"Adding...":"Add Vehicle"})]})]})})]})})},Yc=[{key:"assigned",label:"Assigned",icon:Cr,timeKey:"assignedAt"},{key:"en_route",label:"En Route",icon:rt,timeKey:"enRouteAt"},{key:"arrived",label:"Arrived",icon:We,timeKey:"arrivedAt"},{key:"picked_up",label:"Picked Up",icon:qt,timeKey:"pickedUpAt"},{key:"in_transit",label:"In Transit",icon:op,timeKey:"inTransitAt"},{key:"delivered",label:"Delivered",icon:qs,timeKey:"deliveredAt"}],M3=Yc.map(t=>t.key);function R3({currentStatus:t,assignedAt:s,enRouteAt:r,arrivedAt:a,pickedUpAt:n,inTransitAt:i,deliveredAt:o,cancelledAt:c,issueCode:l}){const u={assignedAt:s||null,enRouteAt:r||null,arrivedAt:a||null,pickedUpAt:n||null,inTransitAt:i||null,deliveredAt:o||null},d=M3.indexOf(t),p=t==="cancelled",h=t==="issue";return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"hidden md:flex items-center justify-between",children:Yc.map((f,y)=>{const v=!p&&!h&&y<d,b=!p&&!h&&y===d,N=!p&&!h&&y>d,A=u[f.timeKey];return e.jsxs("div",{className:"flex-1 flex flex-col items-center relative",children:[y>0&&e.jsx("div",{className:ke("absolute top-5 right-1/2 w-full h-0.5",v||b?"bg-primary":"bg-muted"),style:{transform:"translateX(-50%)"}}),e.jsx("div",{className:ke("relative z-10 w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all",v&&"bg-primary border-primary text-primary-foreground",b&&"bg-primary/10 border-primary text-primary",N&&"bg-muted border-muted-foreground/30 text-muted-foreground"),children:e.jsx(f.icon,{className:"h-5 w-5"})}),e.jsx("span",{className:ke("mt-2 text-xs font-medium text-center",b&&"text-primary",N&&"text-muted-foreground"),children:f.label}),A&&e.jsx("span",{className:"mt-0.5 text-[10px] text-muted-foreground",children:tt(ss(A),"h:mm a")})]},f.key)})}),e.jsx("div",{className:"md:hidden space-y-3",children:Yc.map((f,y)=>{const v=!p&&!h&&y<d,b=!p&&!h&&y===d,N=!p&&!h&&y>d,A=u[f.timeKey];return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:ke("w-8 h-8 rounded-full flex items-center justify-center border-2 flex-shrink-0",v&&"bg-primary border-primary text-primary-foreground",b&&"bg-primary/10 border-primary text-primary",N&&"bg-muted border-muted-foreground/30 text-muted-foreground"),children:e.jsx(f.icon,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:ke("text-sm font-medium",b&&"text-primary",N&&"text-muted-foreground"),children:f.label}),A&&e.jsx("p",{className:"text-xs text-muted-foreground",children:tt(ss(A),"MMM d, h:mm a")})]})]},f.key)})}),(p||h)&&e.jsx("div",{className:ke("mt-4 p-3 rounded-lg flex items-center gap-3",p?"bg-destructive/10 text-destructive":"bg-amber-100 text-amber-800"),children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ur,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Trip Cancelled"}),c&&e.jsx("p",{className:"text-xs",children:tt(ss(c),"MMM d, h:mm a")})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ks,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Issue Reported"}),l&&e.jsxs("p",{className:"text-xs",children:["Code: ",l]})]})]})})]})}function D3({open:t,onOpenChange:s,tripId:r,type:a,nextStatus:n,onSuccess:i}){const[o,c]=x.useState([]),[l,u]=x.useState([]),[d,p]=x.useState(""),[h,f]=x.useState(""),[y,v]=x.useState(!1),b=x.useRef(null),N=_3(),A=gu(),j=N.isPending||A.isPending||y,C=["picked_up","delivered"].includes(n),I=async T=>{const E=Array.from(T.target.files||[]);if(E.length+o.length>3){ce.error("Maximum 3 photos allowed");return}const D=[];for(const q of E){if(!xl(q)){ce.error(`${q.name} is not an image file`);continue}const B=Tn(q,Es.IMAGE_MAX_MB);if(!B.valid){ce.error(`${q.name}: ${B.message}`);continue}let L=q;if(q.size/(1024*1024)>Es.IMAGE_COMPRESS_TARGET_MB){v(!0);try{L=await Ms(q,{maxSizeMB:Es.IMAGE_COMPRESS_TARGET_MB,maxWidthOrHeight:1920,useWebWorker:!0})}catch(K){console.error("Compression failed:",K),ce.error(`Failed to compress ${q.name}`);continue}v(!1)}D.push(L)}if(D.length===0)return;const F=[...o,...D].slice(0,3);c(F);const H=F.map(q=>URL.createObjectURL(q));l.forEach(q=>URL.revokeObjectURL(q)),u(H)},k=T=>{const E=o.filter((D,F)=>F!==T);c(E),URL.revokeObjectURL(l[T]),u(l.filter((D,F)=>F!==T))},R=async()=>{if(C&&o.length===0){ce.error("At least one proof photo is required");return}try{const T=[];for(const E of o){const D=await N.mutateAsync({tripId:r,file:E,type:a});T.push(D)}await A.mutateAsync({tripId:r,newStatus:n,proofPaths:T.length>0?T:void 0,note:h||void 0,actualWeightKg:d?parseFloat(d):void 0}),l.forEach(E=>URL.revokeObjectURL(E)),c([]),u([]),p(""),f(""),s(!1),i?.()}catch(T){const E=fl(T);ce.error(`Failed: ${E}`,{action:ou(R)})}},S=()=>{l.forEach(T=>URL.revokeObjectURL(T)),c([]),u([]),p(""),f(""),s(!1)};return e.jsx(zt,{open:t,onOpenChange:S,children:e.jsxs(It,{className:"max-w-md",children:[e.jsx(Bt,{children:e.jsx($t,{children:a==="pickup"?"Confirm Pickup":"Confirm Delivery"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ie,{className:"flex items-center gap-2",children:["Proof Photos (max 3)",C&&e.jsxs("span",{className:"text-xs text-destructive flex items-center gap-1",children:[e.jsx(rr,{className:"h-3 w-3"}),"Required"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[l.map((T,E)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border",children:[e.jsx("img",{src:T,alt:`Proof ${E+1}`,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>k(E),className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",disabled:j,children:e.jsx(ar,{className:"h-3 w-3"})})]},E)),o.length<3&&e.jsxs("button",{onClick:()=>b.current?.click(),disabled:j,className:"aspect-square rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center text-muted-foreground hover:border-primary hover:text-primary transition-colors disabled:opacity-50",children:[y?e.jsx(et,{className:"h-6 w-6 mb-1 animate-spin"}):e.jsx(dr,{className:"h-6 w-6 mb-1"}),e.jsx("span",{className:"text-xs",children:y?"Processing":"Add"})]})]}),e.jsx("input",{ref:b,type:"file",accept:"image/*",capture:"environment",onChange:I,className:"hidden",disabled:j}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Max ",Es.IMAGE_MAX_MB,"MB per photo  Auto-compressed"]})]}),a==="pickup"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"weight",children:"Actual Weight (kg) - Optional"}),e.jsx(Ce,{id:"weight",type:"number",placeholder:"Enter actual weight",value:d,onChange:T=>p(T.target.value),disabled:j})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(zs,{id:"notes",placeholder:"Any additional notes...",value:h,onChange:T=>f(T.target.value),rows:2,disabled:j})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a==="pickup"?"Take photos of the loaded goods as proof of pickup.":"Take photos showing successful delivery."})]}),e.jsxs(br,{children:[e.jsx(z,{variant:"outline",onClick:S,disabled:j,children:"Cancel"}),e.jsx(z,{onClick:R,disabled:j||C&&o.length===0,children:j?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pi,{className:"h-4 w-4 mr-2"}),a==="pickup"?"Confirm Pickup":"Confirm Delivery"]})})]})]})})}const E3=[{value:"farmer_unavailable",label:"Farmer not available"},{value:"wrong_quantity",label:"Wrong quantity/quality"},{value:"road_block",label:"Road blocked/inaccessible"},{value:"vehicle_problem",label:"Vehicle breakdown"},{value:"weather",label:"Bad weather"},{value:"other",label:"Other issue"}];function I3({open:t,onOpenChange:s,tripId:r,onSuccess:a}){const[n,i]=x.useState(""),[o,c]=x.useState(""),l=gu(),u=async()=>{if(n)try{await l.mutateAsync({tripId:r,newStatus:"issue",issueCode:n,issueNotes:o||void 0}),i(""),c(""),s(!1),a?.()}catch{}};return e.jsx(zt,{open:t,onOpenChange:s,children:e.jsxs(It,{className:"max-w-md",children:[e.jsx(Bt,{children:e.jsxs($t,{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(ks,{className:"h-5 w-5"}),"Report Issue"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(ie,{children:"What's the issue?"}),e.jsx(du,{value:n,onValueChange:i,children:E3.map(d=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ci,{value:d.value,id:d.value}),e.jsx(ie,{htmlFor:d.value,className:"font-normal cursor-pointer",children:d.label})]},d.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"notes",children:"Additional Details"}),e.jsx(zs,{id:"notes",placeholder:"Describe the issue in detail...",value:o,onChange:d=>c(d.target.value),rows:3})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"The farmer and admin will be notified about this issue."})]}),e.jsxs(br,{children:[e.jsx(z,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(z,{variant:"destructive",onClick:u,disabled:!n||l.isPending,children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),"Reporting..."]}):"Report Issue"})]})]})})}const O3={assigned:"bg-blue-100 text-blue-800",en_route:"bg-purple-100 text-purple-800",arrived:"bg-orange-100 text-orange-800",picked_up:"bg-indigo-100 text-indigo-800",in_transit:"bg-cyan-100 text-cyan-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",issue:"bg-amber-100 text-amber-800"},F3=()=>{const{id:t}=Dn(),s=Ut(),{data:r,isLoading:a}=b3(t),{data:n}=w3(t),i=gu(),[o,c]=x.useState(!1),[l,u]=x.useState("pickup"),[d,p]=x.useState(""),[h,f]=x.useState(!1),y=C=>{window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(C)}`,"_blank")},v=C=>{const I=C.replace(/\D/g,"");window.open(`https://wa.me/${I}`,"_blank")},b=C=>{r&&i.mutate({tripId:r.id,newStatus:C})},N=(C,I)=>{u(C),p(I),c(!0)};if(a)return e.jsx(Oe,{title:"Trip Details",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{className:"h-10 w-48"}),e.jsx(Re,{className:"h-32 w-full"}),e.jsx(Re,{className:"h-64 w-full"})]})});if(!r)return e.jsx(Oe,{title:"Trip Details",children:e.jsxs("div",{children:[e.jsxs(z,{variant:"ghost",onClick:()=>s(-1),className:"mb-4",children:[e.jsx(ba,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx(G,{children:e.jsxs(Q,{className:"py-12 text-center",children:[e.jsx(qt,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Trip not found"})]})})]})});const A=r.transport_request,j=["delivered","cancelled"].includes(r.status);return e.jsx(Oe,{title:"Trip Details",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(z,{variant:"ghost",onClick:()=>s(-1),children:[e.jsx(ba,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx("div",{className:"flex-1",children:e.jsxs("h1",{className:"text-2xl font-bold text-foreground",children:[r.crop?.crop_name||"Transport"," Trip"]})}),e.jsx(he,{className:O3[r.status],children:r.status.replace("_"," ")})]}),e.jsx(G,{children:e.jsx(Q,{className:"py-6",children:e.jsx(R3,{currentStatus:r.status,assignedAt:r.assigned_at,enRouteAt:r.en_route_at,arrivedAt:r.arrived_at,pickedUpAt:r.picked_up_at,inTransitAt:r.in_transit_at,deliveredAt:r.delivered_at,cancelledAt:r.cancelled_at,issueCode:r.issue_code})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-5 w-5 text-primary"}),"Load Details"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Crop"}),e.jsx("p",{className:"font-medium text-lg",children:r.crop?.crop_name||"Unknown"}),r.crop?.variety&&e.jsx("p",{className:"text-sm text-muted-foreground",children:r.crop.variety})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Quantity"}),e.jsxs("p",{className:"font-medium text-lg",children:[A?.quantity," ",A?.quantity_unit||"quintals"]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-4",children:[e.jsx(We,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pickup Location"}),e.jsx("p",{className:"font-medium",children:A?.pickup_village||A?.pickup_location})]})]}),e.jsxs(z,{variant:"outline",className:"w-full",onClick:()=>y(A?.pickup_village||A?.pickup_location||""),children:[e.jsx(ya,{className:"h-4 w-4 mr-2"}),"Open in Google Maps"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ms,{className:"h-5 w-5 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preferred Date"}),e.jsx("p",{className:"font-medium",children:A?.preferred_date?tt(ss(A.preferred_date),"MMMM d, yyyy"):"Flexible"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5 text-primary"}),"Farmer"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Name"}),e.jsx("p",{className:"font-medium text-lg",children:r.farmer?.full_name||"Unknown"})]}),r.farmer?.village&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Location"}),e.jsxs("p",{className:"font-medium",children:[r.farmer.village,r.farmer.district&&`, ${r.farmer.district}`]})]}),e.jsx("div",{className:"flex gap-2",children:r.farmer?.phone&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{variant:"outline",className:"flex-1",onClick:()=>window.open(`tel:${r.farmer?.phone}`),children:[e.jsx(hr,{className:"h-4 w-4 mr-2"}),"Call"]}),e.jsxs(z,{variant:"outline",className:"flex-1",onClick:()=>v(r.farmer?.phone||""),children:[e.jsx(pd,{className:"h-4 w-4 mr-2"}),"WhatsApp"]})]})})]})]}),!j&&e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-5 w-5 text-primary"}),"Update Status"]})}),e.jsxs(Q,{className:"space-y-3",children:[r.status==="assigned"&&e.jsxs(z,{className:"w-full h-14 text-lg",onClick:()=>b("en_route"),disabled:i.isPending,children:[e.jsx(aa,{className:"h-5 w-5 mr-2"}),"Start Trip"]}),r.status==="en_route"&&e.jsxs(z,{className:"w-full h-14 text-lg",onClick:()=>b("arrived"),disabled:i.isPending,children:[e.jsx(We,{className:"h-5 w-5 mr-2"}),"Arrived at Pickup"]}),r.status==="arrived"&&e.jsxs(z,{className:"w-full h-14 text-lg",onClick:()=>N("pickup","picked_up"),disabled:i.isPending,children:[e.jsx(qt,{className:"h-5 w-5 mr-2"}),"Confirm Pickup"]}),r.status==="picked_up"&&e.jsxs(z,{className:"w-full h-14 text-lg",onClick:()=>b("in_transit"),disabled:i.isPending,children:[e.jsx(op,{className:"h-5 w-5 mr-2"}),"Start Delivery"]}),r.status==="in_transit"&&e.jsxs(z,{className:"w-full h-14 text-lg bg-green-600 hover:bg-green-700",onClick:()=>N("delivery","delivered"),disabled:i.isPending,children:[e.jsx(qs,{className:"h-5 w-5 mr-2"}),"Confirm Delivery"]}),!["delivered","cancelled","issue"].includes(r.status)&&e.jsxs(z,{variant:"outline",className:"w-full text-amber-600 border-amber-300 hover:bg-amber-50",onClick:()=>f(!0),children:[e.jsx(ks,{className:"h-4 w-4 mr-2"}),"Report Issue"]})]})]}),r.status==="delivered"&&e.jsx(G,{className:"border-green-200 bg-green-50",children:e.jsxs(Q,{className:"py-6 text-center",children:[e.jsx(qs,{className:"h-12 w-12 text-green-600 mx-auto mb-3"}),e.jsx("p",{className:"font-medium text-green-800",children:"Delivered Successfully"}),r.delivered_at&&e.jsx("p",{className:"text-sm text-green-600",children:tt(ss(r.delivered_at),"MMMM d, yyyy h:mm a")})]})})]})]}),e.jsx(D3,{open:o,onOpenChange:c,tripId:r.id,type:l,nextStatus:d}),e.jsx(I3,{open:h,onOpenChange:f,tripId:r.id})]})})},L3=[{value:"truck",label:"Truck"},{value:"pickup",label:"Pickup"},{value:"mini_truck",label:"Mini Truck"},{value:"tempo",label:"Tempo"},{value:"tractor",label:"Tractor Trolley"}],q3=()=>{const{data:t,isLoading:s}=Bn(),r=Xe(),[a,n]=x.useState(!1),[i,o]=x.useState({name:"",phone:"",vehicle_type:"",vehicle_capacity:"",registration_number:"",operating_village:"",operating_district:""});x.useEffect(()=>{t&&o({name:t.name||"",phone:t.phone||"",vehicle_type:t.vehicle_type||"",vehicle_capacity:t.vehicle_capacity?.toString()||"",registration_number:t.registration_number||"",operating_village:t.operating_village||"",operating_district:t.operating_district||""})},[t]);const c=async()=>{if(!t?.id){ce.error("Profile not found");return}n(!0);try{const{error:l}=await W.from("transporters").update({name:i.name,phone:i.phone||null,vehicle_type:i.vehicle_type||null,vehicle_capacity:i.vehicle_capacity?parseFloat(i.vehicle_capacity):null,registration_number:i.registration_number||null,operating_village:i.operating_village||null,operating_district:i.operating_district||null}).eq("id",t.id);if(l)throw l;ce.success("Profile updated successfully!"),r.invalidateQueries({queryKey:["transporter-profile"]})}catch(l){ce.error("Failed to update profile: "+l.message)}finally{n(!1)}};return s?e.jsx(Oe,{title:"My Profile",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{className:"h-10 w-48"}),e.jsx(Re,{className:"h-96 w-full"})]})}):e.jsx(Oe,{title:"My Profile",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"My Profile"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your transporter profile and settings"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5 text-primary"}),"Personal Information"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"name",children:"Full Name *"}),e.jsx(Ce,{id:"name",value:i.name,onChange:l=>o(u=>({...u,name:l.target.value})),placeholder:"Enter your full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"phone",children:"Phone Number"}),e.jsx(Ce,{id:"phone",value:i.phone,onChange:l=>o(u=>({...u,phone:l.target.value})),placeholder:"+91 9876543210"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"operating_village",children:"Operating Village"}),e.jsx(Ce,{id:"operating_village",value:i.operating_village,onChange:l=>o(u=>({...u,operating_village:l.target.value})),placeholder:"Your base village"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"operating_district",children:"Operating District"}),e.jsx(Kr,{value:"",onValueChange:l=>{o(u=>({...u,operating_district:l}))},placeholder:i.operating_district||"Select district"}),i.operating_district&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: ",i.operating_district]})]}),e.jsx(xt,{to:"/logistics/service-area",className:"block mt-2",children:e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg border hover:bg-muted/50 transition-colors cursor-pointer",children:[e.jsx(We,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Service Areas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage districts you operate in"})]})]})})]})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-5 w-5 text-primary"}),"Primary Vehicle"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"vehicle_type",children:"Vehicle Type"}),e.jsxs(lt,{value:i.vehicle_type,onValueChange:l=>o(u=>({...u,vehicle_type:l})),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:"Select vehicle type"})}),e.jsx(ot,{children:L3.map(l=>e.jsx(ge,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"vehicle_capacity",children:"Capacity (tons)"}),e.jsx(Ce,{id:"vehicle_capacity",type:"number",value:i.vehicle_capacity,onChange:l=>o(u=>({...u,vehicle_capacity:l.target.value})),placeholder:"e.g., 10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"registration_number",children:"Registration Number"}),e.jsx(Ce,{id:"registration_number",value:i.registration_number,onChange:l=>o(u=>({...u,registration_number:l.target.value})),placeholder:"e.g., KA-01-AB-1234"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"You can add more vehicles from the Vehicles page"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(z,{onClick:c,disabled:a,children:[e.jsx(gn,{className:"h-4 w-4 mr-2"}),a?"Saving...":"Save Changes"]})})]})})};function z3(){const{data:t,isLoading:s}=mu("logistics"),r=Rv(),a=Dv(),[n,i]=x.useState(!1),[o,c]=x.useState(""),[l,u]=x.useState(""),d=()=>{if(!l&&!o){ce.error("Select at least a state or district");return}r.mutate({role_scope:"logistics",state_id:o||void 0,district_id:l||void 0},{onSuccess:()=>{ce.success("Service area added"),i(!1),c(""),u("")},onError:h=>ce.error(h.message)})},p=h=>{a.mutate(h,{onSuccess:()=>ce.success("Service area removed"),onError:f=>ce.error(f.message)})};return e.jsx(Oe,{title:"Service Area",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(We,{className:"h-6 w-6 text-primary"}),"My Service Areas"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage the districts you operate in. Transport requests in these areas will be suggested to you."})]}),e.jsxs(G,{children:[e.jsxs(je,{className:"flex flex-row items-center justify-between",children:[e.jsx(we,{className:"text-lg",children:"Active Areas"}),!n&&e.jsxs(z,{size:"sm",onClick:()=>i(!0),children:[e.jsx(Ss,{className:"h-4 w-4 mr-1"})," Add"]})]}),e.jsxs(Q,{className:"space-y-3",children:[s&&e.jsx(et,{className:"h-6 w-6 animate-spin mx-auto"}),!s&&(!t||t.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No service areas configured yet. Add your operating districts."}),(t??[]).map(h=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium",children:h.district_name||"State-level coverage"}),e.jsx(he,{variant:h.is_active?"default":"secondary",className:"text-xs",children:h.is_active?"Active":"Inactive"})]}),e.jsx(z,{size:"sm",variant:"ghost",className:"text-destructive hover:text-destructive",onClick:()=>p(h.id),disabled:a.isPending,children:e.jsx(Na,{className:"h-4 w-4"})})]},h.id))]})]}),n&&e.jsxs(G,{children:[e.jsx(je,{children:e.jsx(we,{className:"text-lg",children:"Add Service Area"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:"State"}),e.jsx(Ai,{value:o,onValueChange:h=>{c(h),u("")}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:"District"}),e.jsx(Kr,{stateId:o||null,value:l,onValueChange:u})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{onClick:d,disabled:r.isPending,children:[r.isPending?e.jsx(et,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(Ss,{className:"h-4 w-4 mr-1"}),"Add Area"]}),e.jsx(z,{variant:"outline",onClick:()=>{i(!1),c(""),u("")},children:"Cancel"})]})]})]})]})})}const Mi=()=>{const{user:t}=Fe();return De({queryKey:["buyer-profile",t?.id],queryFn:async()=>{if(!t?.id)return null;const{data:s,error:r}=await W.from("buyers").select("*").eq("user_id",t.id).maybeSingle();if(r)throw r;return s},enabled:!!t?.id})},B3=()=>{const t=Xe(),{user:s}=Fe();return dt({mutationFn:async r=>{if(!s?.id)throw new Error("Not authenticated");const{data:a,error:n}=await W.from("buyers").insert({user_id:s.id,name:r.name||"Buyer",company_name:r.company_name,phone:r.phone,district:r.district,buyer_type:r.buyer_type||"retail",preferred_crops:r.preferred_crops||[]}).select().single();if(n)throw n;return a},onSuccess:()=>{t.invalidateQueries({queryKey:["buyer-profile"]}),ce.success("Profile created!")},onError:r=>{ce.error("Failed to create profile: "+r.message)}})},$3=t=>De({queryKey:["market-products",t],queryFn:async()=>{const s={},{rpcJson:r}=await Ya(async()=>{const{rpcJson:n}=await Promise.resolve().then(()=>su);return{rpcJson:n}},void 0);return(await r("list_market_products_compact_v1",{p_filter:s,p_limit:30,p_cursor:null}))?.items||[]}}),U3=t=>{const{cropName:s,status:r}=t||{};return useInfiniteQuery({queryKey:["market-products-infinite",t],queryFn:async({pageParam:a=null})=>{const n={};s&&(n.crop_name=s),r&&(n.status=r);const{rpcJson:i}=await Ya(async()=>{const{rpcJson:c}=await Promise.resolve().then(()=>su);return{rpcJson:c}},void 0),o=await i("list_market_products_compact_v1",{p_filter:n,p_limit:24,p_cursor:a});return{items:o?.items||[],next_cursor:o?.next_cursor||null}},getNextPageParam:a=>a.next_cursor||void 0})},H3=t=>De({queryKey:["product-detail",t],queryFn:async()=>{const{data:s,error:r}=await W.from("crops").select("*").eq("id",t).single();if(r)throw r;const[a,n,i]=await Promise.all([W.from("profiles").select("full_name, village, district, phone").eq("id",s.farmer_id).maybeSingle(),s.land_id?W.from("farmlands").select("name, village, district, soil_type").eq("id",s.land_id).maybeSingle():Promise.resolve({data:null}),W.from("market_prices").select("*").eq("crop_name",s.crop_name).order("date",{ascending:!1}).limit(1).maybeSingle()]);return{...s,farmer:a.data,land:n.data,market_price:i.data}},enabled:!!t}),V3=()=>{const{data:t}=Mi();return De({queryKey:["buyer-orders",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:s}=await(await Ya(async()=>{const{rpcJson:r}=await Promise.resolve().then(()=>su);return{rpcJson:r}},void 0)).rpcJson("list_orders_compact_v1",{p_limit:50,p_cursor:null});return s?.items||[]},enabled:!!t?.id})},K3=()=>{const t=Xe(),{data:s}=Mi();return dt({mutationFn:async r=>{if(!s?.id)throw new Error("Buyer profile not found");const{placeOrder:a}=await Ya(async()=>{const{placeOrder:i}=await Promise.resolve().then(()=>Bv);return{placeOrder:i}},void 0),n=await a(r.crop_id,r.quantity,r.notes||null);if(!n||!n.success)throw new Error(n?.error||"Order failed");return n},onSuccess:()=>{t.invalidateQueries({queryKey:["buyer-orders"]}),ce.success("Order placed successfully!")},onError:r=>{ce.error("Failed to place order: "+r.message)}})},W3=()=>{const t=Ut(),{user:s}=Fe(),{t:r}=Nt(),{data:a,isLoading:n}=Mi(),i=B3(),{data:o}=$3(),{data:c}=V3(),{data:l,isLoading:u}=De({queryKey:["buyer-dashboard"],queryFn:async()=>await Yt("buyer_dashboard_v1")}),d={totalProducts:o?.length||0,freshHarvest:l?.recent_orders_top10?l.recent_orders_top10.length:0,oneWeekAway:0,activeOrders:l?.recent_orders_top10?l.recent_orders_top10.length:0},[p,h]=x.useState(!1),[f,y]=x.useState(null),v=()=>{i.mutate({name:s?.email?.split("@")[0]||"Buyer",buyer_type:"retail"})},b=async()=>{if(a){h(!0);try{const{data:{session:j}}=await W.auth.getSession();if(!j)throw new Error("Not authenticated");const C=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/ai-gateway/marketplace-ai",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({type:"stock_recommendation",buyerProfile:a,marketData:{available_crops:o?.slice(0,10)}})}),I=await C.json();if(!C.ok)throw new Error(I?.error?.message||"Function error");y(I.result),ce.success("AI recommendations ready!")}catch(j){console.error("AI error:",j),ce.error("Failed to get recommendations")}finally{h(!1)}}};if(n)return e.jsx(Oe,{title:r("nav.dashboard"),children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-32 w-full animate-pulse rounded-lg bg-muted"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[1,2,3,4].map(j=>e.jsx("div",{className:"h-24 animate-pulse rounded-lg bg-muted"},j))})]})});if(!a)return e.jsx(Oe,{title:r("nav.dashboard"),children:e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center",children:e.jsxs(G,{className:"w-full max-w-md",children:[e.jsxs(je,{className:"text-center",children:[e.jsx(ta,{className:"mx-auto mb-4 h-16 w-16 text-primary"}),e.jsx(we,{children:r("marketplace.welcomeMarketplace")})]}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("p",{className:"text-center text-muted-foreground",children:r("marketplace.setupBuyerProfile")}),e.jsx(z,{className:"w-full",onClick:v,disabled:i.isPending,children:i.isPending?r("marketplace.creatingProfile"):r("marketplace.createBuyerProfile")})]})]})})});const N=o?.filter(j=>j.status==="ready").slice(0,4)||[],A=c?.filter(j=>!["delivered","cancelled"].includes(j.status)).slice(0,3)||[];return e.jsx(Oe,{title:r("nav.dashboard"),children:e.jsxs($s,{title:r("marketplace.browseMarketplace"),subtitle:`Welcome, ${a.name} - ${a.company_name||a.buyer_type}`,actions:e.jsxs(z,{"aria-label":"Browse marketplace",onClick:()=>t("/marketplace/browse"),children:[e.jsx(ta,{className:"mr-2 h-4 w-4"}),r("marketplace.browseProducts")]}),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[e.jsx(Xs,{label:r("marketplace.available"),value:d.totalProducts,icon:qt,priority:"primary",onClick:()=>t("/marketplace/browse")}),e.jsx(Xs,{label:r("marketplace.freshHarvest"),value:d.freshHarvest,icon:Ys,priority:"success"}),e.jsx(Xs,{label:r("marketplace.comingSoon"),value:d.oneWeekAway,icon:pr,priority:"warning"}),e.jsx(Xs,{label:r("marketplace.activeOrdersLabel"),value:d.activeOrders,icon:ta,priority:"info",onClick:()=>t("/marketplace/orders")})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Ys,{className:"h-5 w-5 text-green-600"}),r("marketplace.freshHarvestAvailable")]}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>t("/marketplace/browse"),children:[r("common.viewAll")," ",e.jsx(Ir,{className:"ml-1 h-4 w-4"})]})]})}),e.jsx(Q,{children:N.length===0?e.jsx(nr,{icon:Ys,title:r("marketplace.noProductsFound"),description:r("marketplace.tryDifferentFilters")}):e.jsx("div",{className:"space-y-3",children:N.map(j=>e.jsxs("div",{className:"cursor-pointer rounded-lg border p-3 transition-colors hover:bg-accent/50",onClick:()=>t(`/marketplace/product/${j.id}`),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:j.crop_name}),e.jsx(he,{variant:"default",className:"bg-green-100 text-green-800",children:r("crops.readyShort")})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[j.estimated_quantity," ",j.quantity_unit]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3"}),j.farmer?.village||j.land?.village||r("common.unknown")]})]})]},j.id))})})]}),e.jsxs(G,{children:[e.jsx(je,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ta,{className:"h-5 w-5 text-blue-600"}),r("marketplace.yourActiveOrders")]}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>t("/marketplace/orders"),children:[r("common.viewAll")," ",e.jsx(Ir,{className:"ml-1 h-4 w-4"})]})]})}),e.jsx(Q,{children:A.length===0?e.jsx(nr,{icon:ta,title:r("orders.noOrdersYet"),description:r("marketplace.browseProducts"),actionLabel:r("marketplace.browseProducts"),onAction:()=>t("/marketplace/browse")}):e.jsx("div",{className:"space-y-3",children:A.map(j=>e.jsxs("div",{className:"cursor-pointer rounded-lg border p-3 transition-colors hover:bg-accent/50",onClick:()=>t("/marketplace/orders"),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:j.crop?.crop_name||"Order"}),e.jsx(he,{variant:"outline",children:j.status})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[j.quantity," ",j.quantity_unit]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ps,{className:"h-3 w-3"}),j.farmer?.full_name||"Farmer"]})]})]},j.id))})})]})]}),e.jsx(xu,{title:r("marketplace.aiStockAdvisor"),context:r("marketplace.stockAdvisorContext"),primaryAction:e.jsxs(z,{onClick:b,disabled:p,children:[e.jsx(Js,{className:"mr-2 h-4 w-4"}),r(p?"marketplace.stockAdvisorAnalyzing":"marketplace.stockAdvisorCta")]}),children:f?e.jsx("div",{className:"rounded-lg bg-background p-4 text-sm whitespace-pre-wrap",children:f}):e.jsx("p",{className:"text-muted-foreground",children:r("marketplace.stockAdvisorFallback")})})]})})},Y3={ready:"bg-green-100 text-green-800",one_week:"bg-amber-100 text-amber-800",growing:"bg-blue-100 text-blue-800"},G3={ready:"Ready Now",one_week:"1 Week Away",growing:"Growing"},Q3=()=>{const t=Ut(),[s,r]=x.useState(""),[a,n]=x.useState("all"),[i,o]=x.useState("newest"),{data:c,isLoading:l,fetchNextPage:u,hasNextPage:d,isFetchingNextPage:p,refetch:h}=U3({cropName:s||void 0,status:a!=="all"?a:void 0}),f=c?c.pages.flatMap(b=>b.items||[]):[],{t:y}=Nt(),v=[...f||[]].sort((b,N)=>{switch(i){case"quantity_high":return(N.estimated_quantity||0)-(b.estimated_quantity||0);case"quantity_low":return(b.estimated_quantity||0)-(N.estimated_quantity||0);case"harvest_date":return b.harvest_estimate?N.harvest_estimate?new Date(b.harvest_estimate).getTime()-new Date(N.harvest_estimate).getTime():-1:1;default:return 0}});return l?e.jsx(Oe,{title:"Browse Marketplace",children:e.jsx(xr,{loading:!0,children:e.jsx(e.Fragment,{})})}):e.jsx(Oe,{title:"Browse Marketplace",children:e.jsxs(Zs,{title:"Browse Marketplace",subtitle:`${v.length} products available`,children:[e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search crops...",value:s,onChange:b=>r(b.target.value),className:"pl-10"})]}),e.jsxs(lt,{value:a,onValueChange:n,children:[e.jsxs(it,{className:"w-full md:w-40",children:[e.jsx(ud,{className:"h-4 w-4 mr-2"}),e.jsx(ct,{placeholder:"Status"})]}),e.jsxs(ot,{children:[e.jsx(ge,{value:"all",children:"All Status"}),e.jsx(ge,{value:"ready",children:"Ready Now"}),e.jsx(ge,{value:"one_week",children:"1 Week Away"})]})]}),e.jsxs(lt,{value:i,onValueChange:o,children:[e.jsxs(it,{className:"w-full md:w-44",children:[e.jsx(gj,{className:"h-4 w-4 mr-2"}),e.jsx(ct,{placeholder:"Sort by"})]}),e.jsxs(ot,{children:[e.jsx(ge,{value:"newest",children:"Newest First"}),e.jsx(ge,{value:"harvest_date",children:"Harvest Date"}),e.jsx(ge,{value:"quantity_high",children:"Quantity: High"}),e.jsx(ge,{value:"quantity_low",children:"Quantity: Low"})]})]})]})})}),e.jsxs(xr,{empty:v.length===0,emptyTitle:"No products found",emptyMessage:"Try adjusting your search or filters.",children:[e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(b=>e.jsx(G,{className:"cursor-pointer hover:shadow-lg transition-all hover:-translate-y-1",onClick:()=>t(`/marketplace/product/${b.id}`),children:e.jsxs(Q,{className:"p-0",children:[e.jsx("div",{className:"h-32 bg-gradient-to-br from-green-100 to-green-50 flex items-center justify-center",children:e.jsx(Ys,{className:"h-12 w-12 text-green-300"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:b.crop_name}),b.variety&&e.jsx("p",{className:"text-sm text-muted-foreground",children:b.variety})]}),e.jsx(he,{className:Y3[b.status],children:G3[b.status]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Available:"}),e.jsxs("span",{className:"font-medium",children:[b.estimated_quantity," ",b.quantity_unit]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(We,{className:"h-3 w-3"}),e.jsxs("span",{children:[b.land?.village||b.farmer?.village||"Unknown",b.farmer?.district&&`, ${b.farmer.district}`]})]}),b.harvest_estimate&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(ms,{className:"h-3 w-3"}),e.jsxs("span",{children:["Harvest: ",tt(ss(b.harvest_estimate),"MMM d, yyyy")]})]})]}),e.jsx(z,{className:"w-full mt-4",variant:"outline",children:"View Details"})]})]})},b.id))}),e.jsx("div",{className:"mt-6 text-center",children:d?e.jsx(z,{variant:"outline",onClick:()=>u(),disabled:p,children:y(p?"common.loading":"common.loadMore")}):e.jsx("div",{className:"text-sm text-muted-foreground",children:y("common.noMoreItems")})})]})]})})},X3={ready:"bg-green-100 text-green-800",one_week:"bg-amber-100 text-amber-800",growing:"bg-blue-100 text-blue-800"},J3=()=>{const{id:t}=Dn(),s=Ut(),{data:r,isLoading:a}=H3(t),{data:n}=Mi(),i=K3(),[o,c]=x.useState(!1),[l,u]=x.useState(""),[d,p]=x.useState(""),[h,f]=x.useState(""),[y,v]=x.useState(""),[b,N]=x.useState(!1),[A,j]=x.useState(null),[C,I]=x.useState(!1),[k,R]=x.useState(null),S=async()=>{if(r){N(!0);try{const{data:{session:D}}=await W.auth.getSession();if(!D)throw new Error("Not authenticated");const F=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/ai-gateway/marketplace-ai",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${D.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({type:"price_forecast",product:r})}),H=await F.json();if(!F.ok)throw new Error(H?.error?.message||"Function error");j(H.result)}catch(D){console.error("AI error:",D),ce.error("Failed to get price forecast")}finally{N(!1)}}},T=async()=>{if(r){I(!0);try{const{data:{session:D}}=await W.auth.getSession();if(!D)throw new Error("Not authenticated");const F=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/ai-gateway/marketplace-ai",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${D.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtdGtremZ6ZG1wamxxZXhyYm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzEzNDMsImV4cCI6MjA4Njc0NzM0M30.-zSXGm5tasSBBJOONwzMX3Yp6C-stFgAPPmYJfnIMmg"},body:JSON.stringify({type:"alternatives",product:r})}),H=await F.json();if(!F.ok)throw new Error(H?.error?.message||"Function error");R(H.result)}catch(D){console.error("AI error:",D),ce.error("Failed to get alternatives")}finally{I(!1)}}},E=()=>{if(!r||!l){ce.error("Please enter quantity");return}i.mutate({crop_id:r.id,farmer_id:r.farmer_id,quantity:parseFloat(l),quantity_unit:r.quantity_unit,price_offered:d?parseFloat(d):void 0,delivery_address:h,notes:y},{onSuccess:()=>{c(!1),ce.success("Order placed! The farmer will review your request."),s("/marketplace/orders")}})};return a?e.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[e.jsx(Re,{className:"h-10 w-48"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(Re,{className:"h-96"}),e.jsx(Re,{className:"h-96"})]})]}):r?(r.market_price?.trend_direction==="up"||r.market_price?.trend_direction,e.jsx(Oe,{title:r.crop_name,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(z,{variant:"ghost",onClick:()=>s(-1),children:[e.jsx(ba,{className:"h-4 w-4 mr-2"})," Back"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold",children:r.crop_name}),r.variety&&e.jsx("p",{className:"text-muted-foreground",children:r.variety})]}),e.jsx(he,{className:X3[r.status]||"bg-gray-100",children:r.status==="ready"?"Ready Now":r.status==="one_week"?"1 Week":r.status})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-green-600"}),"Product Details"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("div",{className:"h-48 bg-gradient-to-br from-green-100 to-green-50 rounded-lg flex items-center justify-center",children:e.jsx(Ys,{className:"h-20 w-20 text-green-300"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Quantity Available"}),e.jsxs("p",{className:"font-semibold text-lg",children:[r.estimated_quantity," ",r.quantity_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Harvest Date"}),e.jsx("p",{className:"font-semibold",children:r.harvest_estimate?tt(ss(r.harvest_estimate),"MMM d, yyyy"):"TBD"})]}),r.sowing_date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sowing Date"}),e.jsx("p",{className:"font-semibold",children:tt(ss(r.sowing_date),"MMM d, yyyy")})]})]}),r.market_price&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Market Price"}),e.jsxs("p",{className:"font-semibold text-xl",children:["",r.market_price.modal_price,"/quintal"]})]}),e.jsxs("div",{className:`flex items-center gap-1 ${r.market_price.trend_direction==="up"?"text-green-600":r.market_price.trend_direction==="down"?"text-red-600":"text-gray-500"}`,children:[r.market_price.trend_direction==="up"&&e.jsx(pr,{className:"h-5 w-5"}),r.market_price.trend_direction==="down"&&e.jsx(kc,{className:"h-5 w-5"}),r.market_price.trend_direction==="flat"&&e.jsx(ko,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium capitalize",children:r.market_price.trend_direction})]})]})})]})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5 text-primary"}),"Farmer Details"]})}),e.jsxs(Q,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Name"}),e.jsx("p",{className:"font-medium",children:r.farmer?.full_name||"Farmer"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[r.land?.village||r.farmer?.village||"Unknown",r.farmer?.district&&`, ${r.farmer.district}`]})]}),r.farmer?.phone&&e.jsxs(z,{variant:"outline",className:"w-full",onClick:()=>window.open(`tel:${r.farmer?.phone}`),children:[e.jsx(hr,{className:"h-4 w-4 mr-2"}),"Contact Farmer"]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{className:"border-primary/20",children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(ta,{className:"h-5 w-5 text-primary"}),"Place Order"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Request to purchase this crop directly from the farmer."}),e.jsxs(z,{className:"w-full",size:"lg",onClick:()=>c(!0),children:[e.jsx(ta,{className:"h-4 w-4 mr-2"}),"Request Purchase"]})]})]}),e.jsxs(G,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-transparent",children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"h-5 w-5 text-primary"}),"AI Insights"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{variant:"outline",className:"w-full mb-2",onClick:S,disabled:b,children:b?"Analyzing...":"Should I Buy Now?"}),A&&e.jsx("div",{className:"p-3 bg-background rounded-lg text-sm whitespace-pre-wrap max-h-48 overflow-y-auto",children:A})]}),e.jsxs("div",{children:[e.jsx(z,{variant:"outline",className:"w-full mb-2",onClick:T,disabled:C,children:C?"Finding...":"Suggest Alternatives"}),k&&e.jsx("div",{className:"p-3 bg-background rounded-lg text-sm whitespace-pre-wrap max-h-48 overflow-y-auto",children:k})]})]})]})]})]}),e.jsx(zt,{open:o,onOpenChange:c,children:e.jsxs(It,{children:[e.jsx(Bt,{children:e.jsx($t,{children:"Request Purchase"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"font-medium",children:r.crop_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Available: ",r.estimated_quantity," ",r.quantity_unit]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"quantity",children:"Quantity Needed *"}),e.jsx(Ce,{id:"quantity",type:"number",placeholder:`Max: ${r.estimated_quantity} ${r.quantity_unit}`,value:l,onChange:D=>u(D.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"price",children:"Your Offer Price (/quintal)"}),e.jsx(Ce,{id:"price",type:"number",placeholder:"Optional",value:d,onChange:D=>p(D.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"address",children:"Delivery Address"}),e.jsx(zs,{id:"address",placeholder:"Where should it be delivered?",value:h,onChange:D=>f(D.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"notes",children:"Notes"}),e.jsx(zs,{id:"notes",placeholder:"Any special requirements?",value:y,onChange:D=>v(D.target.value)})]})]}),e.jsxs(br,{children:[e.jsx(z,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(z,{onClick:E,disabled:i.isPending,children:i.isPending?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),"Placing..."]}):"Place Order"})]})]})})]})})):e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs(z,{variant:"ghost",onClick:()=>s(-1),children:[e.jsx(ba,{className:"h-4 w-4 mr-2"})," Back"]}),e.jsx(G,{className:"mt-6",children:e.jsxs(Q,{className:"py-12 text-center",children:[e.jsx(Ys,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Product not found"})]})})]})},Z3=()=>Mn({queryKey:["orders-infinite"],queryFn:async({pageParam:t=null})=>{const s=await Yt("list_orders_compact_v1",{p_limit:24,p_cursor:t});return{items:s?.items||[],next_cursor:s?.next_cursor||null}},getNextPageParam:t=>t.next_cursor||void 0});async function vu(t,s){return await(await fetch(`/.netlify/functions/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"})).json()}async function e5(t,s,r){return await vu("place-order",{listing_id:t,qty:s,notes:r})}async function t5(t,s,r){return await vu("update-order-status",{order_id:t,new_status:s,proof_file_id:r||null})}async function zv(t,s){return await vu("create-payment-order",{order_id:t,provider:"razorpay"})}const Bv=Object.freeze(Object.defineProperty({__proto__:null,createPaymentOrder:zv,placeOrder:e5,updateOrderStatus:t5},Symbol.toStringTag,{value:"Module"})),po={requested:{label:"Requested",color:"bg-amber-100 text-amber-800",icon:vs},confirmed:{label:"Confirmed",color:"bg-blue-100 text-blue-800",icon:qs},in_transport:{label:"In Transport",color:"bg-purple-100 text-purple-800",icon:rt},delivered:{label:"Delivered",color:"bg-green-100 text-green-800",icon:qs},cancelled:{label:"Cancelled",color:"bg-red-100 text-red-800",icon:Ur}},s5=()=>{const t=Ut(),{data:s,isLoading:r,fetchNextPage:a,hasNextPage:n,isFetchingNextPage:i}=Z3(),{t:o}=useLanguage(),c=s?s.pages.flatMap(p=>p.items||[]):[];if(r)return e.jsx(Oe,{title:"My Orders",children:e.jsx(xr,{loading:!0,children:e.jsx(e.Fragment,{})})});const u=c?.filter(p=>!["delivered","cancelled"].includes(p.status))||[],d=c?.filter(p=>["delivered","cancelled"].includes(p.status))||[];return e.jsx(Oe,{title:"My Orders",children:e.jsxs(Zs,{title:"My Orders",subtitle:`${c?.length||0} total orders`,actions:e.jsxs(z,{variant:"default",onClick:()=>t("/marketplace/browse"),children:[e.jsx(ta,{className:"h-4 w-4 mr-2"}),"Shop More"]}),children:[e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-5 w-5 text-primary"}),"Active Orders (",u.length,")"]})}),e.jsx(Q,{children:u.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ta,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No active orders"})]}):e.jsx("div",{className:"space-y-4",children:u.map(p=>{const h=po[p.status]||po.requested,f=h.icon;return e.jsx("div",{className:"p-4 rounded-lg border hover:bg-accent/50 transition-colors",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:p.crop?.crop_name||"Order"}),e.jsxs(he,{className:h.color,children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),h.label]}),p.payout_hold&&e.jsx(he,{className:"bg-yellow-100 text-yellow-800 ml-2",children:"Payout hold"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs",children:"Quantity"}),e.jsxs("span",{className:"font-medium text-foreground",children:[p.quantity," ",p.quantity_unit]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs",children:"Farmer"}),e.jsx("span",{className:"font-medium text-foreground",children:p.farmer?.full_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs",children:"Order Date"}),e.jsx("span",{className:"font-medium text-foreground",children:tt(ss(p.created_at),"MMM d, yyyy")})]}),p.price_offered&&e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs",children:"Price Offered"}),e.jsxs("span",{className:"font-medium text-foreground",children:["",p.price_offered,"/q"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"flex items-center gap-1",children:["requested","confirmed","in_transport","delivered"].map((y,v)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${["requested","confirmed","in_transport","delivered"].indexOf(p.status)>=v?"bg-primary":"bg-muted"}`}),v<3&&e.jsx("div",{className:`w-6 h-0.5 ${["requested","confirmed","in_transport","delivered"].indexOf(p.status)>v?"bg-primary":"bg-muted"}`})]},y))})}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[(["unpaid","failed"].includes(p.payment_status)||!p.payment_status)&&["confirmed","requested","placed"].includes(p.status)&&e.jsx("button",{className:"px-3 py-1 rounded bg-primary text-white text-sm",onClick:async()=>{try{const y=await zv(p.id);if(!y||y.error){alert("Payment initiation failed: "+(y?.error||"unknown"));return}const{key_id:v,payment_order_id:b,amount:N,currency:A}=y,j={key:v,order_id:b,amount:N,currency:A,name:"AgriNext",description:"Order payment",notes:{order_id:p.id},handler:function(C){alert("Payment complete. Processing, please wait a few seconds and refresh the order.")},prefill:{}};window.Razorpay?new window.Razorpay(j).open():alert("Razorpay checkout not loaded. Please ensure checkout script is included on page.")}catch(y){console.error("pay now error",y),alert("Payment initiation failed")}},children:"Pay Now"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Payment: ",p.payment_status||"pending"]})]})]})},p.id)})})})]}),e.jsx("div",{className:"p-4 text-center",children:n?e.jsx(z,{variant:"outline",onClick:()=>a(),disabled:i,children:o(i?"common.loading":"common.loadMore")}):e.jsx("div",{className:"text-sm text-muted-foreground",children:o("common.noMoreItems")})}),d.length>0&&e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(qs,{className:"h-5 w-5 text-green-600"}),"Past Orders (",d.length,")"]})}),e.jsx(Q,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Product"}),e.jsx(Se,{children:"Quantity"}),e.jsx(Se,{children:"Farmer"}),e.jsx(Se,{children:"Date"}),e.jsx(Se,{children:"Status"})]})}),e.jsx(Ls,{children:d.map(p=>{const h=po[p.status]||po.requested;return e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:p.crop?.crop_name||"Order"}),e.jsxs(be,{children:[p.quantity," ",p.quantity_unit]}),e.jsx(be,{children:p.farmer?.full_name||"Unknown"}),e.jsx(be,{children:tt(ss(p.created_at),"MMM d, yyyy")}),e.jsx(be,{children:e.jsx(he,{className:h.color,children:h.label})})]},p.id)})})]})})})]})]})})},r5=[{value:"retail",label:"Retail Buyer"},{value:"wholesale",label:"Wholesaler"},{value:"restaurant",label:"Restaurant/Hotel"},{value:"export",label:"Exporter"},{value:"processor",label:"Food Processor"}],a5=()=>{const{data:t,isLoading:s}=Mi(),r=Xe(),[a,n]=x.useState(!1),[i,o]=x.useState({name:"",company_name:"",phone:"",district:"",buyer_type:"retail",preferred_crops:""});x.useEffect(()=>{t&&o({name:t.name||"",company_name:t.company_name||"",phone:t.phone||"",district:t.district||"",buyer_type:t.buyer_type||"retail",preferred_crops:t.preferred_crops?.join(", ")||""})},[t]);const c=async()=>{if(!t?.id){ce.error("Profile not found");return}n(!0);try{const l=i.preferred_crops.split(",").map(d=>d.trim()).filter(d=>d.length>0),{error:u}=await W.from("buyers").update({name:i.name,company_name:i.company_name||null,phone:i.phone||null,district:i.district||null,buyer_type:i.buyer_type,preferred_crops:l}).eq("id",t.id);if(u)throw u;ce.success("Profile updated!"),r.invalidateQueries({queryKey:["buyer-profile"]})}catch(l){const u=l instanceof Error?l.message:"Unknown error";ce.error(`Failed to update: ${u}`)}finally{n(!1)}};return s?e.jsx(Oe,{title:"Buyer Profile",children:e.jsx(xr,{loading:!0,children:e.jsx(e.Fragment,{})})}):e.jsx(Oe,{title:"Buyer Profile",children:e.jsxs(Zs,{title:"Buyer Profile",subtitle:"Manage your marketplace profile",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5 text-primary"}),"Personal Information"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"name",children:"Full Name *"}),e.jsx(Ce,{id:"name",value:i.name,onChange:l=>o(u=>({...u,name:l.target.value})),placeholder:"Your name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"phone",children:"Phone Number"}),e.jsx(Ce,{id:"phone",value:i.phone,onChange:l=>o(u=>({...u,phone:l.target.value})),placeholder:"+91 9876543210"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"district",children:"District"}),e.jsx(Kr,{value:"",onValueChange:l=>o(u=>({...u,district:l})),placeholder:i.district||"Select district"}),i.district&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Current: ",i.district]})]})]})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Xh,{className:"h-5 w-5 text-primary"}),"Business Details"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"company",children:"Company Name"}),e.jsx(Ce,{id:"company",value:i.company_name,onChange:l=>o(u=>({...u,company_name:l.target.value})),placeholder:"Your company/business name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"buyer_type",children:"Buyer Type"}),e.jsxs(lt,{value:i.buyer_type,onValueChange:l=>o(u=>({...u,buyer_type:l})),children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsx(ot,{children:r5.map(l=>e.jsx(ge,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"crops",children:"Preferred Crops"}),e.jsx(Ce,{id:"crops",value:i.preferred_crops,onChange:l=>o(u=>({...u,preferred_crops:l.target.value})),placeholder:"Rice, Wheat, Tomatoes (comma separated)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter crops you frequently purchase, separated by commas"})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(z,{onClick:c,disabled:a,children:[e.jsx(gn,{className:"h-4 w-4 mr-2"}),a?"Saving...":"Save Changes"]})})]})})},$v=()=>De({queryKey:["admin-dashboard-stats"],queryFn:async()=>{const{data:t}=await W.rpc("admin_dashboard_v1",{p_days:1});return{totalFarmers:t?.new_signups||0,totalBuyers:t?.new_signups||0,activeTransporters:t?.active_users||0,totalCrops:0,harvestReady:0,oneWeekAway:0,pendingTransport:0,activeTransport:0,newOrdersToday:t?.payment_failures||0,pendingOrders:0,raw:t}}}),n5=()=>De({queryKey:["admin-all-farmers"],queryFn:async()=>{const{data:t,error:s}=await W.from("profiles").select("*").order("created_at",{ascending:!1});if(s)throw s;return(await Promise.all((t||[]).map(async a=>{const[n,i,o]=await Promise.all([W.from("user_roles").select("role").eq("user_id",a.id).maybeSingle(),W.from("crops").select("id",{count:"exact"}).eq("farmer_id",a.id),W.from("farmlands").select("area").eq("farmer_id",a.id)]),c=(o.data||[]).reduce((l,u)=>l+(Number(u.area)||0),0);return{...a,role:n.data?.role||"unknown",cropCount:i.count||0,totalLand:c}}))).filter(a=>a.role==="farmer")}}),i5=()=>De({queryKey:["admin-all-agents"],queryFn:async()=>{const{data:t,error:s}=await W.from("profiles").select("*").order("created_at",{ascending:!1});if(s)throw s;return(await Promise.all((t||[]).map(async a=>{const[n,i,o]=await Promise.all([W.from("user_roles").select("role").eq("user_id",a.id).maybeSingle(),W.from("agent_tasks").select("id, task_status").eq("agent_id",a.id),W.from("agent_data").select("farmer_id").eq("agent_id",a.id)]),c=i.data||[],l=c.filter(d=>d.task_status==="completed").length,u=new Set((o.data||[]).map(d=>d.farmer_id)).size;return{...a,role:n.data?.role||"unknown",totalTasks:c.length,completedTasks:l,farmersHandled:u}}))).filter(a=>a.role==="agent")}}),o5=()=>De({queryKey:["admin-all-transporters"],queryFn:async()=>{const{data:t,error:s}=await W.from("transporters").select("*").order("created_at",{ascending:!1});if(s)throw s;return await Promise.all((t||[]).map(async a=>{const[n,i]=await Promise.all([W.from("vehicles").select("id",{count:"exact"}).eq("transporter_id",a.id),W.from("transport_requests").select("id, status").eq("transporter_id",a.user_id)]),o=i.data||[];return{...a,vehicleCount:n.count||0,activeTrips:o.filter(c=>["assigned","en_route","picked_up"].includes(c.status)).length,completedTrips:o.filter(c=>c.status==="delivered").length}}))}}),l5=()=>De({queryKey:["admin-all-buyers"],queryFn:async()=>{const{data:t,error:s}=await W.from("buyers").select("*").order("created_at",{ascending:!1});if(s)throw s;return await Promise.all((t||[]).map(async a=>{const i=(await W.from("market_orders").select("id, status").eq("buyer_id",a.id)).data||[];return{...a,totalOrders:i.length,activeOrders:i.filter(o=>!["delivered","cancelled"].includes(o.status)).length}}))}}),c5=()=>De({queryKey:["admin-all-crops"],queryFn:async()=>{const{data:t,error:s}=await W.from("crops").select("*").order("updated_at",{ascending:!1});if(s)throw s;return await Promise.all((t||[]).map(async a=>{const[n,i]=await Promise.all([W.from("profiles").select("full_name, village, district").eq("id",a.farmer_id).maybeSingle(),a.land_id?W.from("farmlands").select("name, village").eq("id",a.land_id).maybeSingle():Promise.resolve({data:null})]);return{...a,farmer:n.data,land:i.data}}))}}),d5=()=>De({queryKey:["admin-all-transport"],queryFn:async()=>{const{data:t,error:s}=await W.from("transport_requests").select("*").order("created_at",{ascending:!1});if(s)throw s;return await Promise.all((t||[]).map(async a=>{const[n,i,o]=await Promise.all([W.from("profiles").select("full_name, village").eq("id",a.farmer_id).maybeSingle(),a.crop_id?W.from("crops").select("crop_name").eq("id",a.crop_id).maybeSingle():Promise.resolve({data:null}),a.transporter_id?W.from("transporters").select("name, phone").eq("user_id",a.transporter_id).maybeSingle():Promise.resolve({data:null})]);return{...a,farmer:n.data,crop:i.data,transporter:o.data}}))}}),u5=()=>De({queryKey:["admin-all-orders"],queryFn:async()=>{const{data:t,error:s}=await W.from("market_orders").select("*").order("created_at",{ascending:!1});if(s)throw s;return await Promise.all((t||[]).map(async a=>{const[n,i,o]=await Promise.all([W.from("buyers").select("name, company_name").eq("id",a.buyer_id).maybeSingle(),W.from("profiles").select("full_name, village").eq("id",a.farmer_id).maybeSingle(),a.crop_id?W.from("crops").select("crop_name, variety").eq("id",a.crop_id).maybeSingle():Promise.resolve({data:null})]);return{...a,buyer:n.data,farmer:i.data,crop:o.data}}))}}),m5=()=>{const t=Xe();return dt({mutationFn:async({id:s,status:r,transporter_id:a})=>{const n={status:r};a!==void 0&&(n.transporter_id=a);const{error:i}=await W.from("transport_requests").update(n).eq("id",s);if(i)throw i},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-all-transport"]}),ce.success("Transport request updated!")},onError:s=>{ce.error("Update failed: "+s.message)}})},h5=()=>{const t=Xe();return dt({mutationFn:async({id:s,status:r})=>{const{error:a}=await W.from("market_orders").update({status:r}).eq("id",s);if(a)throw a},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-all-orders"]}),ce.success("Order status updated!")},onError:s=>{ce.error("Update failed: "+s.message)}})},p5=()=>De({queryKey:["admin-recent-activity"],queryFn:async()=>{const[t,s,r]=await Promise.all([W.from("market_orders").select("id, status, created_at").order("created_at",{ascending:!1}).limit(5),W.from("transport_requests").select("id, status, created_at").order("created_at",{ascending:!1}).limit(5),W.from("crops").select("id, crop_name, status, created_at").order("created_at",{ascending:!1}).limit(5)]),a=[];return(t.data||[]).forEach(n=>{a.push({id:n.id,type:"order",message:`New order placed (${n.status})`,time:n.created_at})}),(s.data||[]).forEach(n=>{a.push({id:n.id,type:"transport",message:`Transport request (${n.status})`,time:n.created_at})}),(r.data||[]).forEach(n=>{a.push({id:n.id,type:"crop",message:`Crop added: ${n.crop_name}`,time:n.created_at})}),a.sort((n,i)=>new Date(i.time).getTime()-new Date(n.time).getTime()).slice(0,10)}}),f5=()=>{const t=Xe(),{userRole:s}=Fe();x.useEffect(()=>{if(s!=="admin")return;console.log("[Admin Realtime] Setting up subscriptions...");const r=W.channel("admin-ecosystem-changes").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},a=>{console.log("[Admin Realtime] Profiles change:",a.eventType),t.invalidateQueries({queryKey:["admin-all-farmers"]}),t.invalidateQueries({queryKey:["admin-all-agents"]}),t.invalidateQueries({queryKey:["admin-dashboard-stats"]}),a.eventType==="INSERT"&&ce.info("New user registered",{description:"A new user has joined the platform"})}).on("postgres_changes",{event:"*",schema:"public",table:"user_roles"},a=>{console.log("[Admin Realtime] User roles change:",a.eventType),t.invalidateQueries({queryKey:["admin-all-farmers"]}),t.invalidateQueries({queryKey:["admin-all-agents"]}),t.invalidateQueries({queryKey:["admin-dashboard-stats"]})}).on("postgres_changes",{event:"*",schema:"public",table:"crops"},a=>{if(console.log("[Admin Realtime] Crops change:",a.eventType),t.invalidateQueries({queryKey:["admin-all-crops"]}),t.invalidateQueries({queryKey:["admin-dashboard-stats"]}),t.invalidateQueries({queryKey:["admin-recent-activity"]}),a.eventType==="INSERT"){const n=a.new;ce.info("New crop added",{description:`Crop: ${n.crop_name||"Unknown"}`})}}).on("postgres_changes",{event:"*",schema:"public",table:"transport_requests"},a=>{if(console.log("[Admin Realtime] Transport request change:",a.eventType),t.invalidateQueries({queryKey:["admin-all-transport"]}),t.invalidateQueries({queryKey:["admin-dashboard-stats"]}),t.invalidateQueries({queryKey:["admin-recent-activity"]}),a.eventType==="INSERT")ce.info("New transport request",{description:"A farmer has requested transport"});else if(a.eventType==="UPDATE"){const n=a.new;ce.info("Transport status updated",{description:`Status: ${n.status||"Unknown"}`})}}).on("postgres_changes",{event:"*",schema:"public",table:"market_orders"},a=>{if(console.log("[Admin Realtime] Market order change:",a.eventType),t.invalidateQueries({queryKey:["admin-all-orders"]}),t.invalidateQueries({queryKey:["admin-dashboard-stats"]}),t.invalidateQueries({queryKey:["admin-recent-activity"]}),a.eventType==="INSERT")ce.info("New market order",{description:"A new order has been placed"});else if(a.eventType==="UPDATE"){const n=a.new;ce.info("Order status updated",{description:`Status: ${n.status||"Unknown"}`})}}).on("postgres_changes",{event:"*",schema:"public",table:"buyers"},a=>{console.log("[Admin Realtime] Buyers change:",a.eventType),t.invalidateQueries({queryKey:["admin-all-buyers"]}),t.invalidateQueries({queryKey:["admin-dashboard-stats"]}),a.eventType==="INSERT"&&ce.info("New buyer registered",{description:"A new buyer has joined the marketplace"})}).on("postgres_changes",{event:"*",schema:"public",table:"transporters"},a=>{console.log("[Admin Realtime] Transporters change:",a.eventType),t.invalidateQueries({queryKey:["admin-all-transporters"]}),t.invalidateQueries({queryKey:["admin-dashboard-stats"]}),a.eventType==="INSERT"&&ce.info("New transporter registered",{description:"A new logistics partner has joined"})}).on("postgres_changes",{event:"*",schema:"public",table:"farmlands"},a=>{console.log("[Admin Realtime] Farmlands change:",a.eventType),t.invalidateQueries({queryKey:["admin-all-farmers"]}),t.invalidateQueries({queryKey:["admin-dashboard-stats"]})}).subscribe(a=>{console.log("[Admin Realtime] Subscription status:",a)});return()=>{console.log("[Admin Realtime] Cleaning up subscriptions..."),W.removeChannel(r)}},[t,s])},x5=()=>{f5();const{t}=Nt(),{data:s,isLoading:r,refetch:a}=$v(),{data:n,isLoading:i}=p5(),[o,c]=x.useState(null),[l,u]=x.useState(null),d=async p=>{c(p),u(null);try{const{data:h,error:f}=await W.functions.invoke("admin-ai",{body:{type:p,data:{totalFarmers:s?.totalFarmers||0,totalBuyers:s?.totalBuyers||0,activeTransporters:s?.activeTransporters||0,totalCrops:s?.totalCrops||0,harvestReady:s?.harvestReady||0,oneWeekAway:s?.oneWeekAway||0,pendingTransport:s?.pendingTransport||0,activeTransport:s?.activeTransport||0,pendingOrders:s?.pendingOrders||0,totalOrders:s?.newOrdersToday||0}}});if(f)throw f;u(h.analysis),ce.success(t("admin.aiAnalysisGenerated"))}catch(h){console.error("AI error:",h),ce.error(t("admin.failedToGenerate"))}finally{c(null)}};return e.jsx(Oe,{title:t("admin.commandCenter"),children:e.jsxs($s,{title:t("admin.commandCenter"),subtitle:t("admin.completeVisibility"),actions:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden items-center gap-2 rounded-full bg-emerald-100 px-3 py-1.5 dark:bg-emerald-900/30 sm:flex",children:[e.jsx(Fj,{className:"h-4 w-4 animate-pulse text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-400",children:t("common.live")})]}),e.jsxs(z,{"aria-label":"Refresh stats",onClick:()=>a(),variant:"outline",size:"sm",children:[e.jsx(jr,{className:"mr-2 h-4 w-4"}),t("common.refresh")]})]}),children:[e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:r?Array(8).fill(0).map((p,h)=>e.jsx(G,{children:e.jsx(Q,{className:"p-4",children:e.jsx(Re,{className:"h-10 w-full"})})},h)):e.jsxs(e.Fragment,{children:[e.jsx(Xs,{label:t("dashboard.totalFarmers"),value:s?.totalFarmers||0,icon:Cs,priority:"success"}),e.jsx(Xs,{label:t("dashboard.activeBuyers"),value:s?.totalBuyers||0,icon:tr,priority:"warning"}),e.jsx(Xs,{label:t("dashboard.activeTransporters"),value:s?.activeTransporters||0,icon:rt,priority:"info"}),e.jsx(Xs,{label:t("dashboard.activeCrops"),value:s?.totalCrops||0,icon:ts,priority:"success"}),e.jsx(Xs,{label:t("dashboard.harvestReady"),value:s?.harvestReady||0,icon:qt,priority:"warning"}),e.jsx(Xs,{label:t("dashboard.pendingTransport"),value:s?.pendingTransport||0,icon:rt,priority:"primary"}),e.jsx(Xs,{label:t("dashboard.newOrdersToday"),value:s?.newOrdersToday||0,icon:pr,priority:"info"}),e.jsx(Xs,{label:t("dashboard.pendingOrders"),value:s?.pendingOrders||0,icon:va,priority:"neutral"})]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(G,{className:"md:col-span-2",children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(va,{className:"h-5 w-5"}),t("dashboard.recentActivity")]})}),e.jsx(Q,{children:i?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((p,h)=>e.jsx(Re,{className:"h-12 w-full"},h))}):e.jsxs("div",{className:"space-y-3",children:[n?.map(p=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-muted/50 p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{variant:p.type==="order"?"default":p.type==="transport"?"secondary":"outline",children:p.type}),e.jsx("span",{className:"text-sm",children:p.message})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Er(new Date(p.time),{addSuffix:!0})})]},p.id)),!n?.length&&e.jsx(nr,{icon:va,title:t("dashboard.noRecentActivity"),description:""})]})})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Cc,{className:"h-5 w-5"}),t("dashboard.quickActions")]})}),e.jsxs(Q,{className:"space-y-3",children:[e.jsx(z,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs("a",{href:"/admin/farmers",children:[e.jsx(Cs,{className:"mr-2 h-4 w-4"}),t("admin.manageFarmers")]})}),e.jsx(z,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs("a",{href:"/admin/agents",children:[e.jsx(Cs,{className:"mr-2 h-4 w-4"}),t("admin.manageAgents")]})}),e.jsx(z,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs("a",{href:"/admin/transporters",children:[e.jsx(rt,{className:"mr-2 h-4 w-4"}),t("admin.manageTransporters")]})}),e.jsx(z,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs("a",{href:"/admin/ai-console",children:[e.jsx(hn,{className:"mr-2 h-4 w-4"}),t("admin.aiConsole")]})})]})]})]}),e.jsxs(xu,{title:t("admin.aiConsole"),context:t("admin.completeVisibility"),children:[e.jsxs("div",{className:"mb-6 grid gap-4 md:grid-cols-4",children:[e.jsxs(z,{onClick:()=>d("cluster_health"),disabled:!!o,className:"bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700",children:[o==="cluster_health"?e.jsx(jr,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(va,{className:"mr-2 h-4 w-4"}),t("admin.clusterHealth")]}),e.jsxs(z,{onClick:()=>d("supply_demand"),disabled:!!o,className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:[o==="supply_demand"?e.jsx(jr,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(pr,{className:"mr-2 h-4 w-4"}),t("admin.supplyDemand")]}),e.jsxs(z,{onClick:()=>d("price_anomaly"),disabled:!!o,className:"bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700",children:[o==="price_anomaly"?e.jsx(jr,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ks,{className:"mr-2 h-4 w-4"}),t("admin.priceAnomaly")]}),e.jsxs(z,{onClick:()=>d("efficiency_advisor"),disabled:!!o,className:"bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700",children:[o==="efficiency_advisor"?e.jsx(jr,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(hn,{className:"mr-2 h-4 w-4"}),t("admin.efficiency")]})]}),l?e.jsxs("div",{className:"rounded-lg border bg-muted/50 p-4",children:[e.jsxs("h4",{className:"mb-3 flex items-center gap-2 font-semibold",children:[e.jsx(hn,{className:"h-4 w-4"}),t("admin.aiAnalysis")]}),e.jsx("div",{className:"prose prose-sm max-w-none whitespace-pre-wrap dark:prose-invert",children:l})]}):null]})]})})},g5=()=>{const{data:t,isLoading:s}=n5(),[r,a]=x.useState(""),n=t?.filter(i=>i.full_name?.toLowerCase().includes(r.toLowerCase())||i.village?.toLowerCase().includes(r.toLowerCase())||i.district?.toLowerCase().includes(r.toLowerCase()))||[];return e.jsx(Oe,{title:"Farmer Management",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Cs,{className:"w-6 h-6 text-green-600"}),"Farmer Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage all registered farmers"})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search farmers...",value:r,onChange:i=>a(i.target.value),className:"pl-9"})]})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{children:["All Farmers (",n.length,")"]})}),e.jsx(Q,{children:s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((i,o)=>e.jsx(Re,{className:"h-16 w-full"},o))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Name"}),e.jsx(Se,{children:"Phone"}),e.jsx(Se,{children:"Location"}),e.jsx(Se,{children:"Land (acres)"}),e.jsx(Se,{children:"Active Crops"}),e.jsx(Se,{children:"Registered"})]})}),e.jsxs(Ls,{children:[n.map(i=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:i.full_name||"Unnamed"}),e.jsx(be,{children:i.phone||"-"}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(We,{className:"w-3 h-3"}),i.village||i.district||"Unknown"]})}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(lr,{className:"w-3 h-3"}),i.totalLand?.toFixed(1)||"0"]})}),e.jsx(be,{children:e.jsxs(he,{variant:"secondary",className:"flex items-center gap-1 w-fit",children:[e.jsx(ts,{className:"w-3 h-3"}),i.cropCount]})}),e.jsx(be,{className:"text-sm text-muted-foreground",children:new Date(i.created_at).toLocaleDateString()})]},i.id)),n.length===0&&e.jsx(mt,{children:e.jsx(be,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No farmers found"})})]})]})})})]})]})})},v5=()=>{const{data:t,isLoading:s}=i5(),[r,a]=x.useState(""),n=t?.filter(i=>i.full_name?.toLowerCase().includes(r.toLowerCase())||i.village?.toLowerCase().includes(r.toLowerCase())||i.district?.toLowerCase().includes(r.toLowerCase()))||[];return e.jsx(Oe,{title:"Agent Management",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Cs,{className:"w-6 h-6 text-purple-600"}),"Agent Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage field agents"})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search agents...",value:r,onChange:i=>a(i.target.value),className:"pl-9"})]})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{children:["All Agents (",n.length,")"]})}),e.jsx(Q,{children:s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((i,o)=>e.jsx(Re,{className:"h-16 w-full"},o))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Name"}),e.jsx(Se,{children:"Phone"}),e.jsx(Se,{children:"District"}),e.jsx(Se,{children:"Farmers Handled"}),e.jsx(Se,{children:"Tasks"}),e.jsx(Se,{children:"Completion Rate"})]})}),e.jsxs(Ls,{children:[n.map(i=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:i.full_name||"Unnamed"}),e.jsx(be,{children:i.phone||"-"}),e.jsx(be,{children:i.district||i.village||"Unknown"}),e.jsx(be,{children:e.jsxs(he,{variant:"secondary",children:[e.jsx(Cs,{className:"w-3 h-3 mr-1"}),i.farmersHandled]})}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"w-3 h-3"}),i.completedTasks,"/",i.totalTasks]})}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-3 h-3 text-green-600"}),i.totalTasks>0?Math.round(i.completedTasks/i.totalTasks*100):0,"%"]})})]},i.id)),n.length===0&&e.jsx(mt,{children:e.jsx(be,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No agents found"})})]})]})})})]})]})})},y5=()=>{const{data:t,isLoading:s}=o5(),[r,a]=x.useState(""),n=t?.filter(i=>i.name?.toLowerCase().includes(r.toLowerCase())||i.operating_district?.toLowerCase().includes(r.toLowerCase())||i.operating_village?.toLowerCase().includes(r.toLowerCase()))||[];return e.jsx(Oe,{title:"Transporter Management",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(rt,{className:"w-6 h-6 text-blue-600"}),"Transporter Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage logistics partners"})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search transporters...",value:r,onChange:i=>a(i.target.value),className:"pl-9"})]})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{children:["All Transporters (",n.length,")"]})}),e.jsx(Q,{children:s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((i,o)=>e.jsx(Re,{className:"h-16 w-full"},o))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Name"}),e.jsx(Se,{children:"Phone"}),e.jsx(Se,{children:"Operating Area"}),e.jsx(Se,{children:"Vehicles"}),e.jsx(Se,{children:"Active Trips"}),e.jsx(Se,{children:"Completed"})]})}),e.jsxs(Ls,{children:[n.map(i=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:i.name}),e.jsx(be,{children:i.phone||"-"}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(We,{className:"w-3 h-3"}),i.operating_district||i.operating_village||"All"]})}),e.jsx(be,{children:e.jsxs(he,{variant:"secondary",children:[e.jsx(rt,{className:"w-3 h-3 mr-1"}),i.vehicleCount]})}),e.jsx(be,{children:e.jsxs(he,{variant:i.activeTrips>0?"default":"outline",children:[e.jsx(qt,{className:"w-3 h-3 mr-1"}),i.activeTrips]})}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(ys,{className:"w-3 h-3"}),i.completedTrips]})})]},i.id)),n.length===0&&e.jsx(mt,{children:e.jsx(be,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No transporters found"})})]})]})})})]})]})})},j5=()=>{const{data:t,isLoading:s}=l5(),[r,a]=x.useState(""),n=t?.filter(o=>o.name?.toLowerCase().includes(r.toLowerCase())||o.company_name?.toLowerCase().includes(r.toLowerCase())||o.district?.toLowerCase().includes(r.toLowerCase()))||[],i=o=>{switch(o){case"retail":return"Retail";case"wholesale":return"Wholesale";case"restaurant":return"Restaurant";case"export":return"Export";default:return o}};return e.jsx(Oe,{title:"Buyer Management",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(tr,{className:"w-6 h-6 text-orange-600"}),"Buyer Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage marketplace buyers"})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search buyers...",value:r,onChange:o=>a(o.target.value),className:"pl-9"})]})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{children:["All Buyers (",n.length,")"]})}),e.jsx(Q,{children:s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((o,c)=>e.jsx(Re,{className:"h-16 w-full"},c))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Name"}),e.jsx(Se,{children:"Company"}),e.jsx(Se,{children:"Type"}),e.jsx(Se,{children:"District"}),e.jsx(Se,{children:"Total Orders"}),e.jsx(Se,{children:"Active Orders"})]})}),e.jsxs(Ls,{children:[n.map(o=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:o.name}),e.jsx(be,{children:o.company_name?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xh,{className:"w-3 h-3"}),o.company_name]}):"-"}),e.jsx(be,{children:e.jsx(he,{variant:"outline",children:i(o.buyer_type||"retail")})}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(We,{className:"w-3 h-3"}),o.district||"Unknown"]})}),e.jsx(be,{children:e.jsxs(he,{variant:"secondary",children:[e.jsx(qt,{className:"w-3 h-3 mr-1"}),o.totalOrders]})}),e.jsx(be,{children:e.jsx(he,{variant:o.activeOrders>0?"default":"outline",children:o.activeOrders})})]},o.id)),n.length===0&&e.jsx(mt,{children:e.jsx(be,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No buyers found"})})]})]})})})]})]})})},b5=()=>{const{data:t,isLoading:s}=c5(),[r,a]=x.useState(""),[n,i]=x.useState("all"),o=t?.filter(u=>{const d=u.crop_name?.toLowerCase().includes(r.toLowerCase())||u.farmer?.full_name?.toLowerCase().includes(r.toLowerCase())||u.farmer?.village?.toLowerCase().includes(r.toLowerCase()),p=n==="all"||u.status===n;return d&&p})||[],c=u=>{switch(u){case"ready":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300";case"one_week":return"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300";case"growing":return"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300";case"harvested":return"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300";default:return""}},l=u=>{switch(u){case"ready":return"Harvest Ready";case"one_week":return"1 Week Away";case"growing":return"Growing";case"harvested":return"Harvested";default:return u}};return e.jsx(Oe,{title:"Crop Monitoring",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(ts,{className:"w-6 h-6 text-emerald-600"}),"Crop Monitoring"]}),e.jsx("p",{className:"text-muted-foreground",children:"Complete crop ecosystem overview"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(lt,{value:n,onValueChange:i,children:[e.jsx(it,{className:"w-40",children:e.jsx(ct,{placeholder:"Filter status"})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"all",children:"All Status"}),e.jsx(ge,{value:"ready",children:"Harvest Ready"}),e.jsx(ge,{value:"one_week",children:"1 Week Away"}),e.jsx(ge,{value:"growing",children:"Growing"}),e.jsx(ge,{value:"harvested",children:"Harvested"})]})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search crops...",value:r,onChange:u=>a(u.target.value),className:"pl-9"})]})]})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{children:["All Crops (",o.length,")"]})}),e.jsx(Q,{children:s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((u,d)=>e.jsx(Re,{className:"h-16 w-full"},d))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Crop"}),e.jsx(Se,{children:"Farmer"}),e.jsx(Se,{children:"Location"}),e.jsx(Se,{children:"Status"}),e.jsx(Se,{children:"Quantity"}),e.jsx(Se,{children:"Harvest Date"})]})}),e.jsxs(Ls,{children:[o.map(u=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:e.jsxs("div",{children:[u.crop_name,u.variety&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(",u.variety,")"]})]})}),e.jsx(be,{children:u.farmer?.full_name||"Unknown"}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(We,{className:"w-3 h-3"}),u.farmer?.village||u.land?.village||"Unknown"]})}),e.jsx(be,{children:e.jsx(he,{className:c(u.status),children:l(u.status)})}),e.jsxs(be,{children:[u.estimated_quantity," ",u.quantity_unit||"quintals"]}),e.jsx(be,{children:u.harvest_estimate?e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ms,{className:"w-3 h-3"}),new Date(u.harvest_estimate).toLocaleDateString()]}):"-"})]},u.id)),o.length===0&&e.jsx(mt,{children:e.jsx(be,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No crops found"})})]})]})})})]})]})})},w5=()=>{const{data:t,isLoading:s}=d5(),r=m5(),a=i=>{switch(i){case"delivered":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300";case"picked_up":case"en_route":return"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300";case"assigned":return"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300";case"requested":return"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300";case"cancelled":return"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300";default:return""}},n=(i,o)=>{r.mutate({id:i,status:o})};return e.jsx(Oe,{title:"Transport Management",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(rt,{className:"w-6 h-6 text-blue-600"}),"Transport Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage all transport requests across the ecosystem"})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{children:["All Transport Requests (",t?.length||0,")"]})}),e.jsx(Q,{children:s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((i,o)=>e.jsx(Re,{className:"h-16 w-full"},o))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Farmer"}),e.jsx(Se,{children:"Crop"}),e.jsx(Se,{children:"Quantity"}),e.jsx(Se,{children:"Pickup"}),e.jsx(Se,{children:"Date"}),e.jsx(Se,{children:"Transporter"}),e.jsx(Se,{children:"Status"}),e.jsx(Se,{children:"Actions"})]})}),e.jsxs(Ls,{children:[t?.map(i=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:i.farmer?.full_name||"Unknown"}),e.jsx(be,{children:i.crop?.crop_name||"-"}),e.jsxs(be,{children:[i.quantity," ",i.quantity_unit||"quintals"]}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(We,{className:"w-3 h-3"}),i.pickup_village||i.pickup_location||"Unknown"]})}),e.jsx(be,{children:i.preferred_date?e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ms,{className:"w-3 h-3"}),new Date(i.preferred_date).toLocaleDateString()]}):"-"}),e.jsx(be,{children:i.transporter?.name||e.jsx("span",{className:"text-muted-foreground",children:"Not assigned"})}),e.jsx(be,{children:e.jsx(he,{className:a(i.status),children:i.status.replace("_"," ")})}),e.jsx(be,{children:e.jsxs(lt,{value:i.status,onValueChange:o=>n(i.id,o),children:[e.jsx(it,{className:"w-32",children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"requested",children:"Requested"}),e.jsx(ge,{value:"assigned",children:"Assigned"}),e.jsx(ge,{value:"en_route",children:"En Route"}),e.jsx(ge,{value:"picked_up",children:"Picked Up"}),e.jsx(ge,{value:"delivered",children:"Delivered"}),e.jsx(ge,{value:"cancelled",children:"Cancelled"})]})]})})]},i.id)),t?.length===0&&e.jsx(mt,{children:e.jsx(be,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No transport requests found"})})]})]})})})]})]})})},N5=()=>{const{data:t,isLoading:s}=u5(),r=h5(),a=i=>{switch(i){case"delivered":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300";case"shipped":return"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300";case"confirmed":return"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300";case"pending":return"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300";case"cancelled":return"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300";case"rejected":return"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300";default:return""}},n=(i,o)=>{r.mutate({id:i,status:o})};return e.jsx(Oe,{title:"Marketplace Orders",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(tr,{className:"w-6 h-6 text-orange-600"}),"Marketplace Orders"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage all marketplace orders"})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{children:["All Orders (",t?.length||0,")"]})}),e.jsx(Q,{children:s?e.jsx("div",{className:"space-y-3",children:Array(5).fill(0).map((i,o)=>e.jsx(Re,{className:"h-16 w-full"},o))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{children:"Buyer"}),e.jsx(Se,{children:"Crop"}),e.jsx(Se,{children:"Farmer"}),e.jsx(Se,{children:"Quantity"}),e.jsx(Se,{children:"Price"}),e.jsx(Se,{children:"Delivery Date"}),e.jsx(Se,{children:"Status"}),e.jsx(Se,{children:"Actions"})]})}),e.jsxs(Ls,{children:[t?.map(i=>e.jsxs(mt,{children:[e.jsx(be,{className:"font-medium",children:e.jsxs("div",{children:[i.buyer?.name||"Unknown",i.buyer?.company_name&&e.jsx("div",{className:"text-xs text-muted-foreground",children:i.buyer.company_name})]})}),e.jsxs(be,{children:[i.crop?.crop_name||"-",i.crop?.variety&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(",i.crop.variety,")"]})]}),e.jsx(be,{children:i.farmer?.full_name||"Unknown"}),e.jsxs(be,{children:[i.quantity," ",i.quantity_unit||"quintals"]}),e.jsx(be,{children:i.price_offered?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(No,{className:"w-3 h-3"}),"",i.price_offered.toLocaleString()]}):"-"}),e.jsx(be,{children:i.delivery_date?e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ms,{className:"w-3 h-3"}),new Date(i.delivery_date).toLocaleDateString()]}):"-"}),e.jsx(be,{children:e.jsx(he,{className:a(i.status),children:i.status.replace("_"," ")})}),e.jsx(be,{children:e.jsxs(lt,{value:i.status,onValueChange:o=>n(i.id,o),children:[e.jsx(it,{className:"w-32",children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"pending",children:"Pending"}),e.jsx(ge,{value:"confirmed",children:"Confirmed"}),e.jsx(ge,{value:"shipped",children:"Shipped"}),e.jsx(ge,{value:"delivered",children:"Delivered"}),e.jsx(ge,{value:"cancelled",children:"Cancelled"}),e.jsx(ge,{value:"rejected",children:"Rejected"})]})]})})]},i.id)),t?.length===0&&e.jsx(mt,{children:e.jsx(be,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No orders found"})})]})]})})})]})]})})},_5=[{id:"cluster_health",title:"Cluster Health Intelligence",description:"Comprehensive ecosystem analysis including hotspots, bottlenecks, and risk factors",icon:va,gradient:"from-purple-600 to-indigo-600",type:"cluster_health"},{id:"supply_demand",title:"Supply-Demand Forecast",description:"7-day prediction of supply vs demand with shortage/surplus alerts",icon:pr,gradient:"from-blue-600 to-cyan-600",type:"supply_demand"},{id:"price_anomaly",title:"Price Anomaly Detection",description:"Detect price irregularities, manipulation risks, and market anomalies",icon:ks,gradient:"from-amber-600 to-orange-600",type:"price_anomaly"},{id:"efficiency_advisor",title:"Operational Efficiency",description:"Agent productivity, transport utilization, and process optimization",icon:Js,gradient:"from-emerald-600 to-teal-600",type:"efficiency_advisor"}],k5=()=>{const{data:t,isLoading:s}=$v(),[r,a]=x.useState(null),[n,i]=x.useState({}),o=async c=>{a(c.id);try{const{data:l,error:u}=await W.functions.invoke("admin-ai",{body:{type:c.type,data:{totalFarmers:t?.totalFarmers||0,totalBuyers:t?.totalBuyers||0,activeTransporters:t?.activeTransporters||0,totalCrops:t?.totalCrops||0,harvestReady:t?.harvestReady||0,oneWeekAway:t?.oneWeekAway||0,pendingTransport:t?.pendingTransport||0,activeTransport:t?.activeTransport||0,pendingOrders:t?.pendingOrders||0,totalOrders:t?.newOrdersToday||0}}});if(u)throw u;i(d=>({...d,[c.id]:{text:l.analysis,timestamp:new Date().toLocaleString()}})),ce.success(`${c.title} analysis complete!`)}catch(l){console.error("AI error:",l),ce.error("Failed to generate AI analysis")}finally{a(null)}};return e.jsx(Oe,{title:"AI Command Console",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(hn,{className:"w-6 h-6 text-purple-600"}),"AI Command Console"]}),e.jsx("p",{className:"text-muted-foreground",children:"Generate AI-powered analytics and insights for the entire Agri Mitra ecosystem"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:_5.map(c=>e.jsxs(G,{className:"overflow-hidden",children:[e.jsxs(je,{className:`bg-gradient-to-r ${c.gradient} text-white`,children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(c.icon,{className:"w-5 h-5"}),c.title]}),e.jsx(kr,{className:"text-white/80",children:c.description})]}),e.jsxs(Q,{className:"p-4",children:[e.jsx(z,{onClick:()=>o(c),disabled:r===c.id||s,className:`w-full bg-gradient-to-r ${c.gradient} hover:opacity-90`,children:r===c.id?e.jsxs(e.Fragment,{children:[e.jsx(jr,{className:"w-4 h-4 mr-2 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(hn,{className:"w-4 h-4 mr-2"}),"Generate Report"]})}),n[c.id]&&e.jsxs("div",{className:"mt-4 p-4 bg-muted/50 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm text-muted-foreground",children:[e.jsx(vs,{className:"w-3 h-3"}),"Generated: ",n[c.id].timestamp]}),e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert whitespace-pre-wrap",children:n[c.id].text})]})]})]},c.id))}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(sr,{className:"w-5 h-5"}),"Current Ecosystem Data"]})}),e.jsx(Q,{children:s?e.jsx(Re,{className:"h-20 w-full"}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground",children:"Farmers"}),e.jsx("p",{className:"text-2xl font-bold",children:t?.totalFarmers||0})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground",children:"Harvest Ready"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t?.harvestReady||0})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground",children:"Pending Transport"}),e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:t?.pendingTransport||0})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-muted-foreground",children:"Pending Orders"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:t?.pendingOrders||0})]})]})})]})]})})};function C5(){const[t,s]=x.useState(!1),[r,a]=x.useState(null),[n,i]=x.useState(null),o=async()=>{s(!0),i(null),a(null);try{const{data:l,error:u}=await W.functions.invoke("seed-test-data");if(u)throw u;if(l?.success)a(l),ce.success("Test data seeded successfully!");else throw new Error(l?.error||"Failed to seed data")}catch(l){const u=l instanceof Error?l.message:"Unknown error occurred";i(u),ce.error("Failed to seed data: "+u)}finally{s(!1)}},c=[{role:"Farmers",icon:Ys,emails:"ramesh.gowda@agrimitra.in, shankarappa@agrimitra.in, etc.",password:"farmer123"},{role:"Agents",icon:Cs,emails:"mahesh.agent@agrimitra.in, kavya.agent@agrimitra.in, etc.",password:"agent123"},{role:"Transporters",icon:rt,emails:"raju.transport@agrimitra.in, sahana.logistics@agrimitra.in, etc.",password:"trans123"},{role:"Buyers",icon:tr,emails:"freshmart@agrimitra.in, mysuru.wholesale@agrimitra.in, etc.",password:"buyer123"},{role:"Super Admin",icon:Hr,emails:"admin@agrimitra.in",password:"admin123"},{role:"Ops Admin",icon:Hr,emails:"ops@agrimitra.in",password:"ops123"}];return e.jsx(Oe,{title:"Seed Test Data",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs(G,{children:[e.jsxs(je,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Ba,{className:"h-6 w-6"}),"Test Data Seeder"]}),e.jsx(kr,{children:"Create sample users, crops, orders, and other data for testing the entire AgriNext Gen ecosystem"})]}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 text-amber-800",children:[e.jsx("p",{className:"font-medium",children:" Warning"}),e.jsx("p",{className:"text-sm",children:"This will create test accounts and sample data. Run this only once on a fresh database to avoid duplicates."})]}),e.jsx(z,{onClick:o,disabled:t,size:"lg",className:"w-full",children:t?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"mr-2 h-5 w-5 animate-spin"}),"Seeding Data... This may take a minute"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ba,{className:"mr-2 h-5 w-5"}),"Seed All Test Data"]})}),n&&e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 text-destructive",children:[e.jsx("p",{className:"font-medium",children:"Error"}),e.jsx("p",{className:"text-sm",children:n})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-green-800",children:e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(ys,{className:"h-5 w-5"}),r.message]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(r.summary).map(([l,u])=>e.jsxs("div",{className:"bg-muted rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:u}),e.jsx("div",{className:"text-xs text-muted-foreground capitalize",children:l.replace(/_/g," ")})]},l))})]})]})]}),e.jsxs(G,{children:[e.jsxs(je,{children:[e.jsx(we,{children:"Test Credentials"}),e.jsx(kr,{children:"Use these credentials to log in and test each dashboard"})]}),e.jsx(Q,{children:e.jsx("div",{className:"space-y-3",children:c.map(l=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-lg",children:[e.jsx(l.icon,{className:"h-5 w-5 mt-0.5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium",children:l.role}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:l.emails})]}),e.jsx("code",{className:"text-sm bg-background px-2 py-1 rounded border",children:l.password})]},l.role))})})]})]})})}function S5(){const[t,s]=x.useState(!1),[r,a]=x.useState(!1),[n,i]=x.useState(null),[o,c]=x.useState(null),[l,u]=x.useState(null),d=async()=>{s(!0),u(null),i(null),c(null);try{const{data:v,error:b}=await W.functions.invoke("seed-mysuru-demo",{body:{action:"generate"}});if(b)throw b;if(v?.success)i(v),ce.success("Mysuru Demo Ecosystem generated successfully!");else throw new Error(v?.error||"Failed to generate demo data")}catch(v){const b=v instanceof Error?v.message:"Unknown error occurred";u(b),ce.error("Failed to generate demo: "+b)}finally{s(!1)}},p=async()=>{if(confirm("Are you sure you want to reset the Mysuru Demo Ecosystem? This will delete all demo data.")){a(!0),u(null),i(null),c(null);try{const{data:v,error:b}=await W.functions.invoke("seed-mysuru-demo",{body:{action:"reset"}});if(b)throw b;if(v?.success)c(v),ce.success("Mysuru Demo Ecosystem reset successfully!");else throw new Error(v?.error||"Failed to reset demo data")}catch(v){const b=v instanceof Error?v.message:"Unknown error occurred";u(b),ce.error("Failed to reset demo: "+b)}finally{a(!1)}}},h=v=>{navigator.clipboard.writeText(v),ce.success("Copied to clipboard!")},f=v=>v.includes("Farmer")?e.jsx(Ys,{className:"h-4 w-4 text-green-600"}):v.includes("Agent")?e.jsx(Cs,{className:"h-4 w-4 text-blue-600"}):v.includes("Transporter")?e.jsx(rt,{className:"h-4 w-4 text-orange-600"}):v.includes("Buyer")?e.jsx(tr,{className:"h-4 w-4 text-purple-600"}):v.includes("Admin")?e.jsx(Hr,{className:"h-4 w-4 text-red-600"}):e.jsx(Cs,{className:"h-4 w-4"}),y=v=>v.includes("Admin")?"destructive":v.includes("Agent")?"default":"secondary";return e.jsx(Oe,{title:"Mysuru Demo Ecosystem",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs(G,{className:"border-primary/20 bg-gradient-to-r from-primary/5 to-transparent",children:[e.jsx(je,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(We,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx(we,{children:"Mysuru Demo Ecosystem v2"}),e.jsx(kr,{children:"Complete demo environment with Hullahalli Hobli focus, scoped admins, escalations & disputes"})]})]})}),e.jsxs(Q,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"What gets created:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:" 15 Farmers (6 small, 6 medium, 3 large)"}),e.jsx("li",{children:" 4 Agents with village coverage"}),e.jsx("li",{children:" 6 Transporters with vehicles"}),e.jsx("li",{children:" 6 Buyers (wholesale, retail, export)"}),e.jsx("li",{children:" 6 Scoped Admins (super, state, district, taluk, village)"}),e.jsx("li",{children:" 60+ Crops with realistic status distribution"}),e.jsx("li",{children:" 40 Transport requests across all statuses"}),e.jsx("li",{children:" 30 Market orders"}),e.jsx("li",{children:" 10 Escalations + 8 Transport disputes"}),e.jsx("li",{children:" 150 Notifications"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Region:"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"State:"})," Karnataka"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"District:"})," Mysuru"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Taluk:"})," Mysuru / Nanjangud"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Hobli:"})," Hullahalli"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Villages:"})," Hullahalli, Bannur, Somanathapura, Talakadu, Sosale, Malavalli, Kollegal, Yelandur, Chamarajanagar, Gundlupet, Nanjangud, Mysuru Rural"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(z,{onClick:d,disabled:t||r,size:"lg",className:"flex-1",children:t?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"mr-2 h-5 w-5 animate-spin"}),"Generating Demo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ba,{className:"mr-2 h-5 w-5"}),"Generate Mysuru Demo Ecosystem"]})}),e.jsx(z,{onClick:p,disabled:t||r,size:"lg",variant:"outline",className:"border-destructive text-destructive hover:bg-destructive/10",children:r?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"mr-2 h-5 w-5 animate-spin"}),"Resetting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(jr,{className:"mr-2 h-5 w-5"}),"Reset Demo"]})})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4 text-amber-800 dark:text-amber-200 mt-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ks,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Important Notes"}),e.jsxs("ul",{className:"text-sm mt-1 space-y-1",children:[e.jsx("li",{children:" All demo data is tagged and can be safely reset without affecting real data"}),e.jsxs("li",{children:[" Password for all demo accounts: ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-900 px-1 rounded",children:"Demo@12345"})]}),e.jsx("li",{children:" Generate once, then use Reset to clear and regenerate"})]})]})]})})]})]}),l&&e.jsx(G,{className:"border-destructive",children:e.jsx(Q,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ks,{className:"h-5 w-5"}),e.jsxs("span",{className:"font-medium",children:["Error: ",l]})]})})}),o&&e.jsxs(G,{className:"border-green-500",children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(ys,{className:"h-5 w-5"}),o.message]})}),e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-3",children:Object.entries(o.deleted).filter(([v,b])=>b>0).map(([v,b])=>e.jsxs("div",{className:"bg-muted rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-destructive",children:b}),e.jsx("div",{className:"text-xs text-muted-foreground capitalize",children:v.replace(/_/g," ")})]},v))})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(ys,{className:"h-5 w-5"}),n.message]})}),e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-3",children:Object.entries(n.summary).map(([v,b])=>e.jsxs("div",{className:"bg-muted rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:b}),e.jsx("div",{className:"text-xs text-muted-foreground capitalize",children:v.replace(/_/g," ")})]},v))})})]}),e.jsxs(G,{children:[e.jsxs(je,{children:[e.jsx(we,{children:"Demo Credentials"}),e.jsxs(kr,{children:["Use these credentials to test each dashboard. Password for all: ",e.jsx("code",{className:"bg-muted px-2 py-1 rounded",children:"Demo@12345"})]})]}),e.jsx(Q,{children:e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(Os,{children:[e.jsx(Fs,{children:e.jsxs(mt,{children:[e.jsx(Se,{className:"w-[150px]",children:"Role"}),e.jsx(Se,{children:"Name"}),e.jsx(Se,{children:"Email"}),e.jsx(Se,{className:"w-[80px]",children:"Copy"})]})}),e.jsx(Ls,{children:n.credentials.map((v,b)=>e.jsxs(mt,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[f(v.role),e.jsx(he,{variant:y(v.role),className:"text-xs",children:v.role})]})}),e.jsx(be,{className:"font-medium",children:v.name}),e.jsx(be,{className:"font-mono text-sm",children:v.email}),e.jsx(be,{children:e.jsx(z,{size:"icon",variant:"ghost",onClick:()=>h(v.email),title:"Copy email",children:e.jsx(Nc,{className:"h-4 w-4"})})})]},b))})]})})})]})]})]})})}const A5=()=>{const[t,s]=x.useState(!1),{data:r,isLoading:a,refetch:n}=De({queryKey:["admin-trusted-sources"],queryFn:async()=>{const{data:N,error:A}=await W.from("trusted_sources").select("*").order("last_crawled_at",{ascending:!0,nullsFirst:!0});if(A)throw A;return N}}),{data:i,isLoading:o,refetch:c}=De({queryKey:["admin-farmer-segments"],queryFn:async()=>{const{data:N,error:A}=await W.from("farmer_segments").select("*").gt("active_farmer_count",0).order("last_crawled_at",{ascending:!0,nullsFirst:!0});if(A)throw A;return N}}),{data:l,isLoading:u,refetch:d}=De({queryKey:["admin-web-fetch-logs"],queryFn:async()=>{const{data:N,error:A}=await W.from("web_fetch_logs").select("*").order("fetched_at",{ascending:!1}).limit(20);if(A)throw A;return N}}),{data:p}=De({queryKey:["admin-price-confidence"],queryFn:async()=>{const{data:N,error:A}=await W.from("market_prices_agg").select("confidence");if(A)throw A;const j={high:0,medium:0,low:0};return N?.forEach(C=>{C.confidence==="high"?j.high++:C.confidence==="medium"?j.medium++:j.low++}),j}}),h=r?.filter(N=>N.last_crawled_at?(Date.now()-new Date(N.last_crawled_at).getTime())/(1e3*60*60)>N.crawl_frequency_hours:!0),f=i?.filter(N=>N.last_crawled_at?(Date.now()-new Date(N.last_crawled_at).getTime())/(1e3*60*60)>N.crawl_frequency_hours:!0),y=l?.filter(N=>!N.success),v=async(N=!1)=>{s(!0);try{const{data:A,error:j}=await W.functions.invoke("sync-karnataka-mandi-prices",{body:{force:N,maxSegments:20}});if(j)throw j;A?.success?(ce.success(`Sync complete! Success: ${A.results?.success||0}, Raw: ${A.results?.raw_records_inserted||0}`),n(),c(),d()):ce.error(A?.error||"Sync failed")}catch(A){ce.error(A instanceof Error?A.message:"Failed to run sync")}finally{s(!1)}},b=async()=>{try{const{data:N,error:A}=await W.functions.invoke("rebuild-farmer-segments",{body:{}});if(A)throw A;N?.success?(ce.success(`Segments rebuilt: ${N.segments_created}`),c()):ce.error(N?.error||"Rebuild failed")}catch(N){ce.error(N instanceof Error?N.message:"Failed to rebuild segments")}};return e.jsx(Oe,{title:"Data Health Monitor",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Firecrawl Data Health"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitor web ingestion, crawl status, and data quality"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",onClick:b,children:[e.jsx(Ba,{className:"h-4 w-4 mr-2"}),"Rebuild Segments"]}),e.jsxs(z,{variant:"outline",onClick:()=>v(!1),disabled:t,children:[e.jsx(jr,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),"Sync Now"]}),e.jsxs(z,{onClick:()=>v(!0),disabled:t,children:[t?e.jsx(jr,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(aa,{className:"h-4 w-4 mr-2"}),"Force Sync"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(G,{children:e.jsxs(Q,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Sources"}),e.jsx("p",{className:"text-2xl font-bold",children:r?.filter(N=>N.active).length||0})]}),e.jsx(mi,{className:"h-8 w-8 text-primary/50"})]}),h&&h.length>0&&e.jsxs(he,{variant:"destructive",className:"mt-2",children:[h.length," stale"]})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Segments"}),e.jsx("p",{className:"text-2xl font-bold",children:i?.length||0})]}),e.jsx(va,{className:"h-8 w-8 text-primary/50"})]}),f&&f.length>0&&e.jsxs(he,{variant:"outline",className:"mt-2 text-amber-600",children:[f.length," due for crawl"]})]})}),e.jsx(G,{children:e.jsx(Q,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price Confidence"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(he,{variant:"default",className:"bg-emerald-600",children:p?.high||0}),e.jsx(he,{variant:"outline",className:"text-amber-600",children:p?.medium||0}),e.jsx(he,{variant:"destructive",children:p?.low||0})]})]}),e.jsx(pr,{className:"h-8 w-8 text-primary/50"})]})})}),e.jsx(G,{children:e.jsx(Q,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Recent Failures"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:y?.length||0})]}),e.jsx(ks,{className:"h-8 w-8 text-destructive/50"})]})})})]}),y&&y.length>0&&e.jsxs(Nn,{variant:"destructive",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsxs(_n,{children:[y.length," recent crawl failures detected. Check logs below for details."]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(G,{children:[e.jsxs(je,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(mi,{className:"h-5 w-5"}),"Trusted Sources"]}),e.jsx(kr,{children:"Registered crawl targets"})]}),e.jsx(Q,{children:a?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(N=>e.jsx(Re,{className:"h-12"},N))}):e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:r?.map(N=>{const A=!N.last_crawled_at||(Date.now()-new Date(N.last_crawled_at).getTime())/36e5>N.crawl_frequency_hours;return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:N.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:N.category})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{variant:N.active?"default":"secondary",children:N.active?"Active":"Inactive"}),N.last_crawled_at?e.jsx("span",{className:`text-xs ${A?"text-amber-600":"text-muted-foreground"}`,children:Er(new Date(N.last_crawled_at),{addSuffix:!0})}):e.jsx("span",{className:"text-xs text-destructive",children:"Never crawled"})]})]},N.id)})})})]}),e.jsxs(G,{children:[e.jsxs(je,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(va,{className:"h-5 w-5"}),"Farmer Segments"]}),e.jsx(kr,{children:"District + Crop combinations with active farmers"})]}),e.jsx(Q,{children:o?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(N=>e.jsx(Re,{className:"h-12"},N))}):i?.length===0?e.jsx("p",{className:"text-muted-foreground text-sm",children:'No active segments. Run "Rebuild Segments" first.'}):e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:i?.map(N=>{const A=!N.last_crawled_at||(Date.now()-new Date(N.last_crawled_at).getTime())/36e5>N.crawl_frequency_hours;return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:N.crop_canonical}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[N.district,"  ",N.active_farmer_count," farmers"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[A?e.jsx(vs,{className:"h-4 w-4 text-amber-600"}):e.jsx(qs,{className:"h-4 w-4 text-emerald-600"}),N.last_crawled_at?e.jsx("span",{className:"text-xs text-muted-foreground",children:Er(new Date(N.last_crawled_at),{addSuffix:!0})}):e.jsx("span",{className:"text-xs text-amber-600",children:"Pending"})]})]},N.segment_key)})})})]})]}),e.jsxs(G,{children:[e.jsxs(je,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Ba,{className:"h-5 w-5"}),"Recent Crawl Logs"]}),e.jsx(kr,{children:"Last 20 web fetch operations"})]}),e.jsx(Q,{children:u?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(N=>e.jsx(Re,{className:"h-10"},N))}):e.jsx("div",{className:"space-y-1 max-h-96 overflow-y-auto",children:l?.map(N=>e.jsxs("div",{className:`flex items-center justify-between p-2 rounded text-sm ${N.success?"bg-muted/30":"bg-destructive/10"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[N.success?e.jsx(qs,{className:"h-4 w-4 text-emerald-600 shrink-0"}):e.jsx(ks,{className:"h-4 w-4 text-destructive shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:N.endpoint}),N.query&&e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-md",children:N.query}),N.error&&e.jsx("p",{className:"text-xs text-destructive truncate max-w-md",children:N.error})]})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:Er(new Date(N.fetched_at),{addSuffix:!0})}),N.latency_ms&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[N.latency_ms,"ms"]})]})]},N.id))})})]})]})})};function T5(){const{user:t}=Fe(),s=Xe(),[r,a]=x.useState(null),{data:n,isLoading:i}=De({queryKey:["admin-pending-updates"],queryFn:async()=>{const{data:l,error:u}=await W.rpc("get_pending_updates_v1");if(u)throw u;return l?.tasks||[]}}),o=dt({mutationFn:async l=>{if(!t?.id)throw new Error("Not authenticated");const u=l.payload,{error:d}=await W.from("profiles").update({...u,updated_at:new Date().toISOString()}).eq("id",l.farmer_id);if(d)throw d;const{error:p}=await W.from("agent_tasks").update({task_status:"approved",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",l.id);if(p)throw p;await W.from("agent_activity_logs").insert({actor_id:t.id,actor_role:"admin",farmer_id:l.farmer_id,action_type:"ADMIN_APPROVED_UPDATE",details:{task_id:l.id,applied_changes:u}})},onSuccess:()=>{s.invalidateQueries({queryKey:["admin-pending-updates"]}),a(null),ce.success("Update approved and applied")},onError:()=>ce.error("Failed to approve update")}),c=dt({mutationFn:async l=>{if(!t?.id)throw new Error("Not authenticated");const{error:u}=await W.from("agent_tasks").update({task_status:"rejected",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",l.id);if(u)throw u;await W.from("agent_activity_logs").insert({actor_id:t.id,actor_role:"admin",farmer_id:l.farmer_id,action_type:"ADMIN_REJECTED_UPDATE",details:{task_id:l.id,rejected_changes:l.payload}})},onSuccess:()=>{s.invalidateQueries({queryKey:["admin-pending-updates"]}),a(null),ce.success("Update rejected")},onError:()=>ce.error("Failed to reject update")});return e.jsx(Oe,{title:"Pending Updates",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Hr,{className:"h-6 w-6 text-amber-600"}),"Pending Farmer Updates"]}),e.jsx("p",{className:"text-muted-foreground",children:"Review and approve agent-submitted profile changes"})]}),i?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(l=>e.jsx(Re,{className:"h-24 w-full"},l))}):n?.length?e.jsx("div",{className:"space-y-4",children:n.map(l=>e.jsx(G,{className:"border-amber-200",children:e.jsx(Q,{className:"py-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsxs(he,{className:"bg-amber-100 text-amber-800",children:[e.jsx(vs,{className:"h-3 w-3 mr-1"}),"Pending Approval"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:tt(ss(l.created_at),"MMM d, yyyy h:mm a")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ps,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:l.farmer_name}),e.jsxs("span",{className:"text-muted-foreground",children:["(",l.farmer_village,", ",l.farmer_district,")"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Submitted by: ",e.jsx("span",{className:"font-medium",children:l.agent_name})]}),l.notes&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1 italic",children:['"',l.notes,'"']}),e.jsxs("div",{className:"mt-3 p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Proposed Changes:"}),Object.entries(l.payload||{}).map(([u,d])=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-mono text-xs bg-background px-1.5 py-0.5 rounded",children:u}),e.jsx(Ir,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:String(d)})]},u))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(z,{size:"sm",onClick:()=>o.mutate(l),disabled:o.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ys,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>c.mutate(l),disabled:c.isPending,className:"text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(Ur,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})})},l.id))}):e.jsx(G,{children:e.jsxs(Q,{className:"py-12 text-center",children:[e.jsx(ys,{className:"h-12 w-12 mx-auto text-green-500 mb-3"}),e.jsx("p",{className:"text-lg font-medium",children:"All caught up!"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending update requests"})]})})]})})}function Uv(t={}){return Mn({queryKey:["ops-inbox",t],queryFn:async({pageParam:s})=>await Yt("admin.get_ops_inbox_v1",{p_filters:t,p_limit:30,p_cursor:s??null}),initialPageParam:null,getNextPageParam:s=>s.next_cursor??void 0,staleTime:3e4,refetchOnWindowFocus:!1})}function P5(){const t=Xe();return dt({mutationFn:async({id:s,status:r})=>{const{data:a,error:n}=await(await Ya(async()=>{const{supabase:i}=await Promise.resolve().then(()=>Mp);return{supabase:i}},void 0)).supabase.from("ops_inbox_items").update({status:r}).eq("id",s);if(n)throw n;return a},onSuccess:()=>t.invalidateQueries({queryKey:["ops-inbox"]})})}function M5(){const{user:t}=Fe(),[s,r]=x.useState(null),[a,n]=x.useState(null),i=dt({mutationFn:async c=>{const l=await Bs("enqueue_job_v1",{p_job_type:"ai_search_intent_v1",p_payload:{query_text:c,actor_id:t?.id},p_run_at:new Date().toISOString(),p_idempotency_key:null});return r(l),l}}),o=De({queryKey:["smart-search-suggestion",s],queryFn:async()=>{const l=(await Yt("admin.list_ai_outputs_v1",{p_filters:{target_type:"search_intent",status:"suggested"},p_limit:5}))?.items||[];if(l.length>0){const u=l[0];return n(u.output?.suggested_filters??null),u}return null},enabled:!!s,refetchInterval:2e3,refetchOnWindowFocus:!1});return{submitSearch:i,suggestedFilters:a,setSuggestedFilters:n,isSearching:i.isPending,suggestion:o.data}}const R5=[{value:"",label:"All"},{value:"ticket",label:"Tickets"},{value:"stuck_trip",label:"Stuck Trips"},{value:"stuck_order",label:"Stuck Orders"},{value:"kyc_pending",label:"KYC Pending"},{value:"payout_pending",label:"Payouts"},{value:"dead_job",label:"Dead Jobs"},{value:"security_alert",label:"Security"}],D5={high:"bg-red-100 text-red-800 border-red-200",medium:"bg-yellow-100 text-yellow-800 border-yellow-200",low:"bg-green-100 text-green-800 border-green-200"};function E5(){const t=Ut(),{toast:s}=hs(),[r,a]=x.useState(""),[n,i]=x.useState(""),[o,c]=x.useState(""),[l,u]=x.useState(""),d=x.useMemo(()=>{const E={};return r&&(E.item_type=r),l&&(E.district_id=l),E},[r,l]),{data:p,fetchNextPage:h,hasNextPage:f,isFetchingNextPage:y,isLoading:v}=Uv(d),b=P5(),{submitSearch:N,suggestedFilters:A,setSuggestedFilters:j,isSearching:C}=M5(),{t:I}=Nt(),k=p?.pages.flatMap(E=>E.items)??[],R=()=>{n.trim()&&N.mutate(n)},S=()=>{A&&(A.item_type&&a(A.item_type),j(null),s({title:"Filters applied",description:"Search suggestion applied to inbox filters."}))},T=E=>{b.mutate({id:E,status:"resolved"},{onSuccess:()=>s({title:"Resolved"})})};return e.jsx(Oe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Ops Inbox"})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Smart search: e.g. 'stuck orders in last week', 'urgent tickets'...",className:"pl-9",value:n,onChange:E=>i(E.target.value),onKeyDown:E=>E.key==="Enter"&&R()})]}),e.jsxs(z,{onClick:R,disabled:C||!n.trim(),children:[e.jsx(Js,{className:"h-4 w-4 mr-1"}),C?"Analyzing...":"AI Search"]})]}),A&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"AI suggested:"}),Object.entries(A).map(([E,D])=>e.jsxs(he,{variant:"secondary",className:"text-xs",children:[E,": ",D]},E)),e.jsx(z,{size:"sm",variant:"outline",onClick:S,children:"Apply"}),e.jsx(z,{size:"sm",variant:"ghost",onClick:()=>j(null),children:e.jsx(ar,{className:"h-3 w-3"})})]})]})}),e.jsx(G,{children:e.jsx(Q,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"w-44",children:e.jsx(Ai,{value:o,onValueChange:E=>{c(E),u("")},placeholder:"Filter by state"})}),e.jsx("div",{className:"w-44",children:e.jsx(Kr,{stateId:o||null,value:l,onValueChange:u,placeholder:"Filter by district"})}),(o||l)&&e.jsxs(z,{size:"sm",variant:"ghost",onClick:()=>{c(""),u("")},children:[e.jsx(ar,{className:"h-3 w-3 mr-1"})," Clear geo"]})]})})}),e.jsx(zn,{value:r,onValueChange:a,children:e.jsx(Ja,{className:"flex-wrap h-auto gap-1",children:R5.map(E=>e.jsx(Vs,{value:E.value,className:"text-xs",children:E.label},E.value))})}),e.jsxs("div",{className:"space-y-2",children:[v&&Array.from({length:5}).map((E,D)=>e.jsx(G,{children:e.jsx(Q,{className:"py-4",children:e.jsx(Re,{className:"h-16 w-full"})})},D)),!v&&k.length===0&&e.jsx(G,{children:e.jsxs(Q,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(ys,{className:"mx-auto h-10 w-10 mb-2 text-green-500"}),e.jsx("p",{className:"font-medium",children:"All clear!"}),e.jsx("p",{className:"text-sm",children:"No open items in the ops inbox."})]})}),k.map(E=>e.jsx(G,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>t(`/admin/entity/${E.entity_type}/${E.entity_id}`),children:e.jsx(Q,{className:"py-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(ks,{className:`h-4 w-4 flex-shrink-0 ${E.severity==="high"?"text-red-500":E.severity==="medium"?"text-yellow-500":"text-green-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(he,{variant:"outline",className:"text-xs",children:E.item_type.replace(/_/g," ")}),e.jsx(he,{className:`text-xs ${D5[E.severity]||""}`,children:E.severity}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[E.entity_type,"/",E.entity_id.slice(0,8)]})]}),e.jsx("p",{className:"text-sm mt-1 truncate",children:E.summary||"No summary"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:[e.jsx(vs,{className:"inline h-3 w-3 mr-1"}),new Date(E.updated_at).toLocaleDateString()]}),e.jsx(z,{size:"sm",variant:"ghost",onClick:D=>{D.stopPropagation(),T(E.id)},children:e.jsx(ys,{className:"h-4 w-4"})})]})]})})},E.id))]}),f&&e.jsx("div",{className:"text-center",children:e.jsx(z,{variant:"outline",onClick:()=>h(),disabled:y,children:I(y?"common.loading":"common.loadMore")})})]})})}function I5({open:t,onClose:s,onConfirm:r,title:a,description:n,loading:i}){const[o,c]=x.useState(""),l=()=>{o.trim()&&(r(o.trim()),c(""))};return e.jsx(zt,{open:t,onOpenChange:u=>!u&&s(),children:e.jsxs(It,{className:"sm:max-w-md",children:[e.jsx(Bt,{children:e.jsx($t,{children:a})}),n&&e.jsx("p",{className:"text-sm text-muted-foreground",children:n}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{htmlFor:"reason",children:"Reason (required)"}),e.jsx(zs,{id:"reason",value:o,onChange:u=>c(u.target.value),placeholder:"Provide a reason for this action...",rows:3})]}),e.jsxs(br,{children:[e.jsx(z,{variant:"outline",onClick:s,disabled:i,children:"Cancel"}),e.jsx(z,{onClick:l,disabled:!o.trim()||i,children:i?"Processing...":"Confirm"})]})]})})}function O5({ev:t}){return e.jsx("div",{className:"flex items-start gap-3 text-sm border-b py-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"text-xs bg-gray-100 text-gray-800",children:t.severity}),e.jsx("span",{className:"font-medium",children:t.event_type}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:new Date(t.created_at).toLocaleString()})]}),t.metadata&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:JSON.stringify(t.metadata)})]})})}function F5({actorId:t}){const[s,r]=x.useState(null),a=20,{data:n,isLoading:i,refetch:o}=De({queryKey:["security-events",t,s],queryFn:()=>Yt("admin.list_security_events_v1",{p_actor_id:t,p_limit:a,p_cursor:s}),enabled:!!t,keepPreviousData:!0}),c=n||[];return e.jsxs("div",{children:[i&&e.jsx("div",{children:"Loading..."}),!i&&c.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"No security events"}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:c.map(l=>e.jsx(O5,{ev:l},l.id))}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(z,{disabled:i||c.length===0,onClick:()=>{if(c.length>0){const l=c[c.length-1];r(l.created_at)}},children:"Load older"}),e.jsx(z,{variant:"outline",onClick:()=>{r(null),o()},children:"Reset"})]})]})}function L5(t,s){return De({queryKey:["entity-360",t,s],queryFn:()=>Yt("admin.entity_360_v1",{p_entity_type:t,p_entity_id:s}),enabled:!!t&&!!s,staleTime:3e4,refetchOnWindowFocus:!1})}function q5(t,s){return De({queryKey:["ai-timeline-summary",t,s],queryFn:async()=>((await Yt("admin.list_ai_outputs_v1",{p_filters:{status:"suggested",target_type:"timeline"},p_limit:1}))?.items||[]).find(n=>n.target_id===s)??null,enabled:!!s,staleTime:6e4})}function z5(){const t=Xe();return dt({mutationFn:({userId:s,lock:r})=>Bs("admin.lock_user_v1",{p_user_id:s,p_lock:r}),onSuccess:()=>t.invalidateQueries({queryKey:["entity-360"]})})}function B5(){const t=Xe();return dt({mutationFn:({userId:s,reason:r})=>Bs("admin.unlock_user_v1",{p_user_id:s,p_reason:r}),onSuccess:()=>t.invalidateQueries({queryKey:["entity-360"]})})}function $5(){const t=Xe();return dt({mutationFn:({tripId:s,newStatus:r,reason:a})=>Bs("admin.override_trip_status_v1",{p_trip_id:s,p_new_status:r,p_reason:a}),onSuccess:()=>t.invalidateQueries({queryKey:["entity-360"]})})}function U5(){const t=Xe();return dt({mutationFn:({orderId:s,newStatus:r,reason:a})=>Bs("admin.admin_override_order_v1",{p_order_id:s,p_new_status:r,p_reason:a}),onSuccess:()=>t.invalidateQueries({queryKey:["entity-360"]})})}function H5(){const t=Xe();return dt({mutationFn:({userId:s})=>Bs("admin.force_logout_user_v1",{p_user_id:s}),onSuccess:()=>t.invalidateQueries({queryKey:["entity-360"]})})}function V5(){const t=Xe();return dt({mutationFn:({userId:s,newStatus:r,reason:a,blockedUntil:n})=>Bs("admin.set_account_status_v1",{p_user_id:s,p_new_status:r,p_reason:a||null,p_blocked_until:n||null}),onSuccess:()=>t.invalidateQueries({queryKey:["entity-360"]})})}function K5(){const t=Xe();return dt({mutationFn:({userId:s,reason:r})=>Bs("admin.reset_risk_score_v1",{p_user_id:s,p_reason:r||null}),onSuccess:()=>t.invalidateQueries({queryKey:["entity-360"]})})}function W5(){const t=Xe();return dt({mutationFn:({userId:s,delta:r,reason:a})=>Bs("admin.add_risk_score_v1",{p_user_id:s,p_delta:r,p_reason:a||null}),onSuccess:()=>t.invalidateQueries({queryKey:["entity-360"]})})}const Y5={STATUS_CHANGED:"bg-blue-100 text-blue-800",OVERRIDE:"bg-red-100 text-red-800",CREATED:"bg-green-100 text-green-800",CANCELLED:"bg-gray-100 text-gray-800"};function G5(t){for(const[s,r]of Object.entries(Y5))if(t.includes(s))return r;return"bg-gray-100 text-gray-700"}function Q5(){const{type:t,id:s}=Dn(),r=Ut(),{toast:a}=hs(),[n,i]=x.useState({action:"",open:!1}),{data:o,isLoading:c,error:l}=L5(t||"",s||""),{data:u,isLoading:d}=q5(t||"",s||""),{data:p}=De({queryKey:["suggest-agents",s],queryFn:()=>Yt("suggest_agents_for_farmer_v1",{p_farmer_user_id:s,p_limit:5}),enabled:t==="user"&&!!s,staleTime:6e4}),{data:h}=De({queryKey:["suggest-transporters",s],queryFn:()=>Yt("suggest_transporters_v1",{p_transport_request_id:s,p_limit:10}),enabled:t==="transport_request"&&!!s,staleTime:6e4}),f=z5(),y=B5(),v=H5(),b=$5(),N=U5(),A=V5(),j=K5(),C=W5(),I=o?.core,k=R=>{const S=n.action;if(i({action:"",open:!1}),S==="lock"&&I?.id)f.mutate({userId:I.id,lock:!0},{onSuccess:()=>a({title:"User locked"})});else if(S==="restrict"&&I?.id){const T=new Date(Date.now()+864e5).toISOString();A.mutate({userId:I.id,newStatus:"restricted",reason:R,blockedUntil:T},{onSuccess:()=>a({title:"User restricted for 24h"})})}else S==="unlock"&&I?.id?y.mutate({userId:I.id,reason:R},{onSuccess:()=>a({title:"User unlocked"})}):S==="force_logout"&&I?.id?v.mutate({userId:I.id},{onSuccess:()=>a({title:"Session revoked"})}):S==="override_trip"&&s?b.mutate({tripId:s,newStatus:"cancelled",reason:R},{onSuccess:()=>a({title:"Trip overridden"})}):S==="override_order"&&s&&N.mutate({orderId:s,newStatus:"cancelled",reason:R},{onSuccess:()=>a({title:"Order overridden"})})};return e.jsx(Oe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>r(-1),children:e.jsx(ba,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold capitalize",children:[t," Details"]}),e.jsx(he,{variant:"outline",className:"text-xs font-mono",children:s?.slice(0,8)})]}),c&&e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((R,S)=>e.jsx(Re,{className:"h-32 w-full"},S))}),l&&e.jsx(G,{children:e.jsx(Q,{className:"py-8 text-center text-red-500",children:"Failed to load entity data."})}),I&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(G,{children:[e.jsx(je,{children:e.jsx(we,{className:"text-base",children:"Core Info"})}),e.jsx(Q,{children:e.jsxs("dl",{className:"space-y-2 text-sm",children:[Object.entries(I).filter(([R])=>!["roles"].includes(R)).map(([R,S])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground capitalize",children:R.replace(/_/g," ")}),e.jsx("dd",{className:"font-medium text-right max-w-[200px] truncate",children:S===!0?"Yes":S===!1?"No":String(S??"")})]},R)),I.roles&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Roles"}),e.jsx("dd",{children:I.roles.map(R=>e.jsx(he,{variant:"secondary",className:"ml-1 text-xs",children:R},R))})]})]})})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsx(we,{className:"text-base",children:"Admin Actions"})}),e.jsxs(Q,{className:"space-y-2",children:[t==="user"&&e.jsxs(e.Fragment,{children:[I.is_locked?e.jsxs(z,{variant:"outline",className:"w-full justify-start",onClick:()=>i({action:"unlock",open:!0}),children:[e.jsx(Ej,{className:"h-4 w-4 mr-2"})," Unlock User"]}):e.jsxs(z,{variant:"destructive",className:"w-full justify-start",onClick:()=>i({action:"lock",open:!0}),children:[e.jsx(md,{className:"h-4 w-4 mr-2"})," Lock User"]}),e.jsxs(z,{variant:"outline",className:"w-full justify-start",onClick:()=>i({action:"force_logout",open:!0}),children:[e.jsx(_o,{className:"h-4 w-4 mr-2"})," Force Logout"]})]}),t==="trip"&&e.jsxs(z,{variant:"destructive",className:"w-full justify-start",onClick:()=>i({action:"override_trip",open:!0}),children:[e.jsx(ks,{className:"h-4 w-4 mr-2"})," Override Trip Status"]}),t==="order"&&e.jsxs(z,{variant:"destructive",className:"w-full justify-start",onClick:()=>i({action:"override_order",open:!0}),children:[e.jsx(ks,{className:"h-4 w-4 mr-2"})," Override Order Status"]}),o?.related&&Object.entries(o.related).filter(([,R])=>R).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(wa,{className:"my-3"}),e.jsx("p",{className:"text-xs text-muted-foreground font-medium",children:"Related Entities"}),Object.entries(o.related).filter(([,R])=>R).map(([R,S])=>{const T=R.replace(/_id$/,"");return e.jsx(xt,{to:`/admin/entity/${T}/${S}`,className:"block",children:e.jsxs(he,{variant:"secondary",className:"cursor-pointer text-xs",children:[R,": ",String(S).slice(0,8),"..."]})},R)})]}),e.jsx(wa,{className:"my-3"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Hr,{className:"h-4 w-4"}),e.jsxs("span",{children:["Security events (30d): ",o?.security_events_30d??0]})]})]})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsx(we,{className:"text-base",children:"Security"})}),e.jsxs(Q,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Account status"}),e.jsx("p",{className:"font-medium",children:I.account_status||"active"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Blocked until"}),e.jsx("p",{className:"font-medium",children:I.blocked_until?new Date(I.blocked_until).toLocaleString():""})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Risk score"}),e.jsx("p",{className:"font-medium",children:I.risk_score??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recent security events"}),e.jsxs("p",{className:"font-medium",children:[o?.security_events_30d??0," (30d)"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"outline",onClick:()=>i({action:"restrict",open:!0}),children:"Restrict (24h)"}),e.jsx(z,{variant:"destructive",onClick:()=>i({action:"lock",open:!0}),children:"Lock"}),e.jsx(z,{variant:"secondary",onClick:()=>j.mutate({userId:I.id,reason:"Admin reset via entity360"}),children:"Reset risk"}),e.jsx(z,{variant:"ghost",onClick:()=>C.mutate({userId:I.id,delta:5,reason:"Manual increment"}),children:"+5 risk"})]})]})]})]}),I&&(I.geo_district_id||I.geo_state_id||I.district)&&e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"text-base flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"})," Geography"]})}),e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[I.geo_state_id&&e.jsxs(he,{variant:"outline",children:["State: ",I.geo_state_id.toString().slice(0,8)]}),I.geo_district_id&&e.jsxs(he,{variant:"outline",children:["District: ",I.geo_district_id.toString().slice(0,8)]}),I.district&&e.jsxs(he,{variant:"secondary",children:["Legacy: ",String(I.district)]}),I.home_market_id&&e.jsxs(he,{variant:"outline",children:["Market: ",I.home_market_id.toString().slice(0,8)]})]})})]}),t==="user"&&p?.items&&p.items.length>0&&e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"text-base flex items-center gap-2",children:[e.jsx(Cs,{className:"h-4 w-4"})," Suggested Agents (",p.items.length,")"]})}),e.jsxs(Q,{children:[e.jsx("div",{className:"space-y-2",children:p.items.map(R=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:R.agent_name||"Agent"}),e.jsx(he,{variant:"outline",className:"text-xs",children:R.match_type}),e.jsx("span",{className:"text-xs text-muted-foreground",children:R.service_district})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Tasks: ",R.open_tasks]}),e.jsxs("span",{children:["Farmers: ",R.assigned_farmers]}),e.jsxs(he,{variant:"secondary",className:"text-xs",children:["Score: ",R.score]})]})]},R.agent_user_id))}),p.reason&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:p.reason})]})]}),t==="transport_request"&&h?.items&&h.items.length>0&&e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"text-base flex items-center gap-2",children:[e.jsx(rt,{className:"h-4 w-4"})," Suggested Transporters (",h.items.length,")"]})}),e.jsxs(Q,{children:[e.jsx("div",{className:"space-y-2",children:h.items.map(R=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:R.transporter_name||"Transporter"}),e.jsx(he,{variant:"outline",className:"text-xs",children:R.match_type}),e.jsx("span",{className:"text-xs text-muted-foreground",children:R.service_district})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Active trips: ",R.active_trips]}),e.jsxs(he,{variant:"secondary",className:"text-xs",children:["Score: ",R.score]})]})]},R.transporter_user_id))}),h.reason&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:h.reason})]})]}),o?.tickets&&o.tickets.length>0&&e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"text-base flex items-center gap-2",children:[e.jsx(up,{className:"h-4 w-4"})," Open Tickets (",o.tickets.length,")"]})}),e.jsx(Q,{children:e.jsx("div",{className:"space-y-2",children:o.tickets.map(R=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{variant:"outline",className:"text-xs",children:R.category}),e.jsx(he,{className:R.priority==="urgent"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:R.priority}),e.jsx("span",{className:"truncate max-w-xs",children:R.message.slice(0,80)})]}),e.jsx(xt,{to:"/admin/tickets",children:e.jsx(z,{size:"sm",variant:"ghost",children:"View"})})]},R.id))})})]}),e.jsxs(G,{children:[e.jsx(je,{children:e.jsx(we,{className:"text-base",children:"AI Timeline Summary"})}),e.jsxs(Q,{children:[d&&e.jsx(Re,{className:"h-20 w-full"}),!d&&u&&e.jsxs("div",{className:"bg-muted/50 p-3 rounded text-sm space-y-1",children:[e.jsx("p",{className:"whitespace-pre-wrap",children:u.output?.summary||"No summary available"}),u.output?.anomalies?.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"font-medium text-xs text-orange-600",children:"Anomalies:"}),e.jsx("ul",{className:"list-disc pl-4 text-xs text-orange-600",children:u.output.anomalies.map((R,S)=>e.jsx("li",{children:R},S))})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Provider: ",u.provider," | Confidence: ",u.confidence??"N/A"]})]}),!d&&!u&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No AI summary available yet. It will be generated when an ops scan runs."})]})]}),o?.timeline&&o.timeline.length>0&&e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"text-base",children:["Timeline (",o.timeline.length," events)"]})}),e.jsx(Q,{children:e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:o.timeline.map((R,S)=>e.jsxs("div",{className:"flex items-start gap-3 text-sm border-l-2 border-muted pl-3 py-1",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(vs,{className:"h-3 w-3 mt-1 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:`text-xs ${G5(R.event_type)}`,children:R.event_type}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(R.created_at).toLocaleString()})]}),R.metadata&&Object.keys(R.metadata).length>0&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5 truncate",children:JSON.stringify(R.metadata).slice(0,120)})]})]},S))})})]}),t==="user"&&e.jsxs(G,{children:[e.jsx(je,{children:e.jsx(we,{className:"text-base",children:"Security Events"})}),e.jsx(Q,{children:e.jsx(F5,{actorId:s||""})})]}),e.jsx(I5,{open:n.open,onClose:()=>i({action:"",open:!1}),onConfirm:k,title:`Confirm: ${n.action.replace(/_/g," ")}`,description:"This action will be audited. Provide a reason.",loading:f.isPending||y.isPending||v.isPending||b.isPending||N.isPending})]})})}function X5(t={}){return Mn({queryKey:["admin-tickets",t],queryFn:async({pageParam:s})=>await Yt("admin.list_tickets_v1",{p_filters:t,p_limit:30,p_cursor:s??null}),initialPageParam:null,getNextPageParam:s=>s.next_cursor??void 0,staleTime:3e4,refetchOnWindowFocus:!1})}function J5(){const t=Xe();return dt({mutationFn:({ticketId:s,adminId:r})=>Bs("admin.assign_ticket_v1",{p_ticket_id:s,p_admin_user_id:r}),onSuccess:()=>t.invalidateQueries({queryKey:["admin-tickets"]})})}function Z5(){const t=Xe();return dt({mutationFn:({ticketId:s,status:r,note:a})=>Bs("admin.update_ticket_status_v2",{p_ticket_id:s,p_status:r,p_note:a??null}),onSuccess:()=>t.invalidateQueries({queryKey:["admin-tickets"]})})}function Hv(t={}){return Mn({queryKey:["ai-outputs",t],queryFn:async({pageParam:s})=>await Yt("admin.list_ai_outputs_v1",{p_filters:t,p_limit:30,p_cursor:s??null}),initialPageParam:null,getNextPageParam:s=>s.next_cursor??void 0,staleTime:3e4,refetchOnWindowFocus:!1})}function Vv(){const t=Xe();return dt({mutationFn:({outputId:s,accept:r})=>Bs("admin.accept_ai_suggestion_v1",{p_ai_output_id:s,p_accept:r}),onSuccess:()=>{t.invalidateQueries({queryKey:["ai-outputs"]}),t.invalidateQueries({queryKey:["admin-tickets"]})}})}const eA=["open","in_progress","resolved","closed"],vc={urgent:"bg-red-100 text-red-800",high:"bg-orange-100 text-orange-800",normal:"bg-blue-100 text-blue-800",low:"bg-gray-100 text-gray-700"};function tA(){const{user:t}=Fe(),{toast:s}=hs(),[r,a]=x.useState("open"),[n,i]=x.useState(null),o=x.useMemo(()=>{const R={};return r&&(R.status=r),R},[r]),{data:c,fetchNextPage:l,hasNextPage:u,isFetchingNextPage:d,isLoading:p}=X5(o),{t:h}=Nt(),f=Z5(),y=J5(),v=Vv(),{data:b}=Hv({target_type:"ticket",status:"suggested"}),N=b?.pages.flatMap(R=>R.items)??[],A=c?.pages.flatMap(R=>R.items)??[],j=R=>N.find(S=>S.target_id===R),C=(R,S)=>{f.mutate({ticketId:R,status:S,note:`Status changed to ${S}`},{onSuccess:()=>s({title:`Ticket ${S}`})})},I=R=>{t?.id&&y.mutate({ticketId:R,adminId:t.id},{onSuccess:()=>s({title:"Ticket assigned to you"})})},k=(R,S)=>{v.mutate({outputId:R,accept:S},{onSuccess:()=>s({title:S?"Suggestion accepted":"Suggestion rejected"})})};return e.jsx(Oe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Support Tickets"})}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs(lt,{value:r,onValueChange:a,children:[e.jsx(it,{className:"w-36",children:e.jsx(ct,{placeholder:"Status"})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"all",children:"All Statuses"}),eA.map(R=>e.jsx(ge,{value:R,children:R.replace(/_/g," ")},R))]})]})}),e.jsxs("div",{className:"space-y-2",children:[p&&Array.from({length:5}).map((R,S)=>e.jsx(Re,{className:"h-20 w-full"},S)),!p&&A.length===0&&e.jsx(G,{children:e.jsx(Q,{className:"py-12 text-center text-muted-foreground",children:"No tickets found."})}),A.map(R=>{const S=j(R.id);return e.jsx(G,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>i(R),children:e.jsx(Q,{className:"py-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx(he,{variant:"outline",className:"text-xs",children:R.category}),e.jsx(he,{className:`text-xs ${vc[R.priority]||""}`,children:R.priority}),e.jsx(he,{variant:"secondary",className:"text-xs",children:R.status.replace(/_/g," ")}),S&&e.jsxs(he,{className:"bg-purple-100 text-purple-800 text-xs",children:[e.jsx(Js,{className:"h-3 w-3 mr-1 inline"}),"AI triaged"]})]}),e.jsx("p",{className:"text-sm truncate",children:R.message.slice(0,120)}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-muted-foreground",children:[R.role&&e.jsxs("span",{children:[e.jsx(Ps,{className:"inline h-3 w-3 mr-0.5"}),R.role]}),e.jsxs("span",{children:[e.jsx(vs,{className:"inline h-3 w-3 mr-0.5"}),new Date(R.created_at).toLocaleDateString()]}),R.assigned_admin&&e.jsxs("span",{children:["Assigned: ",R.assigned_admin.slice(0,8)]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[R.status==="open"&&e.jsx(z,{size:"sm",variant:"outline",onClick:T=>{T.stopPropagation(),C(R.id,"in_progress")},children:"Start"}),R.status==="in_progress"&&e.jsx(z,{size:"sm",variant:"outline",onClick:T=>{T.stopPropagation(),C(R.id,"resolved")},children:"Resolve"})]})]})})},R.id)})]}),u&&e.jsx("div",{className:"text-center",children:e.jsx(z,{variant:"outline",onClick:()=>l(),disabled:d,children:h(d?"common.loading":"common.loadMore")})}),e.jsx(zt,{open:!!n,onOpenChange:R=>!R&&i(null),children:n&&e.jsxs(It,{className:"sm:max-w-lg max-h-[80vh] overflow-y-auto",children:[e.jsx(Bt,{children:e.jsx($t,{children:"Ticket Detail"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(he,{variant:"outline",children:n.category}),e.jsx(he,{className:vc[n.priority]||"",children:n.priority}),e.jsx(he,{variant:"secondary",children:n.status})]}),e.jsx("p",{className:"text-sm",children:n.message}),e.jsxs("dl",{className:"text-xs space-y-1 text-muted-foreground",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{children:"Created by"}),e.jsx("dd",{children:n.created_by.slice(0,8)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{children:"Role"}),e.jsx("dd",{children:n.role||""})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{children:"Entity"}),e.jsx("dd",{children:n.entity_type?`${n.entity_type}/${n.entity_id?.slice(0,8)}`:""})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{children:"Created"}),e.jsx("dd",{children:new Date(n.created_at).toLocaleString()})]})]}),n.entity_type&&n.entity_id&&e.jsx(xt,{to:`/admin/entity/${n.entity_type}/${n.entity_id}`,children:e.jsx(z,{size:"sm",variant:"outline",className:"w-full",children:"View Entity 360"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{size:"sm",variant:"outline",onClick:()=>I(n.id),children:"Assign to me"}),n.status!=="closed"&&e.jsx(z,{size:"sm",onClick:()=>C(n.id,"closed"),children:"Close"})]}),(()=>{const R=j(n.id);return R?e.jsxs(e.Fragment,{children:[e.jsx(wa,{}),e.jsxs(G,{className:"border-purple-200",children:[e.jsx(je,{className:"py-2 px-3",children:e.jsxs(we,{className:"text-sm flex items-center gap-1",children:[e.jsx(Js,{className:"h-4 w-4 text-purple-600"})," AI Triage Suggestion"]})}),e.jsxs(Q,{className:"px-3 pb-3 text-sm space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Category:"}),e.jsx(he,{variant:"outline",children:R.output?.suggested_category})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Priority:"}),e.jsx(he,{className:vc[R.output?.suggested_priority]||"",children:R.output?.suggested_priority})]}),R.output?.suggested_actions&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Actions: "}),e.jsx("span",{children:R.output.suggested_actions.join(", ")})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Provider: ",R.provider," | Confidence: ",R.confidence??"N/A"]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs(z,{size:"sm",onClick:()=>k(R.id,!0),children:[e.jsx(ys,{className:"h-3 w-3 mr-1"})," Accept & Apply"]}),e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>k(R.id,!1),children:[e.jsx(Ur,{className:"h-3 w-3 mr-1"})," Reject"]})]})]})]})]}):null})()]})]})})]})})}const sA=["ticket","timeline","search_intent","voice_note"],rA=["suggested","accepted","rejected"],aA={suggested:"bg-yellow-100 text-yellow-800",accepted:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"};function nA(){const{toast:t}=hs(),[s,r]=x.useState("suggested"),[a,n]=x.useState(""),i=x.useMemo(()=>{const v={};return s&&(v.status=s),a&&(v.target_type=a),v},[s,a]),{data:o,fetchNextPage:c,hasNextPage:l,isFetchingNextPage:u,isLoading:d}=Hv(i),p=Vv(),{t:h}=Nt(),f=o?.pages.flatMap(v=>v.items)??[],y=(v,b)=>{p.mutate({outputId:v,accept:b},{onSuccess:()=>t({title:b?"Accepted":"Rejected"})})};return e.jsx(Oe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold",children:"AI Outputs Review"})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(lt,{value:s,onValueChange:r,children:[e.jsx(it,{className:"w-36",children:e.jsx(ct,{placeholder:"Status"})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"all",children:"All"}),rA.map(v=>e.jsx(ge,{value:v,children:v},v))]})]}),e.jsxs(lt,{value:a,onValueChange:n,children:[e.jsx(it,{className:"w-40",children:e.jsx(ct,{placeholder:"Type"})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"all",children:"All Types"}),sA.map(v=>e.jsx(ge,{value:v,children:v.replace(/_/g," ")},v))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[d&&Array.from({length:5}).map((v,b)=>e.jsx(Re,{className:"h-24 w-full"},b)),!d&&f.length===0&&e.jsx(G,{children:e.jsx(Q,{className:"py-12 text-center text-muted-foreground",children:"No AI outputs to review."})}),f.map(v=>e.jsx(G,{children:e.jsx(Q,{className:"py-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsx(Js,{className:"h-4 w-4 text-purple-500"}),e.jsx(he,{variant:"outline",className:"text-xs capitalize",children:v.target_type.replace(/_/g," ")}),e.jsx(he,{className:`text-xs ${aA[v.status]||""}`,children:v.status}),e.jsx(he,{variant:"secondary",className:"text-xs",children:v.provider}),v.confidence!=null&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Confidence: ",(v.confidence*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mb-1",children:["Target: ",v.target_id.slice(0,8)," | ",e.jsx(vs,{className:"inline h-3 w-3"})," ",new Date(v.created_at).toLocaleString()]}),e.jsxs("div",{className:"bg-muted/50 rounded p-2 text-sm",children:[v.target_type==="ticket"&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["Category: ",e.jsx("strong",{children:v.output?.suggested_category})]}),e.jsxs("p",{children:["Priority: ",e.jsx("strong",{children:v.output?.suggested_priority})]}),v.output?.suggested_actions&&e.jsxs("p",{children:["Actions: ",v.output.suggested_actions.join(", ")]})]}),v.target_type==="timeline"&&e.jsx("p",{className:"whitespace-pre-wrap",children:v.output?.summary||JSON.stringify(v.output).slice(0,200)}),v.target_type==="search_intent"&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["Query: ",e.jsx("em",{children:v.output?.original_query})]}),e.jsxs("p",{children:["Filters: ",JSON.stringify(v.output?.suggested_filters)]})]}),!["ticket","timeline","search_intent"].includes(v.target_type)&&e.jsx("pre",{className:"text-xs overflow-auto max-h-32",children:JSON.stringify(v.output,null,2)})]})]}),v.status==="suggested"&&e.jsxs("div",{className:"flex flex-col gap-1 flex-shrink-0",children:[e.jsxs(z,{size:"sm",onClick:()=>y(v.id,!0),children:[e.jsx(ys,{className:"h-3 w-3 mr-1"})," Accept"]}),e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>y(v.id,!1),children:[e.jsx(Ur,{className:"h-3 w-3 mr-1"})," Reject"]})]})]})})},v.id))]}),l&&e.jsx("div",{className:"text-center",children:e.jsx(z,{variant:"outline",onClick:()=>c(),disabled:u,children:h(u?"common.loading":"common.loadMore")})})]})})}function iA(){const[t,s]=x.useState(null),[r,a]=x.useState([]);return x.useEffect(()=>{(async()=>{try{const i=await(await fetch("/.netlify/functions/admin-jobs-summary",{credentials:"include"})).json();s(i.summary||{}),a(i.jobs||[])}catch(n){console.error("fetch jobs summary",n)}})()},[]),e.jsx(Oe,{title:"Jobs",children:e.jsx(Zs,{title:"Jobs",subtitle:"Background job queue",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Queued"}),e.jsx("div",{className:"text-xl font-semibold",children:t?.queued||0})]}),e.jsxs("div",{className:"p-4 border rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Running"}),e.jsx("div",{className:"text-xl font-semibold",children:t?.running||0})]}),e.jsxs("div",{className:"p-4 border rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Failed"}),e.jsx("div",{className:"text-xl font-semibold",children:t?.failed||0})]}),e.jsxs("div",{className:"p-4 border rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Dead"}),e.jsx("div",{className:"text-xl font-semibold",children:t?.dead||0})]})]}),e.jsx("div",{children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Attempts"}),e.jsx("th",{children:"Run At"}),e.jsx("th",{children:"Priority"}),e.jsx("th",{children:"Error"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:r.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-xs",children:n.id}),e.jsx("td",{children:n.job_type}),e.jsx("td",{children:n.status}),e.jsxs("td",{children:[n.attempts,"/",n.max_attempts]}),e.jsx("td",{children:new Date(n.run_at).toLocaleString()}),e.jsx("td",{children:n.priority}),e.jsx("td",{children:e.jsx("pre",{className:"text-xs",children:n.last_error})}),e.jsx("td",{children:e.jsx("button",{className:"px-2 py-1 border rounded",onClick:async()=>{try{await fetch("/.netlify/functions/admin-enqueue",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_type:n.job_type,payload:n.payload})}),alert("retry enqueued")}catch{alert("failed to enqueue")}},children:"Retry"})})]},n.id))})]})})]})})})}function oA(){const[t,s]=x.useState(null),[r,a]=x.useState(!0);return x.useEffect(()=>{(async()=>{a(!0);try{const i=await(await fetch("/.netlify/functions/admin-finance-summary")).json();s(i)}catch(n){console.error("finance fetch",n)}finally{a(!1)}})()},[]),e.jsx(Oe,{title:"Finance",children:e.jsx(Zs,{title:"Finance",subtitle:"Payments & settlement summary",children:e.jsxs("div",{className:"space-y-4",children:[r&&e.jsx("div",{children:"Loading..."}),!r&&t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded",children:[e.jsx("h4",{className:"text-sm text-muted-foreground",children:"Paid GMV (last 30d)"}),e.jsxs("div",{className:"text-2xl font-semibold",children:["",Number(t.paid_gmv||0).toLocaleString("en-IN")]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.paid_orders_count," paid orders"]})]}),e.jsxs("div",{className:"p-4 border rounded",children:[e.jsx("h4",{className:"text-sm text-muted-foreground",children:"Refunds"}),e.jsxs("div",{className:"text-2xl font-semibold",children:["",Number(t.refund_amount||0).toLocaleString("en-IN")]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.refund_count," refunds"]})]}),e.jsxs("div",{className:"p-4 border rounded",children:[e.jsx("h4",{className:"text-sm text-muted-foreground",children:"Payouts"}),e.jsxs("div",{className:"text-lg",children:["Pending KYC: ",t.payout_pending_kyc]}),e.jsxs("div",{className:"text-lg",children:["Queued: ",t.payout_queued]}),e.jsxs("div",{className:"text-lg",children:["Success: ",t.payout_success]})]})]}),!r&&!t&&e.jsx("div",{children:"No data"})]})})})}const lA=[{value:"",label:"All"},{value:"payment_mismatch",label:"Payment mismatches"},{value:"stale_payment",label:"Stale payments"},{value:"webhook_failed",label:"Webhook failures"},{value:"refund_pending_review",label:"Refunds"},{value:"payout_pending_kyc",label:"Pending KYC"},{value:"payout_eligible_queue",label:"Queued payouts"},{value:"payout_failed",label:"Payout failed"},{value:"high_risk_payment_activity",label:"High risk"}];function cA(){const[t,s]=x.useState(""),r=x.useMemo(()=>t?{item_type:t}:{},[t]),{data:a,fetchNextPage:n,hasNextPage:i,isFetchingNextPage:o,isLoading:c}=Uv(r),{t:l}=Nt(),u=a?.pages.flatMap(d=>d.items)??[];return e.jsx(Oe,{title:"Finance Ops",children:e.jsx(Zs,{title:"Finance Ops",subtitle:"Payments & KYC operational inbox",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(zn,{value:t,onValueChange:s,children:e.jsx(Ja,{className:"flex-wrap h-auto gap-1",children:lA.map(d=>e.jsx(Vs,{value:d.value,className:"text-xs",children:d.label},d.value))})}),e.jsxs("div",{children:[c&&Array.from({length:4}).map((d,p)=>e.jsx(G,{children:e.jsx(Q,{className:"py-4",children:e.jsx(Re,{className:"h-16 w-full"})})},p)),!c&&u.map(d=>e.jsx(G,{className:"mb-2",children:e.jsx(Q,{children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:d.item_type.replace(/_/g," ")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:d.summary})]}),e.jsxs("div",{className:"text-right text-xs",children:[e.jsxs("div",{children:[d.entity_type,"/",d.entity_id?.slice?.(0,8)]}),e.jsx("div",{className:"text-muted-foreground",children:new Date(d.updated_at).toLocaleString()})]})]})})},d.id)),i&&e.jsx("div",{className:"text-center",children:e.jsx(z,{variant:"outline",onClick:()=>n(),disabled:o,children:l(o?"common.loading":"common.loadMore")})})]})]})})})}function dA(){const[t,s]=x.useState([]);x.useEffect(()=>{(async()=>{try{const n=await Yt("admin.list_refund_requests_v1",{p_limit:200});s(n||[])}catch(n){console.error("list refunds",n)}})()},[]);async function r(n){try{await Yt("admin.approve_refund_v1",{p_refund_id:n}),s(i=>i.filter(o=>o.id!==n))}catch(i){console.error(i)}}async function a(n){try{await Yt("admin.reject_refund_v1",{p_refund_id:n,p_reason:"Rejected by ops"}),s(i=>i.filter(o=>o.id!==n))}catch(i){console.error(i)}}return e.jsx(Oe,{title:"Refunds",children:e.jsx(Zs,{title:"Refund Requests",subtitle:"Approve or reject refund requests",children:e.jsx("div",{className:"space-y-3",children:t.map(n=>e.jsx(G,{children:e.jsxs(Q,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Order: ",n.order_id]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Amount: ",n.amount,"  Status: ",n.status]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{onClick:()=>r(n.id),children:"Approve"}),e.jsx(z,{variant:"outline",onClick:()=>a(n.id),children:"Reject"})]})]})},n.id))})})})}function uA(){const[t,s]=x.useState([]);x.useEffect(()=>{(async()=>{try{const i=await Yt("admin.list_payout_jobs_v1",{p_limit:200});s(i||[])}catch(i){console.error("list payouts",i)}})()},[]);async function r(i){try{await Yt("admin.mark_payout_initiated_v1",{p_payout_job_id:i,p_reference_id:`manual:${Date.now()}`})}catch(o){console.error(o)}}async function a(i){try{await Yt("admin.mark_payout_success_v1",{p_payout_job_id:i,p_reference_id:`manual:${Date.now()}`})}catch(o){console.error(o)}}async function n(i){try{await Yt("admin.mark_payout_failed_v1",{p_payout_job_id:i,p_error:"manual failure"})}catch(o){console.error(o)}}return e.jsx(Oe,{title:"Payouts",children:e.jsx(Zs,{title:"Payout Jobs",subtitle:"Manage queued payouts",children:e.jsx("div",{className:"space-y-3",children:t.map(i=>e.jsx(G,{children:e.jsxs(Q,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["Order: ",i.order_id]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Farmer: ",i.farmer_id,"  Amount: ",i.amount]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{onClick:()=>r(i.id),children:"Mark Initiated"}),e.jsx(z,{onClick:()=>a(i.id),children:"Mark Success"}),e.jsx(z,{variant:"outline",onClick:()=>n(i.id),children:"Mark Failed"})]})]})},i.id))})})})}const eh=20;function mA(){const[t,s]=x.useState([]),[r,a]=x.useState(!0),[n,i]=x.useState([]),[o,c]=x.useState(null),[l,u]=x.useState(null),[d,p]=x.useState(null),[h,f]=x.useState(0),[y,v]=x.useState(null),[b,N]=x.useState({open:!1,disputeId:null}),{toast:A}=hs(),j=async()=>{try{const{data:k,error:R}=await W.from("admin_users").select("id, user_id, name").order("name");if(R)throw R;i(k||[])}catch(k){console.error("load admins err",k)}},C=async(k=0)=>{a(!0);try{let R=W.from("disputes").select("*").order("created_at",{ascending:!1});o&&(R=R.eq("status",o)),l&&(R=R.eq("category",l)),d&&(R=R.eq("entity_type",d));const S=k*eh,T=S+eh-1,{data:E,error:D}=await R.range(S,T);if(D)throw D;s(E||[]),f(k)}catch(R){console.error("load disputes err",R),A({title:"Failed to load disputes",description:R?.message||String(R)})}finally{a(!1)}};x.useEffect(()=>{j(),C(0)},[]),x.useEffect(()=>{C(0)},[o,l,d]);const I=async k=>{const R=prompt("Enter resolution (refund,no_refund,partial_refund,replacement,payout_hold,warning,ban):","no_refund");if(R)try{const{error:S}=await W.rpc("admin.set_dispute_status_v1",{p_dispute_id:k,p_status:"resolved",p_resolution:R,p_note:null});if(S)throw S;A({title:"Resolved"}),C(h)}catch(S){console.error(S),A({title:"Failed to resolve",description:S?.message||String(S)})}};return e.jsx(Oe,{children:e.jsx(Zs,{title:"Disputes",subtitle:"Manage disputes and hold payouts",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("select",{className:"border p-2 rounded",value:o??"",onChange:k=>c(k.target.value||null),children:[e.jsx("option",{value:"",children:"All statuses"}),e.jsx("option",{value:"open",children:"open"}),e.jsx("option",{value:"under_review",children:"under_review"}),e.jsx("option",{value:"resolved",children:"resolved"}),e.jsx("option",{value:"rejected",children:"rejected"}),e.jsx("option",{value:"closed",children:"closed"})]}),e.jsxs("select",{className:"border p-2 rounded",value:l??"",onChange:k=>u(k.target.value||null),children:[e.jsx("option",{value:"",children:"All categories"}),e.jsx("option",{value:"quality",children:"quality"}),e.jsx("option",{value:"delivery",children:"delivery"}),e.jsx("option",{value:"fraud",children:"fraud"}),e.jsx("option",{value:"refund",children:"refund"}),e.jsx("option",{value:"payout",children:"payout"}),e.jsx("option",{value:"behavior",children:"behavior"}),e.jsx("option",{value:"other",children:"other"})]}),e.jsxs("select",{className:"border p-2 rounded",value:d??"",onChange:k=>p(k.target.value||null),children:[e.jsx("option",{value:"",children:"All entities"}),e.jsx("option",{value:"order",children:"order"}),e.jsx("option",{value:"trip",children:"trip"}),e.jsx("option",{value:"payment",children:"payment"})]}),e.jsx("div",{className:"flex-1"}),e.jsx(z,{onClick:()=>C(0),children:"Refresh"})]}),r&&e.jsx("div",{children:"Loading..."}),!r&&t.length===0&&e.jsx(G,{children:e.jsx(Q,{children:"No disputes found"})}),e.jsx("div",{className:"grid gap-3",children:t.map(k=>e.jsxs(G,{children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:k.category}),e.jsx(he,{className:"text-xs",children:k.status})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(k.created_at).toLocaleString()})]})}),e.jsxs(Q,{children:[e.jsxs("div",{className:"mb-2 text-sm text-muted-foreground",children:["Entity: ",k.entity_type," ",k.entity_id]}),e.jsx("div",{className:"mb-3",children:k.description}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(z,{size:"sm",variant:"outline",onClick:()=>N({open:!0,disputeId:k.id}),children:"Assign"}),e.jsx(z,{size:"sm",variant:"default",onClick:()=>I(k.id),children:"Resolve"}),e.jsx(z,{size:"sm",variant:"ghost",onClick:()=>navigator.clipboard.writeText(k.id),children:"Copy ID"})]})]})]},k.id))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{disabled:h===0,onClick:()=>C(h-1),children:"Previous"}),e.jsx(z,{onClick:()=>C(h+1),children:"Next"})]})]})]})})})}const cn=({label:t,value:s})=>e.jsxs("div",{className:"p-3 border rounded bg-white shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-500",children:t}),e.jsx("div",{className:"text-2xl font-semibold",children:s??"-"})]}),hA=({alert:t,onChange:s})=>{const r=async()=>{await W.rpc("admin.alerts_ack_v1",{p_alert_id:t.id,p_ack_by:null}).catch(()=>{}),s?.()},a=async()=>{await W.rpc("admin.alerts_resolve_v1",{p_alert_id:t.id}).catch(()=>{}),s?.()};return e.jsxs("div",{className:"flex items-center justify-between p-2 border-b",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.rule_name}),e.jsx("div",{className:"text-sm text-gray-600",children:t.metadata?.metric?`${t.metadata.metric} = ${t.metadata.value}`:JSON.stringify(t.metadata)}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Severity: ",t.severity,"  Created: ",new Date(t.created_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-1 bg-yellow-500 text-white rounded",onClick:r,children:"Acknowledge"}),e.jsx("button",{className:"px-2 py-1 bg-green-600 text-white rounded",onClick:a,children:"Resolve"})]})]})};function pA(){const[t,s]=x.useState(null),[r,a]=x.useState([]),[n,i]=x.useState(!1),o=async()=>{i(!0);try{const{data:c}=await W.rpc("admin.system_health_snapshot_v1");s(c);const{data:l}=await W.from("audit.alerts").select("*").eq("status","open").order("created_at",{ascending:!1}).limit(50);a(l||[])}catch(c){console.error("system health load",c)}finally{i(!1)}};return x.useEffect(()=>{o()},[]),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"System Health"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsx(cn,{label:"Login Success (1h)",value:t?.login_success_count}),e.jsx(cn,{label:"Login Failures (1h)",value:t?.login_failure_count}),e.jsx(cn,{label:"Webhook Failures (1h)",value:t?.webhook_failure_count}),e.jsx(cn,{label:"Job Failures (1h)",value:t?.job_failure_count}),e.jsx(cn,{label:"Dead Jobs (1h)",value:t?.dead_jobs_count}),e.jsx(cn,{label:"Payout Queue",value:t?.payout_queue_count})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Open Alerts"}),e.jsx("div",{className:"border rounded bg-white",children:r.length===0?e.jsx("div",{className:"p-4 text-gray-500",children:"No open alerts"}):r.map(c=>e.jsx(hA,{alert:c,onChange:o},c.id))})]}),e.jsx("div",{children:e.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:o,disabled:n,children:n?"Refreshing...":"Refresh"})})]})}const fA=()=>{const{user:t}=Fe();return Mn({queryKey:["agent-tasks-infinite",t?.id],enabled:!!t?.id,queryFn:async({pageParam:s=null})=>{const r=await Yt("list_agent_tasks_compact_v1",{p_agent_id:t?.id,p_limit:24,p_cursor:s});return{items:r?.items||[],next_cursor:r?.next_cursor||null}},getNextPageParam:s=>s.next_cursor||void 0})},Pn="offlineQueue:v1";function xA(t,s){const r={id:crypto.randomUUID(),action_type:t,payload:s,created_at:new Date().toISOString()},a=JSON.parse(localStorage.getItem(Pn)||"[]");return a.push(r),localStorage.setItem(Pn,JSON.stringify(a)),window.dispatchEvent(new CustomEvent("offlineQueue.updated")),r.id}function yc(){return JSON.parse(localStorage.getItem(Pn)||"[]")}function gA(t){const r=JSON.parse(localStorage.getItem(Pn)||"[]").filter(a=>a.id!==t);localStorage.setItem(Pn,JSON.stringify(r)),window.dispatchEvent(new CustomEvent("offlineQueue.updated"))}async function vA(t){const s=JSON.parse(localStorage.getItem(Pn)||"[]");for(const r of s)try{await t(r)&&gA(r.id)}catch(a){console.warn("retry failed",a)}}function yA(){const[t,s]=x.useState(()=>yc().length);return x.useEffect(()=>{const r=()=>s(yc().length);return window.addEventListener("offlineQueue.updated",r),r(),()=>window.removeEventListener("offlineQueue.updated",r)},[]),{count:t,pending:yc,retryAll:vA}}function jA({open:t,onClose:s,taskId:r,farmerName:a,taskType:n}){const[i,o]=x.useState(0),[c,l]=x.useState(""),[u,d]=x.useState(!1),p=Pi(),{toast:h}=hs(),f=async()=>{d(!0);try{await p.mutateAsync({taskId:r,status:"completed",notes:c}),h({title:"Task completed"}),y()}catch{xA("complete_task",{taskId:r,status:"completed",notes:c}),h({title:"Saved offline",description:"Will sync when network is available."}),y()}finally{d(!1)}},y=()=>{o(0),l(""),s()};return e.jsx(zt,{open:t,onOpenChange:v=>!v&&y(),children:e.jsxs(It,{className:"sm:max-w-md",children:[e.jsx(Bt,{children:e.jsxs($t,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5 text-green-600"}),"Complete Task"]})}),a&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Farmer: ",a," | Task: ",n||"General"]}),e.jsx("div",{className:"flex gap-2 mb-2",children:[0,1].map(v=>e.jsx("div",{className:`h-1 flex-1 rounded ${v<=i?"bg-green-500":"bg-muted"}`},v))}),i===0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"notes",children:"Notes"}),e.jsx(zs,{id:"notes",value:c,onChange:v=>l(v.target.value),placeholder:"What did you observe? Any issues?",rows:4})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",size:"sm",disabled:!0,children:[e.jsx(dr,{className:"h-4 w-4 mr-1"})," Photo (optional)"]}),e.jsxs(z,{variant:"outline",size:"sm",disabled:!0,children:[e.jsx(Xo,{className:"h-4 w-4 mr-1"})," Voice note (optional)"]})]})]}),i===1&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium",children:"Review & Submit"}),e.jsxs("div",{className:"bg-muted/50 rounded p-3 text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," Completed"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",c||"(none)"]})]})]}),e.jsxs(br,{children:[i===0&&e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"outline",onClick:y,children:"Cancel"}),e.jsx(z,{onClick:()=>o(1),children:"Next"})]}),i===1&&e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"outline",onClick:()=>o(0),children:"Back"}),e.jsxs(z,{onClick:f,disabled:u,children:[u&&e.jsx(et,{className:"h-4 w-4 mr-1 animate-spin"}),"Submit"]})]})]})]})})}const bA={urgent:"bg-red-100 text-red-800",high:"bg-orange-100 text-orange-800",normal:"bg-blue-100 text-blue-800",low:"bg-gray-100 text-gray-700"};function wA(){const{user:t}=Fe(),s=Ut(),{toast:r}=hs(),{count:a}=yA(),[n,i]=x.useState(null),{data:o}=mu("agent"),{data:c,isLoading:l}=De({queryKey:["agent-dashboard",t?.id],queryFn:()=>Yt("agent_dashboard_v1"),enabled:!!t?.id,staleTime:3e4}),{data:u,isLoading:d}=fA(),p=u?.pages.flatMap(C=>C.items)??[],h=eu(),f=Pi();tu();const y=new Date().toISOString().slice(0,10),v=x.useMemo(()=>p.filter(C=>C.task_status==="completed"?!1:C.due_date?C.due_date<=y:C.task_status==="pending"||C.task_status==="in_progress"),[p,y]),b=v.filter(C=>C.due_date&&C.due_date<y),N=v.filter(C=>!C.due_date||C.due_date===y),A=C=>{f.mutate({taskId:C.id,status:"in_progress"},{onSuccess:()=>r({title:"Task started"})})},j=C=>{C.farmer?.id&&h.mutate({farmerId:C.farmer.id,taskId:C.id},{onSuccess:()=>r({title:"Visit started"})})};return e.jsx(Oe,{children:e.jsx($s,{title:"Today's Plan",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(bo,{className:"h-6 w-6"})," Today's Plan"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date().toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"})})]}),a>0&&e.jsxs(he,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(Hj,{className:"h-3 w-3"})," ",a," pending sync"]}),o!==void 0&&o.length===0&&e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>s("/agent/service-area"),className:"flex items-center gap-1 border-amber-300 text-amber-700 hover:bg-amber-50","aria-label":"Set up your service area",children:[e.jsx(We,{className:"h-3 w-3"})," Set up your service area"]})]}),l?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Array.from({length:4}).map((C,I)=>e.jsx(Re,{className:"h-20"},I))}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(G,{children:e.jsxs(Q,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:c?.assigned_farmers_count??0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Assigned Farmers"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:v.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tasks Today"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:b.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Overdue"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:c?.visits_today_count??0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Visits Today"})]})})]}),b.length>0&&e.jsxs(G,{className:"border-red-200",children:[e.jsx(je,{className:"py-3",children:e.jsxs(we,{className:"text-base flex items-center gap-2 text-red-700",children:[e.jsx(ks,{className:"h-4 w-4"})," Overdue (",b.length,")"]})}),e.jsx(Q,{className:"space-y-2",children:b.map(C=>e.jsx(th,{task:C,onStart:()=>A(C),onComplete:()=>i({id:C.id,farmerName:C.farmer?.full_name,taskType:C.task_type}),onVisit:()=>j(C),onNavigate:()=>C.farmer?.id&&s(`/agent/farmer/${C.farmer.id}`)},C.id))})]}),e.jsxs(G,{children:[e.jsx(je,{className:"py-3",children:e.jsx(we,{className:"text-base",children:N.length>0?`Due Today (${N.length})`:"No tasks due today"})}),e.jsxs(Q,{className:"space-y-2",children:[d&&Array.from({length:3}).map((C,I)=>e.jsx(Re,{className:"h-16"},I)),N.map(C=>e.jsx(th,{task:C,onStart:()=>A(C),onComplete:()=>i({id:C.id,farmerName:C.farmer?.full_name,taskType:C.task_type}),onVisit:()=>j(C),onNavigate:()=>C.farmer?.id&&s(`/agent/farmer/${C.farmer.id}`)},C.id)),!d&&N.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No tasks scheduled for today. Great work!"})]})]}),n&&e.jsx(jA,{open:!!n,onClose:()=>i(null),taskId:n.id,farmerName:n.farmerName,taskType:n.taskType})]})})})}function th({task:t,onStart:s,onComplete:r,onVisit:a,onNavigate:n}){return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border hover:bg-muted/30 transition-colors",children:[e.jsxs("div",{className:"min-w-0 cursor-pointer",onClick:n,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(he,{variant:"outline",className:"text-xs",children:t.task_type||"task"}),e.jsx(he,{className:`text-xs ${bA[t.priority]||"bg-gray-100"}`,children:t.priority||"normal"}),e.jsx(he,{variant:"secondary",className:"text-xs",children:t.task_status})]}),e.jsxs("p",{className:"text-sm mt-0.5",children:[t.farmer?.full_name||"Unknown farmer",t.crop?.crop_name?`  ${t.crop.crop_name}`:""]}),t.due_date&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1 mt-0.5",children:[e.jsx(vs,{className:"h-3 w-3"})," Due: ",t.due_date]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[t.task_status==="pending"&&e.jsx(z,{size:"sm",variant:"outline",onClick:s,children:e.jsx(Nj,{className:"h-4 w-4"})}),t.farmer?.id&&e.jsx(z,{size:"sm",variant:"outline",onClick:a,title:"Start visit",children:e.jsx(Xo,{className:"h-4 w-4"})}),e.jsx(z,{size:"sm",onClick:r,children:e.jsx(ys,{className:"h-4 w-4"})})]})]})}function NA(){const t=Xe();return dt({mutationFn:({category:s,entityType:r,entityId:a,message:n})=>Bs("create_support_ticket_v2",{p_category:s,p_entity_type:r??null,p_entity_id:a??null,p_message:n}),onSuccess:()=>{t.invalidateQueries({queryKey:["admin-tickets"]}),t.invalidateQueries({queryKey:["farmer-dashboard"]})}})}const _A={order:{pending:"Your order has been placed and is waiting for confirmation.",confirmed:"The buyer has confirmed the order. Prepare your produce.",ready_for_pickup:"Your produce is ready. A transporter will pick it up soon.",in_transit:"Your produce is on its way to the buyer.",delivered:"The buyer has received your produce. Payment will follow.",cancelled:"This order was cancelled."},transport:{requested:"You have requested transport. Waiting for a transporter to accept.",open:"Transport request is open and visible to transporters.",accepted:"A transporter has accepted your request.",in_progress:"Your produce is being transported.",completed:"Transport has been completed.",cancelled:"Transport request was cancelled."},listing:{draft:"Your listing is in draft. Publish it to make it visible to buyers.",pending:"Your listing is pending review by the platform.",approved:"Your listing is live and visible to buyers.",sold:"Your listing has been sold out.",expired:"Your listing has expired. Create a new one to sell."}};function kA(){const{user:t}=Fe(),{t:s}=Nt(),r=Ut(),{toast:a}=hs(),n=NA(),[i,o]=x.useState(null),[c,l]=x.useState(""),[u,d]=x.useState("other"),[p,h]=x.useState(null),{data:f,isLoading:y}=De({queryKey:["farmer-dashboard",t?.id],queryFn:()=>Yt("farmer_dashboard_v1"),enabled:!!t?.id,staleTime:3e4}),v=f?.recent_orders||[],b=f?.crops_by_status||{},N=f?.listings_by_status||{},A=f?.open_transport_requests_count??0,j=f?.active_orders_count??0,C=[];j>0&&C.push({icon:qt,label:"Active orders to manage",count:j,link:"/farmer/orders",type:"order"}),A>0&&C.push({icon:rt,label:"Open transport requests",count:A,link:"/farmer/transport",type:"transport"});const I=N.draft||0;I>0&&C.push({icon:tr,label:"Draft listings to publish",count:I,link:"/farmer/listings",type:"listing"});const k=b.harvest_ready||b.ready||0;k>0&&C.push({icon:tr,label:"Harvest-ready crops",count:k,link:"/farmer/crops",type:"listing"});const R=()=>{!i||!c.trim()||n.mutate({category:u,entityType:i.entityType,entityId:i.entityId,message:c},{onSuccess:()=>{a({title:"Help request sent",description:"Our team will look into this."}),o(null),l("")}})};return e.jsx(Oe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(bo,{className:"h-6 w-6"})," My Day"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date().toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"})})]}),y?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Re,{className:"h-20"}),e.jsx(Re,{className:"h-20"})]}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(G,{children:e.jsxs(Q,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:j}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active Orders"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:A}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Transport Requests"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:Object.values(N).reduce((S,T)=>S+T,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Listings"})]})}),e.jsx(G,{children:e.jsxs(Q,{className:"pt-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:Object.values(b).reduce((S,T)=>S+T,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Crops"})]})})]}),e.jsxs(G,{children:[e.jsx(je,{className:"py-3",children:e.jsx(we,{className:"text-base",children:"Pending Actions"})}),e.jsxs(Q,{className:"space-y-2",children:[C.length===0&&!y&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No pending actions today. You're all caught up!"}),C.map((S,T)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border hover:bg-muted/30 transition-colors cursor-pointer",onClick:()=>r(S.link),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S.icon,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:S.label}),e.jsx(he,{variant:"secondary",className:"text-xs",children:S.count})]})]}),e.jsx(z,{size:"sm",variant:"outline",children:"Go"})]},T))]})]}),v.length>0&&e.jsxs(G,{children:[e.jsx(je,{className:"py-3",children:e.jsx(we,{className:"text-base",children:"Recent Orders"})}),e.jsx(Q,{className:"space-y-2",children:v.slice(0,5).map(S=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border",children:[e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{variant:"outline",className:"text-xs",children:S.status}),e.jsxs("span",{className:"text-sm font-medium",children:["Rs. ",S.total_amount]})]})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(z,{size:"sm",variant:"ghost",title:"Explain status",onClick:()=>h({type:"order",status:S.status}),children:e.jsx(Dj,{className:"h-4 w-4"})}),e.jsx(z,{size:"sm",variant:"ghost",title:"Need help?",onClick:()=>o({entityType:"order",entityId:S.id}),children:e.jsx(cd,{className:"h-4 w-4"})})]})]},S.id))})]}),e.jsx(zt,{open:!!p,onOpenChange:S=>!S&&h(null),children:p&&e.jsxs(It,{className:"sm:max-w-sm",children:[e.jsx(Bt,{children:e.jsxs($t,{children:["Status: ",p.status]})}),e.jsx("p",{className:"text-sm",children:_A[p.type]?.[p.status]||"No explanation available for this status."}),e.jsx(br,{children:e.jsx(z,{onClick:()=>h(null),children:"Got it"})})]})}),e.jsx(zt,{open:!!i,onOpenChange:S=>!S&&o(null),children:i&&e.jsxs(It,{className:"sm:max-w-md",children:[e.jsx(Bt,{children:e.jsx($t,{children:"Need Help?"})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Describe your issue and our team will help you.",e.jsx("br",{}),"Entity: ",i.entityType,"/",i.entityId.slice(0,8)]}),e.jsxs(lt,{value:u,onValueChange:d,children:[e.jsx(it,{children:e.jsx(ct,{})}),e.jsxs(ot,{children:[e.jsx(ge,{value:"order",children:"Order issue"}),e.jsx(ge,{value:"trip",children:"Transport issue"}),e.jsx(ge,{value:"listing",children:"Listing issue"}),e.jsx(ge,{value:"payment",children:"Payment issue"}),e.jsx(ge,{value:"account",children:"Account issue"}),e.jsx(ge,{value:"other",children:"Other"})]})]}),e.jsx(zs,{value:c,onChange:S=>l(S.target.value),placeholder:"What do you need help with?",rows:3}),e.jsxs(br,{children:[e.jsx(z,{variant:"outline",onClick:()=>o(null),children:"Cancel"}),e.jsxs(z,{onClick:R,disabled:!c.trim()||n.isPending,children:[n.isPending&&e.jsx(et,{className:"h-4 w-4 mr-1 animate-spin"}),"Send"]})]})]})})]})})}function CA(){const[t,s]=x.useState([]),r=async()=>{const i=await Ts.actions.orderBy("createdAt").reverse().toArray();s(i)};x.useEffect(()=>{r()},[]);const a=async i=>{await Ts.actions.update(i,{nextRunAt:Date.now(),status:"queued"}),r()},n=async i=>{await Ts.actions.delete(i),r()};return e.jsx(Oe,{children:e.jsx(Zs,{title:"Pending Sync",subtitle:"Queued actions and uploads",children:e.jsxs("div",{className:"space-y-4",children:[t.map(i=>e.jsxs("div",{className:"p-3 border rounded flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[i.name,"  ",i.type]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Status: ",i.status,"  Retries: ",i.retryCount]}),i.lastError&&e.jsxs("div",{className:"text-xs text-red-600",children:["Error: ",i.lastError]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"outline",onClick:()=>a(i.id),children:"Retry"}),e.jsx(z,{variant:"destructive",onClick:()=>n(i.id),children:"Remove"})]})]},i.id)),t.length===0&&e.jsx("div",{className:"text-muted-foreground",children:"No pending actions"})]})})})}function SA(){const[t,s]=x.useState([]),r=async()=>{const i=await Ts.uploads.orderBy("createdAt").reverse().toArray();s(i)};x.useEffect(()=>{r()},[]);const a=async i=>{await Ts.uploads.update(i,{nextRunAt:Date.now(),status:"queued"}),r()},n=async i=>{await Ts.uploads.delete(i),r()};return e.jsx(Oe,{children:e.jsx(Zs,{title:"Uploads Manager",subtitle:"Queued uploads",children:e.jsxs("div",{className:"space-y-4",children:[t.map(i=>e.jsxs("div",{className:"p-3 border rounded flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[i.fileName," (",Math.round((i.size||0)/1024)," KB)"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Status: ",i.status,"  Retries: ",i.retryCount]}),i.lastError&&e.jsxs("div",{className:"text-xs text-red-600",children:["Error: ",i.lastError]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"outline",onClick:()=>a(i.id),children:"Retry"}),e.jsx(z,{variant:"destructive",onClick:()=>n(i.id),children:"Remove"})]})]},i.id)),t.length===0&&e.jsx("div",{className:"text-muted-foreground",children:"No queued uploads"})]})})})}const AA={farmer:"/farmer/dashboard",buyer:"/marketplace/dashboard",agent:"/agent/dashboard",logistics:"/logistics/dashboard",admin:"/admin/dashboard"};function TA(){const t=Ut();return x.useEffect(()=>{(async()=>{try{const{data:s}=await W.auth.getSession(),r=s.session;if(!r?.user){t("/login");return}const a=r.user.id,{data:n,error:i}=await W.from("user_roles").select("role").eq("user_id",a).maybeSingle();if(i&&console.error("role check error",i),!n||!n.role){t("/onboard/role-select");return}t(AA[n.role]||"/")}catch(s){console.error("OAuth callback handling error",s),t("/login")}})()},[t]),null}const PA="agrinext_recent_google_accounts";function MA(){try{return JSON.parse(localStorage.getItem(PA)||"[]")}catch{return[]}}function RA(){const t=MA(),s=async a=>{await W.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`,queryParams:{prompt:"select_account"}}})},r=async()=>{await W.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`,queryParams:{prompt:"select_account"}}})};return e.jsxs("div",{className:"p-4 max-w-md mx-auto",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Switch Google Account"}),t.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent accounts"}),t.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:a.avatarUrl||"/avatar-placeholder.png",alt:"",className:"w-8 h-8 rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.email}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(a.lastUsedAt).toLocaleString()})]})]}),e.jsx(z,{size:"sm",onClick:()=>s(a.email),children:"Use this account"})]},a.email)),e.jsx("div",{className:"mt-4",children:e.jsx(z,{onClick:r,children:"Add another Google account"})})]})}const DA=()=>{const[t,s]=x.useState("farmer"),r=Ut(),a=async()=>{const{data:n}=await W.auth.getSession();if(!n?.access_token)return;const i=await fetch("https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/complete-role-onboard",{method:"POST",headers:{Authorization:`Bearer ${n.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({role:t})}),o=await i.json();i.ok?r(t==="farmer"?"/farmer/dashboard":t==="buyer"?"/marketplace/dashboard":t==="agent"?"/agent/dashboard":"/"):alert(o.error?.message||"Failed to complete onboarding")};return e.jsxs("div",{className:"p-4 max-w-md mx-auto",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Choose your role"}),e.jsxs("select",{value:t,onChange:n=>s(n.target.value),className:"w-full p-2 border rounded mb-4",children:[e.jsx("option",{value:"farmer",children:"Farmer"}),e.jsx("option",{value:"agent",children:"Agent"}),e.jsx("option",{value:"buyer",children:"Buyer"}),e.jsx("option",{value:"logistics",children:"Transporter"})]}),e.jsx(z,{onClick:a,children:"Continue"})]})},EA={photo:"Photo Taken",fertilizer:"Fertilizer Applied",spray:"Pesticide Spray",irrigation:"Irrigation",weeding:"Weeding",disease:"Disease Observed",growth_update:"Growth Update",harvest_update:"Harvest Update",note:"Note",other:"Activity"},IA=()=>{const{traceCode:t}=Dn(),[s,r]=x.useState(null),[a,n]=x.useState(!0),[i,o]=x.useState(null);return x.useEffect(()=>{(async()=>{if(!t){o("Invalid trace code"),n(!1);return}try{const l=await fetch(`https://rmtkkzfzdmpjlqexrbme.supabase.co/functions/v1/public-listing-trace?trace_code=${encodeURIComponent(t)}`,{method:"GET",headers:{"Content-Type":"application/json"}}),u=await l.json();l.ok?(r(u),o(null)):(o(u.message||"This trace record is not available."),r(null))}catch(l){console.error("Error fetching trace data:",l),o("Unable to verify this product. Please try again later.")}finally{n(!1)}})()},[t]),a?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-white flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"h-8 w-8 animate-spin text-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Verifying product origin..."})]})}):i||!s?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-red-50 to-white flex items-center justify-center p-4",children:e.jsx(G,{className:"max-w-md w-full",children:e.jsxs(Q,{className:"pt-6 text-center",children:[e.jsx(rr,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Trace Record Not Available"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:i||"This product trace record is not available or has been unpublished."}),e.jsxs(xt,{to:"/",className:"text-green-600 hover:text-green-700 font-medium inline-flex items-center gap-1",children:["Visit AgriNext Gen ",e.jsx(ya,{className:"h-4 w-4"})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-white py-8 px-4",children:e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-green-100 text-green-800 px-4 py-2 rounded-full mb-4",children:[e.jsx(nm,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Verified Product"})]}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Product Transparency"}),e.jsxs("p",{className:"text-muted-foreground text-sm mt-1",children:["Trace Code: ",s.trace_code]})]}),e.jsxs(G,{className:"mb-4 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-500 p-6 text-white",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"bg-white/20 rounded-lg p-3",children:e.jsx(Ys,{className:"h-8 w-8"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:s.product_name}),e.jsx(he,{variant:"secondary",className:"mt-2 bg-white/20 text-white border-0",children:s.category})]})]})}),e.jsxs(Q,{className:"pt-6 space-y-4",children:[s.origin&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(We,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Origin"}),e.jsx("p",{className:"font-medium",children:s.origin})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(qt,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Quantity Available"}),e.jsxs("p",{className:"font-medium",children:[s.quantity," ",s.unit]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ms,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Listed On"}),e.jsx("p",{className:"font-medium",children:tt(new Date(s.listed_at),"PPP")})]})]}),s.inputs_summary&&e.jsxs(e.Fragment,{children:[e.jsx(wa,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Farming Inputs Used"}),e.jsx("p",{className:"text-sm bg-muted/50 p-3 rounded-lg",children:s.inputs_summary})]})]}),s.test_report_urls&&s.test_report_urls.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(wa,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Test Reports"}),e.jsx("div",{className:"space-y-2",children:s.test_report_urls.map((c,l)=>e.jsxs("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-green-600 hover:text-green-700 text-sm",children:[e.jsx(sr,{className:"h-4 w-4"}),"View Report ",l+1,e.jsx(ya,{className:"h-3 w-3"})]},l))})]})]})]})]}),s.crop&&e.jsx(G,{className:"mb-4",children:e.jsxs(Q,{className:"pt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ts,{className:"h-5 w-5 text-green-600"}),e.jsx("h3",{className:"font-semibold",children:"Crop Details"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Crop"}),e.jsx("p",{className:"font-medium",children:s.crop.crop_name})]}),s.crop.variety&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Variety"}),e.jsx("p",{className:"font-medium",children:s.crop.variety})]}),s.crop.sowing_date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Sown"}),e.jsx("p",{className:"font-medium",children:tt(new Date(s.crop.sowing_date),"PP")})]}),s.crop.harvest_date&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Expected Harvest"}),e.jsx("p",{className:"font-medium",children:tt(new Date(s.crop.harvest_date),"PP")})]}),s.crop.growth_stage&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Stage"}),e.jsx(he,{variant:"outline",children:s.crop.growth_stage})]}),s.crop.origin_district&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Farm Location"}),e.jsx("p",{className:"font-medium",children:[s.crop.origin_village,s.crop.origin_district].filter(Boolean).join(", ")})]})]})]})}),s.crop_timeline&&s.crop_timeline.length>0&&e.jsx(G,{className:"mb-4",children:e.jsxs(Q,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ms,{className:"h-5 w-5 text-green-600"}),e.jsx("h3",{className:"font-semibold",children:"Crop Timeline"})]}),e.jsx("div",{className:"space-y-3",children:s.crop_timeline.map((c,l)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500 mt-1.5"}),l<s.crop_timeline.length-1&&e.jsx("div",{className:"w-0.5 flex-1 bg-green-200 mt-1"})]}),e.jsxs("div",{className:"pb-3",children:[e.jsx("p",{className:"text-sm font-medium",children:EA[c.type]||c.type}),e.jsx("p",{className:"text-xs text-muted-foreground",children:tt(new Date(c.date),"PP")}),c.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:c.notes})]})]},l))})]})}),s.evidence?.stage_photos&&s.evidence.stage_photos.length>0&&e.jsx(G,{className:"mb-4",children:e.jsxs(Q,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(dr,{className:"h-5 w-5 text-green-600"}),e.jsx("h3",{className:"font-semibold",children:"Crop Stage Photos"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.evidence.stage_photos.map((c,l)=>e.jsxs("div",{className:"rounded-lg overflow-hidden border border-border",children:[e.jsx("img",{src:c.url,alt:`Stage ${l+1}`,className:"w-full h-32 object-cover"}),c.notes&&e.jsx("p",{className:"text-xs text-muted-foreground p-2",children:c.notes})]},l))})]})}),s.evidence?.input_photos&&s.evidence.input_photos.length>0&&e.jsx(G,{className:"mb-4",children:e.jsxs(Q,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Go,{className:"h-5 w-5 text-green-600"}),e.jsx("h3",{className:"font-semibold",children:"Input & Fertilizer Proof"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.evidence.input_photos.map((c,l)=>e.jsxs("div",{className:"rounded-lg overflow-hidden border border-border",children:[e.jsx("img",{src:c.url,alt:`Input ${l+1}`,className:"w-full h-32 object-cover"}),c.notes&&e.jsx("p",{className:"text-xs text-muted-foreground p-2",children:c.notes})]},l))})]})}),s.evidence?.soil_reports&&s.evidence.soil_reports.length>0&&e.jsx(G,{className:"mb-4",children:e.jsxs(Q,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(sr,{className:"h-5 w-5 text-green-600"}),e.jsx("h3",{className:"font-semibold",children:"Soil Test Reports"})]}),e.jsx("div",{className:"space-y-2",children:s.evidence.soil_reports.map((c,l)=>e.jsxs("a",{href:c.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 rounded-lg border border-border hover:bg-muted/30 transition-colors",children:[e.jsx(sr,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Soil Report ",l+1]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:tt(new Date(c.date),"PP")})]}),e.jsx(ya,{className:"h-4 w-4 text-muted-foreground"})]},l))})]})}),s.geo_verified&&e.jsx(G,{className:"mb-4 border-blue-200 bg-blue-50",children:e.jsxs(Q,{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-800",children:[e.jsx(We,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Geo-verified at farm level"})]}),e.jsx("p",{className:"text-xs text-center text-blue-700 mt-1",children:"Farm location has been verified via GPS"})]})}),e.jsx(G,{className:"bg-green-50 border-green-200",children:e.jsxs(Q,{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-800",children:[e.jsx(nm,{className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Verified on ",s.platform]})]}),e.jsx("p",{className:"text-xs text-center text-green-700 mt-2",children:"This product listing has been verified for authenticity"})]})}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs(xt,{to:"/",className:"text-muted-foreground hover:text-foreground text-sm inline-flex items-center gap-1",children:["Learn more about AgriNext Gen ",e.jsx(ya,{className:"h-3 w-3"})]})})]})})},OA=["agent-tasks","today-tasks","agent-dashboard-stats","dashboard","entity-360","get_timeline_v1"],Kv={async persist(t){try{const s=t.getQueryCache().getAll(),r=[];s.forEach(a=>{const n=a.queryKey;if(!(!n||n.length===0)&&OA.includes(n[0])){const i=t.getQueryData(n);r.push({key:n,state:i})}}),await Ts.cache_meta.put({key:"queries",value:r})}catch(s){console.error("persist error",s)}},async restore(){try{return(await Ts.cache_meta.get("queries"))?.value||[]}catch(t){return console.error("restore error",t),[]}}},zo=new yy;(async function(){try{const s=await Kv.restore();s?.length&&s.forEach(({key:r,state:a})=>{try{zo.setQueryData(r,a)}catch{}})}catch{}})();let sh=null;zo.getQueryCache().subscribe(()=>{clearTimeout(sh),sh=setTimeout(()=>Kv.persist(zo),2e3)});const FA=()=>e.jsx(jy,{client:zo,children:e.jsx(Mb,{children:e.jsx(zb,{children:e.jsxs(Cb,{children:[e.jsx(A0,{}),e.jsx(ib,{}),e.jsx(wy,{children:e.jsxs(Ny,{children:[e.jsx(Le,{path:"/",element:e.jsx(tw,{})}),e.jsx(Le,{path:"/login",element:e.jsx(lw,{})}),e.jsx(Le,{path:"/signup",element:e.jsx(dw,{})}),e.jsx(Le,{path:"/auth/callback",element:e.jsx(TA,{})}),e.jsx(Le,{path:"/account/switch",element:e.jsx(RA,{})}),null,e.jsx(Le,{path:"/about",element:e.jsx(hw,{})}),e.jsx(Le,{path:"/contact",element:e.jsx(fw,{})}),e.jsx(Le,{path:"/trace/listing/:traceCode",element:e.jsx(IA,{})}),e.jsx(Le,{path:"/marketplace",element:e.jsx(ea,{to:"/login",replace:!0})}),e.jsx(Le,{path:"/farmer",element:e.jsx(ea,{to:"/farmer/dashboard",replace:!0})}),e.jsx(Le,{path:"/buyer",element:e.jsx(ea,{to:"/marketplace/dashboard",replace:!0})}),e.jsx(Le,{path:"/agent",element:e.jsx(ea,{to:"/agent/dashboard",replace:!0})}),e.jsx(Le,{path:"/admin",element:e.jsx(ea,{to:"/admin/dashboard",replace:!0})}),e.jsx(Le,{path:"/farmer/my-day",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(kA,{})})}),e.jsx(Le,{path:"/farmer/dashboard",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(pC,{})})}),e.jsx(Le,{path:"/farmer/crops",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(pS,{})})}),e.jsx(Le,{path:"/farmer/crops/:cropId",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(OS,{})})}),e.jsx(Le,{path:"/farmer/farmlands",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(w4,{})})}),e.jsx(Le,{path:"/farmer/transport",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(N4,{})})}),e.jsx(Le,{path:"/farmer/listings",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(YC,{})})}),e.jsx(Le,{path:"/farmer/orders",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(GC,{})})}),e.jsx(Le,{path:"/farmer/earnings",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(ZC,{})})}),e.jsx(Le,{path:"/farmer/notifications",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(_4,{})})}),e.jsx(Le,{path:"/farmer/settings",element:e.jsx(Je,{allowedRoles:["farmer"],children:e.jsx(T4,{})})}),e.jsx(Le,{path:"/agent/today",element:e.jsx(Je,{allowedRoles:["agent"],children:e.jsx(wA,{})})}),e.jsx(Le,{path:"/agent/dashboard",element:e.jsx(Je,{allowedRoles:["agent"],children:e.jsx(U4,{})})}),e.jsx(Le,{path:"/agent/tasks",element:e.jsx(Je,{allowedRoles:["agent"],children:e.jsx(J4,{})})}),e.jsx(Le,{path:"/agent/farmers",element:e.jsx(Je,{allowedRoles:["agent"],children:e.jsx(Z4,{})})}),e.jsx(Le,{path:"/agent/my-farmers",element:e.jsx(Je,{allowedRoles:["agent"],children:e.jsx(e3,{})})}),e.jsx(Le,{path:"/agent/farmer/:farmerId",element:e.jsx(Je,{allowedRoles:["agent"],children:e.jsx(o3,{})})}),e.jsx(Le,{path:"/agent/transport",element:e.jsx(Je,{allowedRoles:["agent"],children:e.jsx(c3,{})})}),e.jsx(Le,{path:"/agent/profile",element:e.jsx(Je,{allowedRoles:["agent"],children:e.jsx(d3,{})})}),e.jsx(Le,{path:"/agent/service-area",element:e.jsx(Je,{allowedRoles:["agent"],children:e.jsx(u3,{})})}),e.jsx(Le,{path:"/logistics",element:e.jsx(ea,{to:"/logistics/dashboard",replace:!0})}),e.jsx(Le,{path:"/logistics/dashboard",element:e.jsx(Je,{allowedRoles:["logistics"],children:e.jsx(v3,{})})}),e.jsx(Le,{path:"/logistics/loads",element:e.jsx(Je,{allowedRoles:["logistics"],children:e.jsx(k3,{})})}),e.jsx(Le,{path:"/logistics/trips",element:e.jsx(Je,{allowedRoles:["logistics"],children:e.jsx(S3,{})})}),e.jsx(Le,{path:"/logistics/completed",element:e.jsx(Je,{allowedRoles:["logistics"],children:e.jsx(A3,{})})}),e.jsx(Le,{path:"/logistics/vehicles",element:e.jsx(Je,{allowedRoles:["logistics"],children:e.jsx(P3,{})})}),e.jsx(Le,{path:"/logistics/trip/:id",element:e.jsx(Je,{allowedRoles:["logistics"],children:e.jsx(F3,{})})}),e.jsx(Le,{path:"/logistics/profile",element:e.jsx(Je,{allowedRoles:["logistics"],children:e.jsx(q3,{})})}),e.jsx(Le,{path:"/logistics/service-area",element:e.jsx(Je,{allowedRoles:["logistics"],children:e.jsx(z3,{})})}),e.jsx(Le,{path:"/marketplace/dashboard",element:e.jsx(Je,{allowedRoles:["buyer"],children:e.jsx(W3,{})})}),e.jsx(Le,{path:"/marketplace/browse",element:e.jsx(Je,{allowedRoles:["buyer"],children:e.jsx(Q3,{})})}),e.jsx(Le,{path:"/marketplace/product/:id",element:e.jsx(Je,{allowedRoles:["buyer"],children:e.jsx(J3,{})})}),e.jsx(Le,{path:"/marketplace/orders",element:e.jsx(Je,{allowedRoles:["buyer"],children:e.jsx(s5,{})})}),e.jsx(Le,{path:"/marketplace/profile",element:e.jsx(Je,{allowedRoles:["buyer"],children:e.jsx(a5,{})})}),e.jsx(Le,{path:"/onboard/role-select",element:e.jsx(DA,{})}),e.jsx(Le,{path:"/admin/dashboard",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(x5,{})})}),e.jsx(Le,{path:"/admin/farmers",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(g5,{})})}),e.jsx(Le,{path:"/admin/agents",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(v5,{})})}),e.jsx(Le,{path:"/admin/transporters",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(y5,{})})}),e.jsx(Le,{path:"/admin/buyers",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(j5,{})})}),e.jsx(Le,{path:"/admin/crops",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(b5,{})})}),e.jsx(Le,{path:"/admin/transport",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(w5,{})})}),e.jsx(Le,{path:"/admin/orders",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(N5,{})})}),e.jsx(Le,{path:"/admin/ai-console",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(k5,{})})}),e.jsx(Le,{path:"/admin/seed-data",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(C5,{})})}),e.jsx(Le,{path:"/admin/data-health",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(A5,{})})}),e.jsx(Le,{path:"/admin/mysuru-demo",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(S5,{})})}),e.jsx(Le,{path:"/admin/pending-updates",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(T5,{})})}),e.jsx(Le,{path:"/admin/ops",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(E5,{})})}),e.jsx(Le,{path:"/admin/entity/:type/:id",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(Q5,{})})}),e.jsx(Le,{path:"/admin/disputes",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(mA,{})})}),e.jsx(Le,{path:"/admin/system-health",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(pA,{})})}),e.jsx(Le,{path:"/pending-sync",element:e.jsx(Je,{allowedRoles:["agent","farmer","buyer","logistics"],children:e.jsx(CA,{})})}),e.jsx(Le,{path:"/uploads-manager",element:e.jsx(Je,{allowedRoles:["agent","farmer","buyer","logistics"],children:e.jsx(SA,{})})}),e.jsx(Le,{path:"/admin/tickets",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(tA,{})})}),e.jsx(Le,{path:"/admin/ai-review",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(nA,{})})}),e.jsx(Le,{path:"/admin/jobs",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(iA,{})})}),e.jsx(Le,{path:"/admin/finance",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(oA,{})})}),e.jsx(Le,{path:"/admin/finance/ops",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(cA,{})})}),e.jsx(Le,{path:"/admin/finance/refunds",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(dA,{})})}),e.jsx(Le,{path:"/admin/finance/payouts",element:e.jsx(Je,{allowedRoles:["admin"],children:e.jsx(uA,{})})}),e.jsx(Le,{path:"*",element:e.jsx(xw,{})})]})})]})})})});Ch(document.getElementById("root")).render(e.jsx(FA,{}));
